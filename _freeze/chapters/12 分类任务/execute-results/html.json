{
  "hash": "9e7c4b3a40ffee5de53361117accaf4a",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"12 分类任务\"\nformat: html\neditor: visual\n---\n\n\n\n## 分类问题导读\n\n分类问题是机器学习中最常见的任务之一，广泛应用于物种分类、医疗诊断、客户分类等领域。本章将通过鸢尾花分类案例，完整展示多分类问题的解决方案，涵盖数据探索、特征工程、多种分类算法比较、模型评估等关键环节。\n\n## 12.1 Benchmark\n\nmlr3提供了强大的Benchmark功能，可以系统性地比较多个学习器在多个任务上的性能。\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(mlr3)\nlibrary(mlr3verse)\nlibrary(mlr3pipelines)\nlibrary(mlr3tuning)\nlibrary(data.table)\nlibrary(ggplot2)\nlibrary(corrplot)\nlibrary(gridExtra)\nlibrary(patchwork)\nlibrary(paradox)\n# 查看mlr包支持的学习算法\nmlr_learners\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n<DictionaryLearner> with 51 stored values\nKeys: classif.cv_glmnet, classif.debug, classif.featureless,\n  classif.glmnet, classif.kknn, classif.lda, classif.log_reg,\n  classif.multinom, classif.naive_bayes, classif.nnet, classif.qda,\n  classif.ranger, classif.rpart, classif.svm, classif.xgboost,\n  clust.agnes, clust.ap, clust.bico, clust.birch, clust.cmeans,\n  clust.cobweb, clust.dbscan, clust.dbscan_fpc, clust.diana, clust.em,\n  clust.fanny, clust.featureless, clust.ff, clust.hclust,\n  clust.hdbscan, clust.kkmeans, clust.kmeans, clust.MBatchKMeans,\n  clust.mclust, clust.meanshift, clust.optics, clust.pam,\n  clust.SimpleKMeans, clust.xmeans, regr.cv_glmnet, regr.debug,\n  regr.featureless, regr.glmnet, regr.kknn, regr.km, regr.lm,\n  regr.nnet, regr.ranger, regr.rpart, regr.svm, regr.xgboost\n```\n\n\n:::\n:::\n\n\n加载数据，建立任务\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 创建多个任务（不同特征子集）\ndata(\"Ionosphere\", package = \"mlbench\")\nIonosphere_data <- as.data.table(Ionosphere)\nIonosphere_data=Ionosphere_data[, -c(1, 2)]\nstr(Ionosphere_data )\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nClasses 'data.table' and 'data.frame':\t351 obs. of  33 variables:\n $ V3   : num  0.995 1 1 1 1 ...\n $ V4   : num  -0.0589 -0.1883 -0.0336 -0.4516 -0.024 ...\n $ V5   : num  0.852 0.93 1 1 0.941 ...\n $ V6   : num  0.02306 -0.36156 0.00485 1 0.06531 ...\n $ V7   : num  0.834 -0.109 1 0.712 0.921 ...\n $ V8   : num  -0.377 -0.936 -0.121 -1 -0.233 ...\n $ V9   : num  1 1 0.89 0 0.772 ...\n $ V10  : num  0.0376 -0.0455 0.012 0 -0.164 ...\n $ V11  : num  0.852 0.509 0.731 0 0.528 ...\n $ V12  : num  -0.1776 -0.6774 0.0535 0 -0.2028 ...\n $ V13  : num  0.598 0.344 0.854 0 0.564 ...\n $ V14  : num  -0.44945 -0.69707 0.00827 0 -0.00712 ...\n $ V15  : num  0.605 -0.517 0.546 -1 0.344 ...\n $ V16  : num  -0.38223 -0.97515 0.00299 0.14516 -0.27457 ...\n $ V17  : num  0.844 0.055 0.838 0.541 0.529 ...\n $ V18  : num  -0.385 -0.622 -0.136 -0.393 -0.218 ...\n $ V19  : num  0.582 0.331 0.755 -1 0.451 ...\n $ V20  : num  -0.3219 -1 -0.0854 -0.5447 -0.1781 ...\n $ V21  : num  0.5697 -0.1315 0.7089 -0.6997 0.0598 ...\n $ V22  : num  -0.297 -0.453 -0.275 1 -0.356 ...\n $ V23  : num  0.3695 -0.1806 0.4339 0 0.0231 ...\n $ V24  : num  -0.474 -0.357 -0.121 0 -0.529 ...\n $ V25  : num  0.5681 -0.2033 0.5753 1 0.0329 ...\n $ V26  : num  -0.512 -0.266 -0.402 0.907 -0.652 ...\n $ V27  : num  0.411 -0.205 0.59 0.516 0.133 ...\n $ V28  : num  -0.462 -0.184 -0.221 1 -0.532 ...\n $ V29  : num  0.2127 -0.1904 0.431 1 0.0243 ...\n $ V30  : num  -0.341 -0.116 -0.174 -0.201 -0.622 ...\n $ V31  : num  0.4227 -0.1663 0.6044 0.2568 -0.0571 ...\n $ V32  : num  -0.5449 -0.0629 -0.2418 1 -0.5957 ...\n $ V33  : num  0.1864 -0.1374 0.5605 -0.3238 -0.0461 ...\n $ V34  : num  -0.453 -0.0245 -0.3824 1 -0.657 ...\n $ Class: Factor w/ 2 levels \"bad\",\"good\": 2 1 2 1 2 1 2 1 2 1 ...\n - attr(*, \".internal.selfref\")=<externalptr> \n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"\\n缺失值检查:\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n缺失值检查:\n```\n\n\n:::\n\n```{.r .cell-code}\nmissing_counts <- colSums(is.na(Ionosphere_data))\nprint(missing_counts)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   V3    V4    V5    V6    V7    V8    V9   V10   V11   V12   V13   V14   V15 \n    0     0     0     0     0     0     0     0     0     0     0     0     0 \n  V16   V17   V18   V19   V20   V21   V22   V23   V24   V25   V26   V27   V28 \n    0     0     0     0     0     0     0     0     0     0     0     0     0 \n  V29   V30   V31   V32   V33   V34 Class \n    0     0     0     0     0     0     0 \n```\n\n\n:::\n\n```{.r .cell-code}\ndata(\"Sonar\", package = \"mlbench\")\nsonar_data <- as.data.table(Sonar)\ncat(\"\\n缺失值检查:\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n缺失值检查:\n```\n\n\n:::\n\n```{.r .cell-code}\nmissing_sonar <- colSums(is.na(sonar_data)) \nprint(missing_sonar)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   V1    V2    V3    V4    V5    V6    V7    V8    V9   V10   V11   V12   V13 \n    0     0     0     0     0     0     0     0     0     0     0     0     0 \n  V14   V15   V16   V17   V18   V19   V20   V21   V22   V23   V24   V25   V26 \n    0     0     0     0     0     0     0     0     0     0     0     0     0 \n  V27   V28   V29   V30   V31   V32   V33   V34   V35   V36   V37   V38   V39 \n    0     0     0     0     0     0     0     0     0     0     0     0     0 \n  V40   V41   V42   V43   V44   V45   V46   V47   V48   V49   V50   V51   V52 \n    0     0     0     0     0     0     0     0     0     0     0     0     0 \n  V53   V54   V55   V56   V57   V58   V59   V60 Class \n    0     0     0     0     0     0     0     0     0 \n```\n\n\n:::\n\n```{.r .cell-code}\nstr(sonar_data)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nClasses 'data.table' and 'data.frame':\t208 obs. of  61 variables:\n $ V1   : num  0.02 0.0453 0.0262 0.01 0.0762 0.0286 0.0317 0.0519 0.0223 0.0164 ...\n $ V2   : num  0.0371 0.0523 0.0582 0.0171 0.0666 0.0453 0.0956 0.0548 0.0375 0.0173 ...\n $ V3   : num  0.0428 0.0843 0.1099 0.0623 0.0481 ...\n $ V4   : num  0.0207 0.0689 0.1083 0.0205 0.0394 ...\n $ V5   : num  0.0954 0.1183 0.0974 0.0205 0.059 ...\n $ V6   : num  0.0986 0.2583 0.228 0.0368 0.0649 ...\n $ V7   : num  0.154 0.216 0.243 0.11 0.121 ...\n $ V8   : num  0.16 0.348 0.377 0.128 0.247 ...\n $ V9   : num  0.3109 0.3337 0.5598 0.0598 0.3564 ...\n $ V10  : num  0.211 0.287 0.619 0.126 0.446 ...\n $ V11  : num  0.1609 0.4918 0.6333 0.0881 0.4152 ...\n $ V12  : num  0.158 0.655 0.706 0.199 0.395 ...\n $ V13  : num  0.2238 0.6919 0.5544 0.0184 0.4256 ...\n $ V14  : num  0.0645 0.7797 0.532 0.2261 0.4135 ...\n $ V15  : num  0.066 0.746 0.648 0.173 0.453 ...\n $ V16  : num  0.227 0.944 0.693 0.213 0.533 ...\n $ V17  : num  0.31 1 0.6759 0.0693 0.7306 ...\n $ V18  : num  0.3 0.887 0.755 0.228 0.619 ...\n $ V19  : num  0.508 0.802 0.893 0.406 0.203 ...\n $ V20  : num  0.48 0.782 0.862 0.397 0.464 ...\n $ V21  : num  0.578 0.521 0.797 0.274 0.415 ...\n $ V22  : num  0.507 0.405 0.674 0.369 0.429 ...\n $ V23  : num  0.433 0.396 0.429 0.556 0.573 ...\n $ V24  : num  0.555 0.391 0.365 0.485 0.54 ...\n $ V25  : num  0.671 0.325 0.533 0.314 0.316 ...\n $ V26  : num  0.641 0.32 0.241 0.533 0.229 ...\n $ V27  : num  0.71 0.327 0.507 0.526 0.7 ...\n $ V28  : num  0.808 0.277 0.853 0.252 1 ...\n $ V29  : num  0.679 0.442 0.604 0.209 0.726 ...\n $ V30  : num  0.386 0.203 0.851 0.356 0.472 ...\n $ V31  : num  0.131 0.379 0.851 0.626 0.51 ...\n $ V32  : num  0.26 0.295 0.504 0.734 0.546 ...\n $ V33  : num  0.512 0.198 0.186 0.612 0.288 ...\n $ V34  : num  0.7547 0.2341 0.2709 0.3497 0.0981 ...\n $ V35  : num  0.854 0.131 0.423 0.395 0.195 ...\n $ V36  : num  0.851 0.418 0.304 0.301 0.418 ...\n $ V37  : num  0.669 0.384 0.612 0.541 0.46 ...\n $ V38  : num  0.61 0.106 0.676 0.881 0.322 ...\n $ V39  : num  0.494 0.184 0.537 0.986 0.283 ...\n $ V40  : num  0.274 0.197 0.472 0.917 0.243 ...\n $ V41  : num  0.051 0.167 0.465 0.612 0.198 ...\n $ V42  : num  0.2834 0.0583 0.2587 0.5006 0.2444 ...\n $ V43  : num  0.282 0.14 0.213 0.321 0.185 ...\n $ V44  : num  0.4256 0.1628 0.2222 0.3202 0.0841 ...\n $ V45  : num  0.2641 0.0621 0.2111 0.4295 0.0692 ...\n $ V46  : num  0.1386 0.0203 0.0176 0.3654 0.0528 ...\n $ V47  : num  0.1051 0.053 0.1348 0.2655 0.0357 ...\n $ V48  : num  0.1343 0.0742 0.0744 0.1576 0.0085 ...\n $ V49  : num  0.0383 0.0409 0.013 0.0681 0.023 0.0264 0.0507 0.0285 0.0777 0.0092 ...\n $ V50  : num  0.0324 0.0061 0.0106 0.0294 0.0046 0.0081 0.0159 0.0178 0.0439 0.0198 ...\n $ V51  : num  0.0232 0.0125 0.0033 0.0241 0.0156 0.0104 0.0195 0.0052 0.0061 0.0118 ...\n $ V52  : num  0.0027 0.0084 0.0232 0.0121 0.0031 0.0045 0.0201 0.0081 0.0145 0.009 ...\n $ V53  : num  0.0065 0.0089 0.0166 0.0036 0.0054 0.0014 0.0248 0.012 0.0128 0.0223 ...\n $ V54  : num  0.0159 0.0048 0.0095 0.015 0.0105 0.0038 0.0131 0.0045 0.0145 0.0179 ...\n $ V55  : num  0.0072 0.0094 0.018 0.0085 0.011 0.0013 0.007 0.0121 0.0058 0.0084 ...\n $ V56  : num  0.0167 0.0191 0.0244 0.0073 0.0015 0.0089 0.0138 0.0097 0.0049 0.0068 ...\n $ V57  : num  0.018 0.014 0.0316 0.005 0.0072 0.0057 0.0092 0.0085 0.0065 0.0032 ...\n $ V58  : num  0.0084 0.0049 0.0164 0.0044 0.0048 0.0027 0.0143 0.0047 0.0093 0.0035 ...\n $ V59  : num  0.009 0.0052 0.0095 0.004 0.0107 0.0051 0.0036 0.0048 0.0059 0.0056 ...\n $ V60  : num  0.0032 0.0044 0.0078 0.0117 0.0094 0.0062 0.0103 0.0053 0.0022 0.004 ...\n $ Class: Factor w/ 2 levels \"M\",\"R\": 2 2 2 2 2 2 2 2 2 2 ...\n - attr(*, \".internal.selfref\")=<externalptr> \n```\n\n\n:::\n\n```{.r .cell-code}\ntask_Ionosphere <- as_task_classif(Ionosphere_data, target = \"Class\", id = \"Ionosphere\")\n\ntask_sonar <- as_task_classif(sonar_data, target = \"Class\", id = \"sonar\")\n\ntasks = list(task_Ionosphere, task_sonar)\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 定义学习器\nlearners_extended <- list(\n  lrn(\"classif.ranger\", id = \"random_forest\", predict_type = \"prob\"),\n  lrn(\"classif.xgboost\", id = \"xgboost\", predict_type = \"prob\"),\n  lrn(\"classif.svm\", id = \"svm\", predict_type = \"prob\"),\n  lrn(\"classif.kknn\", id = \"knn\", predict_type = \"prob\"),\n  lrn(\"classif.naive_bayes\", id = \"naive_bayes\", predict_type = \"prob\"),\n  lrn(\"classif.rpart\", id = \"decision_tree\", predict_type = \"prob\")\n)\n\n# 设置不同的重采样策略\nresamplings <- list(\n  cv5 = rsmp(\"cv\", folds = 5),\n  cv10 = rsmp(\"cv\", folds = 10),\n  holdout = rsmp(\"holdout\", ratio = 0.7),\n  bootstrap = rsmp(\"bootstrap\", repeats = 5)\n)\n\n# 创建Benchmark设计\ndesign_extended <- benchmark_grid(\n  tasks = tasks,\n  learners = learners_extended,\n  resamplings = resamplings[1]  # 使用5折交叉验证以节省时间\n)\n\n# 执行Benchmark\ncat(\"开始扩展Benchmark分析...\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n开始扩展Benchmark分析...\n```\n\n\n:::\n\n```{.r .cell-code}\nbmr_extended <- benchmark(design_extended, store_models = TRUE)\n\n# 性能汇总\ncat(\"\\n=== Benchmark性能汇总 ===\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n=== Benchmark性能汇总 ===\n```\n\n\n:::\n\n```{.r .cell-code}\nmeasures_all <- msrs(c(\"classif.acc\", \"classif.auc\", \"classif.bacc\", \"classif.ce\"))\nbmr_results <- bmr_extended$aggregate(measures_all)\n\n# 格式化结果\nresults_detailed <- bmr_results[, .(\n  Task = task_id,\n  Model = learner_id,\n  Resampling = resampling_id,\n  Accuracy = classif.acc,\n  AUC = classif.auc,\n  Balanced_Accuracy = classif.bacc,\n  LogLoss = classif.ce\n)]\n\nprint(results_detailed[order(Task, -Accuracy)])\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n          Task         Model Resampling  Accuracy       AUC Balanced_Accuracy\n        <char>        <char>     <char>     <num>     <num>             <num>\n 1: Ionosphere           svm         cv 0.9600402 0.9817941         0.9521703\n 2: Ionosphere random_forest         cv 0.9344869 0.9767042         0.9240374\n 3: Ionosphere       xgboost         cv 0.9316298 0.9705965         0.9160039\n 4: Ionosphere decision_tree         cv 0.8689336 0.9133973         0.8424137\n 5: Ionosphere           knn         cv 0.8461569 0.9090057         0.7925212\n 6: Ionosphere   naive_bayes         cv 0.8177465 0.9371054         0.8307731\n 7:      sonar       xgboost         cv 0.8605110 0.9353244         0.8583196\n 8:      sonar           knn         cv 0.8456446 0.9390770         0.8435546\n 9:      sonar           svm         cv 0.8311266 0.9303297         0.8308425\n10:      sonar random_forest         cv 0.8217189 0.9292171         0.8166896\n11:      sonar decision_tree         cv 0.7065041 0.7225530         0.6973107\n12:      sonar   naive_bayes         cv 0.6771196 0.7807500         0.6796139\n       LogLoss\n         <num>\n 1: 0.03995976\n 2: 0.06551308\n 3: 0.06837022\n 4: 0.13106640\n 5: 0.15384306\n 6: 0.18225352\n 7: 0.13948897\n 8: 0.15435540\n 9: 0.16887340\n10: 0.17828107\n11: 0.29349593\n12: 0.32288037\n```\n\n\n:::\n\n```{.r .cell-code}\n# 按任务分组统计\ncat(\"\\n=== 按任务分组的性能统计 ===\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n=== 按任务分组的性能统计 ===\n```\n\n\n:::\n\n```{.r .cell-code}\ntask_stats <- results_detailed[, .(\n  Mean_Accuracy = mean(Accuracy),\n  Std_Accuracy = sd(Accuracy),\n  Best_Model = .SD[which.max(Accuracy)]$Model,\n  Best_Accuracy = max(Accuracy)\n), by = Task]\n\nprint(task_stats)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n         Task Mean_Accuracy Std_Accuracy Best_Model Best_Accuracy\n       <char>         <num>        <num>     <char>         <num>\n1: Ionosphere     0.8931657   0.05682290        svm     0.9600402\n2:      sonar     0.7904375   0.07807434    xgboost     0.8605110\n```\n\n\n:::\n:::\n\n\nBenchmark结果可视化\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Benchmark结果可视化\n\n# 1. 按任务和模型的准确率热图\naccuracy_matrix <- dcast(results_detailed, Model ~ Task, value.var = \"Accuracy\")\nprint(\"准确率矩阵:\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"准确率矩阵:\"\n```\n\n\n:::\n\n```{.r .cell-code}\nprint(accuracy_matrix)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nKey: <Model>\n           Model Ionosphere     sonar\n          <char>      <num>     <num>\n1: decision_tree  0.8689336 0.7065041\n2:           knn  0.8461569 0.8456446\n3:   naive_bayes  0.8177465 0.6771196\n4: random_forest  0.9344869 0.8217189\n5:           svm  0.9600402 0.8311266\n6:       xgboost  0.9316298 0.8605110\n```\n\n\n:::\n\n```{.r .cell-code}\n# 可视化热图\nheatmap_data <- as.matrix(accuracy_matrix[, -1])\nrownames(heatmap_data) <- accuracy_matrix$Model\n\nlibrary(reshape2)\nheatmap_df <- melt(accuracy_matrix, id.vars = \"Model\", \n                   variable.name = \"Task\", value.name = \"Accuracy\")\n\np1 <- ggplot(heatmap_df, aes(x = Task, y = Model, fill = Accuracy)) +\n  geom_tile(color = \"white\") +\n  geom_text(aes(label = round(Accuracy, 3)), color = \"black\", size = 3) +\n  scale_fill_gradient2(low = \"red\", mid = \"white\", high = \"blue\", midpoint = 0.9) +\n  labs(title = \"模型在不同任务上的准确率热图\", \n       x = \"任务\", y = \"模型\") +\n  theme_minimal() +\n  theme(axis.text.x = element_text(angle = 45, hjust = 1))\n\n# 2. 模型性能比较箱线图\np2 <- ggplot(results_detailed, aes(x = reorder(Model, Accuracy), y = Accuracy, fill = Model)) +\n  geom_boxplot(alpha = 0.7) +\n  geom_jitter(width = 0.2, alpha = 0.5) +\n  labs(title = \"模型性能分布\", x = \"模型\", y = \"准确率\") +\n  theme_minimal() +\n  theme(axis.text.x = element_text(angle = 45, hjust = 1),\n        legend.position = \"none\") +\n  coord_flip()\n\n# 3. 任务性能比较\np3 <- ggplot(results_detailed, aes(x = Task, y = Accuracy, fill = Task)) +\n  geom_boxplot(alpha = 0.7) +\n  labs(title = \"不同任务的性能比较\", x = \"任务\", y = \"准确率\") +\n  theme_minimal() +\n  theme(legend.position = \"none\")\n\n# 组合图形\nlibrary(patchwork)\n(p1) / (p2 | p3)\n```\n\n::: {.cell-output-display}\n![](12-分类任务_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n统计显著性检验\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 统计显著性检验\n\n# 提取所有resample结果的预测\npredictions_all <- bmr_extended$score()\n\n# 查看提取的结果结构\nstr(predictions_all, max.level = 1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nClasses 'bmr_score', 'data.table' and 'data.frame':\t60 obs. of  11 variables:\n $ uhash          : chr  \"7dc04d62-a2ab-46ef-9c5e-d656c7cd542a\" \"7dc04d62-a2ab-46ef-9c5e-d656c7cd542a\" \"7dc04d62-a2ab-46ef-9c5e-d656c7cd542a\" \"7dc04d62-a2ab-46ef-9c5e-d656c7cd542a\" ...\n $ nr             : int  1 1 1 1 1 2 2 2 2 2 ...\n $ task           :List of 60\n $ task_id        : chr  \"Ionosphere\" \"Ionosphere\" \"Ionosphere\" \"Ionosphere\" ...\n $ learner        :List of 60\n $ learner_id     : chr  \"random_forest\" \"random_forest\" \"random_forest\" \"random_forest\" ...\n $ resampling     :List of 60\n $ resampling_id  : chr  \"cv\" \"cv\" \"cv\" \"cv\" ...\n $ iteration      : int  1 2 3 4 5 1 2 3 4 5 ...\n $ prediction_test:List of 60\n $ classif.ce     : num  0.0704 0.0429 0.1 0.0714 0.0429 ...\n - attr(*, \".internal.selfref\")=<externalptr> \n```\n\n\n:::\n\n```{.r .cell-code}\n# 提取具体的预测对象\npredictions_list <- predictions_all$prediction\n\n# Friedman检验 - 比较多个模型的性能\nif (requireNamespace(\"scmamp\", quietly = TRUE)) {\n  library(scmamp)\n  \n  # 准备数据用于Friedman检验\n  accuracy_matrix <- dcast(results_detailed, Task ~ Model, value.var = \"Accuracy\")\n  accuracy_data <- as.matrix(accuracy_matrix[, -1])\n  \n  cat(\"\\n=== Friedman检验 ===\\n\")\n  friedman_test <- friedmanTest(accuracy_data)\n  print(friedman_test)\n  \n  if (friedman_test$p.value < 0.05) {\n    cat(\"模型间存在显著差异，进行事后检验...\\n\")\n    \n    # Nemenyi事后检验\n    nemenyi_test <- nemenyiTest(accuracy_data)\n    print(nemenyi_test)\n    \n    # 可视化CD图\n    plotCD(accuracy_data, alpha = 0.05)\n  } else {\n    cat(\"模型间无显著差异\\n\")\n  }\n} else {\n  cat(\"scmamp包未安装，跳过统计检验\\n\")\n}\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nscmamp包未安装，跳过统计检验\n```\n\n\n:::\n\n```{.r .cell-code}\n# 简单的成对t检验\ncat(\"\\n=== 最佳模型 vs 其他模型的成对t检验 ===\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n=== 最佳模型 vs 其他模型的成对t检验 ===\n```\n\n\n:::\n\n```{.r .cell-code}\nbest_model <- results_detailed[which.max(Accuracy)]$Model\nbest_accuracies <- results_detailed[Model == best_model]$Accuracy\n\nfor (model in unique(results_detailed$Model)) {\n  if (model != best_model) {\n    model_accuracies <- results_detailed[Model == model]$Accuracy\n    t_test <- t.test(best_accuracies, model_accuracies, paired = TRUE)\n    cat(sprintf(\"%s vs %s: p-value = %.4f\\n\", best_model, model, t_test$p.value))\n  }\n}\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nsvm vs random_forest: p-value = 0.2754\nsvm vs xgboost: p-value = 0.9893\nsvm vs knn: p-value = 0.5807\nsvm vs naive_bayes: p-value = 0.0252\nsvm vs decision_tree: p-value = 0.0981\n```\n\n\n:::\n:::\n\n\n## 12.2 Benchmark分析总结\n\nmlr3 Benchmark优势\n\n统一的接口：`benchmark()`函数提供统一的Benchmark接口 灵活的设计：支持多个任务、学习器、重采样策略的组合 内置存储：可以存储模型和预测结果用于后续分析 丰富的结果：自动计算多个评估指标 统计检验：内置Friedman检验等统计方法\n\n最佳实践建议\n\n系统化比较：在项目初期进行全面的Benchmark分析 多维度评估：考虑准确率、训练时间、可解释性等多个维度 统计验证：使用统计检验验证性能差异的显著性 业务导向：根据具体业务需求选择最适合的模型 可重复性：设置随机种子确保结果可重复\n\n这样的Benchmark分析为模型选择提供了科学依据，确保选择的模型不仅在测试集上表现好，而且具有统计显著性。\n\n## 12.4 R语言--多分类\n\n数据集说明 本案例使用经典的鸢尾花数据集（Iris Dataset），包含三种鸢尾花的萼片和花瓣测量数据。 **目标**：预测鸢尾花的种类（Species）\\\n**任务类型**：多分类问题（3个类别）\\\n**业务价值**：植物分类、物种识别\n\n数据加载与探索\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 综合案例：鸢尾花分类 - R语言实现 (mlr3框架)\n\n# 加载必要的包\nlibrary(mlr3)\nlibrary(mlr3verse)\nlibrary(mlr3pipelines)\nlibrary(mlr3tuning)\nlibrary(data.table)\nlibrary(ggplot2)\nlibrary(corrplot)\nlibrary(gridExtra)\nlibrary(patchwork)\n\n# 加载鸢尾花数据集\ndata(\"iris\", package = \"datasets\")\niris_data <- as.data.table(iris)\n\n# 数据基本信息\nstr(iris_data)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nClasses 'data.table' and 'data.frame':\t150 obs. of  5 variables:\n $ Sepal.Length: num  5.1 4.9 4.7 4.6 5 5.4 4.6 5 4.4 4.9 ...\n $ Sepal.Width : num  3.5 3 3.2 3.1 3.6 3.9 3.4 3.4 2.9 3.1 ...\n $ Petal.Length: num  1.4 1.4 1.3 1.5 1.4 1.7 1.4 1.5 1.4 1.5 ...\n $ Petal.Width : num  0.2 0.2 0.2 0.2 0.2 0.4 0.3 0.2 0.2 0.1 ...\n $ Species     : Factor w/ 3 levels \"setosa\",\"versicolor\",..: 1 1 1 1 1 1 1 1 1 1 ...\n - attr(*, \".internal.selfref\")=<externalptr> \n```\n\n\n:::\n\n```{.r .cell-code}\n# 检查缺失值\ncat(\"\\n缺失值检查:\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n缺失值检查:\n```\n\n\n:::\n\n```{.r .cell-code}\nprint(colSums(is.na(iris_data)))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSepal.Length  Sepal.Width Petal.Length  Petal.Width      Species \n           0            0            0            0            0 \n```\n\n\n:::\n:::\n\n\n数据可视化分析\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 数据可视化分析 - R语言\n\n# 类别分布\np1 <- ggplot(iris_data, aes(x = Species, fill = Species)) +\n  geom_bar(alpha = 0.7) +\n  scale_fill_brewer(palette = \"Set1\") +\n  labs(title = \"类别分布\", x = \"鸢尾花种类\", y = \"数量\") +\n  theme_minimal() +\n  theme(legend.position = \"none\")\n\n# 花萼长度与宽度的关系\np2 <- ggplot(iris_data, aes(x = Sepal.Length, y = Sepal.Width, color = Species)) +\n  geom_point(alpha = 0.7, size = 2) +\n  scale_color_brewer(palette = \"Set1\") +\n  labs(title = \"花萼长度 vs 宽度\", x = \"花萼长度\", y = \"花萼宽度\") +\n  theme_minimal()\n\n# 花瓣长度与宽度的关系\np3 <- ggplot(iris_data, aes(x = Petal.Length, y = Petal.Width, color = Species)) +\n  geom_point(alpha = 0.7, size = 2) +\n  scale_color_brewer(palette = \"Set1\") +\n  labs(title = \"花瓣长度 vs 宽度\", x = \"花瓣长度\", y = \"花瓣宽度\") +\n  theme_minimal()\n\n# 特征分布箱线图\np4 <- ggplot(iris_data, aes(x = Species, y = Petal.Length, fill = Species)) +\n  geom_boxplot(alpha = 0.7) +\n  scale_fill_brewer(palette = \"Set1\") +\n  labs(title = \"花瓣长度分布\", x = \"鸢尾花种类\", y = \"花瓣长度\") +\n  theme_minimal() +\n  theme(legend.position = \"none\")\n\n# 组合图形\n(p1 + p2) / (p3 + p4)\n```\n\n::: {.cell-output-display}\n![](12-分类任务_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\n创建mlr3任务和数据预处理\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 创建mlr3任务和数据预处理\n\n# 创建分类任务\ntask_iris <- as_task_classif(iris_data, target = \"Species\", id = \"iris\",store_backends=TRUE)\n\n# 查看任务信息\ncat(\"任务信息:\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n任务信息:\n```\n\n\n:::\n\n```{.r .cell-code}\nprint(task_iris)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n── <TaskClassif> (150x5) ───────────────────────────────────────────────────────\n• Target: Species\n• Target classes: setosa (33%), versicolor (33%), virginica (33%)\n• Properties: multiclass\n• Features (4):\n  • dbl (4): Petal.Length, Petal.Width, Sepal.Length, Sepal.Width\n```\n\n\n:::\n\n```{.r .cell-code}\n# 数据预处理管道\npreprocess_pipeline <- po(\"scale\") %>>% \n  po(\"encode\") %>>%\n  po(\"colapply\", applicator = as.numeric)\n\n# 应用预处理\ntask_preprocessed <- preprocess_pipeline$train(task_iris)[[1]]\n\ncat(\"\\n预处理后的任务信息:\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n预处理后的任务信息:\n```\n\n\n:::\n\n```{.r .cell-code}\nprint(task_preprocessed)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n── <TaskClassif> (150x5) ───────────────────────────────────────────────────────\n• Target: Species\n• Target classes: setosa (33%), versicolor (33%), virginica (33%)\n• Properties: multiclass\n• Features (4):\n  • dbl (4): Petal.Length, Petal.Width, Sepal.Length, Sepal.Width\n```\n\n\n:::\n:::\n\n\n模型训练与比较\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 模型训练与比较 - mlr3\n\n# 定义学习器\nlearners <- list(\n  lrn(\"classif.ranger\", id = \"random_forest\", predict_type = \"prob\"),\n  lrn(\"classif.xgboost\", id = \"xgboost\", predict_type = \"prob\"),\n  lrn(\"classif.svm\", id = \"svm\", predict_type = \"prob\"),\n  lrn(\"classif.kknn\", id = \"knn\", predict_type = \"prob\")\n)\n\n# 设置交叉验证和评估指标\nresampling <- rsmp(\"cv\", folds = 5)\nmeasures <- msrs(c(\"classif.acc\", \"classif.auc\", \"classif.bacc\", \"classif.ce\"))\n\n# 基准测试\ndesign <- benchmark_grid(\n  tasks = task_preprocessed,\n  learners = learners,\n  resamplings = resampling\n)\n\nbmr <- benchmark(design,store_backends=TRUE)\n\n# 性能评估\ncat(\"模型性能比较:\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n模型性能比较:\n```\n\n\n:::\n\n```{.r .cell-code}\nbmr_aggregated <- bmr$aggregate(measures)\n\n# 格式化输出结果\nresults_r <- bmr_aggregated[, .(\n  Model = learner_id,\n  Accuracy = classif.acc,\n  AUC = classif.auc,\n  Balanced_Accuracy = classif.bacc,\n  LogLoss = classif.ce\n)]\n\nprint(results_r[order(-Accuracy)])\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n           Model  Accuracy   AUC Balanced_Accuracy    LogLoss\n          <char>     <num> <num>             <num>      <num>\n1:           svm 0.9666667   NaN         0.9644974 0.03333333\n2: random_forest 0.9600000   NaN         0.9561640 0.04000000\n3:           knn 0.9466667   NaN         0.9413492 0.05333333\n4:       xgboost 0.9400000   NaN         0.9339418 0.06000000\n```\n\n\n:::\n\n```{.r .cell-code}\n# 性能可视化\nggplot(results_r, aes(x = reorder(Model, Accuracy), y = Accuracy)) +\n  geom_bar(stat = \"identity\", fill = \"steelblue\", alpha = 0.7) +\n  labs(title = \"模型性能比较 (准确率) - R/mlr3\", x = \"模型\", y = \"准确率\") +\n  theme_minimal() +\n  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +\n  ylim(0, 1)\n```\n\n::: {.cell-output-display}\n![](12-分类任务_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\n超参数调优\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 超参数调优示例 - 随机森林\nlibrary(mlr3)           # 核心\nlibrary(mlr3learners)   # 学习器\nlibrary(mlr3tuning)     # 参数调优（包含 tnr()）\nlibrary(paradox)        # 参数空间\nlibrary(mlr3viz)        # 可视化\n# 定义随机森林学习器\nlearner_rf_tune <- lrn(\"classif.ranger\", predict_type = \"prob\", num.trees = 100)\n\n# 定义超参数空间\nparam_set <- ps(\n  mtry = p_int(lower = 1, upper = ncol(iris_data) - 1),\n  min.node.size = p_int(lower = 1, upper = 10),\n  sample.fraction = p_dbl(lower = 0.6, upper = 0.9)\n)\n\n# 定义调优器\ntuner <- tnr(\"grid_search\", resolution = 5)\nterminator <- trm(\"evals\", n_evals = 10)\n\n# 自动调优\nat <- auto_tuner(\n  tuner = tuner,\n  learner = learner_rf_tune,\n  resampling = rsmp(\"holdout\"),\n  measure = msr(\"classif.ce\"),\n  search_space = param_set,\n  terminator = terminator\n)\n\n# 在数据上演示调优\nset.seed(123)\nat$train(task_preprocessed)\n\ncat(\"最佳参数:\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n最佳参数:\n```\n\n\n:::\n\n```{.r .cell-code}\nprint(at$tuning_result)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n    mtry min.node.size sample.fraction learner_param_vals  x_domain classif.ce\n   <int>         <int>           <num>             <list>    <list>      <num>\n1:     2             3             0.6          <list[5]> <list[3]>       0.04\n```\n\n\n:::\n\n```{.r .cell-code}\n# 使用调优后的模型进行预测\npredictions_tuned <- at$predict(task_preprocessed)\ncat(\"调优完成\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n调优完成\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"调优后模型准确率:\", predictions_tuned$score(msr(\"classif.acc\")), \"\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n调优后模型准确率: 0.9733333 \n```\n\n\n:::\n:::\n\n\n模型解释\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 模型解释 - 特征重要性\nlibrary(ggplot2)\n# 训练最佳模型（随机森林）\nset.seed(123)\nlearner_best <- lrn(\"classif.ranger\", predict_type = \"prob\", importance = \"permutation\")\nlearner_best$train(task_preprocessed)\n\n# 特征重要性\nif (!is.null(learner_best$importance)) {\n  feature_importance <- learner_best$importance()\n  importance_df <- data.frame(\n    Feature = names(feature_importance),\n    Importance = as.numeric(feature_importance)\n  )\n  importance_df <- importance_df[order(-importance_df$Importance), ]\n  \n  cat(\"特征重要性排序:\\n\")\n  print(importance_df)\n  \n  # 可视化特征重要性\n  ggplot(importance_df, aes(x = reorder(Feature, Importance), y = Importance)) +\n    geom_bar(stat = \"identity\", fill = \"darkorange\", alpha = 0.7) +\n    labs(title = \"特征重要性 - 随机森林\", x = \"特征\", y = \"重要性\") +\n    coord_flip() +\n    theme_minimal()\n} else {\n  cat(\"该学习器不支持特征重要性计算\\n\")\n}\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n特征重要性排序:\n       Feature  Importance\n1  Petal.Width 0.296006354\n2 Petal.Length 0.292785833\n3 Sepal.Length 0.033216550\n4  Sepal.Width 0.006679592\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](12-分类任务_files/figure-html/unnamed-chunk-12-1.png){width=672}\n:::\n:::\n\n\n模型评估与混淆矩阵\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 模型评估与混淆矩阵\n\n# 使用最佳模型进行预测\npredictions <- learner_best$predict(task_preprocessed)\n\n# 混淆矩阵\ncat(\"混淆矩阵:\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n混淆矩阵:\n```\n\n\n:::\n\n```{.r .cell-code}\nprint(predictions$confusion)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n            truth\nresponse     setosa versicolor virginica\n  setosa         50          0         0\n  versicolor      0         48         1\n  virginica       0          2        49\n```\n\n\n:::\n:::\n\n\n## 12.5 Python--多分类\n\n数据加载与探索\n\n\n::: {.cell}\n\n```{.python .cell-code}\n# 综合案例：鸢尾花分类 - Python语言实现 (sklearn框架)\n\nimport pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport seaborn as sns\nfrom sklearn.datasets import load_iris\nfrom sklearn.model_selection import train_test_split, cross_val_score, GridSearchCV, StratifiedKFold\nfrom sklearn.preprocessing import StandardScaler, LabelEncoder\nfrom sklearn.linear_model import LogisticRegression\nfrom sklearn.ensemble import RandomForestClassifier\nfrom sklearn.ensemble import GradientBoostingClassifier\nfrom sklearn.svm import SVC\nfrom sklearn.neighbors import KNeighborsClassifier\nfrom sklearn.metrics import (accuracy_score, precision_score, recall_score, f1_score, \n                           roc_auc_score, confusion_matrix, classification_report, \n                           roc_curve, auc)\nfrom sklearn.inspection import permutation_importance\nimport warnings\nwarnings.filterwarnings('ignore')\n\n# 设置图形样式\nplt.style.use('default')\nsns.set_palette(\"husl\")\n\n# 加载鸢尾花数据集\niris = load_iris()\nX = pd.DataFrame(iris.data, columns=iris.feature_names)\ny = pd.Series(iris.target, name='species')\niris_data = pd.concat([X, y], axis=1)\n\n# 映射数字标签到类别名称\ntarget_names = iris.target_names\niris_data['species_name'] = iris_data['species'].map(lambda x: target_names[x])\n\nprint(\"数据集基本信息:\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n数据集基本信息:\n```\n\n\n:::\n\n```{.python .cell-code}\nprint(f\"样本数: {iris_data.shape[0]}\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n样本数: 150\n```\n\n\n:::\n\n```{.python .cell-code}\nprint(f\"变量数: {iris_data.shape[1]}\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n变量数: 6\n```\n\n\n:::\n\n```{.python .cell-code}\nprint(\"\\n变量名称:\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n变量名称:\n```\n\n\n:::\n\n```{.python .cell-code}\nprint(iris_data.columns.tolist())\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n['sepal length (cm)', 'sepal width (cm)', 'petal length (cm)', 'petal width (cm)', 'species', 'species_name']\n```\n\n\n:::\n\n```{.python .cell-code}\n# 类别分布\nprint(\"\\n类别分布:\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n类别分布:\n```\n\n\n:::\n\n```{.python .cell-code}\nclass_dist = iris_data['species_name'].value_counts()\nprint(class_dist)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nspecies_name\nsetosa        50\nversicolor    50\nvirginica     50\nName: count, dtype: int64\n```\n\n\n:::\n\n```{.python .cell-code}\nprint(\"\\n类别比例:\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n类别比例:\n```\n\n\n:::\n\n```{.python .cell-code}\nprint(class_dist / class_dist.sum())\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nspecies_name\nsetosa        0.333333\nversicolor    0.333333\nvirginica     0.333333\nName: count, dtype: float64\n```\n\n\n:::\n\n```{.python .cell-code}\nprint(\"\\n数据概览:\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n数据概览:\n```\n\n\n:::\n\n```{.python .cell-code}\nprint(iris_data.describe())\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n       sepal length (cm)  sepal width (cm)  ...  petal width (cm)     species\ncount         150.000000        150.000000  ...        150.000000  150.000000\nmean            5.843333          3.057333  ...          1.199333    1.000000\nstd             0.828066          0.435866  ...          0.762238    0.819232\nmin             4.300000          2.000000  ...          0.100000    0.000000\n25%             5.100000          2.800000  ...          0.300000    0.000000\n50%             5.800000          3.000000  ...          1.300000    1.000000\n75%             6.400000          3.300000  ...          1.800000    2.000000\nmax             7.900000          4.400000  ...          2.500000    2.000000\n\n[8 rows x 5 columns]\n```\n\n\n:::\n\n```{.python .cell-code}\nprint(\"\\n缺失值检查:\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n缺失值检查:\n```\n\n\n:::\n\n```{.python .cell-code}\nprint(iris_data.isnull().sum())\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nsepal length (cm)    0\nsepal width (cm)     0\npetal length (cm)    0\npetal width (cm)     0\nspecies              0\nspecies_name         0\ndtype: int64\n```\n\n\n:::\n:::\n\n\n数据可视化分析\n\n\n::: {.cell}\n\n```{.python .cell-code}\n# 数据可视化分析 - Python\n\nfig, axes = plt.subplots(2, 2, figsize=(15, 12))\n\n# 类别分布\nclass_counts = iris_data['species_name'].value_counts()\naxes[0,0].bar(class_counts.index, class_counts.values, color=['steelblue', 'darkorange', 'darkgreen'], alpha=0.7)\naxes[0,0].set_title('类别分布')\naxes[0,0].set_ylabel('数量')\naxes[0,0].tick_params(axis='x', rotation=45)\n\n# 花萼长度与宽度的关系\nspecies_colors = {'setosa': 'red', 'versicolor': 'green', 'virginica': 'blue'}\nfor species in iris_data['species_name'].unique():\n    species_data = iris_data[iris_data['species_name'] == species]\n    axes[0,1].scatter(species_data['sepal length (cm)'], species_data['sepal width (cm)'], \n                     label=species, alpha=0.7, s=60)\naxes[0,1].set_title('花萼长度 vs 宽度')\naxes[0,1].set_xlabel('花萼长度 (cm)')\naxes[0,1].set_ylabel('花萼宽度 (cm)')\naxes[0,1].legend()\n\n# 花瓣长度与宽度的关系\nfor species in iris_data['species_name'].unique():\n    species_data = iris_data[iris_data['species_name'] == species]\n    axes[1,0].scatter(species_data['petal length (cm)'], species_data['petal width (cm)'], \n                     label=species, alpha=0.7, s=60)\naxes[1,0].set_title('花瓣长度 vs 宽度')\naxes[1,0].set_xlabel('花瓣长度 (cm)')\naxes[1,0].set_ylabel('花瓣宽度 (cm)')\naxes[1,0].legend()\n\n# 特征分布箱线图\nfeature_data = iris_data.melt(id_vars=['species_name'], \n                             value_vars=['sepal length (cm)', 'sepal width (cm)', \n                                       'petal length (cm)', 'petal width (cm)'])\nsns.boxplot(data=feature_data, x='variable', y='value', hue='species_name', ax=axes[1,1])\naxes[1,1].set_title('特征分布比较')\naxes[1,1].set_xlabel('特征')\naxes[1,1].set_ylabel('值')\naxes[1,1].tick_params(axis='x', rotation=45)\naxes[1,1].legend(bbox_to_anchor=(1.05, 1), loc='upper left')\n\nplt.tight_layout()\nplt.show()\n```\n\n::: {.cell-output-display}\n![](12-分类任务_files/figure-html/unnamed-chunk-15-1.png)\n:::\n\n```{.python .cell-code}\n# 相关性热图\nplt.figure(figsize=(10, 8))\ncorr_matrix = iris_data[['sepal length (cm)', 'sepal width (cm)', \n                        'petal length (cm)', 'petal width (cm)', 'species']].corr()\nsns.heatmap(corr_matrix, annot=True, cmap='coolwarm', center=0,\n            square=True, linewidths=0.5, cbar_kws={\"shrink\": 0.8}, fmt='.2f')\nplt.title('变量相关性热图 - Python/sklearn')\nplt.tight_layout()\nplt.show()\n```\n\n::: {.cell-output-display}\n![](12-分类任务_files/figure-html/unnamed-chunk-15-2.png)\n:::\n:::\n\n\n数据预处理\n\n\n::: {.cell}\n\n```{.python .cell-code}\n# 数据预处理 - Python\n\n# 准备特征和目标变量\nX = iris_data[['sepal length (cm)', 'sepal width (cm)', \n               'petal length (cm)', 'petal width (cm)']]\ny = iris_data['species']\n\n# 数据划分（分层抽样保持类别比例）\nX_train, X_test, y_train, y_test = train_test_split(\n    X, y, test_size=0.3, random_state=42, stratify=y\n)\n\nprint(f\"训练集大小: {X_train.shape[0]}\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n训练集大小: 105\n```\n\n\n:::\n\n```{.python .cell-code}\nprint(f\"测试集大小: {X_test.shape[0]}\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n测试集大小: 45\n```\n\n\n:::\n\n```{.python .cell-code}\nprint(f\"训练集类别分布:\\n{y_train.value_counts().sort_index()}\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n训练集类别分布:\nspecies\n0    35\n1    35\n2    35\nName: count, dtype: int64\n```\n\n\n:::\n\n```{.python .cell-code}\nprint(f\"测试集类别分布:\\n{y_test.value_counts().sort_index()}\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n测试集类别分布:\nspecies\n0    15\n1    15\n2    15\nName: count, dtype: int64\n```\n\n\n:::\n\n```{.python .cell-code}\n# 数据标准化\nscaler = StandardScaler()\nX_train_scaled = scaler.fit_transform(X_train)\nX_test_scaled = scaler.transform(X_test)\n\nprint(\"数据预处理完成\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n数据预处理完成\n```\n\n\n:::\n:::\n\n\n模型训练与比较\n\n\n::: {.cell}\n\n```{.python .cell-code}\n# 模型训练与比较 - sklearn\n\n# 定义模型字典\nmodels = {\n    'Logistic Regression': LogisticRegression(random_state=42, max_iter=1000),\n    'Random Forest': RandomForestClassifier(random_state=42),\n    'K-Neighbors': KNeighborsClassifier(),\n    'Gradient Boosting': GradientBoostingClassifier(random_state=42)\n}\n\n# 训练和评估模型\nresults = []\n\nfor name, model in models.items():\n    # 训练模型\n    model.fit(X_train_scaled, y_train)\n    \n    # 预测\n    y_pred = model.predict(X_test_scaled)\n    y_pred_proba = model.predict_proba(X_test_scaled)\n    \n    # 计算评估指标\n    accuracy = accuracy_score(y_test, y_pred)\n    precision = precision_score(y_test, y_pred, average='weighted')\n    recall = recall_score(y_test, y_pred, average='weighted')\n    f1 = f1_score(y_test, y_pred, average='weighted')\n    \n    # 多类AUC（One-vs-Rest）\n    try:\n        auc_score = roc_auc_score(y_test, y_pred_proba, multi_class='ovr')\n    except:\n        auc_score = np.nan\n    \n    # 交叉验证\n    cv = StratifiedKFold(n_splits=5, shuffle=True, random_state=42)\n    cv_scores = cross_val_score(model, X_train_scaled, y_train, cv=cv, scoring='accuracy')\n    cv_accuracy_mean = cv_scores.mean()\n    \n    results.append({\n        'Model': name,\n        'Accuracy': accuracy,\n        'Precision': precision,\n        'Recall': recall,\n        'F1_Score': f1,\n        'AUC': auc_score,\n        'CV_Accuracy': cv_accuracy_mean\n    })\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<style>#sk-container-id-1 {\n  /* Definition of color scheme common for light and dark mode */\n  --sklearn-color-text: #000;\n  --sklearn-color-text-muted: #666;\n  --sklearn-color-line: gray;\n  /* Definition of color scheme for unfitted estimators */\n  --sklearn-color-unfitted-level-0: #fff5e6;\n  --sklearn-color-unfitted-level-1: #f6e4d2;\n  --sklearn-color-unfitted-level-2: #ffe0b3;\n  --sklearn-color-unfitted-level-3: chocolate;\n  /* Definition of color scheme for fitted estimators */\n  --sklearn-color-fitted-level-0: #f0f8ff;\n  --sklearn-color-fitted-level-1: #d4ebff;\n  --sklearn-color-fitted-level-2: #b3dbfd;\n  --sklearn-color-fitted-level-3: cornflowerblue;\n\n  /* Specific color for light theme */\n  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));\n  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));\n  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));\n  --sklearn-color-icon: #696969;\n\n  @media (prefers-color-scheme: dark) {\n    /* Redefinition of color scheme for dark theme */\n    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));\n    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));\n    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));\n    --sklearn-color-icon: #878787;\n  }\n}\n\n#sk-container-id-1 {\n  color: var(--sklearn-color-text);\n}\n\n#sk-container-id-1 pre {\n  padding: 0;\n}\n\n#sk-container-id-1 input.sk-hidden--visually {\n  border: 0;\n  clip: rect(1px 1px 1px 1px);\n  clip: rect(1px, 1px, 1px, 1px);\n  height: 1px;\n  margin: -1px;\n  overflow: hidden;\n  padding: 0;\n  position: absolute;\n  width: 1px;\n}\n\n#sk-container-id-1 div.sk-dashed-wrapped {\n  border: 1px dashed var(--sklearn-color-line);\n  margin: 0 0.4em 0.5em 0.4em;\n  box-sizing: border-box;\n  padding-bottom: 0.4em;\n  background-color: var(--sklearn-color-background);\n}\n\n#sk-container-id-1 div.sk-container {\n  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`\n     but bootstrap.min.css set `[hidden] { display: none !important; }`\n     so we also need the `!important` here to be able to override the\n     default hidden behavior on the sphinx rendered scikit-learn.org.\n     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */\n  display: inline-block !important;\n  position: relative;\n}\n\n#sk-container-id-1 div.sk-text-repr-fallback {\n  display: none;\n}\n\ndiv.sk-parallel-item,\ndiv.sk-serial,\ndiv.sk-item {\n  /* draw centered vertical line to link estimators */\n  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));\n  background-size: 2px 100%;\n  background-repeat: no-repeat;\n  background-position: center center;\n}\n\n/* Parallel-specific style estimator block */\n\n#sk-container-id-1 div.sk-parallel-item::after {\n  content: \"\";\n  width: 100%;\n  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);\n  flex-grow: 1;\n}\n\n#sk-container-id-1 div.sk-parallel {\n  display: flex;\n  align-items: stretch;\n  justify-content: center;\n  background-color: var(--sklearn-color-background);\n  position: relative;\n}\n\n#sk-container-id-1 div.sk-parallel-item {\n  display: flex;\n  flex-direction: column;\n}\n\n#sk-container-id-1 div.sk-parallel-item:first-child::after {\n  align-self: flex-end;\n  width: 50%;\n}\n\n#sk-container-id-1 div.sk-parallel-item:last-child::after {\n  align-self: flex-start;\n  width: 50%;\n}\n\n#sk-container-id-1 div.sk-parallel-item:only-child::after {\n  width: 0;\n}\n\n/* Serial-specific style estimator block */\n\n#sk-container-id-1 div.sk-serial {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  background-color: var(--sklearn-color-background);\n  padding-right: 1em;\n  padding-left: 1em;\n}\n\n\n/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is\nclickable and can be expanded/collapsed.\n- Pipeline and ColumnTransformer use this feature and define the default style\n- Estimators will overwrite some part of the style using the `sk-estimator` class\n*/\n\n/* Pipeline and ColumnTransformer style (default) */\n\n#sk-container-id-1 div.sk-toggleable {\n  /* Default theme specific background. It is overwritten whether we have a\n  specific estimator or a Pipeline/ColumnTransformer */\n  background-color: var(--sklearn-color-background);\n}\n\n/* Toggleable label */\n#sk-container-id-1 label.sk-toggleable__label {\n  cursor: pointer;\n  display: flex;\n  width: 100%;\n  margin-bottom: 0;\n  padding: 0.5em;\n  box-sizing: border-box;\n  text-align: center;\n  align-items: start;\n  justify-content: space-between;\n  gap: 0.5em;\n}\n\n#sk-container-id-1 label.sk-toggleable__label .caption {\n  font-size: 0.6rem;\n  font-weight: lighter;\n  color: var(--sklearn-color-text-muted);\n}\n\n#sk-container-id-1 label.sk-toggleable__label-arrow:before {\n  /* Arrow on the left of the label */\n  content: \"▸\";\n  float: left;\n  margin-right: 0.25em;\n  color: var(--sklearn-color-icon);\n}\n\n#sk-container-id-1 label.sk-toggleable__label-arrow:hover:before {\n  color: var(--sklearn-color-text);\n}\n\n/* Toggleable content - dropdown */\n\n#sk-container-id-1 div.sk-toggleable__content {\n  max-height: 0;\n  max-width: 0;\n  overflow: hidden;\n  text-align: left;\n  /* unfitted */\n  background-color: var(--sklearn-color-unfitted-level-0);\n}\n\n#sk-container-id-1 div.sk-toggleable__content.fitted {\n  /* fitted */\n  background-color: var(--sklearn-color-fitted-level-0);\n}\n\n#sk-container-id-1 div.sk-toggleable__content pre {\n  margin: 0.2em;\n  border-radius: 0.25em;\n  color: var(--sklearn-color-text);\n  /* unfitted */\n  background-color: var(--sklearn-color-unfitted-level-0);\n}\n\n#sk-container-id-1 div.sk-toggleable__content.fitted pre {\n  /* unfitted */\n  background-color: var(--sklearn-color-fitted-level-0);\n}\n\n#sk-container-id-1 input.sk-toggleable__control:checked~div.sk-toggleable__content {\n  /* Expand drop-down */\n  max-height: 200px;\n  max-width: 100%;\n  overflow: auto;\n}\n\n#sk-container-id-1 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {\n  content: \"▾\";\n}\n\n/* Pipeline/ColumnTransformer-specific style */\n\n#sk-container-id-1 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {\n  color: var(--sklearn-color-text);\n  background-color: var(--sklearn-color-unfitted-level-2);\n}\n\n#sk-container-id-1 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {\n  background-color: var(--sklearn-color-fitted-level-2);\n}\n\n/* Estimator-specific style */\n\n/* Colorize estimator box */\n#sk-container-id-1 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {\n  /* unfitted */\n  background-color: var(--sklearn-color-unfitted-level-2);\n}\n\n#sk-container-id-1 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {\n  /* fitted */\n  background-color: var(--sklearn-color-fitted-level-2);\n}\n\n#sk-container-id-1 div.sk-label label.sk-toggleable__label,\n#sk-container-id-1 div.sk-label label {\n  /* The background is the default theme color */\n  color: var(--sklearn-color-text-on-default-background);\n}\n\n/* On hover, darken the color of the background */\n#sk-container-id-1 div.sk-label:hover label.sk-toggleable__label {\n  color: var(--sklearn-color-text);\n  background-color: var(--sklearn-color-unfitted-level-2);\n}\n\n/* Label box, darken color on hover, fitted */\n#sk-container-id-1 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {\n  color: var(--sklearn-color-text);\n  background-color: var(--sklearn-color-fitted-level-2);\n}\n\n/* Estimator label */\n\n#sk-container-id-1 div.sk-label label {\n  font-family: monospace;\n  font-weight: bold;\n  display: inline-block;\n  line-height: 1.2em;\n}\n\n#sk-container-id-1 div.sk-label-container {\n  text-align: center;\n}\n\n/* Estimator-specific */\n#sk-container-id-1 div.sk-estimator {\n  font-family: monospace;\n  border: 1px dotted var(--sklearn-color-border-box);\n  border-radius: 0.25em;\n  box-sizing: border-box;\n  margin-bottom: 0.5em;\n  /* unfitted */\n  background-color: var(--sklearn-color-unfitted-level-0);\n}\n\n#sk-container-id-1 div.sk-estimator.fitted {\n  /* fitted */\n  background-color: var(--sklearn-color-fitted-level-0);\n}\n\n/* on hover */\n#sk-container-id-1 div.sk-estimator:hover {\n  /* unfitted */\n  background-color: var(--sklearn-color-unfitted-level-2);\n}\n\n#sk-container-id-1 div.sk-estimator.fitted:hover {\n  /* fitted */\n  background-color: var(--sklearn-color-fitted-level-2);\n}\n\n/* Specification for estimator info (e.g. \"i\" and \"?\") */\n\n/* Common style for \"i\" and \"?\" */\n\n.sk-estimator-doc-link,\na:link.sk-estimator-doc-link,\na:visited.sk-estimator-doc-link {\n  float: right;\n  font-size: smaller;\n  line-height: 1em;\n  font-family: monospace;\n  background-color: var(--sklearn-color-background);\n  border-radius: 1em;\n  height: 1em;\n  width: 1em;\n  text-decoration: none !important;\n  margin-left: 0.5em;\n  text-align: center;\n  /* unfitted */\n  border: var(--sklearn-color-unfitted-level-1) 1pt solid;\n  color: var(--sklearn-color-unfitted-level-1);\n}\n\n.sk-estimator-doc-link.fitted,\na:link.sk-estimator-doc-link.fitted,\na:visited.sk-estimator-doc-link.fitted {\n  /* fitted */\n  border: var(--sklearn-color-fitted-level-1) 1pt solid;\n  color: var(--sklearn-color-fitted-level-1);\n}\n\n/* On hover */\ndiv.sk-estimator:hover .sk-estimator-doc-link:hover,\n.sk-estimator-doc-link:hover,\ndiv.sk-label-container:hover .sk-estimator-doc-link:hover,\n.sk-estimator-doc-link:hover {\n  /* unfitted */\n  background-color: var(--sklearn-color-unfitted-level-3);\n  color: var(--sklearn-color-background);\n  text-decoration: none;\n}\n\ndiv.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,\n.sk-estimator-doc-link.fitted:hover,\ndiv.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,\n.sk-estimator-doc-link.fitted:hover {\n  /* fitted */\n  background-color: var(--sklearn-color-fitted-level-3);\n  color: var(--sklearn-color-background);\n  text-decoration: none;\n}\n\n/* Span, style for the box shown on hovering the info icon */\n.sk-estimator-doc-link span {\n  display: none;\n  z-index: 9999;\n  position: relative;\n  font-weight: normal;\n  right: .2ex;\n  padding: .5ex;\n  margin: .5ex;\n  width: min-content;\n  min-width: 20ex;\n  max-width: 50ex;\n  color: var(--sklearn-color-text);\n  box-shadow: 2pt 2pt 4pt #999;\n  /* unfitted */\n  background: var(--sklearn-color-unfitted-level-0);\n  border: .5pt solid var(--sklearn-color-unfitted-level-3);\n}\n\n.sk-estimator-doc-link.fitted span {\n  /* fitted */\n  background: var(--sklearn-color-fitted-level-0);\n  border: var(--sklearn-color-fitted-level-3);\n}\n\n.sk-estimator-doc-link:hover span {\n  display: block;\n}\n\n/* \"?\"-specific style due to the `<a>` HTML tag */\n\n#sk-container-id-1 a.estimator_doc_link {\n  float: right;\n  font-size: 1rem;\n  line-height: 1em;\n  font-family: monospace;\n  background-color: var(--sklearn-color-background);\n  border-radius: 1rem;\n  height: 1rem;\n  width: 1rem;\n  text-decoration: none;\n  /* unfitted */\n  color: var(--sklearn-color-unfitted-level-1);\n  border: var(--sklearn-color-unfitted-level-1) 1pt solid;\n}\n\n#sk-container-id-1 a.estimator_doc_link.fitted {\n  /* fitted */\n  border: var(--sklearn-color-fitted-level-1) 1pt solid;\n  color: var(--sklearn-color-fitted-level-1);\n}\n\n/* On hover */\n#sk-container-id-1 a.estimator_doc_link:hover {\n  /* unfitted */\n  background-color: var(--sklearn-color-unfitted-level-3);\n  color: var(--sklearn-color-background);\n  text-decoration: none;\n}\n\n#sk-container-id-1 a.estimator_doc_link.fitted:hover {\n  /* fitted */\n  background-color: var(--sklearn-color-fitted-level-3);\n}\n</style><div id=\"sk-container-id-1\" class=\"sk-top-container\"><div class=\"sk-text-repr-fallback\"><pre>GradientBoostingClassifier(random_state=42)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class=\"sk-container\" hidden><div class=\"sk-item\"><div class=\"sk-estimator fitted sk-toggleable\"><input class=\"sk-toggleable__control sk-hidden--visually\" id=\"sk-estimator-id-1\" type=\"checkbox\" checked><label for=\"sk-estimator-id-1\" class=\"sk-toggleable__label fitted sk-toggleable__label-arrow\"><div><div>GradientBoostingClassifier</div></div><div><a class=\"sk-estimator-doc-link fitted\" rel=\"noreferrer\" target=\"_blank\" href=\"https://scikit-learn.org/1.6/modules/generated/sklearn.ensemble.GradientBoostingClassifier.html\">?<span>Documentation for GradientBoostingClassifier</span></a><span class=\"sk-estimator-doc-link fitted\">i<span>Fitted</span></span></div></label><div class=\"sk-toggleable__content fitted\"><pre>GradientBoostingClassifier(random_state=42)</pre></div> </div></div></div></div>\n```\n\n:::\n\n```{.python .cell-code}\n# 创建结果DataFrame\nresults_python = pd.DataFrame(results)\nprint(\"模型性能比较 - Python/sklearn:\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n模型性能比较 - Python/sklearn:\n```\n\n\n:::\n\n```{.python .cell-code}\nprint(results_python.sort_values('Accuracy', ascending=False))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                 Model  Accuracy  Precision  ...  F1_Score       AUC  CV_Accuracy\n3    Gradient Boosting  0.933333   0.944444  ...  0.932660  0.998519     0.961905\n0  Logistic Regression  0.911111   0.915535  ...  0.910714  0.995556     0.980952\n2          K-Neighbors  0.911111   0.929825  ...  0.909502  0.988889     0.942857\n1        Random Forest  0.888889   0.898148  ...  0.887767  0.992593     0.952381\n\n[4 rows x 7 columns]\n```\n\n\n:::\n\n```{.python .cell-code}\n# 可视化模型比较\nfig, axes = plt.subplots(2, 2, figsize=(15, 10))\n\n# 准确率比较\nmodels_sorted_acc = results_python.sort_values('Accuracy')\naxes[0,0].barh(models_sorted_acc['Model'], models_sorted_acc['Accuracy'], color='steelblue')\naxes[0,0].set_xlabel('准确率')\naxes[0,0].set_title('模型准确率比较 - Python/sklearn')\naxes[0,0].set_xlim(0.8, 1.0)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n(0.8, 1.0)\n```\n\n\n:::\n\n```{.python .cell-code}\naxes[0,0].grid(axis='x', alpha=0.3)\n\n# F1分数比较\nmodels_sorted_f1 = results_python.sort_values('F1_Score')\naxes[0,1].barh(models_sorted_f1['Model'], models_sorted_f1['F1_Score'], color='darkorange')\naxes[0,1].set_xlabel('F1分数')\naxes[0,1].set_title('模型F1分数比较 - Python/sklearn')\naxes[0,1].set_xlim(0.8, 1.0)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n(0.8, 1.0)\n```\n\n\n:::\n\n```{.python .cell-code}\naxes[0,1].grid(axis='x', alpha=0.3)\n\n# AUC比较\nmodels_sorted_auc = results_python.sort_values('AUC')\naxes[1,0].barh(models_sorted_auc['Model'], models_sorted_auc['AUC'], color='darkgreen')\naxes[1,0].set_xlabel('AUC')\naxes[1,0].set_title('模型AUC比较 - Python/sklearn')\naxes[1,0].set_xlim(0.8, 1.0)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n(0.8, 1.0)\n```\n\n\n:::\n\n```{.python .cell-code}\naxes[1,0].grid(axis='x', alpha=0.3)\n\n# 交叉验证准确率比较\nmodels_sorted_cv = results_python.sort_values('CV_Accuracy')\naxes[1,1].barh(models_sorted_cv['Model'], models_sorted_cv['CV_Accuracy'], color='darkred')\naxes[1,1].set_xlabel('交叉验证准确率')\naxes[1,1].set_title('交叉验证准确率比较 - Python/sklearn')\naxes[1,1].set_xlim(0.8, 1.0)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n(0.8, 1.0)\n```\n\n\n:::\n\n```{.python .cell-code}\naxes[1,1].grid(axis='x', alpha=0.3)\n\nplt.tight_layout()\nplt.show()\n```\n\n::: {.cell-output-display}\n![](12-分类任务_files/figure-html/unnamed-chunk-17-5.png)\n:::\n:::\n\n\n详细模型评估\n\n\n::: {.cell}\n\n```{.python .cell-code}\n# 详细模型评估 - 最佳模型\n\n# 选择最佳模型（基于准确率）\nbest_model_name = results_python.loc[results_python['Accuracy'].idxmax(), 'Model']\nbest_model = models[best_model_name]\n\nprint(f\"最佳模型: {best_model_name}\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n最佳模型: Gradient Boosting\n```\n\n\n:::\n\n```{.python .cell-code}\n# 重新训练最佳模型\nbest_model.fit(X_train_scaled, y_train)\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<style>#sk-container-id-2 {\n  /* Definition of color scheme common for light and dark mode */\n  --sklearn-color-text: #000;\n  --sklearn-color-text-muted: #666;\n  --sklearn-color-line: gray;\n  /* Definition of color scheme for unfitted estimators */\n  --sklearn-color-unfitted-level-0: #fff5e6;\n  --sklearn-color-unfitted-level-1: #f6e4d2;\n  --sklearn-color-unfitted-level-2: #ffe0b3;\n  --sklearn-color-unfitted-level-3: chocolate;\n  /* Definition of color scheme for fitted estimators */\n  --sklearn-color-fitted-level-0: #f0f8ff;\n  --sklearn-color-fitted-level-1: #d4ebff;\n  --sklearn-color-fitted-level-2: #b3dbfd;\n  --sklearn-color-fitted-level-3: cornflowerblue;\n\n  /* Specific color for light theme */\n  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));\n  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));\n  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));\n  --sklearn-color-icon: #696969;\n\n  @media (prefers-color-scheme: dark) {\n    /* Redefinition of color scheme for dark theme */\n    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));\n    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));\n    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));\n    --sklearn-color-icon: #878787;\n  }\n}\n\n#sk-container-id-2 {\n  color: var(--sklearn-color-text);\n}\n\n#sk-container-id-2 pre {\n  padding: 0;\n}\n\n#sk-container-id-2 input.sk-hidden--visually {\n  border: 0;\n  clip: rect(1px 1px 1px 1px);\n  clip: rect(1px, 1px, 1px, 1px);\n  height: 1px;\n  margin: -1px;\n  overflow: hidden;\n  padding: 0;\n  position: absolute;\n  width: 1px;\n}\n\n#sk-container-id-2 div.sk-dashed-wrapped {\n  border: 1px dashed var(--sklearn-color-line);\n  margin: 0 0.4em 0.5em 0.4em;\n  box-sizing: border-box;\n  padding-bottom: 0.4em;\n  background-color: var(--sklearn-color-background);\n}\n\n#sk-container-id-2 div.sk-container {\n  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`\n     but bootstrap.min.css set `[hidden] { display: none !important; }`\n     so we also need the `!important` here to be able to override the\n     default hidden behavior on the sphinx rendered scikit-learn.org.\n     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */\n  display: inline-block !important;\n  position: relative;\n}\n\n#sk-container-id-2 div.sk-text-repr-fallback {\n  display: none;\n}\n\ndiv.sk-parallel-item,\ndiv.sk-serial,\ndiv.sk-item {\n  /* draw centered vertical line to link estimators */\n  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));\n  background-size: 2px 100%;\n  background-repeat: no-repeat;\n  background-position: center center;\n}\n\n/* Parallel-specific style estimator block */\n\n#sk-container-id-2 div.sk-parallel-item::after {\n  content: \"\";\n  width: 100%;\n  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);\n  flex-grow: 1;\n}\n\n#sk-container-id-2 div.sk-parallel {\n  display: flex;\n  align-items: stretch;\n  justify-content: center;\n  background-color: var(--sklearn-color-background);\n  position: relative;\n}\n\n#sk-container-id-2 div.sk-parallel-item {\n  display: flex;\n  flex-direction: column;\n}\n\n#sk-container-id-2 div.sk-parallel-item:first-child::after {\n  align-self: flex-end;\n  width: 50%;\n}\n\n#sk-container-id-2 div.sk-parallel-item:last-child::after {\n  align-self: flex-start;\n  width: 50%;\n}\n\n#sk-container-id-2 div.sk-parallel-item:only-child::after {\n  width: 0;\n}\n\n/* Serial-specific style estimator block */\n\n#sk-container-id-2 div.sk-serial {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  background-color: var(--sklearn-color-background);\n  padding-right: 1em;\n  padding-left: 1em;\n}\n\n\n/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is\nclickable and can be expanded/collapsed.\n- Pipeline and ColumnTransformer use this feature and define the default style\n- Estimators will overwrite some part of the style using the `sk-estimator` class\n*/\n\n/* Pipeline and ColumnTransformer style (default) */\n\n#sk-container-id-2 div.sk-toggleable {\n  /* Default theme specific background. It is overwritten whether we have a\n  specific estimator or a Pipeline/ColumnTransformer */\n  background-color: var(--sklearn-color-background);\n}\n\n/* Toggleable label */\n#sk-container-id-2 label.sk-toggleable__label {\n  cursor: pointer;\n  display: flex;\n  width: 100%;\n  margin-bottom: 0;\n  padding: 0.5em;\n  box-sizing: border-box;\n  text-align: center;\n  align-items: start;\n  justify-content: space-between;\n  gap: 0.5em;\n}\n\n#sk-container-id-2 label.sk-toggleable__label .caption {\n  font-size: 0.6rem;\n  font-weight: lighter;\n  color: var(--sklearn-color-text-muted);\n}\n\n#sk-container-id-2 label.sk-toggleable__label-arrow:before {\n  /* Arrow on the left of the label */\n  content: \"▸\";\n  float: left;\n  margin-right: 0.25em;\n  color: var(--sklearn-color-icon);\n}\n\n#sk-container-id-2 label.sk-toggleable__label-arrow:hover:before {\n  color: var(--sklearn-color-text);\n}\n\n/* Toggleable content - dropdown */\n\n#sk-container-id-2 div.sk-toggleable__content {\n  max-height: 0;\n  max-width: 0;\n  overflow: hidden;\n  text-align: left;\n  /* unfitted */\n  background-color: var(--sklearn-color-unfitted-level-0);\n}\n\n#sk-container-id-2 div.sk-toggleable__content.fitted {\n  /* fitted */\n  background-color: var(--sklearn-color-fitted-level-0);\n}\n\n#sk-container-id-2 div.sk-toggleable__content pre {\n  margin: 0.2em;\n  border-radius: 0.25em;\n  color: var(--sklearn-color-text);\n  /* unfitted */\n  background-color: var(--sklearn-color-unfitted-level-0);\n}\n\n#sk-container-id-2 div.sk-toggleable__content.fitted pre {\n  /* unfitted */\n  background-color: var(--sklearn-color-fitted-level-0);\n}\n\n#sk-container-id-2 input.sk-toggleable__control:checked~div.sk-toggleable__content {\n  /* Expand drop-down */\n  max-height: 200px;\n  max-width: 100%;\n  overflow: auto;\n}\n\n#sk-container-id-2 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {\n  content: \"▾\";\n}\n\n/* Pipeline/ColumnTransformer-specific style */\n\n#sk-container-id-2 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {\n  color: var(--sklearn-color-text);\n  background-color: var(--sklearn-color-unfitted-level-2);\n}\n\n#sk-container-id-2 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {\n  background-color: var(--sklearn-color-fitted-level-2);\n}\n\n/* Estimator-specific style */\n\n/* Colorize estimator box */\n#sk-container-id-2 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {\n  /* unfitted */\n  background-color: var(--sklearn-color-unfitted-level-2);\n}\n\n#sk-container-id-2 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {\n  /* fitted */\n  background-color: var(--sklearn-color-fitted-level-2);\n}\n\n#sk-container-id-2 div.sk-label label.sk-toggleable__label,\n#sk-container-id-2 div.sk-label label {\n  /* The background is the default theme color */\n  color: var(--sklearn-color-text-on-default-background);\n}\n\n/* On hover, darken the color of the background */\n#sk-container-id-2 div.sk-label:hover label.sk-toggleable__label {\n  color: var(--sklearn-color-text);\n  background-color: var(--sklearn-color-unfitted-level-2);\n}\n\n/* Label box, darken color on hover, fitted */\n#sk-container-id-2 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {\n  color: var(--sklearn-color-text);\n  background-color: var(--sklearn-color-fitted-level-2);\n}\n\n/* Estimator label */\n\n#sk-container-id-2 div.sk-label label {\n  font-family: monospace;\n  font-weight: bold;\n  display: inline-block;\n  line-height: 1.2em;\n}\n\n#sk-container-id-2 div.sk-label-container {\n  text-align: center;\n}\n\n/* Estimator-specific */\n#sk-container-id-2 div.sk-estimator {\n  font-family: monospace;\n  border: 1px dotted var(--sklearn-color-border-box);\n  border-radius: 0.25em;\n  box-sizing: border-box;\n  margin-bottom: 0.5em;\n  /* unfitted */\n  background-color: var(--sklearn-color-unfitted-level-0);\n}\n\n#sk-container-id-2 div.sk-estimator.fitted {\n  /* fitted */\n  background-color: var(--sklearn-color-fitted-level-0);\n}\n\n/* on hover */\n#sk-container-id-2 div.sk-estimator:hover {\n  /* unfitted */\n  background-color: var(--sklearn-color-unfitted-level-2);\n}\n\n#sk-container-id-2 div.sk-estimator.fitted:hover {\n  /* fitted */\n  background-color: var(--sklearn-color-fitted-level-2);\n}\n\n/* Specification for estimator info (e.g. \"i\" and \"?\") */\n\n/* Common style for \"i\" and \"?\" */\n\n.sk-estimator-doc-link,\na:link.sk-estimator-doc-link,\na:visited.sk-estimator-doc-link {\n  float: right;\n  font-size: smaller;\n  line-height: 1em;\n  font-family: monospace;\n  background-color: var(--sklearn-color-background);\n  border-radius: 1em;\n  height: 1em;\n  width: 1em;\n  text-decoration: none !important;\n  margin-left: 0.5em;\n  text-align: center;\n  /* unfitted */\n  border: var(--sklearn-color-unfitted-level-1) 1pt solid;\n  color: var(--sklearn-color-unfitted-level-1);\n}\n\n.sk-estimator-doc-link.fitted,\na:link.sk-estimator-doc-link.fitted,\na:visited.sk-estimator-doc-link.fitted {\n  /* fitted */\n  border: var(--sklearn-color-fitted-level-1) 1pt solid;\n  color: var(--sklearn-color-fitted-level-1);\n}\n\n/* On hover */\ndiv.sk-estimator:hover .sk-estimator-doc-link:hover,\n.sk-estimator-doc-link:hover,\ndiv.sk-label-container:hover .sk-estimator-doc-link:hover,\n.sk-estimator-doc-link:hover {\n  /* unfitted */\n  background-color: var(--sklearn-color-unfitted-level-3);\n  color: var(--sklearn-color-background);\n  text-decoration: none;\n}\n\ndiv.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,\n.sk-estimator-doc-link.fitted:hover,\ndiv.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,\n.sk-estimator-doc-link.fitted:hover {\n  /* fitted */\n  background-color: var(--sklearn-color-fitted-level-3);\n  color: var(--sklearn-color-background);\n  text-decoration: none;\n}\n\n/* Span, style for the box shown on hovering the info icon */\n.sk-estimator-doc-link span {\n  display: none;\n  z-index: 9999;\n  position: relative;\n  font-weight: normal;\n  right: .2ex;\n  padding: .5ex;\n  margin: .5ex;\n  width: min-content;\n  min-width: 20ex;\n  max-width: 50ex;\n  color: var(--sklearn-color-text);\n  box-shadow: 2pt 2pt 4pt #999;\n  /* unfitted */\n  background: var(--sklearn-color-unfitted-level-0);\n  border: .5pt solid var(--sklearn-color-unfitted-level-3);\n}\n\n.sk-estimator-doc-link.fitted span {\n  /* fitted */\n  background: var(--sklearn-color-fitted-level-0);\n  border: var(--sklearn-color-fitted-level-3);\n}\n\n.sk-estimator-doc-link:hover span {\n  display: block;\n}\n\n/* \"?\"-specific style due to the `<a>` HTML tag */\n\n#sk-container-id-2 a.estimator_doc_link {\n  float: right;\n  font-size: 1rem;\n  line-height: 1em;\n  font-family: monospace;\n  background-color: var(--sklearn-color-background);\n  border-radius: 1rem;\n  height: 1rem;\n  width: 1rem;\n  text-decoration: none;\n  /* unfitted */\n  color: var(--sklearn-color-unfitted-level-1);\n  border: var(--sklearn-color-unfitted-level-1) 1pt solid;\n}\n\n#sk-container-id-2 a.estimator_doc_link.fitted {\n  /* fitted */\n  border: var(--sklearn-color-fitted-level-1) 1pt solid;\n  color: var(--sklearn-color-fitted-level-1);\n}\n\n/* On hover */\n#sk-container-id-2 a.estimator_doc_link:hover {\n  /* unfitted */\n  background-color: var(--sklearn-color-unfitted-level-3);\n  color: var(--sklearn-color-background);\n  text-decoration: none;\n}\n\n#sk-container-id-2 a.estimator_doc_link.fitted:hover {\n  /* fitted */\n  background-color: var(--sklearn-color-fitted-level-3);\n}\n</style><div id=\"sk-container-id-2\" class=\"sk-top-container\"><div class=\"sk-text-repr-fallback\"><pre>GradientBoostingClassifier(random_state=42)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class=\"sk-container\" hidden><div class=\"sk-item\"><div class=\"sk-estimator fitted sk-toggleable\"><input class=\"sk-toggleable__control sk-hidden--visually\" id=\"sk-estimator-id-2\" type=\"checkbox\" checked><label for=\"sk-estimator-id-2\" class=\"sk-toggleable__label fitted sk-toggleable__label-arrow\"><div><div>GradientBoostingClassifier</div></div><div><a class=\"sk-estimator-doc-link fitted\" rel=\"noreferrer\" target=\"_blank\" href=\"https://scikit-learn.org/1.6/modules/generated/sklearn.ensemble.GradientBoostingClassifier.html\">?<span>Documentation for GradientBoostingClassifier</span></a><span class=\"sk-estimator-doc-link fitted\">i<span>Fitted</span></span></div></label><div class=\"sk-toggleable__content fitted\"><pre>GradientBoostingClassifier(random_state=42)</pre></div> </div></div></div></div>\n```\n\n:::\n\n```{.python .cell-code}\n# 预测\ny_pred_best = best_model.predict(X_test_scaled)\ny_pred_proba_best = best_model.predict_proba(X_test_scaled)\n\n# 混淆矩阵\ncm = confusion_matrix(y_test, y_pred_best)\nprint(\"\\n混淆矩阵:\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n混淆矩阵:\n```\n\n\n:::\n\n```{.python .cell-code}\nprint(cm)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[[15  0  0]\n [ 0 15  0]\n [ 0  3 12]]\n```\n\n\n:::\n\n```{.python .cell-code}\n# 分类报告\nprint(\"\\n分类报告:\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n分类报告:\n```\n\n\n:::\n\n```{.python .cell-code}\nprint(classification_report(y_test, y_pred_best, target_names=target_names))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n              precision    recall  f1-score   support\n\n      setosa       1.00      1.00      1.00        15\n  versicolor       0.83      1.00      0.91        15\n   virginica       1.00      0.80      0.89        15\n\n    accuracy                           0.93        45\n   macro avg       0.94      0.93      0.93        45\nweighted avg       0.94      0.93      0.93        45\n```\n\n\n:::\n\n```{.python .cell-code}\n# 可视化混淆矩阵\nplt.figure(figsize=(8, 6))\nsns.heatmap(cm, annot=True, fmt='d', cmap='Blues', \n            xticklabels=target_names, yticklabels=target_names)\nplt.title(f'混淆矩阵 - {best_model_name}')\nplt.xlabel('预测标签')\nplt.ylabel('真实标签')\nplt.tight_layout()\nplt.show()\n```\n\n::: {.cell-output-display}\n![](12-分类任务_files/figure-html/unnamed-chunk-18-7.png)\n:::\n:::\n\n\n特征重要性分析\n\n\n::: {.cell}\n\n```{.python .cell-code}\n# 特征重要性分析 - Python\n\nif hasattr(best_model, 'feature_importances_'):\n    feature_importance = best_model.feature_importances_\n    feature_names = X.columns\n    \n    # 创建特征重要性DataFrame\n    importance_df = pd.DataFrame({\n        'Feature': feature_names,\n        'Importance': feature_importance\n    }).sort_values('Importance', ascending=False)\n    \n    print(\"特征重要性排序 - Python/sklearn:\")\n    print(importance_df)\n    \n    # 可视化特征重要性\n    plt.figure(figsize=(10, 6))\n    sns.barplot(data=importance_df, x='Importance', y='Feature', palette='viridis')\n    plt.title(f'特征重要性 - {best_model_name} (Python/sklearn)')\n    plt.xlabel('重要性')\n    plt.tight_layout()\n    plt.show()\n\nelse:\n    print(f\"{best_model_name} 不支持特征重要性计算\")\n    \n    # 使用排列重要性作为替代\n    perm_importance = permutation_importance(\n        best_model, X_test_scaled, y_test, n_repeats=10, random_state=42\n    )\n    \n    perm_importance_df = pd.DataFrame({\n        'Feature': feature_names,\n        'Importance': perm_importance.importances_mean\n    }).sort_values('Importance', ascending=False)\n    \n    print(\"\\n排列特征重要性:\")\n    print(perm_importance_df)\n    \n    # 可视化排列重要性\n    plt.figure(figsize=(10, 6))\n    sns.barplot(data=perm_importance_df, x='Importance', y='Feature', palette='rocket')\n    plt.title(f'排列特征重要性 - {best_model_name} (Python/sklearn)')\n    plt.xlabel('重要性')\n    plt.tight_layout()\n    plt.show()\n```\n\n::: {.cell-output-display}\n![](12-分类任务_files/figure-html/unnamed-chunk-19-9.png)\n:::\n:::\n\n\n## 12.6 多分类案例总结\n\n关键发现\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 案例总结 - R语言\ncat(\"=== 鸢尾花分类案例总结 ===\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n=== 鸢尾花分类案例总结 ===\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"1. 数据特征:\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n1. 数据特征:\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"   - 数据集包含\", nrow(iris_data), \"个样本，\", ncol(iris_data)-1, \"个特征\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   - 数据集包含 150 个样本， 4 个特征\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"   - 目标变量: 鸢尾花种类(3个类别)\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   - 目标变量: 鸢尾花种类(3个类别)\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"   - 类别分布均衡\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   - 类别分布均衡\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"   - 最重要的特征: 花瓣长度和宽度\\n\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   - 最重要的特征: 花瓣长度和宽度\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"2. 模型性能比较:\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n2. 模型性能比较:\n```\n\n\n:::\n\n```{.r .cell-code}\nprint(results_r[order(-Accuracy)])\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n           Model  Accuracy   AUC Balanced_Accuracy    LogLoss\n          <char>     <num> <num>             <num>      <num>\n1:           svm 0.9666667   NaN         0.9644974 0.03333333\n2: random_forest 0.9600000   NaN         0.9561640 0.04000000\n3:           knn 0.9466667   NaN         0.9413492 0.05333333\n4:       xgboost 0.9400000   NaN         0.9339418 0.06000000\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"\\n3. 分类问题最佳实践:\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n3. 分类问题最佳实践:\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"   - 树模型和SVM在分类问题上表现优异\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   - 树模型和SVM在分类问题上表现优异\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"   - 特征标准化对距离-based模型很重要\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   - 特征标准化对距离-based模型很重要\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"   - 多分类问题需要考虑合适的评估指标\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   - 多分类问题需要考虑合适的评估指标\n```\n\n\n:::\n\n```{.r .cell-code}\ncat(\"   - 特征重要性分析有助于理解模型决策\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   - 特征重要性分析有助于理解模型决策\n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.python .cell-code}\n# 案例总结 - Python\nprint(\"=== 鸢尾花分类案例总结 ===\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n=== 鸢尾花分类案例总结 ===\n```\n\n\n:::\n\n```{.python .cell-code}\nprint(\"1. 数据特征:\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n1. 数据特征:\n```\n\n\n:::\n\n```{.python .cell-code}\nprint(f\"   - 数据集包含 {iris_data.shape[0]} 个样本，{iris_data.shape[1]-1} 个特征\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   - 数据集包含 150 个样本，5 个特征\n```\n\n\n:::\n\n```{.python .cell-code}\nprint(\"   - 目标变量: 鸢尾花种类(3个类别)\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   - 目标变量: 鸢尾花种类(3个类别)\n```\n\n\n:::\n\n```{.python .cell-code}\nprint(\"   - 类别分布均衡\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   - 类别分布均衡\n```\n\n\n:::\n\n```{.python .cell-code}\nprint(\"   - 最重要的特征: 花瓣长度和宽度\\n\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   - 最重要的特征: 花瓣长度和宽度\n```\n\n\n:::\n\n```{.python .cell-code}\nprint(\"2. 模型性能比较:\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n2. 模型性能比较:\n```\n\n\n:::\n\n```{.python .cell-code}\nprint(results_python[['Model', 'Accuracy', 'F1_Score', 'AUC']].sort_values('Accuracy', ascending=False).to_string(index=False))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n              Model  Accuracy  F1_Score      AUC\n  Gradient Boosting  0.933333  0.932660 0.998519\nLogistic Regression  0.911111  0.910714 0.995556\n        K-Neighbors  0.911111  0.909502 0.988889\n      Random Forest  0.888889  0.887767 0.992593\n```\n\n\n:::\n\n```{.python .cell-code}\nprint(\"\\n3. 分类问题最佳实践:\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n3. 分类问题最佳实践:\n```\n\n\n:::\n\n```{.python .cell-code}\nprint(\"   - 集成学习方法在分类问题上表现稳定\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   - 集成学习方法在分类问题上表现稳定\n```\n\n\n:::\n\n```{.python .cell-code}\nprint(\"   - 数据预处理对模型性能影响显著\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   - 数据预处理对模型性能影响显著\n```\n\n\n:::\n\n```{.python .cell-code}\nprint(\"   - 交叉验证提供更可靠的性能估计\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   - 交叉验证提供更可靠的性能估计\n```\n\n\n:::\n\n```{.python .cell-code}\nprint(\"   - 混淆矩阵和分类报告提供详细性能分析\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   - 混淆矩阵和分类报告提供详细性能分析\n```\n\n\n:::\n:::\n\n\n技术要点回顾\n\n**数据预处理**： - 特征标准化：确保不同尺度的特征具有可比性 - 类别编码：将文本标签转换为数值 - 数据划分：使用分层抽样保持类别比例\n\n**模型选择**： - 逻辑回归：可解释性强，适合线性可分数据 - 树模型：自动处理非线性关系，提供特征重要性 - SVM：在高维空间中表现优异 - KNN：基于距离的简单有效方法\n\n**模型评估**： - 准确率：整体分类正确率 - 精确率、召回率、F1分数：更细致的性能评估 - AUC：模型区分能力的综合指标 - 混淆矩阵：详细分析各类别的分类情况\n\n**模型优化**： - 超参数调优：提升模型性能 - 特征选择：基于重要性筛选特征 - 交叉验证：稳健的性能估计\n\n业务应用建议\n\n-   物种识别：扩展到其他植物或动物的分类识别\n\n-   质量检测：应用于工业产品质量分类\n\n-   医疗诊断：用于疾病分类和诊断辅助\n\n-   客户细分：用于市场营销中的客户分类",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}