<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh-Hans" xml:lang="zh-Hans"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>13&nbsp; 分类任务 – 现代预测建模：从回归到机器学习</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../chapters/14 案例综合分析.html" rel="next">
<link href="../chapters/12 回归任务.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-70a47bd5681a7291082a5b9f83d58762.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "没有结果",
    "search-matching-documents-text": "匹配的文档",
    "search-copy-link-title": "复制搜索链接",
    "search-hide-matches-text": "隐藏其它匹配结果",
    "search-more-match-text": "更多匹配结果",
    "search-more-matches-text": "更多匹配结果",
    "search-clear-button-title": "清除",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "取消",
    "search-submit-button-title": "提交",
    "search-label": "搜索"
  }
}</script><link rel="stylesheet" href="science-textbook.css">
</head>
<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="展开或折叠侧边栏导航" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapters/11 基准测试.html">实训——综合案例建模实践</a></li><li class="breadcrumb-item"><a href="../chapters/13 分类任务.html"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">分类任务</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="展开或折叠侧边栏导航" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="搜索" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">现代预测建模：从回归到机器学习</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="搜索"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">前言</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">index.html</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">起步-线性回归分析</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="展开或折叠此栏">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/1 预测、过拟合与模型评估.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">预测、过拟合与模型评估</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/2 线性回归.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">线性回归</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/3 模型诊断.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">模型诊断</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/4 时间序列分析初步.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">时间序列分析初步</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">扩展——线性分析模型及其超越</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="展开或折叠此栏">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/5 高维线性模型：正则化与降维.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">高维线性模型：正则化与降维</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/6 广义线性模型与线性分类.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">广义线性模型与线性分类</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/7 多项式回归与样条回归.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">多项式与样条回归</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">进阶——超越线性的机器学习</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="展开或折叠此栏">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/8 决策树与集成学习.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">决策树与集成学习</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/9 支持向量机.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">支持向量机</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/10 神经网络与深度学习基础.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">神经网络与深度学习基础</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">实训——综合案例建模实践</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="展开或折叠此栏">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/11 基准测试.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">基准测试</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/12 回归任务.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">回归任务</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/13 分类任务.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">分类任务</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/14 案例综合分析.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">综合数据分析</span></span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">目录</h2>
   
  <ul>
<li><a href="#%E5%88%86%E7%B1%BB%E9%97%AE%E9%A2%98%E5%AF%BC%E8%AF%BB" id="toc-分类问题导读" class="nav-link active" data-scroll-target="#%E5%88%86%E7%B1%BB%E9%97%AE%E9%A2%98%E5%AF%BC%E8%AF%BB"><span class="header-section-number">13.1</span> 分类问题导读</a></li>
  <li><a href="#r%E8%AF%AD%E8%A8%80%E5%AE%9E%E7%8E%B0-mlr3%E6%A1%86%E6%9E%B6%E5%88%86%E7%B1%BB" id="toc-r语言实现-mlr3框架分类" class="nav-link" data-scroll-target="#r%E8%AF%AD%E8%A8%80%E5%AE%9E%E7%8E%B0-mlr3%E6%A1%86%E6%9E%B6%E5%88%86%E7%B1%BB"><span class="header-section-number">13.2</span> 13.1 R语言实现 (mlr3框架)–分类</a></li>
  <li><a href="#python%E8%AF%AD%E8%A8%80%E5%AE%9E%E7%8E%B0-sklearn%E6%A1%86%E6%9E%B6%E5%88%86%E7%B1%BB" id="toc-python语言实现-sklearn框架分类" class="nav-link" data-scroll-target="#python%E8%AF%AD%E8%A8%80%E5%AE%9E%E7%8E%B0-sklearn%E6%A1%86%E6%9E%B6%E5%88%86%E7%B1%BB"><span class="header-section-number">13.3</span> 13.2 Python语言实现 (sklearn框架)–分类</a></li>
  <li><a href="#%E6%A1%88%E4%BE%8B%E6%80%BB%E7%BB%93%E4%B8%8E%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5" id="toc-案例总结与最佳实践" class="nav-link" data-scroll-target="#%E6%A1%88%E4%BE%8B%E6%80%BB%E7%BB%93%E4%B8%8E%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="header-section-number">13.4</span> 13.3 案例总结与最佳实践</a></li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapters/11 基准测试.html">实训——综合案例建模实践</a></li><li class="breadcrumb-item"><a href="../chapters/13 分类任务.html"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">分类任务</span></a></li></ol></nav><div class="quarto-title">
<h1 class="title">
<span class="chapter-number">13</span>&nbsp; <span class="chapter-title">分类任务</span>
</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><section id="分类问题导读" class="level2" data-number="13.1"><h2 data-number="13.1" class="anchored" data-anchor-id="分类问题导读">
<span class="header-section-number">13.1</span> 分类问题导读</h2>
<p>分类问题是机器学习中最常见的任务之一，广泛应用于物种分类、医疗诊断、客户分类等领域。本章将通过鸢尾花分类案例，完整展示多分类问题的解决方案，涵盖数据探索、特征工程、多种分类算法比较、模型评估等关键环节。</p>
<p>数据集说明 本案例使用经典的鸢尾花数据集（Iris Dataset），包含三种鸢尾花的萼片和花瓣测量数据。</p>
<p>问题定义 <strong>目标</strong>：预测鸢尾花的种类（Species）<br><strong>任务类型</strong>：多分类问题（3个类别）<br><strong>业务价值</strong>：植物分类、物种识别</p>
</section><section id="r语言实现-mlr3框架分类" class="level2" data-number="13.2"><h2 data-number="13.2" class="anchored" data-anchor-id="r语言实现-mlr3框架分类">
<span class="header-section-number">13.2</span> 13.1 R语言实现 (mlr3框架)–分类</h2>
<p>数据加载与探索</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="co"># 综合案例：鸢尾花分类 - R语言实现 (mlr3框架)</span></span>
<span id="cb1-2"><a href="#cb1-2"></a></span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="co"># 加载必要的包</span></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="fu">library</span>(mlr3)</span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="fu">library</span>(mlr3verse)</span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="fu">library</span>(mlr3pipelines)</span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="fu">library</span>(mlr3tuning)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: paradox</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="fu">library</span>(corrplot)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>corrplot 0.95 loaded</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb5-3"><a href="#cb5-3"></a></span>
<span id="cb5-4"><a href="#cb5-4"></a><span class="co"># 加载鸢尾花数据集</span></span>
<span id="cb5-5"><a href="#cb5-5"></a><span class="fu">data</span>(<span class="st">"iris"</span>, <span class="at">package =</span> <span class="st">"datasets"</span>)</span>
<span id="cb5-6"><a href="#cb5-6"></a>iris_data <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(iris)</span>
<span id="cb5-7"><a href="#cb5-7"></a></span>
<span id="cb5-8"><a href="#cb5-8"></a><span class="co"># 数据基本信息</span></span>
<span id="cb5-9"><a href="#cb5-9"></a><span class="fu">cat</span>(<span class="st">"数据集基本信息:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>数据集基本信息:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="fu">cat</span>(<span class="st">"样本数:"</span>, <span class="fu">nrow</span>(iris_data), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>样本数: 150 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="fu">cat</span>(<span class="st">"变量数:"</span>, <span class="fu">ncol</span>(iris_data), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>变量数: 5 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">变量名称:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
变量名称:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="fu">print</span>(<span class="fu">names</span>(iris_data))</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Sepal.Length" "Sepal.Width"  "Petal.Length" "Petal.Width"  "Species"     </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="co"># 类别分布</span></span>
<span id="cb15-2"><a href="#cb15-2"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">类别分布:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
类别分布:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a>class_dist <span class="ot">&lt;-</span> <span class="fu">table</span>(iris_data<span class="sc">$</span>Species)</span>
<span id="cb17-2"><a href="#cb17-2"></a><span class="fu">print</span>(class_dist)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    setosa versicolor  virginica 
        50         50         50 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="fu">cat</span>(<span class="st">"类别比例:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>类别比例:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a><span class="fu">print</span>(<span class="fu">prop.table</span>(class_dist))</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    setosa versicolor  virginica 
 0.3333333  0.3333333  0.3333333 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a><span class="co"># 数据概览</span></span>
<span id="cb23-2"><a href="#cb23-2"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">数据概览:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
数据概览:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a><span class="fu">print</span>(<span class="fu">summary</span>(iris_data))</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Sepal.Length    Sepal.Width     Petal.Length    Petal.Width   
 Min.   :4.300   Min.   :2.000   Min.   :1.000   Min.   :0.100  
 1st Qu.:5.100   1st Qu.:2.800   1st Qu.:1.600   1st Qu.:0.300  
 Median :5.800   Median :3.000   Median :4.350   Median :1.300  
 Mean   :5.843   Mean   :3.057   Mean   :3.758   Mean   :1.199  
 3rd Qu.:6.400   3rd Qu.:3.300   3rd Qu.:5.100   3rd Qu.:1.800  
 Max.   :7.900   Max.   :4.400   Max.   :6.900   Max.   :2.500  
       Species  
 setosa    :50  
 versicolor:50  
 virginica :50  
                
                
                </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a><span class="co"># 检查缺失值</span></span>
<span id="cb27-2"><a href="#cb27-2"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">缺失值检查:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
缺失值检查:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a><span class="fu">print</span>(<span class="fu">colSums</span>(<span class="fu">is.na</span>(iris_data)))</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Sepal.Length  Sepal.Width Petal.Length  Petal.Width      Species 
           0            0            0            0            0 </code></pre>
</div>
</div>
<p>数据可视化分析</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a><span class="co"># 数据可视化分析 - R语言</span></span>
<span id="cb31-2"><a href="#cb31-2"></a></span>
<span id="cb31-3"><a href="#cb31-3"></a><span class="co"># 类别分布</span></span>
<span id="cb31-4"><a href="#cb31-4"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(iris_data, <span class="fu">aes</span>(<span class="at">x =</span> Species, <span class="at">fill =</span> Species)) <span class="sc">+</span></span>
<span id="cb31-5"><a href="#cb31-5"></a>  <span class="fu">geom_bar</span>(<span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb31-6"><a href="#cb31-6"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">"Set1"</span>) <span class="sc">+</span></span>
<span id="cb31-7"><a href="#cb31-7"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"类别分布"</span>, <span class="at">x =</span> <span class="st">"鸢尾花种类"</span>, <span class="at">y =</span> <span class="st">"数量"</span>) <span class="sc">+</span></span>
<span id="cb31-8"><a href="#cb31-8"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb31-9"><a href="#cb31-9"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb31-10"><a href="#cb31-10"></a></span>
<span id="cb31-11"><a href="#cb31-11"></a><span class="co"># 花萼长度与宽度的关系</span></span>
<span id="cb31-12"><a href="#cb31-12"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(iris_data, <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width, <span class="at">color =</span> Species)) <span class="sc">+</span></span>
<span id="cb31-13"><a href="#cb31-13"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb31-14"><a href="#cb31-14"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">"Set1"</span>) <span class="sc">+</span></span>
<span id="cb31-15"><a href="#cb31-15"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"花萼长度 vs 宽度"</span>, <span class="at">x =</span> <span class="st">"花萼长度"</span>, <span class="at">y =</span> <span class="st">"花萼宽度"</span>) <span class="sc">+</span></span>
<span id="cb31-16"><a href="#cb31-16"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb31-17"><a href="#cb31-17"></a></span>
<span id="cb31-18"><a href="#cb31-18"></a><span class="co"># 花瓣长度与宽度的关系</span></span>
<span id="cb31-19"><a href="#cb31-19"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(iris_data, <span class="fu">aes</span>(<span class="at">x =</span> Petal.Length, <span class="at">y =</span> Petal.Width, <span class="at">color =</span> Species)) <span class="sc">+</span></span>
<span id="cb31-20"><a href="#cb31-20"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb31-21"><a href="#cb31-21"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">"Set1"</span>) <span class="sc">+</span></span>
<span id="cb31-22"><a href="#cb31-22"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"花瓣长度 vs 宽度"</span>, <span class="at">x =</span> <span class="st">"花瓣长度"</span>, <span class="at">y =</span> <span class="st">"花瓣宽度"</span>) <span class="sc">+</span></span>
<span id="cb31-23"><a href="#cb31-23"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb31-24"><a href="#cb31-24"></a></span>
<span id="cb31-25"><a href="#cb31-25"></a><span class="co"># 特征分布箱线图</span></span>
<span id="cb31-26"><a href="#cb31-26"></a>p4 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(iris_data, <span class="fu">aes</span>(<span class="at">x =</span> Species, <span class="at">y =</span> Petal.Length, <span class="at">fill =</span> Species)) <span class="sc">+</span></span>
<span id="cb31-27"><a href="#cb31-27"></a>  <span class="fu">geom_boxplot</span>(<span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb31-28"><a href="#cb31-28"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">"Set1"</span>) <span class="sc">+</span></span>
<span id="cb31-29"><a href="#cb31-29"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"花瓣长度分布"</span>, <span class="at">x =</span> <span class="st">"鸢尾花种类"</span>, <span class="at">y =</span> <span class="st">"花瓣长度"</span>) <span class="sc">+</span></span>
<span id="cb31-30"><a href="#cb31-30"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb31-31"><a href="#cb31-31"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb31-32"><a href="#cb31-32"></a></span>
<span id="cb31-33"><a href="#cb31-33"></a><span class="co"># 组合图形</span></span>
<span id="cb31-34"><a href="#cb31-34"></a>(p1 <span class="sc">+</span> p2) <span class="sc">/</span> (p3 <span class="sc">+</span> p4)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="13-分类任务_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>创建mlr3任务和数据预处理</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a><span class="co"># 创建mlr3任务和数据预处理</span></span>
<span id="cb32-2"><a href="#cb32-2"></a></span>
<span id="cb32-3"><a href="#cb32-3"></a><span class="co"># 创建分类任务</span></span>
<span id="cb32-4"><a href="#cb32-4"></a>task_iris <span class="ot">&lt;-</span> <span class="fu">as_task_classif</span>(iris_data, <span class="at">target =</span> <span class="st">"Species"</span>, <span class="at">id =</span> <span class="st">"iris"</span>)</span>
<span id="cb32-5"><a href="#cb32-5"></a></span>
<span id="cb32-6"><a href="#cb32-6"></a><span class="co"># 查看任务信息</span></span>
<span id="cb32-7"><a href="#cb32-7"></a><span class="fu">cat</span>(<span class="st">"任务信息:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>任务信息:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a><span class="fu">print</span>(task_iris)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
── &lt;TaskClassif&gt; (150x5) ───────────────────────────────────────────────────────
• Target: Species
• Target classes: setosa (33%), versicolor (33%), virginica (33%)
• Properties: multiclass
• Features (4):
  • dbl (4): Petal.Length, Petal.Width, Sepal.Length, Sepal.Width</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a><span class="co"># 数据预处理管道</span></span>
<span id="cb36-2"><a href="#cb36-2"></a>preprocess_pipeline <span class="ot">&lt;-</span> <span class="fu">po</span>(<span class="st">"scale"</span>) <span class="sc">%&gt;&gt;%</span> </span>
<span id="cb36-3"><a href="#cb36-3"></a>  <span class="fu">po</span>(<span class="st">"encode"</span>) <span class="sc">%&gt;&gt;%</span></span>
<span id="cb36-4"><a href="#cb36-4"></a>  <span class="fu">po</span>(<span class="st">"colapply"</span>, <span class="at">applicator =</span> as.numeric)</span>
<span id="cb36-5"><a href="#cb36-5"></a></span>
<span id="cb36-6"><a href="#cb36-6"></a><span class="co"># 应用预处理</span></span>
<span id="cb36-7"><a href="#cb36-7"></a>task_preprocessed <span class="ot">&lt;-</span> preprocess_pipeline<span class="sc">$</span><span class="fu">train</span>(task_iris)[[<span class="dv">1</span>]]</span>
<span id="cb36-8"><a href="#cb36-8"></a></span>
<span id="cb36-9"><a href="#cb36-9"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">预处理后的任务信息:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
预处理后的任务信息:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1"></a><span class="fu">print</span>(task_preprocessed)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
── &lt;TaskClassif&gt; (150x5) ───────────────────────────────────────────────────────
• Target: Species
• Target classes: setosa (33%), versicolor (33%), virginica (33%)
• Properties: multiclass
• Features (4):
  • dbl (4): Petal.Length, Petal.Width, Sepal.Length, Sepal.Width</code></pre>
</div>
</div>
<p>模型训练与比较</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1"></a><span class="co"># 模型训练与比较 - mlr3</span></span>
<span id="cb40-2"><a href="#cb40-2"></a></span>
<span id="cb40-3"><a href="#cb40-3"></a><span class="co"># 定义学习器</span></span>
<span id="cb40-4"><a href="#cb40-4"></a>learners <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb40-5"><a href="#cb40-5"></a>  <span class="fu">lrn</span>(<span class="st">"classif.ranger"</span>, <span class="at">id =</span> <span class="st">"random_forest"</span>, <span class="at">predict_type =</span> <span class="st">"prob"</span>),</span>
<span id="cb40-6"><a href="#cb40-6"></a>  <span class="fu">lrn</span>(<span class="st">"classif.xgboost"</span>, <span class="at">id =</span> <span class="st">"xgboost"</span>, <span class="at">predict_type =</span> <span class="st">"prob"</span>),</span>
<span id="cb40-7"><a href="#cb40-7"></a>  <span class="fu">lrn</span>(<span class="st">"classif.svm"</span>, <span class="at">id =</span> <span class="st">"svm"</span>, <span class="at">predict_type =</span> <span class="st">"prob"</span>),</span>
<span id="cb40-8"><a href="#cb40-8"></a>  <span class="fu">lrn</span>(<span class="st">"classif.kknn"</span>, <span class="at">id =</span> <span class="st">"knn"</span>, <span class="at">predict_type =</span> <span class="st">"prob"</span>)</span>
<span id="cb40-9"><a href="#cb40-9"></a>)</span>
<span id="cb40-10"><a href="#cb40-10"></a></span>
<span id="cb40-11"><a href="#cb40-11"></a><span class="co"># 设置交叉验证和评估指标</span></span>
<span id="cb40-12"><a href="#cb40-12"></a>resampling <span class="ot">&lt;-</span> <span class="fu">rsmp</span>(<span class="st">"cv"</span>, <span class="at">folds =</span> <span class="dv">5</span>)</span>
<span id="cb40-13"><a href="#cb40-13"></a>measures <span class="ot">&lt;-</span> <span class="fu">msrs</span>(<span class="fu">c</span>(<span class="st">"classif.acc"</span>, <span class="st">"classif.auc"</span>, <span class="st">"classif.bacc"</span>, <span class="st">"classif.ce"</span>))</span>
<span id="cb40-14"><a href="#cb40-14"></a></span>
<span id="cb40-15"><a href="#cb40-15"></a><span class="co"># 基准测试</span></span>
<span id="cb40-16"><a href="#cb40-16"></a>design <span class="ot">&lt;-</span> <span class="fu">benchmark_grid</span>(</span>
<span id="cb40-17"><a href="#cb40-17"></a>  <span class="at">tasks =</span> task_preprocessed,</span>
<span id="cb40-18"><a href="#cb40-18"></a>  <span class="at">learners =</span> learners,</span>
<span id="cb40-19"><a href="#cb40-19"></a>  <span class="at">resamplings =</span> resampling</span>
<span id="cb40-20"><a href="#cb40-20"></a>)</span>
<span id="cb40-21"><a href="#cb40-21"></a></span>
<span id="cb40-22"><a href="#cb40-22"></a>bmr <span class="ot">&lt;-</span> <span class="fu">benchmark</span>(design)</span>
<span id="cb40-23"><a href="#cb40-23"></a></span>
<span id="cb40-24"><a href="#cb40-24"></a><span class="co"># 性能评估</span></span>
<span id="cb40-25"><a href="#cb40-25"></a><span class="fu">cat</span>(<span class="st">"模型性能比较:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>模型性能比较:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1"></a>bmr_aggregated <span class="ot">&lt;-</span> bmr<span class="sc">$</span><span class="fu">aggregate</span>(measures)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Measure 'classif.auc' is missing properties 'twoclass' of task 'iris'
Warning: Measure 'classif.auc' is missing properties 'twoclass' of task 'iris'
Warning: Measure 'classif.auc' is missing properties 'twoclass' of task 'iris'
Warning: Measure 'classif.auc' is missing properties 'twoclass' of task 'iris'</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb44"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1"></a><span class="co"># 格式化输出结果</span></span>
<span id="cb44-2"><a href="#cb44-2"></a>results_r <span class="ot">&lt;-</span> bmr_aggregated[, .(</span>
<span id="cb44-3"><a href="#cb44-3"></a>  <span class="at">Model =</span> learner_id,</span>
<span id="cb44-4"><a href="#cb44-4"></a>  <span class="at">Accuracy =</span> classif.acc,</span>
<span id="cb44-5"><a href="#cb44-5"></a>  <span class="at">AUC =</span> classif.auc,</span>
<span id="cb44-6"><a href="#cb44-6"></a>  <span class="at">Balanced_Accuracy =</span> classif.bacc,</span>
<span id="cb44-7"><a href="#cb44-7"></a>  <span class="at">LogLoss =</span> classif.ce</span>
<span id="cb44-8"><a href="#cb44-8"></a>)]</span>
<span id="cb44-9"><a href="#cb44-9"></a></span>
<span id="cb44-10"><a href="#cb44-10"></a><span class="fu">print</span>(results_r[<span class="fu">order</span>(<span class="sc">-</span>Accuracy)])</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>           Model  Accuracy   AUC Balanced_Accuracy    LogLoss
          &lt;char&gt;     &lt;num&gt; &lt;num&gt;             &lt;num&gt;      &lt;num&gt;
1:           svm 0.9600000   NaN         0.9677489 0.04000000
2: random_forest 0.9533333   NaN         0.9621934 0.04666667
3:           knn 0.9533333   NaN         0.9610823 0.04666667
4:       xgboost 0.9466667   NaN         0.9498918 0.05333333</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1"></a><span class="co"># 性能可视化</span></span>
<span id="cb46-2"><a href="#cb46-2"></a><span class="fu">ggplot</span>(results_r, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(Model, Accuracy), <span class="at">y =</span> Accuracy)) <span class="sc">+</span></span>
<span id="cb46-3"><a href="#cb46-3"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">fill =</span> <span class="st">"steelblue"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb46-4"><a href="#cb46-4"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"模型性能比较 (准确率) - R/mlr3"</span>, <span class="at">x =</span> <span class="st">"模型"</span>, <span class="at">y =</span> <span class="st">"准确率"</span>) <span class="sc">+</span></span>
<span id="cb46-5"><a href="#cb46-5"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb46-6"><a href="#cb46-6"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb46-7"><a href="#cb46-7"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>, <span class="dv">1</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="13-分类任务_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>超参数调优</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1"></a><span class="co"># 超参数调优示例 - 随机森林</span></span>
<span id="cb47-2"><a href="#cb47-2"></a></span>
<span id="cb47-3"><a href="#cb47-3"></a><span class="co"># 定义随机森林学习器</span></span>
<span id="cb47-4"><a href="#cb47-4"></a>learner_rf_tune <span class="ot">&lt;-</span> <span class="fu">lrn</span>(<span class="st">"classif.ranger"</span>, <span class="at">predict_type =</span> <span class="st">"prob"</span>, <span class="at">num.trees =</span> <span class="dv">100</span>)</span>
<span id="cb47-5"><a href="#cb47-5"></a></span>
<span id="cb47-6"><a href="#cb47-6"></a><span class="co"># 定义超参数空间</span></span>
<span id="cb47-7"><a href="#cb47-7"></a>param_set <span class="ot">&lt;-</span> <span class="fu">ps</span>(</span>
<span id="cb47-8"><a href="#cb47-8"></a>  <span class="at">mtry =</span> <span class="fu">p_int</span>(<span class="at">lower =</span> <span class="dv">1</span>, <span class="at">upper =</span> <span class="fu">ncol</span>(iris_data) <span class="sc">-</span> <span class="dv">1</span>),</span>
<span id="cb47-9"><a href="#cb47-9"></a>  <span class="at">min.node.size =</span> <span class="fu">p_int</span>(<span class="at">lower =</span> <span class="dv">1</span>, <span class="at">upper =</span> <span class="dv">10</span>),</span>
<span id="cb47-10"><a href="#cb47-10"></a>  <span class="at">sample.fraction =</span> <span class="fu">p_dbl</span>(<span class="at">lower =</span> <span class="fl">0.6</span>, <span class="at">upper =</span> <span class="fl">0.9</span>)</span>
<span id="cb47-11"><a href="#cb47-11"></a>)</span>
<span id="cb47-12"><a href="#cb47-12"></a></span>
<span id="cb47-13"><a href="#cb47-13"></a><span class="co"># 定义调优器</span></span>
<span id="cb47-14"><a href="#cb47-14"></a>tuner <span class="ot">&lt;-</span> <span class="fu">tnr</span>(<span class="st">"grid_search"</span>, <span class="at">resolution =</span> <span class="dv">5</span>)</span>
<span id="cb47-15"><a href="#cb47-15"></a>terminator <span class="ot">&lt;-</span> <span class="fu">trm</span>(<span class="st">"evals"</span>, <span class="at">n_evals =</span> <span class="dv">10</span>)</span>
<span id="cb47-16"><a href="#cb47-16"></a></span>
<span id="cb47-17"><a href="#cb47-17"></a><span class="co"># 自动调优</span></span>
<span id="cb47-18"><a href="#cb47-18"></a>at <span class="ot">&lt;-</span> <span class="fu">auto_tuner</span>(</span>
<span id="cb47-19"><a href="#cb47-19"></a>  <span class="at">tuner =</span> tuner,</span>
<span id="cb47-20"><a href="#cb47-20"></a>  <span class="at">learner =</span> learner_rf_tune,</span>
<span id="cb47-21"><a href="#cb47-21"></a>  <span class="at">resampling =</span> <span class="fu">rsmp</span>(<span class="st">"holdout"</span>),</span>
<span id="cb47-22"><a href="#cb47-22"></a>  <span class="at">measure =</span> <span class="fu">msr</span>(<span class="st">"classif.ce"</span>),</span>
<span id="cb47-23"><a href="#cb47-23"></a>  <span class="at">search_space =</span> param_set,</span>
<span id="cb47-24"><a href="#cb47-24"></a>  <span class="at">terminator =</span> terminator</span>
<span id="cb47-25"><a href="#cb47-25"></a>)</span>
<span id="cb47-26"><a href="#cb47-26"></a></span>
<span id="cb47-27"><a href="#cb47-27"></a><span class="co"># 在数据上演示调优</span></span>
<span id="cb47-28"><a href="#cb47-28"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb47-29"><a href="#cb47-29"></a>at<span class="sc">$</span><span class="fu">train</span>(task_preprocessed)</span>
<span id="cb47-30"><a href="#cb47-30"></a></span>
<span id="cb47-31"><a href="#cb47-31"></a><span class="fu">cat</span>(<span class="st">"最佳参数:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>最佳参数:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb49"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1"></a><span class="fu">print</span>(at<span class="sc">$</span>tuning_result)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>    mtry min.node.size sample.fraction learner_param_vals  x_domain classif.ce
   &lt;int&gt;         &lt;int&gt;           &lt;num&gt;             &lt;list&gt;    &lt;list&gt;      &lt;num&gt;
1:     2             3             0.6          &lt;list[5]&gt; &lt;list[3]&gt;       0.04</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb51"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1"></a><span class="co"># 使用调优后的模型进行预测</span></span>
<span id="cb51-2"><a href="#cb51-2"></a>predictions_tuned <span class="ot">&lt;-</span> at<span class="sc">$</span><span class="fu">predict</span>(task_preprocessed)</span>
<span id="cb51-3"><a href="#cb51-3"></a><span class="fu">cat</span>(<span class="st">"调优完成</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>调优完成</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb53"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1"></a><span class="fu">cat</span>(<span class="st">"调优后模型准确率:"</span>, predictions_tuned<span class="sc">$</span><span class="fu">score</span>(<span class="fu">msr</span>(<span class="st">"classif.acc"</span>)), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>调优后模型准确率: 0.9733333 </code></pre>
</div>
</div>
<p>模型解释</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb55"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1"></a><span class="co"># 模型解释 - 特征重要性</span></span>
<span id="cb55-2"><a href="#cb55-2"></a></span>
<span id="cb55-3"><a href="#cb55-3"></a><span class="co"># 训练最佳模型（随机森林）</span></span>
<span id="cb55-4"><a href="#cb55-4"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb55-5"><a href="#cb55-5"></a>learner_best <span class="ot">&lt;-</span> <span class="fu">lrn</span>(<span class="st">"classif.ranger"</span>, <span class="at">predict_type =</span> <span class="st">"prob"</span>, <span class="at">importance =</span> <span class="st">"permutation"</span>)</span>
<span id="cb55-6"><a href="#cb55-6"></a>learner_best<span class="sc">$</span><span class="fu">train</span>(task_preprocessed)</span>
<span id="cb55-7"><a href="#cb55-7"></a></span>
<span id="cb55-8"><a href="#cb55-8"></a><span class="co"># 特征重要性</span></span>
<span id="cb55-9"><a href="#cb55-9"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(learner_best<span class="sc">$</span>importance)) {</span>
<span id="cb55-10"><a href="#cb55-10"></a>  feature_importance <span class="ot">&lt;-</span> learner_best<span class="sc">$</span><span class="fu">importance</span>()</span>
<span id="cb55-11"><a href="#cb55-11"></a>  importance_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb55-12"><a href="#cb55-12"></a>    <span class="at">Feature =</span> <span class="fu">names</span>(feature_importance),</span>
<span id="cb55-13"><a href="#cb55-13"></a>    <span class="at">Importance =</span> <span class="fu">as.numeric</span>(feature_importance)</span>
<span id="cb55-14"><a href="#cb55-14"></a>  )</span>
<span id="cb55-15"><a href="#cb55-15"></a>  importance_df <span class="ot">&lt;-</span> importance_df[<span class="fu">order</span>(<span class="sc">-</span>importance_df<span class="sc">$</span>Importance), ]</span>
<span id="cb55-16"><a href="#cb55-16"></a>  </span>
<span id="cb55-17"><a href="#cb55-17"></a>  <span class="fu">cat</span>(<span class="st">"特征重要性排序:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb55-18"><a href="#cb55-18"></a>  <span class="fu">print</span>(importance_df)</span>
<span id="cb55-19"><a href="#cb55-19"></a>  </span>
<span id="cb55-20"><a href="#cb55-20"></a>  <span class="co"># 可视化特征重要性</span></span>
<span id="cb55-21"><a href="#cb55-21"></a>  <span class="fu">ggplot</span>(importance_df, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(Feature, Importance), <span class="at">y =</span> Importance)) <span class="sc">+</span></span>
<span id="cb55-22"><a href="#cb55-22"></a>    <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">fill =</span> <span class="st">"darkorange"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb55-23"><a href="#cb55-23"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"特征重要性 - 随机森林"</span>, <span class="at">x =</span> <span class="st">"特征"</span>, <span class="at">y =</span> <span class="st">"重要性"</span>) <span class="sc">+</span></span>
<span id="cb55-24"><a href="#cb55-24"></a>    <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb55-25"><a href="#cb55-25"></a>    <span class="fu">theme_minimal</span>()</span>
<span id="cb55-26"><a href="#cb55-26"></a>} <span class="cf">else</span> {</span>
<span id="cb55-27"><a href="#cb55-27"></a>  <span class="fu">cat</span>(<span class="st">"该学习器不支持特征重要性计算</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb55-28"><a href="#cb55-28"></a>}</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>特征重要性排序:
       Feature  Importance
1  Petal.Width 0.296006354
2 Petal.Length 0.292785833
3 Sepal.Length 0.033216550
4  Sepal.Width 0.006679592</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="13-分类任务_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>模型评估与混淆矩阵</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb57"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1"></a><span class="co"># 模型评估与混淆矩阵</span></span>
<span id="cb57-2"><a href="#cb57-2"></a></span>
<span id="cb57-3"><a href="#cb57-3"></a><span class="co"># 使用最佳模型进行预测</span></span>
<span id="cb57-4"><a href="#cb57-4"></a>predictions <span class="ot">&lt;-</span> learner_best<span class="sc">$</span><span class="fu">predict</span>(task_preprocessed)</span>
<span id="cb57-5"><a href="#cb57-5"></a></span>
<span id="cb57-6"><a href="#cb57-6"></a><span class="co"># 混淆矩阵</span></span>
<span id="cb57-7"><a href="#cb57-7"></a><span class="fu">cat</span>(<span class="st">"混淆矩阵:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>混淆矩阵:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb59"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1"></a><span class="fu">print</span>(predictions<span class="sc">$</span>confusion)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>            truth
response     setosa versicolor virginica
  setosa         50          0         0
  versicolor      0         48         1
  virginica       0          2        49</code></pre>
</div>
</div>
</section><section id="python语言实现-sklearn框架分类" class="level2" data-number="13.3"><h2 data-number="13.3" class="anchored" data-anchor-id="python语言实现-sklearn框架分类">
<span class="header-section-number">13.3</span> 13.2 Python语言实现 (sklearn框架)–分类</h2>
<p>数据加载与探索</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb61"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1"></a><span class="co"># 综合案例：鸢尾花分类 - Python语言实现 (sklearn框架)</span></span>
<span id="cb61-2"><a href="#cb61-2"></a></span>
<span id="cb61-3"><a href="#cb61-3"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb61-4"><a href="#cb61-4"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb61-5"><a href="#cb61-5"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb61-6"><a href="#cb61-6"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb61-7"><a href="#cb61-7"></a><span class="im">from</span> sklearn.datasets <span class="im">import</span> load_iris</span>
<span id="cb61-8"><a href="#cb61-8"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split, cross_val_score, GridSearchCV, StratifiedKFold</span>
<span id="cb61-9"><a href="#cb61-9"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler, LabelEncoder</span>
<span id="cb61-10"><a href="#cb61-10"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LogisticRegression</span>
<span id="cb61-11"><a href="#cb61-11"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestClassifier</span>
<span id="cb61-12"><a href="#cb61-12"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> GradientBoostingClassifier</span>
<span id="cb61-13"><a href="#cb61-13"></a><span class="im">from</span> sklearn.svm <span class="im">import</span> SVC</span>
<span id="cb61-14"><a href="#cb61-14"></a><span class="im">from</span> sklearn.neighbors <span class="im">import</span> KNeighborsClassifier</span>
<span id="cb61-15"><a href="#cb61-15"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> (accuracy_score, precision_score, recall_score, f1_score, </span>
<span id="cb61-16"><a href="#cb61-16"></a>                           roc_auc_score, confusion_matrix, classification_report, </span>
<span id="cb61-17"><a href="#cb61-17"></a>                           roc_curve, auc)</span>
<span id="cb61-18"><a href="#cb61-18"></a><span class="im">from</span> sklearn.inspection <span class="im">import</span> permutation_importance</span>
<span id="cb61-19"><a href="#cb61-19"></a><span class="im">import</span> warnings</span>
<span id="cb61-20"><a href="#cb61-20"></a>warnings.filterwarnings(<span class="st">'ignore'</span>)</span>
<span id="cb61-21"><a href="#cb61-21"></a></span>
<span id="cb61-22"><a href="#cb61-22"></a><span class="co"># 设置图形样式</span></span>
<span id="cb61-23"><a href="#cb61-23"></a>plt.style.use(<span class="st">'default'</span>)</span>
<span id="cb61-24"><a href="#cb61-24"></a>sns.set_palette(<span class="st">"husl"</span>)</span>
<span id="cb61-25"><a href="#cb61-25"></a></span>
<span id="cb61-26"><a href="#cb61-26"></a><span class="co"># 加载鸢尾花数据集</span></span>
<span id="cb61-27"><a href="#cb61-27"></a>iris <span class="op">=</span> load_iris()</span>
<span id="cb61-28"><a href="#cb61-28"></a>X <span class="op">=</span> pd.DataFrame(iris.data, columns<span class="op">=</span>iris.feature_names)</span>
<span id="cb61-29"><a href="#cb61-29"></a>y <span class="op">=</span> pd.Series(iris.target, name<span class="op">=</span><span class="st">'species'</span>)</span>
<span id="cb61-30"><a href="#cb61-30"></a>iris_data <span class="op">=</span> pd.concat([X, y], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb61-31"><a href="#cb61-31"></a></span>
<span id="cb61-32"><a href="#cb61-32"></a><span class="co"># 映射数字标签到类别名称</span></span>
<span id="cb61-33"><a href="#cb61-33"></a>target_names <span class="op">=</span> iris.target_names</span>
<span id="cb61-34"><a href="#cb61-34"></a>iris_data[<span class="st">'species_name'</span>] <span class="op">=</span> iris_data[<span class="st">'species'</span>].<span class="bu">map</span>(<span class="kw">lambda</span> x: target_names[x])</span>
<span id="cb61-35"><a href="#cb61-35"></a></span>
<span id="cb61-36"><a href="#cb61-36"></a><span class="bu">print</span>(<span class="st">"数据集基本信息:"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>数据集基本信息:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb63"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1"></a><span class="bu">print</span>(<span class="ss">f"样本数: </span><span class="sc">{</span>iris_data<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>样本数: 150</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb65"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1"></a><span class="bu">print</span>(<span class="ss">f"变量数: </span><span class="sc">{</span>iris_data<span class="sc">.</span>shape[<span class="dv">1</span>]<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>变量数: 6</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb67"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">变量名称:"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
变量名称:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb69"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1"></a><span class="bu">print</span>(iris_data.columns.tolist())</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>['sepal length (cm)', 'sepal width (cm)', 'petal length (cm)', 'petal width (cm)', 'species', 'species_name']</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb71"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1"></a><span class="co"># 类别分布</span></span>
<span id="cb71-2"><a href="#cb71-2"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">类别分布:"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
类别分布:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb73"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1"></a>class_dist <span class="op">=</span> iris_data[<span class="st">'species_name'</span>].value_counts()</span>
<span id="cb73-2"><a href="#cb73-2"></a><span class="bu">print</span>(class_dist)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>species_name
setosa        50
versicolor    50
virginica     50
Name: count, dtype: int64</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb75"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">类别比例:"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
类别比例:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb77"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1"></a><span class="bu">print</span>(class_dist <span class="op">/</span> class_dist.<span class="bu">sum</span>())</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>species_name
setosa        0.333333
versicolor    0.333333
virginica     0.333333
Name: count, dtype: float64</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb79"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">数据概览:"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
数据概览:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb81"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1"></a><span class="bu">print</span>(iris_data.describe())</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>       sepal length (cm)  sepal width (cm)  ...  petal width (cm)     species
count         150.000000        150.000000  ...        150.000000  150.000000
mean            5.843333          3.057333  ...          1.199333    1.000000
std             0.828066          0.435866  ...          0.762238    0.819232
min             4.300000          2.000000  ...          0.100000    0.000000
25%             5.100000          2.800000  ...          0.300000    0.000000
50%             5.800000          3.000000  ...          1.300000    1.000000
75%             6.400000          3.300000  ...          1.800000    2.000000
max             7.900000          4.400000  ...          2.500000    2.000000

[8 rows x 5 columns]</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb83"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">缺失值检查:"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
缺失值检查:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb85"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1"></a><span class="bu">print</span>(iris_data.isnull().<span class="bu">sum</span>())</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>sepal length (cm)    0
sepal width (cm)     0
petal length (cm)    0
petal width (cm)     0
species              0
species_name         0
dtype: int64</code></pre>
</div>
</div>
<p>数据可视化分析</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb87"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1"></a><span class="co"># 数据可视化分析 - Python</span></span>
<span id="cb87-2"><a href="#cb87-2"></a></span>
<span id="cb87-3"><a href="#cb87-3"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">12</span>))</span>
<span id="cb87-4"><a href="#cb87-4"></a></span>
<span id="cb87-5"><a href="#cb87-5"></a><span class="co"># 类别分布</span></span>
<span id="cb87-6"><a href="#cb87-6"></a>class_counts <span class="op">=</span> iris_data[<span class="st">'species_name'</span>].value_counts()</span>
<span id="cb87-7"><a href="#cb87-7"></a>axes[<span class="dv">0</span>,<span class="dv">0</span>].bar(class_counts.index, class_counts.values, color<span class="op">=</span>[<span class="st">'steelblue'</span>, <span class="st">'darkorange'</span>, <span class="st">'darkgreen'</span>], alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb87-8"><a href="#cb87-8"></a>axes[<span class="dv">0</span>,<span class="dv">0</span>].set_title(<span class="st">'类别分布'</span>)</span>
<span id="cb87-9"><a href="#cb87-9"></a>axes[<span class="dv">0</span>,<span class="dv">0</span>].set_ylabel(<span class="st">'数量'</span>)</span>
<span id="cb87-10"><a href="#cb87-10"></a>axes[<span class="dv">0</span>,<span class="dv">0</span>].tick_params(axis<span class="op">=</span><span class="st">'x'</span>, rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb87-11"><a href="#cb87-11"></a></span>
<span id="cb87-12"><a href="#cb87-12"></a><span class="co"># 花萼长度与宽度的关系</span></span>
<span id="cb87-13"><a href="#cb87-13"></a>species_colors <span class="op">=</span> {<span class="st">'setosa'</span>: <span class="st">'red'</span>, <span class="st">'versicolor'</span>: <span class="st">'green'</span>, <span class="st">'virginica'</span>: <span class="st">'blue'</span>}</span>
<span id="cb87-14"><a href="#cb87-14"></a><span class="cf">for</span> species <span class="kw">in</span> iris_data[<span class="st">'species_name'</span>].unique():</span>
<span id="cb87-15"><a href="#cb87-15"></a>    species_data <span class="op">=</span> iris_data[iris_data[<span class="st">'species_name'</span>] <span class="op">==</span> species]</span>
<span id="cb87-16"><a href="#cb87-16"></a>    axes[<span class="dv">0</span>,<span class="dv">1</span>].scatter(species_data[<span class="st">'sepal length (cm)'</span>], species_data[<span class="st">'sepal width (cm)'</span>], </span>
<span id="cb87-17"><a href="#cb87-17"></a>                     label<span class="op">=</span>species, alpha<span class="op">=</span><span class="fl">0.7</span>, s<span class="op">=</span><span class="dv">60</span>)</span>
<span id="cb87-18"><a href="#cb87-18"></a>axes[<span class="dv">0</span>,<span class="dv">1</span>].set_title(<span class="st">'花萼长度 vs 宽度'</span>)</span>
<span id="cb87-19"><a href="#cb87-19"></a>axes[<span class="dv">0</span>,<span class="dv">1</span>].set_xlabel(<span class="st">'花萼长度 (cm)'</span>)</span>
<span id="cb87-20"><a href="#cb87-20"></a>axes[<span class="dv">0</span>,<span class="dv">1</span>].set_ylabel(<span class="st">'花萼宽度 (cm)'</span>)</span>
<span id="cb87-21"><a href="#cb87-21"></a>axes[<span class="dv">0</span>,<span class="dv">1</span>].legend()</span>
<span id="cb87-22"><a href="#cb87-22"></a></span>
<span id="cb87-23"><a href="#cb87-23"></a><span class="co"># 花瓣长度与宽度的关系</span></span>
<span id="cb87-24"><a href="#cb87-24"></a><span class="cf">for</span> species <span class="kw">in</span> iris_data[<span class="st">'species_name'</span>].unique():</span>
<span id="cb87-25"><a href="#cb87-25"></a>    species_data <span class="op">=</span> iris_data[iris_data[<span class="st">'species_name'</span>] <span class="op">==</span> species]</span>
<span id="cb87-26"><a href="#cb87-26"></a>    axes[<span class="dv">1</span>,<span class="dv">0</span>].scatter(species_data[<span class="st">'petal length (cm)'</span>], species_data[<span class="st">'petal width (cm)'</span>], </span>
<span id="cb87-27"><a href="#cb87-27"></a>                     label<span class="op">=</span>species, alpha<span class="op">=</span><span class="fl">0.7</span>, s<span class="op">=</span><span class="dv">60</span>)</span>
<span id="cb87-28"><a href="#cb87-28"></a>axes[<span class="dv">1</span>,<span class="dv">0</span>].set_title(<span class="st">'花瓣长度 vs 宽度'</span>)</span>
<span id="cb87-29"><a href="#cb87-29"></a>axes[<span class="dv">1</span>,<span class="dv">0</span>].set_xlabel(<span class="st">'花瓣长度 (cm)'</span>)</span>
<span id="cb87-30"><a href="#cb87-30"></a>axes[<span class="dv">1</span>,<span class="dv">0</span>].set_ylabel(<span class="st">'花瓣宽度 (cm)'</span>)</span>
<span id="cb87-31"><a href="#cb87-31"></a>axes[<span class="dv">1</span>,<span class="dv">0</span>].legend()</span>
<span id="cb87-32"><a href="#cb87-32"></a></span>
<span id="cb87-33"><a href="#cb87-33"></a><span class="co"># 特征分布箱线图</span></span>
<span id="cb87-34"><a href="#cb87-34"></a>feature_data <span class="op">=</span> iris_data.melt(id_vars<span class="op">=</span>[<span class="st">'species_name'</span>], </span>
<span id="cb87-35"><a href="#cb87-35"></a>                             value_vars<span class="op">=</span>[<span class="st">'sepal length (cm)'</span>, <span class="st">'sepal width (cm)'</span>, </span>
<span id="cb87-36"><a href="#cb87-36"></a>                                       <span class="st">'petal length (cm)'</span>, <span class="st">'petal width (cm)'</span>])</span>
<span id="cb87-37"><a href="#cb87-37"></a>sns.boxplot(data<span class="op">=</span>feature_data, x<span class="op">=</span><span class="st">'variable'</span>, y<span class="op">=</span><span class="st">'value'</span>, hue<span class="op">=</span><span class="st">'species_name'</span>, ax<span class="op">=</span>axes[<span class="dv">1</span>,<span class="dv">1</span>])</span>
<span id="cb87-38"><a href="#cb87-38"></a>axes[<span class="dv">1</span>,<span class="dv">1</span>].set_title(<span class="st">'特征分布比较'</span>)</span>
<span id="cb87-39"><a href="#cb87-39"></a>axes[<span class="dv">1</span>,<span class="dv">1</span>].set_xlabel(<span class="st">'特征'</span>)</span>
<span id="cb87-40"><a href="#cb87-40"></a>axes[<span class="dv">1</span>,<span class="dv">1</span>].set_ylabel(<span class="st">'值'</span>)</span>
<span id="cb87-41"><a href="#cb87-41"></a>axes[<span class="dv">1</span>,<span class="dv">1</span>].tick_params(axis<span class="op">=</span><span class="st">'x'</span>, rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb87-42"><a href="#cb87-42"></a>axes[<span class="dv">1</span>,<span class="dv">1</span>].legend(bbox_to_anchor<span class="op">=</span>(<span class="fl">1.05</span>, <span class="dv">1</span>), loc<span class="op">=</span><span class="st">'upper left'</span>)</span>
<span id="cb87-43"><a href="#cb87-43"></a></span>
<span id="cb87-44"><a href="#cb87-44"></a>plt.tight_layout()</span>
<span id="cb87-45"><a href="#cb87-45"></a>plt.show()</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="13-分类任务_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb88"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1"></a><span class="co"># 相关性热图</span></span>
<span id="cb88-2"><a href="#cb88-2"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb88-3"><a href="#cb88-3"></a>corr_matrix <span class="op">=</span> iris_data[[<span class="st">'sepal length (cm)'</span>, <span class="st">'sepal width (cm)'</span>, </span>
<span id="cb88-4"><a href="#cb88-4"></a>                        <span class="st">'petal length (cm)'</span>, <span class="st">'petal width (cm)'</span>, <span class="st">'species'</span>]].corr()</span>
<span id="cb88-5"><a href="#cb88-5"></a>sns.heatmap(corr_matrix, annot<span class="op">=</span><span class="va">True</span>, cmap<span class="op">=</span><span class="st">'coolwarm'</span>, center<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb88-6"><a href="#cb88-6"></a>            square<span class="op">=</span><span class="va">True</span>, linewidths<span class="op">=</span><span class="fl">0.5</span>, cbar_kws<span class="op">=</span>{<span class="st">"shrink"</span>: <span class="fl">0.8</span>}, fmt<span class="op">=</span><span class="st">'.2f'</span>)</span>
<span id="cb88-7"><a href="#cb88-7"></a>plt.title(<span class="st">'变量相关性热图 - Python/sklearn'</span>)</span>
<span id="cb88-8"><a href="#cb88-8"></a>plt.tight_layout()</span>
<span id="cb88-9"><a href="#cb88-9"></a>plt.show()</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="13-分类任务_files/figure-html/unnamed-chunk-9-2.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<p>数据预处理</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb89"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1"></a><span class="co"># 数据预处理 - Python</span></span>
<span id="cb89-2"><a href="#cb89-2"></a></span>
<span id="cb89-3"><a href="#cb89-3"></a><span class="co"># 准备特征和目标变量</span></span>
<span id="cb89-4"><a href="#cb89-4"></a>X <span class="op">=</span> iris_data[[<span class="st">'sepal length (cm)'</span>, <span class="st">'sepal width (cm)'</span>, </span>
<span id="cb89-5"><a href="#cb89-5"></a>               <span class="st">'petal length (cm)'</span>, <span class="st">'petal width (cm)'</span>]]</span>
<span id="cb89-6"><a href="#cb89-6"></a>y <span class="op">=</span> iris_data[<span class="st">'species'</span>]</span>
<span id="cb89-7"><a href="#cb89-7"></a></span>
<span id="cb89-8"><a href="#cb89-8"></a><span class="co"># 数据划分（分层抽样保持类别比例）</span></span>
<span id="cb89-9"><a href="#cb89-9"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(</span>
<span id="cb89-10"><a href="#cb89-10"></a>    X, y, test_size<span class="op">=</span><span class="fl">0.3</span>, random_state<span class="op">=</span><span class="dv">42</span>, stratify<span class="op">=</span>y</span>
<span id="cb89-11"><a href="#cb89-11"></a>)</span>
<span id="cb89-12"><a href="#cb89-12"></a></span>
<span id="cb89-13"><a href="#cb89-13"></a><span class="bu">print</span>(<span class="ss">f"训练集大小: </span><span class="sc">{</span>X_train<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>训练集大小: 105</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb91"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1"></a><span class="bu">print</span>(<span class="ss">f"测试集大小: </span><span class="sc">{</span>X_test<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>测试集大小: 45</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb93"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1"></a><span class="bu">print</span>(<span class="ss">f"训练集类别分布:</span><span class="ch">\n</span><span class="sc">{</span>y_train<span class="sc">.</span>value_counts()<span class="sc">.</span>sort_index()<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>训练集类别分布:
species
0    35
1    35
2    35
Name: count, dtype: int64</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb95"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1"></a><span class="bu">print</span>(<span class="ss">f"测试集类别分布:</span><span class="ch">\n</span><span class="sc">{</span>y_test<span class="sc">.</span>value_counts()<span class="sc">.</span>sort_index()<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>测试集类别分布:
species
0    15
1    15
2    15
Name: count, dtype: int64</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb97"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1"></a><span class="co"># 数据标准化</span></span>
<span id="cb97-2"><a href="#cb97-2"></a>scaler <span class="op">=</span> StandardScaler()</span>
<span id="cb97-3"><a href="#cb97-3"></a>X_train_scaled <span class="op">=</span> scaler.fit_transform(X_train)</span>
<span id="cb97-4"><a href="#cb97-4"></a>X_test_scaled <span class="op">=</span> scaler.transform(X_test)</span>
<span id="cb97-5"><a href="#cb97-5"></a></span>
<span id="cb97-6"><a href="#cb97-6"></a><span class="bu">print</span>(<span class="st">"数据预处理完成"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>数据预处理完成</code></pre>
</div>
</div>
<p>模型训练与比较</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb99"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1"></a><span class="co"># 模型训练与比较 - sklearn</span></span>
<span id="cb99-2"><a href="#cb99-2"></a></span>
<span id="cb99-3"><a href="#cb99-3"></a><span class="co"># 定义模型字典</span></span>
<span id="cb99-4"><a href="#cb99-4"></a>models <span class="op">=</span> {</span>
<span id="cb99-5"><a href="#cb99-5"></a>    <span class="st">'Logistic Regression'</span>: LogisticRegression(random_state<span class="op">=</span><span class="dv">42</span>, max_iter<span class="op">=</span><span class="dv">1000</span>),</span>
<span id="cb99-6"><a href="#cb99-6"></a>    <span class="st">'Random Forest'</span>: RandomForestClassifier(random_state<span class="op">=</span><span class="dv">42</span>),</span>
<span id="cb99-7"><a href="#cb99-7"></a>    <span class="st">'K-Neighbors'</span>: KNeighborsClassifier(),</span>
<span id="cb99-8"><a href="#cb99-8"></a>    <span class="st">'Gradient Boosting'</span>: GradientBoostingClassifier(random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb99-9"><a href="#cb99-9"></a>}</span>
<span id="cb99-10"><a href="#cb99-10"></a></span>
<span id="cb99-11"><a href="#cb99-11"></a><span class="co"># 训练和评估模型</span></span>
<span id="cb99-12"><a href="#cb99-12"></a>results <span class="op">=</span> []</span>
<span id="cb99-13"><a href="#cb99-13"></a></span>
<span id="cb99-14"><a href="#cb99-14"></a><span class="cf">for</span> name, model <span class="kw">in</span> models.items():</span>
<span id="cb99-15"><a href="#cb99-15"></a>    <span class="co"># 训练模型</span></span>
<span id="cb99-16"><a href="#cb99-16"></a>    model.fit(X_train_scaled, y_train)</span>
<span id="cb99-17"><a href="#cb99-17"></a>    </span>
<span id="cb99-18"><a href="#cb99-18"></a>    <span class="co"># 预测</span></span>
<span id="cb99-19"><a href="#cb99-19"></a>    y_pred <span class="op">=</span> model.predict(X_test_scaled)</span>
<span id="cb99-20"><a href="#cb99-20"></a>    y_pred_proba <span class="op">=</span> model.predict_proba(X_test_scaled)</span>
<span id="cb99-21"><a href="#cb99-21"></a>    </span>
<span id="cb99-22"><a href="#cb99-22"></a>    <span class="co"># 计算评估指标</span></span>
<span id="cb99-23"><a href="#cb99-23"></a>    accuracy <span class="op">=</span> accuracy_score(y_test, y_pred)</span>
<span id="cb99-24"><a href="#cb99-24"></a>    precision <span class="op">=</span> precision_score(y_test, y_pred, average<span class="op">=</span><span class="st">'weighted'</span>)</span>
<span id="cb99-25"><a href="#cb99-25"></a>    recall <span class="op">=</span> recall_score(y_test, y_pred, average<span class="op">=</span><span class="st">'weighted'</span>)</span>
<span id="cb99-26"><a href="#cb99-26"></a>    f1 <span class="op">=</span> f1_score(y_test, y_pred, average<span class="op">=</span><span class="st">'weighted'</span>)</span>
<span id="cb99-27"><a href="#cb99-27"></a>    </span>
<span id="cb99-28"><a href="#cb99-28"></a>    <span class="co"># 多类AUC（One-vs-Rest）</span></span>
<span id="cb99-29"><a href="#cb99-29"></a>    <span class="cf">try</span>:</span>
<span id="cb99-30"><a href="#cb99-30"></a>        auc_score <span class="op">=</span> roc_auc_score(y_test, y_pred_proba, multi_class<span class="op">=</span><span class="st">'ovr'</span>)</span>
<span id="cb99-31"><a href="#cb99-31"></a>    <span class="cf">except</span>:</span>
<span id="cb99-32"><a href="#cb99-32"></a>        auc_score <span class="op">=</span> np.nan</span>
<span id="cb99-33"><a href="#cb99-33"></a>    </span>
<span id="cb99-34"><a href="#cb99-34"></a>    <span class="co"># 交叉验证</span></span>
<span id="cb99-35"><a href="#cb99-35"></a>    cv <span class="op">=</span> StratifiedKFold(n_splits<span class="op">=</span><span class="dv">5</span>, shuffle<span class="op">=</span><span class="va">True</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb99-36"><a href="#cb99-36"></a>    cv_scores <span class="op">=</span> cross_val_score(model, X_train_scaled, y_train, cv<span class="op">=</span>cv, scoring<span class="op">=</span><span class="st">'accuracy'</span>)</span>
<span id="cb99-37"><a href="#cb99-37"></a>    cv_accuracy_mean <span class="op">=</span> cv_scores.mean()</span>
<span id="cb99-38"><a href="#cb99-38"></a>    </span>
<span id="cb99-39"><a href="#cb99-39"></a>    results.append({</span>
<span id="cb99-40"><a href="#cb99-40"></a>        <span class="st">'Model'</span>: name,</span>
<span id="cb99-41"><a href="#cb99-41"></a>        <span class="st">'Accuracy'</span>: accuracy,</span>
<span id="cb99-42"><a href="#cb99-42"></a>        <span class="st">'Precision'</span>: precision,</span>
<span id="cb99-43"><a href="#cb99-43"></a>        <span class="st">'Recall'</span>: recall,</span>
<span id="cb99-44"><a href="#cb99-44"></a>        <span class="st">'F1_Score'</span>: f1,</span>
<span id="cb99-45"><a href="#cb99-45"></a>        <span class="st">'AUC'</span>: auc_score,</span>
<span id="cb99-46"><a href="#cb99-46"></a>        <span class="st">'CV_Accuracy'</span>: cv_accuracy_mean</span>
<span id="cb99-47"><a href="#cb99-47"></a>    })</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<style>#sk-container-id-1 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: #000;
  --sklearn-color-text-muted: #666;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-1 {
  color: var(--sklearn-color-text);
}

#sk-container-id-1 pre {
  padding: 0;
}

#sk-container-id-1 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-1 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-1 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-1 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-1 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-1 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-1 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-1 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-1 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-1 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-1 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-1 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-1 label.sk-toggleable__label {
  cursor: pointer;
  display: flex;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
  align-items: start;
  justify-content: space-between;
  gap: 0.5em;
}

#sk-container-id-1 label.sk-toggleable__label .caption {
  font-size: 0.6rem;
  font-weight: lighter;
  color: var(--sklearn-color-text-muted);
}

#sk-container-id-1 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-1 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-1 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-1 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-1 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-1 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-1 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-1 div.sk-label label.sk-toggleable__label,
#sk-container-id-1 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-1 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-1 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-1 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-1 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-1 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-1 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 0.5em;
  text-align: center;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-1 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-1 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-1 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-1 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style>
<div id="sk-container-id-1" class="sk-top-container">
<div class="sk-text-repr-fallback">
<pre>GradientBoostingClassifier(random_state=42)</pre>
<b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b>
</div>
<div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator fitted sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-1" type="checkbox" checked=""><label for="sk-estimator-id-1" class="sk-toggleable__label fitted sk-toggleable__label-arrow"><div><div>GradientBoostingClassifier</div></div>
<div>
<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.6/modules/generated/sklearn.ensemble.GradientBoostingClassifier.html">?<span>Documentation for GradientBoostingClassifier</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span>
</div></label><div class="sk-toggleable__content fitted"><pre>GradientBoostingClassifier(random_state=42)</pre></div> </div></div></div>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb100"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1"></a><span class="co"># 创建结果DataFrame</span></span>
<span id="cb100-2"><a href="#cb100-2"></a>results_python <span class="op">=</span> pd.DataFrame(results)</span>
<span id="cb100-3"><a href="#cb100-3"></a><span class="bu">print</span>(<span class="st">"模型性能比较 - Python/sklearn:"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>模型性能比较 - Python/sklearn:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb102"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1"></a><span class="bu">print</span>(results_python.sort_values(<span class="st">'Accuracy'</span>, ascending<span class="op">=</span><span class="va">False</span>))</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>                 Model  Accuracy  Precision  ...  F1_Score       AUC  CV_Accuracy
3    Gradient Boosting  0.933333   0.944444  ...  0.932660  0.998519     0.961905
0  Logistic Regression  0.911111   0.915535  ...  0.910714  0.995556     0.980952
2          K-Neighbors  0.911111   0.929825  ...  0.909502  0.988889     0.942857
1        Random Forest  0.888889   0.898148  ...  0.887767  0.992593     0.952381

[4 rows x 7 columns]</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb104"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1"></a><span class="co"># 可视化模型比较</span></span>
<span id="cb104-2"><a href="#cb104-2"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">10</span>))</span>
<span id="cb104-3"><a href="#cb104-3"></a></span>
<span id="cb104-4"><a href="#cb104-4"></a><span class="co"># 准确率比较</span></span>
<span id="cb104-5"><a href="#cb104-5"></a>models_sorted_acc <span class="op">=</span> results_python.sort_values(<span class="st">'Accuracy'</span>)</span>
<span id="cb104-6"><a href="#cb104-6"></a>axes[<span class="dv">0</span>,<span class="dv">0</span>].barh(models_sorted_acc[<span class="st">'Model'</span>], models_sorted_acc[<span class="st">'Accuracy'</span>], color<span class="op">=</span><span class="st">'steelblue'</span>)</span>
<span id="cb104-7"><a href="#cb104-7"></a>axes[<span class="dv">0</span>,<span class="dv">0</span>].set_xlabel(<span class="st">'准确率'</span>)</span>
<span id="cb104-8"><a href="#cb104-8"></a>axes[<span class="dv">0</span>,<span class="dv">0</span>].set_title(<span class="st">'模型准确率比较 - Python/sklearn'</span>)</span>
<span id="cb104-9"><a href="#cb104-9"></a>axes[<span class="dv">0</span>,<span class="dv">0</span>].set_xlim(<span class="fl">0.8</span>, <span class="fl">1.0</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>(0.8, 1.0)</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb106"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1"></a>axes[<span class="dv">0</span>,<span class="dv">0</span>].grid(axis<span class="op">=</span><span class="st">'x'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb106-2"><a href="#cb106-2"></a></span>
<span id="cb106-3"><a href="#cb106-3"></a><span class="co"># F1分数比较</span></span>
<span id="cb106-4"><a href="#cb106-4"></a>models_sorted_f1 <span class="op">=</span> results_python.sort_values(<span class="st">'F1_Score'</span>)</span>
<span id="cb106-5"><a href="#cb106-5"></a>axes[<span class="dv">0</span>,<span class="dv">1</span>].barh(models_sorted_f1[<span class="st">'Model'</span>], models_sorted_f1[<span class="st">'F1_Score'</span>], color<span class="op">=</span><span class="st">'darkorange'</span>)</span>
<span id="cb106-6"><a href="#cb106-6"></a>axes[<span class="dv">0</span>,<span class="dv">1</span>].set_xlabel(<span class="st">'F1分数'</span>)</span>
<span id="cb106-7"><a href="#cb106-7"></a>axes[<span class="dv">0</span>,<span class="dv">1</span>].set_title(<span class="st">'模型F1分数比较 - Python/sklearn'</span>)</span>
<span id="cb106-8"><a href="#cb106-8"></a>axes[<span class="dv">0</span>,<span class="dv">1</span>].set_xlim(<span class="fl">0.8</span>, <span class="fl">1.0</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>(0.8, 1.0)</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb108"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb108-1"><a href="#cb108-1"></a>axes[<span class="dv">0</span>,<span class="dv">1</span>].grid(axis<span class="op">=</span><span class="st">'x'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb108-2"><a href="#cb108-2"></a></span>
<span id="cb108-3"><a href="#cb108-3"></a><span class="co"># AUC比较</span></span>
<span id="cb108-4"><a href="#cb108-4"></a>models_sorted_auc <span class="op">=</span> results_python.sort_values(<span class="st">'AUC'</span>)</span>
<span id="cb108-5"><a href="#cb108-5"></a>axes[<span class="dv">1</span>,<span class="dv">0</span>].barh(models_sorted_auc[<span class="st">'Model'</span>], models_sorted_auc[<span class="st">'AUC'</span>], color<span class="op">=</span><span class="st">'darkgreen'</span>)</span>
<span id="cb108-6"><a href="#cb108-6"></a>axes[<span class="dv">1</span>,<span class="dv">0</span>].set_xlabel(<span class="st">'AUC'</span>)</span>
<span id="cb108-7"><a href="#cb108-7"></a>axes[<span class="dv">1</span>,<span class="dv">0</span>].set_title(<span class="st">'模型AUC比较 - Python/sklearn'</span>)</span>
<span id="cb108-8"><a href="#cb108-8"></a>axes[<span class="dv">1</span>,<span class="dv">0</span>].set_xlim(<span class="fl">0.8</span>, <span class="fl">1.0</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>(0.8, 1.0)</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb110"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb110-1"><a href="#cb110-1"></a>axes[<span class="dv">1</span>,<span class="dv">0</span>].grid(axis<span class="op">=</span><span class="st">'x'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb110-2"><a href="#cb110-2"></a></span>
<span id="cb110-3"><a href="#cb110-3"></a><span class="co"># 交叉验证准确率比较</span></span>
<span id="cb110-4"><a href="#cb110-4"></a>models_sorted_cv <span class="op">=</span> results_python.sort_values(<span class="st">'CV_Accuracy'</span>)</span>
<span id="cb110-5"><a href="#cb110-5"></a>axes[<span class="dv">1</span>,<span class="dv">1</span>].barh(models_sorted_cv[<span class="st">'Model'</span>], models_sorted_cv[<span class="st">'CV_Accuracy'</span>], color<span class="op">=</span><span class="st">'darkred'</span>)</span>
<span id="cb110-6"><a href="#cb110-6"></a>axes[<span class="dv">1</span>,<span class="dv">1</span>].set_xlabel(<span class="st">'交叉验证准确率'</span>)</span>
<span id="cb110-7"><a href="#cb110-7"></a>axes[<span class="dv">1</span>,<span class="dv">1</span>].set_title(<span class="st">'交叉验证准确率比较 - Python/sklearn'</span>)</span>
<span id="cb110-8"><a href="#cb110-8"></a>axes[<span class="dv">1</span>,<span class="dv">1</span>].set_xlim(<span class="fl">0.8</span>, <span class="fl">1.0</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>(0.8, 1.0)</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb112"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb112-1"><a href="#cb112-1"></a>axes[<span class="dv">1</span>,<span class="dv">1</span>].grid(axis<span class="op">=</span><span class="st">'x'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb112-2"><a href="#cb112-2"></a></span>
<span id="cb112-3"><a href="#cb112-3"></a>plt.tight_layout()</span>
<span id="cb112-4"><a href="#cb112-4"></a>plt.show()</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="13-分类任务_files/figure-html/unnamed-chunk-11-5.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>详细模型评估</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb113"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1"></a><span class="co"># 详细模型评估 - 最佳模型</span></span>
<span id="cb113-2"><a href="#cb113-2"></a></span>
<span id="cb113-3"><a href="#cb113-3"></a><span class="co"># 选择最佳模型（基于准确率）</span></span>
<span id="cb113-4"><a href="#cb113-4"></a>best_model_name <span class="op">=</span> results_python.loc[results_python[<span class="st">'Accuracy'</span>].idxmax(), <span class="st">'Model'</span>]</span>
<span id="cb113-5"><a href="#cb113-5"></a>best_model <span class="op">=</span> models[best_model_name]</span>
<span id="cb113-6"><a href="#cb113-6"></a></span>
<span id="cb113-7"><a href="#cb113-7"></a><span class="bu">print</span>(<span class="ss">f"最佳模型: </span><span class="sc">{</span>best_model_name<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>最佳模型: Gradient Boosting</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb115"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb115-1"><a href="#cb115-1"></a><span class="co"># 重新训练最佳模型</span></span>
<span id="cb115-2"><a href="#cb115-2"></a>best_model.fit(X_train_scaled, y_train)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<style>#sk-container-id-2 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: #000;
  --sklearn-color-text-muted: #666;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-2 {
  color: var(--sklearn-color-text);
}

#sk-container-id-2 pre {
  padding: 0;
}

#sk-container-id-2 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-2 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-2 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-2 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-2 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-2 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-2 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-2 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-2 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-2 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-2 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-2 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-2 label.sk-toggleable__label {
  cursor: pointer;
  display: flex;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
  align-items: start;
  justify-content: space-between;
  gap: 0.5em;
}

#sk-container-id-2 label.sk-toggleable__label .caption {
  font-size: 0.6rem;
  font-weight: lighter;
  color: var(--sklearn-color-text-muted);
}

#sk-container-id-2 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-2 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-2 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-2 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-2 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-2 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-2 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-2 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-2 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-2 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-2 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-2 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-2 div.sk-label label.sk-toggleable__label,
#sk-container-id-2 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-2 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-2 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-2 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-2 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-2 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-2 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-2 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-2 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 0.5em;
  text-align: center;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-2 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-2 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-2 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-2 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style>
<div id="sk-container-id-2" class="sk-top-container">
<div class="sk-text-repr-fallback">
<pre>GradientBoostingClassifier(random_state=42)</pre>
<b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b>
</div>
<div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator fitted sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-2" type="checkbox" checked=""><label for="sk-estimator-id-2" class="sk-toggleable__label fitted sk-toggleable__label-arrow"><div><div>GradientBoostingClassifier</div></div>
<div>
<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.6/modules/generated/sklearn.ensemble.GradientBoostingClassifier.html">?<span>Documentation for GradientBoostingClassifier</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span>
</div></label><div class="sk-toggleable__content fitted"><pre>GradientBoostingClassifier(random_state=42)</pre></div> </div></div></div>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb116"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb116-1"><a href="#cb116-1"></a><span class="co"># 预测</span></span>
<span id="cb116-2"><a href="#cb116-2"></a>y_pred_best <span class="op">=</span> best_model.predict(X_test_scaled)</span>
<span id="cb116-3"><a href="#cb116-3"></a>y_pred_proba_best <span class="op">=</span> best_model.predict_proba(X_test_scaled)</span>
<span id="cb116-4"><a href="#cb116-4"></a></span>
<span id="cb116-5"><a href="#cb116-5"></a><span class="co"># 混淆矩阵</span></span>
<span id="cb116-6"><a href="#cb116-6"></a>cm <span class="op">=</span> confusion_matrix(y_test, y_pred_best)</span>
<span id="cb116-7"><a href="#cb116-7"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">混淆矩阵:"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
混淆矩阵:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb118"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb118-1"><a href="#cb118-1"></a><span class="bu">print</span>(cm)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[15  0  0]
 [ 0 15  0]
 [ 0  3 12]]</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb120"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb120-1"><a href="#cb120-1"></a><span class="co"># 分类报告</span></span>
<span id="cb120-2"><a href="#cb120-2"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">分类报告:"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
分类报告:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb122"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb122-1"><a href="#cb122-1"></a><span class="bu">print</span>(classification_report(y_test, y_pred_best, target_names<span class="op">=</span>target_names))</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>              precision    recall  f1-score   support

      setosa       1.00      1.00      1.00        15
  versicolor       0.83      1.00      0.91        15
   virginica       1.00      0.80      0.89        15

    accuracy                           0.93        45
   macro avg       0.94      0.93      0.93        45
weighted avg       0.94      0.93      0.93        45</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb124"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb124-1"><a href="#cb124-1"></a><span class="co"># 可视化混淆矩阵</span></span>
<span id="cb124-2"><a href="#cb124-2"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb124-3"><a href="#cb124-3"></a>sns.heatmap(cm, annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">'d'</span>, cmap<span class="op">=</span><span class="st">'Blues'</span>, </span>
<span id="cb124-4"><a href="#cb124-4"></a>            xticklabels<span class="op">=</span>target_names, yticklabels<span class="op">=</span>target_names)</span>
<span id="cb124-5"><a href="#cb124-5"></a>plt.title(<span class="ss">f'混淆矩阵 - </span><span class="sc">{</span>best_model_name<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb124-6"><a href="#cb124-6"></a>plt.xlabel(<span class="st">'预测标签'</span>)</span>
<span id="cb124-7"><a href="#cb124-7"></a>plt.ylabel(<span class="st">'真实标签'</span>)</span>
<span id="cb124-8"><a href="#cb124-8"></a>plt.tight_layout()</span>
<span id="cb124-9"><a href="#cb124-9"></a>plt.show()</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="13-分类任务_files/figure-html/unnamed-chunk-12-7.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<p>特征重要性分析</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb125"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb125-1"><a href="#cb125-1"></a><span class="co"># 特征重要性分析 - Python</span></span>
<span id="cb125-2"><a href="#cb125-2"></a></span>
<span id="cb125-3"><a href="#cb125-3"></a><span class="cf">if</span> <span class="bu">hasattr</span>(best_model, <span class="st">'feature_importances_'</span>):</span>
<span id="cb125-4"><a href="#cb125-4"></a>    feature_importance <span class="op">=</span> best_model.feature_importances_</span>
<span id="cb125-5"><a href="#cb125-5"></a>    feature_names <span class="op">=</span> X.columns</span>
<span id="cb125-6"><a href="#cb125-6"></a>    </span>
<span id="cb125-7"><a href="#cb125-7"></a>    <span class="co"># 创建特征重要性DataFrame</span></span>
<span id="cb125-8"><a href="#cb125-8"></a>    importance_df <span class="op">=</span> pd.DataFrame({</span>
<span id="cb125-9"><a href="#cb125-9"></a>        <span class="st">'Feature'</span>: feature_names,</span>
<span id="cb125-10"><a href="#cb125-10"></a>        <span class="st">'Importance'</span>: feature_importance</span>
<span id="cb125-11"><a href="#cb125-11"></a>    }).sort_values(<span class="st">'Importance'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb125-12"><a href="#cb125-12"></a>    </span>
<span id="cb125-13"><a href="#cb125-13"></a>    <span class="bu">print</span>(<span class="st">"特征重要性排序 - Python/sklearn:"</span>)</span>
<span id="cb125-14"><a href="#cb125-14"></a>    <span class="bu">print</span>(importance_df)</span>
<span id="cb125-15"><a href="#cb125-15"></a>    </span>
<span id="cb125-16"><a href="#cb125-16"></a>    <span class="co"># 可视化特征重要性</span></span>
<span id="cb125-17"><a href="#cb125-17"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb125-18"><a href="#cb125-18"></a>    sns.barplot(data<span class="op">=</span>importance_df, x<span class="op">=</span><span class="st">'Importance'</span>, y<span class="op">=</span><span class="st">'Feature'</span>, palette<span class="op">=</span><span class="st">'viridis'</span>)</span>
<span id="cb125-19"><a href="#cb125-19"></a>    plt.title(<span class="ss">f'特征重要性 - </span><span class="sc">{</span>best_model_name<span class="sc">}</span><span class="ss"> (Python/sklearn)'</span>)</span>
<span id="cb125-20"><a href="#cb125-20"></a>    plt.xlabel(<span class="st">'重要性'</span>)</span>
<span id="cb125-21"><a href="#cb125-21"></a>    plt.tight_layout()</span>
<span id="cb125-22"><a href="#cb125-22"></a>    plt.show()</span>
<span id="cb125-23"><a href="#cb125-23"></a></span>
<span id="cb125-24"><a href="#cb125-24"></a><span class="cf">else</span>:</span>
<span id="cb125-25"><a href="#cb125-25"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>best_model_name<span class="sc">}</span><span class="ss"> 不支持特征重要性计算"</span>)</span>
<span id="cb125-26"><a href="#cb125-26"></a>    </span>
<span id="cb125-27"><a href="#cb125-27"></a>    <span class="co"># 使用排列重要性作为替代</span></span>
<span id="cb125-28"><a href="#cb125-28"></a>    perm_importance <span class="op">=</span> permutation_importance(</span>
<span id="cb125-29"><a href="#cb125-29"></a>        best_model, X_test_scaled, y_test, n_repeats<span class="op">=</span><span class="dv">10</span>, random_state<span class="op">=</span><span class="dv">42</span></span>
<span id="cb125-30"><a href="#cb125-30"></a>    )</span>
<span id="cb125-31"><a href="#cb125-31"></a>    </span>
<span id="cb125-32"><a href="#cb125-32"></a>    perm_importance_df <span class="op">=</span> pd.DataFrame({</span>
<span id="cb125-33"><a href="#cb125-33"></a>        <span class="st">'Feature'</span>: feature_names,</span>
<span id="cb125-34"><a href="#cb125-34"></a>        <span class="st">'Importance'</span>: perm_importance.importances_mean</span>
<span id="cb125-35"><a href="#cb125-35"></a>    }).sort_values(<span class="st">'Importance'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb125-36"><a href="#cb125-36"></a>    </span>
<span id="cb125-37"><a href="#cb125-37"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">排列特征重要性:"</span>)</span>
<span id="cb125-38"><a href="#cb125-38"></a>    <span class="bu">print</span>(perm_importance_df)</span>
<span id="cb125-39"><a href="#cb125-39"></a>    </span>
<span id="cb125-40"><a href="#cb125-40"></a>    <span class="co"># 可视化排列重要性</span></span>
<span id="cb125-41"><a href="#cb125-41"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb125-42"><a href="#cb125-42"></a>    sns.barplot(data<span class="op">=</span>perm_importance_df, x<span class="op">=</span><span class="st">'Importance'</span>, y<span class="op">=</span><span class="st">'Feature'</span>, palette<span class="op">=</span><span class="st">'rocket'</span>)</span>
<span id="cb125-43"><a href="#cb125-43"></a>    plt.title(<span class="ss">f'排列特征重要性 - </span><span class="sc">{</span>best_model_name<span class="sc">}</span><span class="ss"> (Python/sklearn)'</span>)</span>
<span id="cb125-44"><a href="#cb125-44"></a>    plt.xlabel(<span class="st">'重要性'</span>)</span>
<span id="cb125-45"><a href="#cb125-45"></a>    plt.tight_layout()</span>
<span id="cb125-46"><a href="#cb125-46"></a>    plt.show()</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="13-分类任务_files/figure-html/unnamed-chunk-13-9.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
</section><section id="案例总结与最佳实践" class="level2" data-number="13.4"><h2 data-number="13.4" class="anchored" data-anchor-id="案例总结与最佳实践">
<span class="header-section-number">13.4</span> 13.3 案例总结与最佳实践</h2>
<p>关键发现</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb126"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1"></a><span class="co"># 案例总结 - R语言</span></span>
<span id="cb126-2"><a href="#cb126-2"></a><span class="fu">cat</span>(<span class="st">"=== 鸢尾花分类案例总结 ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== 鸢尾花分类案例总结 ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb128"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1"></a><span class="fu">cat</span>(<span class="st">"1. 数据特征:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>1. 数据特征:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb130"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1"></a><span class="fu">cat</span>(<span class="st">"   - 数据集包含"</span>, <span class="fu">nrow</span>(iris_data), <span class="st">"个样本，"</span>, <span class="fu">ncol</span>(iris_data)<span class="sc">-</span><span class="dv">1</span>, <span class="st">"个特征</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   - 数据集包含 150 个样本， 4 个特征</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb132"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1"></a><span class="fu">cat</span>(<span class="st">"   - 目标变量: 鸢尾花种类(3个类别)</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   - 目标变量: 鸢尾花种类(3个类别)</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb134"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1"></a><span class="fu">cat</span>(<span class="st">"   - 类别分布均衡</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   - 类别分布均衡</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb136"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1"></a><span class="fu">cat</span>(<span class="st">"   - 最重要的特征: 花瓣长度和宽度</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   - 最重要的特征: 花瓣长度和宽度</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb138"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1"></a><span class="fu">cat</span>(<span class="st">"2. 模型性能比较:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>2. 模型性能比较:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb140"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1"></a><span class="fu">print</span>(results_r[<span class="fu">order</span>(<span class="sc">-</span>Accuracy)])</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>           Model  Accuracy   AUC Balanced_Accuracy    LogLoss
          &lt;char&gt;     &lt;num&gt; &lt;num&gt;             &lt;num&gt;      &lt;num&gt;
1:           svm 0.9600000   NaN         0.9677489 0.04000000
2: random_forest 0.9533333   NaN         0.9621934 0.04666667
3:           knn 0.9533333   NaN         0.9610823 0.04666667
4:       xgboost 0.9466667   NaN         0.9498918 0.05333333</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb142"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">3. 分类问题最佳实践:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
3. 分类问题最佳实践:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb144"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1"></a><span class="fu">cat</span>(<span class="st">"   - 树模型和SVM在分类问题上表现优异</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   - 树模型和SVM在分类问题上表现优异</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb146"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1"></a><span class="fu">cat</span>(<span class="st">"   - 特征标准化对距离-based模型很重要</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   - 特征标准化对距离-based模型很重要</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb148"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1"></a><span class="fu">cat</span>(<span class="st">"   - 多分类问题需要考虑合适的评估指标</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   - 多分类问题需要考虑合适的评估指标</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb150"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1"></a><span class="fu">cat</span>(<span class="st">"   - 特征重要性分析有助于理解模型决策</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   - 特征重要性分析有助于理解模型决策</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb152"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb152-1"><a href="#cb152-1"></a><span class="co"># 案例总结 - Python</span></span>
<span id="cb152-2"><a href="#cb152-2"></a><span class="bu">print</span>(<span class="st">"=== 鸢尾花分类案例总结 ==="</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== 鸢尾花分类案例总结 ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb154"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb154-1"><a href="#cb154-1"></a><span class="bu">print</span>(<span class="st">"1. 数据特征:"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>1. 数据特征:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb156"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb156-1"><a href="#cb156-1"></a><span class="bu">print</span>(<span class="ss">f"   - 数据集包含 </span><span class="sc">{</span>iris_data<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">}</span><span class="ss"> 个样本，</span><span class="sc">{</span>iris_data<span class="sc">.</span>shape[<span class="dv">1</span>]<span class="op">-</span><span class="dv">1</span><span class="sc">}</span><span class="ss"> 个特征"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   - 数据集包含 150 个样本，5 个特征</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb158"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb158-1"><a href="#cb158-1"></a><span class="bu">print</span>(<span class="st">"   - 目标变量: 鸢尾花种类(3个类别)"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   - 目标变量: 鸢尾花种类(3个类别)</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb160"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb160-1"><a href="#cb160-1"></a><span class="bu">print</span>(<span class="st">"   - 类别分布均衡"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   - 类别分布均衡</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb162"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb162-1"><a href="#cb162-1"></a><span class="bu">print</span>(<span class="st">"   - 最重要的特征: 花瓣长度和宽度</span><span class="ch">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   - 最重要的特征: 花瓣长度和宽度</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb164"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb164-1"><a href="#cb164-1"></a><span class="bu">print</span>(<span class="st">"2. 模型性能比较:"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>2. 模型性能比较:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb166"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb166-1"><a href="#cb166-1"></a><span class="bu">print</span>(results_python[[<span class="st">'Model'</span>, <span class="st">'Accuracy'</span>, <span class="st">'F1_Score'</span>, <span class="st">'AUC'</span>]].sort_values(<span class="st">'Accuracy'</span>, ascending<span class="op">=</span><span class="va">False</span>).to_string(index<span class="op">=</span><span class="va">False</span>))</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>              Model  Accuracy  F1_Score      AUC
  Gradient Boosting  0.933333  0.932660 0.998519
Logistic Regression  0.911111  0.910714 0.995556
        K-Neighbors  0.911111  0.909502 0.988889
      Random Forest  0.888889  0.887767 0.992593</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb168"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb168-1"><a href="#cb168-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">3. 分类问题最佳实践:"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
3. 分类问题最佳实践:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb170"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb170-1"><a href="#cb170-1"></a><span class="bu">print</span>(<span class="st">"   - 集成学习方法在分类问题上表现稳定"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   - 集成学习方法在分类问题上表现稳定</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb172"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb172-1"><a href="#cb172-1"></a><span class="bu">print</span>(<span class="st">"   - 数据预处理对模型性能影响显著"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   - 数据预处理对模型性能影响显著</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb174"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb174-1"><a href="#cb174-1"></a><span class="bu">print</span>(<span class="st">"   - 交叉验证提供更可靠的性能估计"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   - 交叉验证提供更可靠的性能估计</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb176"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb176-1"><a href="#cb176-1"></a><span class="bu">print</span>(<span class="st">"   - 混淆矩阵和分类报告提供详细性能分析"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   - 混淆矩阵和分类报告提供详细性能分析</code></pre>
</div>
</div>
<p>技术要点回顾</p>
<p><strong>数据预处理</strong>： - 特征标准化：确保不同尺度的特征具有可比性 - 类别编码：将文本标签转换为数值 - 数据划分：使用分层抽样保持类别比例</p>
<p><strong>模型选择</strong>： - 逻辑回归：可解释性强，适合线性可分数据 - 树模型：自动处理非线性关系，提供特征重要性 - SVM：在高维空间中表现优异 - KNN：基于距离的简单有效方法</p>
<p><strong>模型评估</strong>： - 准确率：整体分类正确率 - 精确率、召回率、F1分数：更细致的性能评估 - AUC：模型区分能力的综合指标 - 混淆矩阵：详细分析各类别的分类情况</p>
<p><strong>模型优化</strong>： - 超参数调优：提升模型性能 - 特征选择：基于重要性筛选特征 - 交叉验证：稳健的性能估计</p>
<p>业务应用建议</p>
<ol type="1">
<li>
<strong>物种识别</strong>：扩展到其他植物或动物的分类识别</li>
<li>
<strong>质量检测</strong>：应用于工业产品质量分类</li>
<li>
<strong>医疗诊断</strong>：用于疾病分类和诊断辅助</li>
<li>
<strong>客户细分</strong>：用于市场营销中的客户分类</li>
</ol>
<p>这个分类模型案例的特点：</p>
<ol type="1">
<li>
<strong>使用共享数据集</strong>：鸢尾花数据集在R和Python中都内置可用</li>
<li>
<strong>完整分类流程</strong>：从数据探索到模型解释的完整流程</li>
<li>
<strong>多分类问题</strong>：展示3个类别的分类解决方案</li>
<li>
<strong>现代框架</strong>：R使用mlr3，Python使用sklearn</li>
<li>
<strong>丰富可视化</strong>：包含多种数据可视化和模型评估图表</li>
<li>
<strong>实用性强</strong>：包含特征重要性分析、混淆矩阵等实用功能</li>
</ol>
<p>通过本分类案例，我们展示了从数据探索到模型部署的完整分类问题解决方案，为读者在实际工作中应用机器学习方法提供了完整的参考框架。</p>


</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "已复制");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "已复制");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="../chapters/12 回归任务.html" class="pagination-link" aria-label="回归任务">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">回归任务</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../chapters/14 案例综合分析.html" class="pagination-link" aria-label="综合数据分析">
        <span class="nav-page-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">综合数据分析</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>