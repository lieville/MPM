<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh-Hans" xml:lang="zh-Hans"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>1&nbsp; 预测、过拟合与模型评估 – 现代预测建模：从回归到机器学习</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../chapters/2 线性回归.html" rel="next">
<link href="../index.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-70a47bd5681a7291082a5b9f83d58762.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "没有结果",
    "search-matching-documents-text": "匹配的文档",
    "search-copy-link-title": "复制搜索链接",
    "search-hide-matches-text": "隐藏其它匹配结果",
    "search-more-match-text": "更多匹配结果",
    "search-more-matches-text": "更多匹配结果",
    "search-clear-button-title": "清除",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "取消",
    "search-submit-button-title": "提交",
    "search-label": "搜索"
  }
}</script><script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script><link rel="stylesheet" href="science-textbook.css">
</head>
<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="展开或折叠侧边栏导航" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapters/1 预测、过拟合与模型评估.html">起步-线性回归分析</a></li><li class="breadcrumb-item"><a href="../chapters/1 预测、过拟合与模型评估.html"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">预测、过拟合与模型评估</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="展开或折叠侧边栏导航" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="搜索" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">现代预测建模：从回归到机器学习</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="搜索"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">前言</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">index.html</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">起步-线性回归分析</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="展开或折叠此栏">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/1 预测、过拟合与模型评估.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">预测、过拟合与模型评估</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/2 线性回归.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">线性回归</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/3 模型诊断.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">模型诊断</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/4 时间序列分析初步.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">时间序列分析初步</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">扩展——线性分析模型及其超越</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="展开或折叠此栏">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/5 高维线性模型：正则化与降维.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">高维线性模型：正则化与降维</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/6 广义线性模型与线性分类.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">广义线性模型与线性分类</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/7 多项式回归与样条回归.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">多项式与样条回归</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">进阶——超越线性的机器学习</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="展开或折叠此栏">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/8 决策树与集成学习.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">决策树与集成学习</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/9 支持向量机.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">支持向量机</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/10 神经网络与深度学习基础.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">神经网络与深度学习基础</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">实训——综合案例建模实践</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="展开或折叠此栏">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/11 基准测试.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">基准测试</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/12 回归任务.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">回归任务</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/13 分类任务.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">分类任务</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/14 案例综合分析.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">综合数据分析</span></span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">目录</h2>
   
  <ul>
<li><a href="#%E6%9C%AC%E7%AB%A0%E5%AF%BC%E8%AF%BB" id="toc-本章导读" class="nav-link active" data-scroll-target="#%E6%9C%AC%E7%AB%A0%E5%AF%BC%E8%AF%BB"><span class="header-section-number">1.1</span> 本章导读</a></li>
  <li>
<a href="#%E9%A2%84%E6%B5%8B%E5%BB%BA%E6%A8%A1%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5" id="toc-预测建模的基本概念" class="nav-link" data-scroll-target="#%E9%A2%84%E6%B5%8B%E5%BB%BA%E6%A8%A1%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="header-section-number">1.2</span> 1.1 预测建模的基本概念</a>
  <ul class="collapse">
<li><a href="#%E5%9B%9E%E5%BD%92%E4%B8%8E%E5%88%86%E7%B1%BB%E4%BB%BB%E5%8A%A1" id="toc-回归与分类任务" class="nav-link" data-scroll-target="#%E5%9B%9E%E5%BD%92%E4%B8%8E%E5%88%86%E7%B1%BB%E4%BB%BB%E5%8A%A1"><span class="header-section-number">1.2.1</span> 1.1.1 回归与分类任务</a></li>
  <li><a href="#%E7%89%B9%E5%BE%81%E4%B8%8E%E5%93%8D%E5%BA%94%E5%8F%98%E9%87%8F" id="toc-特征与响应变量" class="nav-link" data-scroll-target="#%E7%89%B9%E5%BE%81%E4%B8%8E%E5%93%8D%E5%BA%94%E5%8F%98%E9%87%8F"><span class="header-section-number">1.2.2</span> 1.1.2 特征与响应变量</a></li>
  <li><a href="#%E9%A2%84%E6%B5%8B%E5%BB%BA%E6%A8%A1%E7%9A%84%E6%B5%81%E7%A8%8B" id="toc-预测建模的流程" class="nav-link" data-scroll-target="#%E9%A2%84%E6%B5%8B%E5%BB%BA%E6%A8%A1%E7%9A%84%E6%B5%81%E7%A8%8B"><span class="header-section-number">1.2.3</span> 1.1.3 预测建模的流程</a></li>
  </ul>
</li>
  <li>
<a href="#%E8%BF%87%E6%8B%9F%E5%90%88%E4%B8%8E%E6%A8%A1%E5%9E%8B%E5%A4%8D%E6%9D%82%E5%BA%A6" id="toc-过拟合与模型复杂度" class="nav-link" data-scroll-target="#%E8%BF%87%E6%8B%9F%E5%90%88%E4%B8%8E%E6%A8%A1%E5%9E%8B%E5%A4%8D%E6%9D%82%E5%BA%A6"><span class="header-section-number">1.3</span> 1.2 过拟合与模型复杂度</a>
  <ul class="collapse">
<li><a href="#%E8%BF%87%E6%8B%9F%E5%90%88%E7%9A%84%E6%A6%82%E5%BF%B5%E4%B8%8E%E6%9C%BA%E5%88%B6" id="toc-过拟合的概念与机制" class="nav-link" data-scroll-target="#%E8%BF%87%E6%8B%9F%E5%90%88%E7%9A%84%E6%A6%82%E5%BF%B5%E4%B8%8E%E6%9C%BA%E5%88%B6"><span class="header-section-number">1.3.1</span> 1.2.1 过拟合的概念与机制</a></li>
  <li><a href="#%E5%81%8F%E5%B7%AE-%E6%96%B9%E5%B7%AE%E6%9D%83%E8%A1%A1%E7%9A%84%E6%B7%B1%E5%85%A5%E5%88%86%E6%9E%90" id="toc-偏差-方差权衡的深入分析" class="nav-link" data-scroll-target="#%E5%81%8F%E5%B7%AE-%E6%96%B9%E5%B7%AE%E6%9D%83%E8%A1%A1%E7%9A%84%E6%B7%B1%E5%85%A5%E5%88%86%E6%9E%90"><span class="header-section-number">1.3.2</span> 1.2.2 偏差-方差权衡的深入分析</a></li>
  <li><a href="#%E6%A8%A1%E5%9E%8B%E5%A4%8D%E6%9D%82%E5%BA%A6%E7%9A%84%E5%BD%B1%E5%93%8D%E5%88%86%E6%9E%90" id="toc-模型复杂度的影响分析" class="nav-link" data-scroll-target="#%E6%A8%A1%E5%9E%8B%E5%A4%8D%E6%9D%82%E5%BA%A6%E7%9A%84%E5%BD%B1%E5%93%8D%E5%88%86%E6%9E%90"><span class="header-section-number">1.3.3</span> 1.2.3 模型复杂度的影响分析</a></li>
  </ul>
</li>
  <li>
<a href="#%E6%A8%A1%E5%9E%8B%E8%AF%84%E4%BC%B0%E6%A1%86%E6%9E%B6" id="toc-模型评估框架" class="nav-link" data-scroll-target="#%E6%A8%A1%E5%9E%8B%E8%AF%84%E4%BC%B0%E6%A1%86%E6%9E%B6"><span class="header-section-number">1.4</span> 1.3 模型评估框架</a>
  <ul class="collapse">
<li><a href="#%E6%95%B0%E6%8D%AE%E5%88%92%E5%88%86%E7%9A%84%E8%AF%A6%E7%BB%86%E7%AD%96%E7%95%A5" id="toc-数据划分的详细策略" class="nav-link" data-scroll-target="#%E6%95%B0%E6%8D%AE%E5%88%92%E5%88%86%E7%9A%84%E8%AF%A6%E7%BB%86%E7%AD%96%E7%95%A5"><span class="header-section-number">1.4.1</span> 1.3.1 数据划分的详细策略</a></li>
  <li><a href="#%E4%BA%A4%E5%8F%89%E9%AA%8C%E8%AF%81%E6%96%B9%E6%B3%95%E7%9A%84%E8%AF%A6%E7%BB%86%E8%AE%A8%E8%AE%BA" id="toc-交叉验证方法的详细讨论" class="nav-link" data-scroll-target="#%E4%BA%A4%E5%8F%89%E9%AA%8C%E8%AF%81%E6%96%B9%E6%B3%95%E7%9A%84%E8%AF%A6%E7%BB%86%E8%AE%A8%E8%AE%BA"><span class="header-section-number">1.4.2</span> 1.3.2 交叉验证方法的详细讨论</a></li>
  </ul>
</li>
  <li>
<a href="#%E8%AF%84%E4%BC%B0%E6%8C%87%E6%A0%87" id="toc-评估指标" class="nav-link" data-scroll-target="#%E8%AF%84%E4%BC%B0%E6%8C%87%E6%A0%87"><span class="header-section-number">1.5</span> 1.4 评估指标</a>
  <ul class="collapse">
<li><a href="#%E5%9B%9E%E5%BD%92%E9%97%AE%E9%A2%98%E8%AF%84%E4%BC%B0%E6%8C%87%E6%A0%87%E7%9A%84%E6%B7%B1%E5%85%A5%E8%AE%A8%E8%AE%BA" id="toc-回归问题评估指标的深入讨论" class="nav-link" data-scroll-target="#%E5%9B%9E%E5%BD%92%E9%97%AE%E9%A2%98%E8%AF%84%E4%BC%B0%E6%8C%87%E6%A0%87%E7%9A%84%E6%B7%B1%E5%85%A5%E8%AE%A8%E8%AE%BA"><span class="header-section-number">1.5.1</span> 1.4.1 回归问题评估指标的深入讨论</a></li>
  <li><a href="#%E5%88%86%E7%B1%BB%E9%97%AE%E9%A2%98%E8%AF%84%E4%BC%B0%E6%8C%87%E6%A0%87%E7%9A%84%E5%AE%8C%E6%95%B4%E4%BD%93%E7%B3%BB" id="toc-分类问题评估指标的完整体系" class="nav-link" data-scroll-target="#%E5%88%86%E7%B1%BB%E9%97%AE%E9%A2%98%E8%AF%84%E4%BC%B0%E6%8C%87%E6%A0%87%E7%9A%84%E5%AE%8C%E6%95%B4%E4%BD%93%E7%B3%BB"><span class="header-section-number">1.5.2</span> 1.4.2 分类问题评估指标的完整体系</a></li>
  <li><a href="#roc%E6%9B%B2%E7%BA%BF%E4%B8%8Eauc%E7%9A%84%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3" id="toc-roc曲线与auc的深入理解" class="nav-link" data-scroll-target="#roc%E6%9B%B2%E7%BA%BF%E4%B8%8Eauc%E7%9A%84%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3"><span class="header-section-number">1.5.3</span> 1.4.3 ROC曲线与AUC的深入理解</a></li>
  </ul>
</li>
  <li>
<a href="#%E6%A8%A1%E5%9E%8B%E9%80%89%E6%8B%A9%E5%8E%9F%E5%88%99" id="toc-模型选择原则" class="nav-link" data-scroll-target="#%E6%A8%A1%E5%9E%8B%E9%80%89%E6%8B%A9%E5%8E%9F%E5%88%99"><span class="header-section-number">1.6</span> 1.5 模型选择原则</a>
  <ul class="collapse">
<li><a href="#%E5%A5%A5%E5%8D%A1%E5%A7%86%E5%89%83%E5%88%80%E5%8E%9F%E7%90%86%E7%9A%84%E7%BB%9F%E8%AE%A1%E5%9F%BA%E7%A1%80" id="toc-奥卡姆剃刀原理的统计基础" class="nav-link" data-scroll-target="#%E5%A5%A5%E5%8D%A1%E5%A7%86%E5%89%83%E5%88%80%E5%8E%9F%E7%90%86%E7%9A%84%E7%BB%9F%E8%AE%A1%E5%9F%BA%E7%A1%80"><span class="header-section-number">1.6.1</span> 1.5.1 奥卡姆剃刀原理的统计基础</a></li>
  <li><a href="#%E4%BF%A1%E6%81%AF%E5%87%86%E5%88%99%E7%9A%84%E8%AF%A6%E7%BB%86%E6%8E%A8%E5%AF%BC" id="toc-信息准则的详细推导" class="nav-link" data-scroll-target="#%E4%BF%A1%E6%81%AF%E5%87%86%E5%88%99%E7%9A%84%E8%AF%A6%E7%BB%86%E6%8E%A8%E5%AF%BC"><span class="header-section-number">1.6.2</span> 1.5.2 信息准则的详细推导</a></li>
  <li><a href="#%E5%AE%9E%E9%99%85%E9%80%89%E6%8B%A9%E7%AD%96%E7%95%A5" id="toc-实际选择策略" class="nav-link" data-scroll-target="#%E5%AE%9E%E9%99%85%E9%80%89%E6%8B%A9%E7%AD%96%E7%95%A5"><span class="header-section-number">1.6.3</span> 1.5.3 实际选择策略</a></li>
  </ul>
</li>
  <li>
<a href="#%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B" id="toc-综合案例" class="nav-link" data-scroll-target="#%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8B"><span class="header-section-number">1.7</span> 1.6 综合案例</a>
  <ul class="collapse">
<li><a href="#%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8Bmtcars%E6%95%B0%E6%8D%AE%E9%9B%86%E5%88%86%E6%9E%90" id="toc-综合案例mtcars数据集分析" class="nav-link" data-scroll-target="#%E7%BB%BC%E5%90%88%E6%A1%88%E4%BE%8Bmtcars%E6%95%B0%E6%8D%AE%E9%9B%86%E5%88%86%E6%9E%90"><span class="header-section-number">1.7.1</span> 1.6.1 综合案例：mtcars数据集分析</a></li>
  <li><a href="#%E6%A1%88%E4%BE%8B%E6%80%BB%E7%BB%93%E4%B8%8E%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5" id="toc-案例总结与最佳实践" class="nav-link" data-scroll-target="#%E6%A1%88%E4%BE%8B%E6%80%BB%E7%BB%93%E4%B8%8E%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="header-section-number">1.7.2</span> 1.6.2 案例总结与最佳实践</a></li>
  </ul>
</li>
  <li><a href="#%E6%9C%AC%E7%AB%A0%E6%80%BB%E7%BB%93" id="toc-本章总结" class="nav-link" data-scroll-target="#%E6%9C%AC%E7%AB%A0%E6%80%BB%E7%BB%93"><span class="header-section-number">1.8</span> 本章总结</a></li>
  <li><a href="#%E4%B8%8E%E5%90%8E%E7%BB%AD%E7%AB%A0%E8%8A%82%E7%9A%84%E8%81%94%E7%B3%BB" id="toc-与后续章节的联系" class="nav-link" data-scroll-target="#%E4%B8%8E%E5%90%8E%E7%BB%AD%E7%AB%A0%E8%8A%82%E7%9A%84%E8%81%94%E7%B3%BB"><span class="header-section-number">1.9</span> 与后续章节的联系</a></li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapters/1 预测、过拟合与模型评估.html">起步-线性回归分析</a></li><li class="breadcrumb-item"><a href="../chapters/1 预测、过拟合与模型评估.html"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">预测、过拟合与模型评估</span></a></li></ol></nav><div class="quarto-title">
<h1 class="title">
<span class="chapter-number">1</span>&nbsp; <span class="chapter-title">预测、过拟合与模型评估</span>
</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><section id="本章导读" class="level2" data-number="1.1"><h2 data-number="1.1" class="anchored" data-anchor-id="本章导读">
<span class="header-section-number">1.1</span> 本章导读</h2>
<p>预测建模是现代数据分析的核心任务，无论是预测连续数值（回归）还是预测类别标签（分类），都需要建立系统的评估框架。本章将介绍预测建模的基本概念，重点讨论过拟合现象及其危害，并建立完整的模型评估体系，为后续学习各种预测模型奠定基础。</p>
</section><section id="预测建模的基本概念" class="level2" data-number="1.2"><h2 data-number="1.2" class="anchored" data-anchor-id="预测建模的基本概念">
<span class="header-section-number">1.2</span> 1.1 预测建模的基本概念</h2>
<section id="回归与分类任务" class="level3" data-number="1.2.1"><h3 data-number="1.2.1" class="anchored" data-anchor-id="回归与分类任务">
<span class="header-section-number">1.2.1</span> 1.1.1 回归与分类任务</h3>
<p>回归分析： 回归任务旨在预测连续型数值变量。例如： - 预测房屋价格（连续金额） - 预测股票收益率（连续百分比） - 预测气温变化（连续温度值） - 预测销售额（连续数量）</p>
<p>数学上，回归模型试图建立从特征变量 <span class="math inline">\(X\)</span> 到连续响应变量 <span class="math inline">\(Y\)</span> 的映射： <span class="math display">\[
Y = f(X) + \varepsilon
\]</span> 其中 <span class="math inline">\(\varepsilon\)</span> 是随机误差项，代表模型无法解释的部分。</p>
<p>分类分析： 分类任务旨在预测离散型类别变量。例如： - 判断邮件是否为垃圾邮件（二分类：是/否） - 诊断患者是否患病（二分类：健康/患病） - 识别图像中的物体类别（多分类：猫/狗/车等） - 信用风险评估（多分类：低风险/中风险/高风险）</p>
<p>分类模型建立从特征变量 <span class="math inline">\(X\)</span> 到类别标签 <span class="math inline">\(Y\)</span> 的映射： <span class="math display">\[
Y = g(X), \quad Y \in \{C_1, C_2, \ldots, C_K\}
\]</span></p>
</section><section id="特征与响应变量" class="level3" data-number="1.2.2"><h3 data-number="1.2.2" class="anchored" data-anchor-id="特征与响应变量">
<span class="header-section-number">1.2.2</span> 1.1.2 特征与响应变量</h3>
<p>特征变量（自变量）： - 用于预测的输入变量 - 可以是数值型、分类型或顺序型 - 表示为 <span class="math inline">\(X = (X_1, X_2, \ldots, X_p)\)</span> - 特征工程：从原始数据中提取有意义的特征</p>
<p>响应变量（因变量）： - 需要预测的目标变量 - 回归问题中为连续数值 - 分类问题中为离散类别 - 应该与业务目标紧密相关</p>
<p>示例分析： 以房价预测为例： - 特征变量：房屋面积、卧室数量、地理位置、房龄等 - 响应变量：房屋价格（连续值） - 问题类型：回归问题</p>
<p>以垃圾邮件检测为例： - 特征变量：邮件关键词频率、发件人信誉、邮件长度等 - 响应变量：邮件类型（垃圾邮件/正常邮件） - 问题类型：二分类问题</p>
</section><section id="预测建模的流程" class="level3" data-number="1.2.3"><h3 data-number="1.2.3" class="anchored" data-anchor-id="预测建模的流程">
<span class="header-section-number">1.2.3</span> 1.1.3 预测建模的流程</h3>
<p>完整工作流：</p>
<ol type="1">
<li>问题定义：
<ul>
<li>明确业务目标</li>
<li>确定预测任务类型（回归/分类）</li>
<li>制定成功标准</li>
</ul>
</li>
<li>数据准备：
<ul>
<li>数据收集与整合</li>
<li>数据清洗与预处理</li>
<li>探索性数据分析</li>
</ul>
</li>
<li>特征工程：
<ul>
<li>特征选择</li>
<li>特征变换</li>
<li>特征创建</li>
</ul>
</li>
<li>模型选择：
<ul>
<li>根据问题特点选择算法家族</li>
<li>考虑数据规模和特征类型</li>
<li>评估模型假设的合理性</li>
</ul>
</li>
<li>模型训练：
<ul>
<li>参数估计</li>
<li>超参数调优</li>
<li>模型验证</li>
</ul>
</li>
<li>模型评估：
<ul>
<li>性能指标计算</li>
<li>模型比较</li>
<li>误差分析</li>
</ul>
</li>
<li>模型部署：
<ul>
<li>生产环境集成</li>
<li>性能监控</li>
<li>模型更新</li>
</ul>
</li>
</ol></section></section><section id="过拟合与模型复杂度" class="level2" data-number="1.3"><h2 data-number="1.3" class="anchored" data-anchor-id="过拟合与模型复杂度">
<span class="header-section-number">1.3</span> 1.2 过拟合与模型复杂度</h2>
<section id="过拟合的概念与机制" class="level3" data-number="1.3.1"><h3 data-number="1.3.1" class="anchored" data-anchor-id="过拟合的概念与机制">
<span class="header-section-number">1.3.1</span> 1.2.1 过拟合的概念与机制</h3>
<p>过拟合的本质： 模型过度适应训练数据中的特定模式（包括噪声），导致在新数据上泛化能力下降。</p>
<p>过拟合的数学描述： 设 <span class="math inline">\(f\)</span> 为真实函数，<span class="math inline">\(\hat{f}\)</span> 为估计函数，则： - 训练误差：<span class="math inline">\(\text{Err}_{\text{train}} = E[L(Y, \hat{f}(X)) | \text{train}]\)</span> - 测试误差：<span class="math inline">\(\text{Err}_{\text{test}} = E[L(Y, \hat{f}(X)) | \text{test}]\)</span></p>
<p>当 <span class="math inline">\(\text{Err}_{\text{train}} \ll \text{Err}_{\text{test}}\)</span> 时，发生过拟合。</p>
<p>过拟合的视觉示例： 考虑多项式回归： - 适当阶数：平滑曲线，很好拟合真实趋势 - 过高阶数：曲线剧烈波动，拟合每个数据点（包括噪声）</p>
<p>欠拟合： 与过拟合相对，模型过于简单，无法捕捉数据中的基本模式： - <span class="math inline">\(\text{Err}_{\text{train}}\)</span> 很大 - <span class="math inline">\(\text{Err}_{\text{test}}\)</span> 也很大 - 模型能力不足</p>
<p><strong>编程演示：过拟合现象</strong></p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="co"># 1.2.1 过拟合现象演示 - 生成数据</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="co"># 生成理想的过拟合演示数据</span></span>
<span id="cb1-3"><a href="#cb1-3"></a>generate_overfitting_demo_data <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">n =</span> <span class="dv">100</span>) {</span>
<span id="cb1-4"><a href="#cb1-4"></a>  <span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb1-5"><a href="#cb1-5"></a>  x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">4</span> <span class="sc">*</span> pi, <span class="at">length.out =</span> n)</span>
<span id="cb1-6"><a href="#cb1-6"></a>  <span class="co"># 真实关系：正弦函数 + 噪声</span></span>
<span id="cb1-7"><a href="#cb1-7"></a>  y_true <span class="ot">&lt;-</span> <span class="fu">sin</span>(x) <span class="sc">+</span> <span class="fl">0.5</span> <span class="sc">*</span> <span class="fu">sin</span>(<span class="dv">2</span><span class="sc">*</span>x)</span>
<span id="cb1-8"><a href="#cb1-8"></a>  y_observed <span class="ot">&lt;-</span> y_true <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="fl">0.2</span>)</span>
<span id="cb1-9"><a href="#cb1-9"></a>  <span class="fu">return</span>(<span class="fu">data.frame</span>(<span class="at">x =</span> x, <span class="at">y_true =</span> y_true, <span class="at">y_observed =</span> y_observed))</span>
<span id="cb1-10"><a href="#cb1-10"></a>}</span>
<span id="cb1-11"><a href="#cb1-11"></a></span>
<span id="cb1-12"><a href="#cb1-12"></a><span class="co"># 生成数据</span></span>
<span id="cb1-13"><a href="#cb1-13"></a>demo_data <span class="ot">&lt;-</span> <span class="fu">generate_overfitting_demo_data</span>(<span class="dv">100</span>)</span>
<span id="cb1-14"><a href="#cb1-14"></a></span>
<span id="cb1-15"><a href="#cb1-15"></a><span class="co"># 拟合不同复杂度的多项式模型</span></span>
<span id="cb1-16"><a href="#cb1-16"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-17"><a href="#cb1-17"></a>fit_polynomial_models <span class="ot">&lt;-</span> <span class="cf">function</span>(data, <span class="at">max_degree =</span> <span class="dv">6</span>) {</span>
<span id="cb1-18"><a href="#cb1-18"></a>  models <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb1-19"><a href="#cb1-19"></a>  predictions <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> data<span class="sc">$</span>x)</span>
<span id="cb1-20"><a href="#cb1-20"></a>  </span>
<span id="cb1-21"><a href="#cb1-21"></a>  <span class="cf">for</span> (degree <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>max_degree) {</span>
<span id="cb1-22"><a href="#cb1-22"></a>    model <span class="ot">&lt;-</span> <span class="fu">lm</span>(y_observed <span class="sc">~</span> <span class="fu">poly</span>(x, degree), <span class="at">data =</span> data)</span>
<span id="cb1-23"><a href="#cb1-23"></a>    models[[<span class="fu">paste0</span>(<span class="st">"degree_"</span>, degree)]] <span class="ot">&lt;-</span> model</span>
<span id="cb1-24"><a href="#cb1-24"></a>    predictions[[<span class="fu">paste0</span>(<span class="st">"pred_"</span>, degree)]] <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, <span class="at">newdata =</span> data)</span>
<span id="cb1-25"><a href="#cb1-25"></a>  }</span>
<span id="cb1-26"><a href="#cb1-26"></a>  </span>
<span id="cb1-27"><a href="#cb1-27"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">models =</span> models, <span class="at">predictions =</span> predictions))</span>
<span id="cb1-28"><a href="#cb1-28"></a>}</span>
<span id="cb1-29"><a href="#cb1-29"></a></span>
<span id="cb1-30"><a href="#cb1-30"></a><span class="co"># 拟合模型</span></span>
<span id="cb1-31"><a href="#cb1-31"></a>results <span class="ot">&lt;-</span> <span class="fu">fit_polynomial_models</span>(demo_data)</span>
<span id="cb1-32"><a href="#cb1-32"></a></span>
<span id="cb1-33"><a href="#cb1-33"></a><span class="co"># 可视化过拟合现象</span></span>
<span id="cb1-34"><a href="#cb1-34"></a>plot_overfitting_demo <span class="ot">&lt;-</span> <span class="cf">function</span>(data, predictions) {</span>
<span id="cb1-35"><a href="#cb1-35"></a>  plot_data <span class="ot">&lt;-</span> <span class="fu">cbind</span>(data, predictions)</span>
<span id="cb1-36"><a href="#cb1-36"></a>  plot_data_long <span class="ot">&lt;-</span> reshape2<span class="sc">::</span><span class="fu">melt</span>(plot_data, <span class="at">id.vars =</span> <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y_true"</span>, <span class="st">"y_observed"</span>), </span>
<span id="cb1-37"><a href="#cb1-37"></a>                                  <span class="at">variable.name =</span> <span class="st">"model"</span>, <span class="at">value.name =</span> <span class="st">"prediction"</span>)</span>
<span id="cb1-38"><a href="#cb1-38"></a>  </span>
<span id="cb1-39"><a href="#cb1-39"></a>  <span class="fu">ggplot</span>(plot_data_long, <span class="fu">aes</span>(<span class="at">x =</span> x)) <span class="sc">+</span></span>
<span id="cb1-40"><a href="#cb1-40"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> y_observed), <span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb1-41"><a href="#cb1-41"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> y_true, <span class="at">color =</span> <span class="st">"真实关系"</span>), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb1-42"><a href="#cb1-42"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> prediction, <span class="at">color =</span> model), <span class="at">size =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb1-43"><a href="#cb1-43"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span> model, <span class="at">ncol =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb1-44"><a href="#cb1-44"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"过拟合现象演示：不同阶数多项式回归"</span>,</span>
<span id="cb1-45"><a href="#cb1-45"></a>         <span class="at">x =</span> <span class="st">"X"</span>, <span class="at">y =</span> <span class="st">"Y"</span>,</span>
<span id="cb1-46"><a href="#cb1-46"></a>         <span class="at">color =</span> <span class="st">"曲线类型"</span>) <span class="sc">+</span></span>
<span id="cb1-47"><a href="#cb1-47"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb1-48"><a href="#cb1-48"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"真实关系"</span> <span class="ot">=</span> <span class="st">"black"</span>, </span>
<span id="cb1-49"><a href="#cb1-49"></a>                                 <span class="st">"pred_1"</span> <span class="ot">=</span> <span class="st">"red"</span>, <span class="st">"pred_2"</span> <span class="ot">=</span> <span class="st">"blue"</span>, </span>
<span id="cb1-50"><a href="#cb1-50"></a>                                 <span class="st">"pred_3"</span> <span class="ot">=</span> <span class="st">"green"</span>, <span class="st">"pred_4"</span> <span class="ot">=</span> <span class="st">"orange"</span>,</span>
<span id="cb1-51"><a href="#cb1-51"></a>                                 <span class="st">"pred_5"</span> <span class="ot">=</span> <span class="st">"purple"</span>, <span class="st">"pred_6"</span> <span class="ot">=</span> <span class="st">"brown"</span>)) <span class="sc">+</span></span>
<span id="cb1-52"><a href="#cb1-52"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb1-53"><a href="#cb1-53"></a>}</span>
<span id="cb1-54"><a href="#cb1-54"></a></span>
<span id="cb1-55"><a href="#cb1-55"></a><span class="co"># 显示图形</span></span>
<span id="cb1-56"><a href="#cb1-56"></a><span class="fu">plot_overfitting_demo</span>(demo_data, results<span class="sc">$</span>predictions)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
ℹ Please use `linewidth` instead.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="1-预测、过拟合与模型评估_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="偏差-方差权衡的深入分析" class="level3" data-number="1.3.2"><h3 data-number="1.3.2" class="anchored" data-anchor-id="偏差-方差权衡的深入分析">
<span class="header-section-number">1.3.2</span> 1.2.2 偏差-方差权衡的深入分析</h3>
<p>期望预测误差的严格分解： 对于回归问题，在平方损失下： <span class="math display">\[
\begin{aligned}
E[(Y - \hat{f}(X))^2] &amp;= E[(Y - E[Y|X] + E[Y|X] - \hat{f}(X))^2] \\
&amp;= E[(Y - E[Y|X])^2] + E[(E[Y|X] - \hat{f}(X))^2] \\
&amp;= \text{Var}(Y|X) + \text{Bias}^2(\hat{f}(X)) + \text{Var}(\hat{f}(X))
\end{aligned}
\]</span></p>
<p>偏差： - <span class="math inline">\(\text{Bias}(\hat{f}(X)) = E[\hat{f}(X)] - f(X)\)</span> - 系统性错误，模型与真实关系的差距 - 高偏差原因：模型过于简单，假设太强</p>
<p>方差： - <span class="math inline">\(\text{Var}(\hat{f}(X)) = E[(\hat{f}(X) - E[\hat{f}(X)])^2]\)</span> - 模型对训练数据变化的敏感性 - 高方差原因：模型过于复杂，对噪声敏感</p>
<p>不可约误差： - <span class="math inline">\(\sigma_\varepsilon^2 = \text{Var}(Y|X)\)</span> - 数据内在的随机性 - 无法通过改进模型减少</p>
<p><strong>编程演示：偏差-方差权衡</strong></p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="co"># 1.2.2 偏差-方差权衡演示</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>demonstrate_bias_variance <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb3-3"><a href="#cb3-3"></a>  <span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb3-4"><a href="#cb3-4"></a>  n_simulations <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb3-5"><a href="#cb3-5"></a>  x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">length.out =</span> <span class="dv">50</span>)</span>
<span id="cb3-6"><a href="#cb3-6"></a>  true_function <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">sin</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> x)</span>
<span id="cb3-7"><a href="#cb3-7"></a>  </span>
<span id="cb3-8"><a href="#cb3-8"></a>  <span class="co"># 生成多个训练集</span></span>
<span id="cb3-9"><a href="#cb3-9"></a>  generate_training_set <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb3-10"><a href="#cb3-10"></a>    x_train <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">20</span>, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb3-11"><a href="#cb3-11"></a>    y_train <span class="ot">&lt;-</span> <span class="fu">true_function</span>(x_train) <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">20</span>, <span class="dv">0</span>, <span class="fl">0.3</span>)</span>
<span id="cb3-12"><a href="#cb3-12"></a>    <span class="fu">return</span>(<span class="fu">data.frame</span>(<span class="at">x =</span> x_train, <span class="at">y =</span> y_train))</span>
<span id="cb3-13"><a href="#cb3-13"></a>  }</span>
<span id="cb3-14"><a href="#cb3-14"></a>  </span>
<span id="cb3-15"><a href="#cb3-15"></a>  <span class="co"># 拟合不同复杂度的模型</span></span>
<span id="cb3-16"><a href="#cb3-16"></a>  fit_models <span class="ot">&lt;-</span> <span class="cf">function</span>(data, degree) {</span>
<span id="cb3-17"><a href="#cb3-17"></a>    <span class="cf">if</span> (degree <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb3-18"><a href="#cb3-18"></a>      <span class="fu">lm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> data)</span>
<span id="cb3-19"><a href="#cb3-19"></a>    } <span class="cf">else</span> {</span>
<span id="cb3-20"><a href="#cb3-20"></a>      <span class="fu">lm</span>(y <span class="sc">~</span> <span class="fu">poly</span>(x, degree), <span class="at">data =</span> data)</span>
<span id="cb3-21"><a href="#cb3-21"></a>    }</span>
<span id="cb3-22"><a href="#cb3-22"></a>  }</span>
<span id="cb3-23"><a href="#cb3-23"></a>  </span>
<span id="cb3-24"><a href="#cb3-24"></a>  <span class="co"># 计算偏差和方差</span></span>
<span id="cb3-25"><a href="#cb3-25"></a>  results <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb3-26"><a href="#cb3-26"></a>  degrees <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">10</span>)  <span class="co"># 低、中、高复杂度</span></span>
<span id="cb3-27"><a href="#cb3-27"></a>  </span>
<span id="cb3-28"><a href="#cb3-28"></a>  <span class="cf">for</span> (degree <span class="cf">in</span> degrees) {</span>
<span id="cb3-29"><a href="#cb3-29"></a>    predictions <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> <span class="fu">length</span>(x), <span class="at">ncol =</span> n_simulations)</span>
<span id="cb3-30"><a href="#cb3-30"></a>    </span>
<span id="cb3-31"><a href="#cb3-31"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_simulations) {</span>
<span id="cb3-32"><a href="#cb3-32"></a>      train_data <span class="ot">&lt;-</span> <span class="fu">generate_training_set</span>()</span>
<span id="cb3-33"><a href="#cb3-33"></a>      model <span class="ot">&lt;-</span> <span class="fu">fit_models</span>(train_data, degree)</span>
<span id="cb3-34"><a href="#cb3-34"></a>      pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, <span class="at">newdata =</span> <span class="fu">data.frame</span>(<span class="at">x =</span> x))</span>
<span id="cb3-35"><a href="#cb3-35"></a>      predictions[, i] <span class="ot">&lt;-</span> pred</span>
<span id="cb3-36"><a href="#cb3-36"></a>    }</span>
<span id="cb3-37"><a href="#cb3-37"></a>    </span>
<span id="cb3-38"><a href="#cb3-38"></a>    <span class="co"># 计算偏差和方差</span></span>
<span id="cb3-39"><a href="#cb3-39"></a>    mean_pred <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(predictions)</span>
<span id="cb3-40"><a href="#cb3-40"></a>    bias_sq <span class="ot">&lt;-</span> <span class="fu">mean</span>((mean_pred <span class="sc">-</span> <span class="fu">true_function</span>(x))<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb3-41"><a href="#cb3-41"></a>    variance <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">apply</span>(predictions, <span class="dv">1</span>, var))</span>
<span id="cb3-42"><a href="#cb3-42"></a>    </span>
<span id="cb3-43"><a href="#cb3-43"></a>    results[[<span class="fu">as.character</span>(degree)]] <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb3-44"><a href="#cb3-44"></a>      <span class="at">bias_sq =</span> bias_sq,</span>
<span id="cb3-45"><a href="#cb3-45"></a>      <span class="at">variance =</span> variance,</span>
<span id="cb3-46"><a href="#cb3-46"></a>      <span class="at">total_error =</span> bias_sq <span class="sc">+</span> variance <span class="sc">+</span> <span class="fl">0.3</span><span class="sc">^</span><span class="dv">2</span>,  <span class="co"># 加上噪声方差</span></span>
<span id="cb3-47"><a href="#cb3-47"></a>      <span class="at">predictions =</span> predictions,</span>
<span id="cb3-48"><a href="#cb3-48"></a>      <span class="at">mean_pred =</span> mean_pred</span>
<span id="cb3-49"><a href="#cb3-49"></a>    )</span>
<span id="cb3-50"><a href="#cb3-50"></a>  }</span>
<span id="cb3-51"><a href="#cb3-51"></a>  </span>
<span id="cb3-52"><a href="#cb3-52"></a>  <span class="fu">return</span>(results)</span>
<span id="cb3-53"><a href="#cb3-53"></a>}</span>
<span id="cb3-54"><a href="#cb3-54"></a></span>
<span id="cb3-55"><a href="#cb3-55"></a><span class="co"># 运行演示</span></span>
<span id="cb3-56"><a href="#cb3-56"></a>bias_variance_results <span class="ot">&lt;-</span> <span class="fu">demonstrate_bias_variance</span>()</span>
<span id="cb3-57"><a href="#cb3-57"></a></span>
<span id="cb3-58"><a href="#cb3-58"></a><span class="co"># 可视化结果</span></span>
<span id="cb3-59"><a href="#cb3-59"></a>plot_bias_variance <span class="ot">&lt;-</span> <span class="cf">function</span>(results, x) {</span>
<span id="cb3-60"><a href="#cb3-60"></a>  true_y <span class="ot">&lt;-</span> <span class="fu">sin</span>(<span class="dv">2</span> <span class="sc">*</span> pi <span class="sc">*</span> x)</span>
<span id="cb3-61"><a href="#cb3-61"></a>  </span>
<span id="cb3-62"><a href="#cb3-62"></a>  <span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>))</span>
<span id="cb3-63"><a href="#cb3-63"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>) {</span>
<span id="cb3-64"><a href="#cb3-64"></a>    degree <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">10</span>)[i]</span>
<span id="cb3-65"><a href="#cb3-65"></a>    res <span class="ot">&lt;-</span> results[[<span class="fu">as.character</span>(degree)]]</span>
<span id="cb3-66"><a href="#cb3-66"></a>    </span>
<span id="cb3-67"><a href="#cb3-67"></a>    <span class="fu">plot</span>(x, true_y, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">"black"</span>, </span>
<span id="cb3-68"><a href="#cb3-68"></a>         <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">1.5</span>, <span class="fl">1.5</span>), <span class="at">main =</span> <span class="fu">paste</span>(<span class="st">"多项式阶数:"</span>, degree),</span>
<span id="cb3-69"><a href="#cb3-69"></a>         <span class="at">xlab =</span> <span class="st">"X"</span>, <span class="at">ylab =</span> <span class="st">"Y"</span>)</span>
<span id="cb3-70"><a href="#cb3-70"></a>    </span>
<span id="cb3-71"><a href="#cb3-71"></a>    <span class="co"># 绘制多个拟合曲线</span></span>
<span id="cb3-72"><a href="#cb3-72"></a>    <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>) {</span>
<span id="cb3-73"><a href="#cb3-73"></a>      <span class="fu">lines</span>(x, res<span class="sc">$</span>predictions[, j], <span class="at">col =</span> <span class="fu">rgb</span>(<span class="fl">0.7</span>, <span class="fl">0.7</span>, <span class="fl">0.7</span>, <span class="fl">0.3</span>))</span>
<span id="cb3-74"><a href="#cb3-74"></a>    }</span>
<span id="cb3-75"><a href="#cb3-75"></a>    </span>
<span id="cb3-76"><a href="#cb3-76"></a>    <span class="co"># 绘制平均预测和真实函数</span></span>
<span id="cb3-77"><a href="#cb3-77"></a>    <span class="fu">lines</span>(x, res<span class="sc">$</span>mean_pred, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb3-78"><a href="#cb3-78"></a>    <span class="fu">lines</span>(x, true_y, <span class="at">col =</span> <span class="st">"black"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb3-79"><a href="#cb3-79"></a>    </span>
<span id="cb3-80"><a href="#cb3-80"></a>    <span class="co"># 添加图例</span></span>
<span id="cb3-81"><a href="#cb3-81"></a>    <span class="fu">legend</span>(<span class="st">"topright"</span>, </span>
<span id="cb3-82"><a href="#cb3-82"></a>           <span class="at">legend =</span> <span class="fu">c</span>(<span class="st">"真实函数"</span>, <span class="st">"平均预测"</span>, <span class="st">"单个拟合"</span>),</span>
<span id="cb3-83"><a href="#cb3-83"></a>           <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"red"</span>, <span class="st">"gray"</span>), <span class="at">lwd =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>), <span class="at">bty =</span> <span class="st">"n"</span>)</span>
<span id="cb3-84"><a href="#cb3-84"></a>  }</span>
<span id="cb3-85"><a href="#cb3-85"></a>  <span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb3-86"><a href="#cb3-86"></a>}</span>
<span id="cb3-87"><a href="#cb3-87"></a></span>
<span id="cb3-88"><a href="#cb3-88"></a><span class="co"># 创建x值用于绘图</span></span>
<span id="cb3-89"><a href="#cb3-89"></a>x_plot <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">length.out =</span> <span class="dv">50</span>)</span>
<span id="cb3-90"><a href="#cb3-90"></a><span class="fu">plot_bias_variance</span>(bias_variance_results, x_plot)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="1-预测、过拟合与模型评估_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="co"># 打印偏差-方差分解结果</span></span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="fu">cat</span>(<span class="st">"偏差-方差分解结果:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>偏差-方差分解结果:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="cf">for</span> (degree <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">10</span>)) {</span>
<span id="cb6-2"><a href="#cb6-2"></a>  res <span class="ot">&lt;-</span> bias_variance_results[[<span class="fu">as.character</span>(degree)]]</span>
<span id="cb6-3"><a href="#cb6-3"></a>  <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"阶数 %d: 偏差²=%.4f, 方差=%.4f, 总误差=%.4f</span><span class="sc">\n</span><span class="st">"</span>, </span>
<span id="cb6-4"><a href="#cb6-4"></a>              degree, res<span class="sc">$</span>bias_sq, res<span class="sc">$</span>variance, res<span class="sc">$</span>total_error))</span>
<span id="cb6-5"><a href="#cb6-5"></a>}</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>阶数 1: 偏差²=0.2124, 方差=0.0309, 总误差=0.3333
阶数 3: 偏差²=0.0068, 方差=0.0269, 总误差=0.1236
阶数 10: 偏差²=479112.8409, 方差=48825232.2140, 总误差=49304345.1449</code></pre>
</div>
</div>
</section><section id="模型复杂度的影响分析" class="level3" data-number="1.3.3"><h3 data-number="1.3.3" class="anchored" data-anchor-id="模型复杂度的影响分析">
<span class="header-section-number">1.3.3</span> 1.2.3 模型复杂度的影响分析</h3>
<p>复杂度与误差的关系：</p>
<table class="caption-top table">
<thead><tr class="header">
<th>复杂度状态</th>
<th>训练误差</th>
<th>测试误差</th>
<th>偏差</th>
<th>方差</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>低复杂度</td>
<td>高</td>
<td>高</td>
<td>高</td>
<td>低</td>
</tr>
<tr class="even">
<td>最优复杂度</td>
<td>中等</td>
<td>最低</td>
<td>中等</td>
<td>中等</td>
</tr>
<tr class="odd">
<td>高复杂度</td>
<td>很低</td>
<td>高</td>
<td>低</td>
<td>高</td>
</tr>
</tbody>
</table>
<p>学习曲线分析： 绘制训练集大小与误差的关系： - 训练误差：随样本增加而增加（趋于稳定） - 测试误差：随样本增加而减少（趋于稳定） - 两者差距：反映方差大小</p>
<p>实际指导意义： - 高偏差：增加模型复杂度，增加特征 - 高方差：减少模型复杂度，增加数据，正则化</p>
</section></section><section id="模型评估框架" class="level2" data-number="1.4"><h2 data-number="1.4" class="anchored" data-anchor-id="模型评估框架">
<span class="header-section-number">1.4</span> 1.3 模型评估框架</h2>
<section id="数据划分的详细策略" class="level3" data-number="1.4.1"><h3 data-number="1.4.1" class="anchored" data-anchor-id="数据划分的详细策略">
<span class="header-section-number">1.4.1</span> 1.3.1 数据划分的详细策略</h3>
<p>为什么需要数据划分： - 评估模型泛化能力 - 避免对训练数据的过度优化 - 提供无偏的性能估计</p>
<p>训练集： - 用于模型参数估计 - 应该足够大以学习数据模式 - 通常占60-80%</p>
<p>验证集： - 用于模型选择和超参数调优 - 提供模型比较的基础 - 通常占10-20%</p>
<p>测试集： - 用于最终模型评估 - 在整个建模过程中只能使用一次 - 通常占10-20%</p>
<p>数学表达： 将数据集 <span class="math inline">\(D\)</span> 划分为： <span class="math display">\[
D = D_{\text{train}} \cup D_{\text{val}} \cup D_{\text{test}}
\]</span> 其中： - <span class="math inline">\(D_{\text{train}} \cap D_{\text{val}} = \emptyset\)</span> - <span class="math inline">\(D_{\text{train}} \cap D_{\text{test}} = \emptyset\)</span> - <span class="math inline">\(D_{\text{val}} \cap D_{\text{test}} = \emptyset\)</span></p>
<p>特殊情况的处理： - 小样本：使用交叉验证 - 时间序列：按时间顺序划分 - 不平衡数据：分层抽样</p>
<p><strong>编程演示：数据划分策略</strong></p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="co"># 1.3.1 数据划分策略演示</span></span>
<span id="cb8-2"><a href="#cb8-2"></a>demonstrate_data_splitting <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb8-3"><a href="#cb8-3"></a>  <span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb8-4"><a href="#cb8-4"></a>  n <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb8-5"><a href="#cb8-5"></a>  <span class="co"># 生成回归数据</span></span>
<span id="cb8-6"><a href="#cb8-6"></a>  x1 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n)</span>
<span id="cb8-7"><a href="#cb8-7"></a>  x2 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n)</span>
<span id="cb8-8"><a href="#cb8-8"></a>  y <span class="ot">&lt;-</span> <span class="dv">2</span><span class="sc">*</span>x1 <span class="sc">+</span> <span class="dv">3</span><span class="sc">*</span>x2 <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb8-9"><a href="#cb8-9"></a>  data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x1 =</span> x1, <span class="at">x2 =</span> x2, <span class="at">y =</span> y)</span>
<span id="cb8-10"><a href="#cb8-10"></a>  </span>
<span id="cb8-11"><a href="#cb8-11"></a>  <span class="co"># 简单划分（70%训练，30%测试）</span></span>
<span id="cb8-12"><a href="#cb8-12"></a>  train_idx_simple <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span>n, <span class="at">size =</span> <span class="fl">0.7</span> <span class="sc">*</span> n)</span>
<span id="cb8-13"><a href="#cb8-13"></a>  test_idx_simple <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="dv">1</span><span class="sc">:</span>n, train_idx_simple)</span>
<span id="cb8-14"><a href="#cb8-14"></a>  </span>
<span id="cb8-15"><a href="#cb8-15"></a>  <span class="fu">cat</span>(<span class="st">"简单划分结果:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb8-16"><a href="#cb8-16"></a>  <span class="fu">cat</span>(<span class="st">"训练集大小:"</span>, <span class="fu">length</span>(train_idx_simple), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb8-17"><a href="#cb8-17"></a>  <span class="fu">cat</span>(<span class="st">"测试集大小:"</span>, <span class="fu">length</span>(test_idx_simple), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb8-18"><a href="#cb8-18"></a>  </span>
<span id="cb8-19"><a href="#cb8-19"></a>  <span class="co"># 检查分布是否相似</span></span>
<span id="cb8-20"><a href="#cb8-20"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">训练集和测试集分布比较:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb8-21"><a href="#cb8-21"></a>  <span class="fu">cat</span>(<span class="st">"训练集y均值:"</span>, <span class="fu">mean</span>(data<span class="sc">$</span>y[train_idx_simple]), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb8-22"><a href="#cb8-22"></a>  <span class="fu">cat</span>(<span class="st">"测试集y均值:"</span>, <span class="fu">mean</span>(data<span class="sc">$</span>y[test_idx_simple]), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb8-23"><a href="#cb8-23"></a>  </span>
<span id="cb8-24"><a href="#cb8-24"></a>  <span class="fu">return</span>(<span class="fu">list</span>(</span>
<span id="cb8-25"><a href="#cb8-25"></a>    <span class="at">data =</span> data,</span>
<span id="cb8-26"><a href="#cb8-26"></a>    <span class="at">train_idx =</span> train_idx_simple,</span>
<span id="cb8-27"><a href="#cb8-27"></a>    <span class="at">test_idx =</span> test_idx_simple</span>
<span id="cb8-28"><a href="#cb8-28"></a>  ))</span>
<span id="cb8-29"><a href="#cb8-29"></a>}</span>
<span id="cb8-30"><a href="#cb8-30"></a></span>
<span id="cb8-31"><a href="#cb8-31"></a><span class="co"># 运行演示</span></span>
<span id="cb8-32"><a href="#cb8-32"></a>split_results <span class="ot">&lt;-</span> <span class="fu">demonstrate_data_splitting</span>()</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>简单划分结果:
训练集大小: 700 
测试集大小: 300 

训练集和测试集分布比较:
训练集y均值: 0.1586161 
测试集y均值: 0.09502576 </code></pre>
</div>
</div>
</section><section id="交叉验证方法的详细讨论" class="level3" data-number="1.4.2"><h3 data-number="1.4.2" class="anchored" data-anchor-id="交叉验证方法的详细讨论">
<span class="header-section-number">1.4.2</span> 1.3.2 交叉验证方法的详细讨论</h3>
<p>k折交叉验证的完整流程：</p>
<ol type="1">
<li>数据准备：
<ul>
<li>随机打乱数据</li>
<li>将数据分为k个大小相等的子集 <span class="math inline">\(D_1, D_2, \ldots, D_k\)</span>
</li>
</ul>
</li>
<li>交叉验证循环： For <span class="math inline">\(i = 1\)</span> to <span class="math inline">\(k\)</span>:
<ul>
<li>训练集：<span class="math inline">\(D_{\text{train}}^{(i)} = D \setminus D_i\)</span>
</li>
<li>验证集：<span class="math inline">\(D_{\text{val}}^{(i)} = D_i\)</span>
</li>
<li>在 <span class="math inline">\(D_{\text{train}}^{(i)}\)</span> 上训练模型</li>
<li>在 <span class="math inline">\(D_{\text{val}}^{(i)}\)</span> 上计算验证误差 <span class="math inline">\(\text{Err}^{(i)}\)</span>
</li>
</ul>
</li>
<li>结果汇总：
<ul>
<li>平均验证误差：<span class="math inline">\(CV(k) = \frac{1}{k} \sum_{i=1}^k \text{Err}^{(i)}\)</span>
</li>
<li>误差标准差：<span class="math inline">\(SE_{CV} = \sqrt{\frac{1}{k-1} \sum_{i=1}^k (\text{Err}^{(i)} - CV(k))^2}\)</span>
</li>
</ul>
</li>
</ol>
<p>k值选择： - <span class="math inline">\(k=5\)</span> 或 <span class="math inline">\(k=10\)</span>：常用选择 - <span class="math inline">\(k=n\)</span>（留一法）：计算量大，方差可能较高 - 小k值：偏差较小，方差较大 - 大k值：偏差较大，方差较小</p>
<p>分层k折交叉验证： 对于分类问题，保持每个折中类别比例与整体一致。</p>
<p>时间序列交叉验证： 对于时间相关数据，确保验证集时间在训练集之后。</p>
</section></section><section id="评估指标" class="level2" data-number="1.5"><h2 data-number="1.5" class="anchored" data-anchor-id="评估指标">
<span class="header-section-number">1.5</span> 1.4 评估指标</h2>
<section id="回归问题评估指标的深入讨论" class="level3" data-number="1.5.1"><h3 data-number="1.5.1" class="anchored" data-anchor-id="回归问题评估指标的深入讨论">
<span class="header-section-number">1.5.1</span> 1.4.1 回归问题评估指标的深入讨论</h3>
<p>均方误差： <span class="math display">\[
MSE = \frac{1}{n} \sum_{i=1}^n (y_i - \hat{y}_i)^2
\]</span> - 优点：数学性质好，便于优化 - 缺点：对异常值敏感，量纲与原始数据不同</p>
<p>均方根误差： <span class="math display">\[
RMSE = \sqrt{MSE}
\]</span> - 优点：量纲与原始数据相同 - 缺点：仍然对异常值敏感</p>
<p>平均绝对误差： <span class="math display">\[
MAE = \frac{1}{n} \sum_{i=1}^n |y_i - \hat{y}_i|
\]</span> - 优点：对异常值不敏感 - 缺点：数学性质较差，优化困难</p>
<p>平均绝对百分比误差： <span class="math display">\[
MAPE = \frac{100\%}{n} \sum_{i=1}^n \left| \frac{y_i - \hat{y}_i}{y_i} \right|
\]</span> - 优点：相对误差，易于解释 - 缺点：<span class="math inline">\(y_i=0\)</span>时无法计算，对负值处理困难</p>
<p>决定系数 <span class="math inline">\(R^2\)</span>： <span class="math display">\[
R^2 = 1 - \frac{\sum_{i=1}^n (y_i - \hat{y}_i)^2}{\sum_{i=1}^n (y_i - \bar{y})^2}
\]</span> - 优点：标准化，易于比较 - 缺点：随特征增加而增加，可能误导</p>
<p>调整<span class="math inline">\(R^2\)</span>： <span class="math display">\[
R^2_{\text{adj}} = 1 - \frac{(1-R^2)(n-1)}{n-p-1}
\]</span> 其中 <span class="math inline">\(p\)</span> 是特征数，惩罚特征过多的模型。</p>
<p>** 演示：回归评估指标**</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="co"># 1.4.1 回归评估指标演示</span></span>
<span id="cb10-2"><a href="#cb10-2"></a>demonstrate_regression_metrics <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb10-3"><a href="#cb10-3"></a>  <span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb10-4"><a href="#cb10-4"></a>  n <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb10-5"><a href="#cb10-5"></a>  <span class="co"># 生成数据</span></span>
<span id="cb10-6"><a href="#cb10-6"></a>  x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n)</span>
<span id="cb10-7"><a href="#cb10-7"></a>  y_true <span class="ot">&lt;-</span> <span class="dv">2</span><span class="sc">*</span>x <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb10-8"><a href="#cb10-8"></a>  y_pred <span class="ot">&lt;-</span> y_true <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="fl">0.5</span>)  <span class="co"># 预测值（带有误差）</span></span>
<span id="cb10-9"><a href="#cb10-9"></a>  y_actual <span class="ot">&lt;-</span> y_true <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="fl">0.3</span>)  <span class="co"># 实际观测值（带有噪声）</span></span>
<span id="cb10-10"><a href="#cb10-10"></a>  </span>
<span id="cb10-11"><a href="#cb10-11"></a>  <span class="co"># 计算各种评估指标</span></span>
<span id="cb10-12"><a href="#cb10-12"></a>  calculate_regression_metrics <span class="ot">&lt;-</span> <span class="cf">function</span>(actual, predicted) {</span>
<span id="cb10-13"><a href="#cb10-13"></a>    n <span class="ot">&lt;-</span> <span class="fu">length</span>(actual)</span>
<span id="cb10-14"><a href="#cb10-14"></a>    residuals <span class="ot">&lt;-</span> actual <span class="sc">-</span> predicted</span>
<span id="cb10-15"><a href="#cb10-15"></a>    </span>
<span id="cb10-16"><a href="#cb10-16"></a>    mse <span class="ot">&lt;-</span> <span class="fu">mean</span>(residuals<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb10-17"><a href="#cb10-17"></a>    rmse <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(mse)</span>
<span id="cb10-18"><a href="#cb10-18"></a>    mae <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">abs</span>(residuals))</span>
<span id="cb10-19"><a href="#cb10-19"></a>    </span>
<span id="cb10-20"><a href="#cb10-20"></a>    <span class="co"># R-squared</span></span>
<span id="cb10-21"><a href="#cb10-21"></a>    ss_residual <span class="ot">&lt;-</span> <span class="fu">sum</span>(residuals<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb10-22"><a href="#cb10-22"></a>    ss_total <span class="ot">&lt;-</span> <span class="fu">sum</span>((actual <span class="sc">-</span> <span class="fu">mean</span>(actual))<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb10-23"><a href="#cb10-23"></a>    r_squared <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> (ss_residual <span class="sc">/</span> ss_total)</span>
<span id="cb10-24"><a href="#cb10-24"></a>    </span>
<span id="cb10-25"><a href="#cb10-25"></a>    <span class="co"># 调整R-squared</span></span>
<span id="cb10-26"><a href="#cb10-26"></a>    p <span class="ot">&lt;-</span> <span class="dv">1</span>  <span class="co"># 特征数</span></span>
<span id="cb10-27"><a href="#cb10-27"></a>    r_squared_adj <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> (<span class="dv">1</span> <span class="sc">-</span> r_squared) <span class="sc">*</span> (n <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">/</span> (n <span class="sc">-</span> p <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb10-28"><a href="#cb10-28"></a>    </span>
<span id="cb10-29"><a href="#cb10-29"></a>    <span class="fu">return</span>(<span class="fu">list</span>(</span>
<span id="cb10-30"><a href="#cb10-30"></a>      <span class="at">MSE =</span> mse,</span>
<span id="cb10-31"><a href="#cb10-31"></a>      <span class="at">RMSE =</span> rmse,</span>
<span id="cb10-32"><a href="#cb10-32"></a>      <span class="at">MAE =</span> mae,</span>
<span id="cb10-33"><a href="#cb10-33"></a>      <span class="at">R2 =</span> r_squared,</span>
<span id="cb10-34"><a href="#cb10-34"></a>      <span class="at">R2_adj =</span> r_squared_adj</span>
<span id="cb10-35"><a href="#cb10-35"></a>    ))</span>
<span id="cb10-36"><a href="#cb10-36"></a>  }</span>
<span id="cb10-37"><a href="#cb10-37"></a>  </span>
<span id="cb10-38"><a href="#cb10-38"></a>  metrics <span class="ot">&lt;-</span> <span class="fu">calculate_regression_metrics</span>(y_actual, y_pred)</span>
<span id="cb10-39"><a href="#cb10-39"></a>  </span>
<span id="cb10-40"><a href="#cb10-40"></a>  <span class="fu">cat</span>(<span class="st">"回归评估指标:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb10-41"><a href="#cb10-41"></a>  <span class="fu">cat</span>(<span class="st">"MSE (均方误差):"</span>, <span class="fu">round</span>(metrics<span class="sc">$</span>MSE, <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb10-42"><a href="#cb10-42"></a>  <span class="fu">cat</span>(<span class="st">"RMSE (均方根误差):"</span>, <span class="fu">round</span>(metrics<span class="sc">$</span>RMSE, <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb10-43"><a href="#cb10-43"></a>  <span class="fu">cat</span>(<span class="st">"MAE (平均绝对误差):"</span>, <span class="fu">round</span>(metrics<span class="sc">$</span>MAE, <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb10-44"><a href="#cb10-44"></a>  <span class="fu">cat</span>(<span class="st">"R² (决定系数):"</span>, <span class="fu">round</span>(metrics<span class="sc">$</span>R2, <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb10-45"><a href="#cb10-45"></a>  <span class="fu">cat</span>(<span class="st">"调整R²:"</span>, <span class="fu">round</span>(metrics<span class="sc">$</span>R2_adj, <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb10-46"><a href="#cb10-46"></a>  </span>
<span id="cb10-47"><a href="#cb10-47"></a>  <span class="co"># 可视化预测效果</span></span>
<span id="cb10-48"><a href="#cb10-48"></a>  plot_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb10-49"><a href="#cb10-49"></a>    <span class="at">Actual =</span> y_actual,</span>
<span id="cb10-50"><a href="#cb10-50"></a>    <span class="at">Predicted =</span> y_pred,</span>
<span id="cb10-51"><a href="#cb10-51"></a>    <span class="at">Perfect =</span> y_actual  <span class="co"># 完美预测线</span></span>
<span id="cb10-52"><a href="#cb10-52"></a>  )</span>
<span id="cb10-53"><a href="#cb10-53"></a>  </span>
<span id="cb10-54"><a href="#cb10-54"></a>  <span class="fu">library</span>(ggplot2)</span>
<span id="cb10-55"><a href="#cb10-55"></a>  p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(plot_data, <span class="fu">aes</span>(<span class="at">x =</span> Actual, <span class="at">y =</span> Predicted)) <span class="sc">+</span></span>
<span id="cb10-56"><a href="#cb10-56"></a>    <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb10-57"><a href="#cb10-57"></a>    <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>, <span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb10-58"><a href="#cb10-58"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb10-59"><a href="#cb10-59"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"预测值 vs 实际值"</span>,</span>
<span id="cb10-60"><a href="#cb10-60"></a>         <span class="at">subtitle =</span> <span class="fu">paste</span>(<span class="st">"R² ="</span>, <span class="fu">round</span>(metrics<span class="sc">$</span>R2, <span class="dv">4</span>)),</span>
<span id="cb10-61"><a href="#cb10-61"></a>         <span class="at">x =</span> <span class="st">"实际值"</span>, <span class="at">y =</span> <span class="st">"预测值"</span>) <span class="sc">+</span></span>
<span id="cb10-62"><a href="#cb10-62"></a>    <span class="fu">theme_minimal</span>()</span>
<span id="cb10-63"><a href="#cb10-63"></a>  </span>
<span id="cb10-64"><a href="#cb10-64"></a>  <span class="fu">print</span>(p)</span>
<span id="cb10-65"><a href="#cb10-65"></a>  </span>
<span id="cb10-66"><a href="#cb10-66"></a>  <span class="fu">return</span>(metrics)</span>
<span id="cb10-67"><a href="#cb10-67"></a>}</span>
<span id="cb10-68"><a href="#cb10-68"></a></span>
<span id="cb10-69"><a href="#cb10-69"></a><span class="co"># 运行回归指标演示</span></span>
<span id="cb10-70"><a href="#cb10-70"></a>regression_metrics <span class="ot">&lt;-</span> <span class="fu">demonstrate_regression_metrics</span>()</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>回归评估指标:
MSE (均方误差): 0.3116 
RMSE (均方根误差): 0.5582 
MAE (平均绝对误差): 0.4523 
R² (决定系数): 0.904 
调整R²: 0.9031 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="1-预测、过拟合与模型评估_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="分类问题评估指标的完整体系" class="level3" data-number="1.5.2"><h3 data-number="1.5.2" class="anchored" data-anchor-id="分类问题评估指标的完整体系">
<span class="header-section-number">1.5.2</span> 1.4.2 分类问题评估指标的完整体系</h3>
<p>混淆矩阵的扩展： 对于多分类问题，混淆矩阵是 <span class="math inline">\(K \times K\)</span> 的表格。</p>
<p>准确率的局限性： - 在不平衡数据中可能误导 - 例：99%负例，全预测负类仍有99%准确率</p>
<p>精确率与召回率的权衡： - 精确率：预测为正的样本中实际为正的比例 - 召回率：实际为正的样本中被预测为正的比例 - 通常存在trade-off关系</p>
<p>Fβ分数： <span class="math display">\[
F_\beta = (1+\beta^2) \times \frac{\text{Precision} \times \text{Recall}}{(\beta^2 \times \text{Precision}) + \text{Recall}}
\]</span> - <span class="math inline">\(\beta &gt; 1\)</span>：更重视召回率 - <span class="math inline">\(\beta &lt; 1\)</span>：更重视精确率 - <span class="math inline">\(\beta = 1\)</span>：平衡（F1分数）</p>
<p>马修斯相关系数： <span class="math display">\[
MCC = \frac{TP \times TN - FP \times FN}{\sqrt{(TP+FP)(TP+FN)(TN+FP)(TN+FN)}}
\]</span> 适用于不平衡数据的综合指标。</p>
<ul>
<li>编程演示：分类评估指标*</li>
</ul>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="co"># 1.4.2 分类评估指标演示</span></span>
<span id="cb13-2"><a href="#cb13-2"></a>demonstrate_classification_metrics <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb13-3"><a href="#cb13-3"></a>  <span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb13-4"><a href="#cb13-4"></a>  n <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb13-5"><a href="#cb13-5"></a>  <span class="co"># 生成二分类数据</span></span>
<span id="cb13-6"><a href="#cb13-6"></a>  feature1 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n)</span>
<span id="cb13-7"><a href="#cb13-7"></a>  feature2 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n)</span>
<span id="cb13-8"><a href="#cb13-8"></a>  </span>
<span id="cb13-9"><a href="#cb13-9"></a>  <span class="co"># 生成真实概率</span></span>
<span id="cb13-10"><a href="#cb13-10"></a>  true_prob <span class="ot">&lt;-</span> <span class="fu">plogis</span>(<span class="fl">0.5</span> <span class="sc">+</span> <span class="fl">1.2</span> <span class="sc">*</span> feature1 <span class="sc">-</span> <span class="fl">0.8</span> <span class="sc">*</span> feature2)</span>
<span id="cb13-11"><a href="#cb13-11"></a>  true_labels <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n, <span class="dv">1</span>, true_prob)</span>
<span id="cb13-12"><a href="#cb13-12"></a>  </span>
<span id="cb13-13"><a href="#cb13-13"></a>  <span class="co"># 生成预测概率（带有一些误差）</span></span>
<span id="cb13-14"><a href="#cb13-14"></a>  pred_prob <span class="ot">&lt;-</span> true_prob <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="fl">0.1</span>)</span>
<span id="cb13-15"><a href="#cb13-15"></a>  pred_prob <span class="ot">&lt;-</span> <span class="fu">pmin</span>(<span class="fu">pmax</span>(pred_prob, <span class="dv">0</span>), <span class="dv">1</span>)  <span class="co"># 限制在[0,1]范围内</span></span>
<span id="cb13-16"><a href="#cb13-16"></a>  pred_labels <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(pred_prob <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb13-17"><a href="#cb13-17"></a>  </span>
<span id="cb13-18"><a href="#cb13-18"></a>  <span class="co"># 计算混淆矩阵</span></span>
<span id="cb13-19"><a href="#cb13-19"></a>  calculate_confusion_matrix <span class="ot">&lt;-</span> <span class="cf">function</span>(actual, predicted) {</span>
<span id="cb13-20"><a href="#cb13-20"></a>    tp <span class="ot">&lt;-</span> <span class="fu">sum</span>(actual <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> predicted <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb13-21"><a href="#cb13-21"></a>    tn <span class="ot">&lt;-</span> <span class="fu">sum</span>(actual <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> predicted <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb13-22"><a href="#cb13-22"></a>    fp <span class="ot">&lt;-</span> <span class="fu">sum</span>(actual <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> predicted <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb13-23"><a href="#cb13-23"></a>    fn <span class="ot">&lt;-</span> <span class="fu">sum</span>(actual <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> predicted <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb13-24"><a href="#cb13-24"></a>    </span>
<span id="cb13-25"><a href="#cb13-25"></a>    <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">TP =</span> tp, <span class="at">TN =</span> tn, <span class="at">FP =</span> fp, <span class="at">FN =</span> fn))</span>
<span id="cb13-26"><a href="#cb13-26"></a>  }</span>
<span id="cb13-27"><a href="#cb13-27"></a>  </span>
<span id="cb13-28"><a href="#cb13-28"></a>  cm <span class="ot">&lt;-</span> <span class="fu">calculate_confusion_matrix</span>(true_labels, pred_labels)</span>
<span id="cb13-29"><a href="#cb13-29"></a>  </span>
<span id="cb13-30"><a href="#cb13-30"></a>  <span class="co"># 计算各种指标</span></span>
<span id="cb13-31"><a href="#cb13-31"></a>  accuracy <span class="ot">&lt;-</span> (cm<span class="sc">$</span>TP <span class="sc">+</span> cm<span class="sc">$</span>TN) <span class="sc">/</span> n</span>
<span id="cb13-32"><a href="#cb13-32"></a>  precision <span class="ot">&lt;-</span> cm<span class="sc">$</span>TP <span class="sc">/</span> (cm<span class="sc">$</span>TP <span class="sc">+</span> cm<span class="sc">$</span>FP)</span>
<span id="cb13-33"><a href="#cb13-33"></a>  recall <span class="ot">&lt;-</span> cm<span class="sc">$</span>TP <span class="sc">/</span> (cm<span class="sc">$</span>TP <span class="sc">+</span> cm<span class="sc">$</span>FN)</span>
<span id="cb13-34"><a href="#cb13-34"></a>  f1_score <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> (precision <span class="sc">*</span> recall) <span class="sc">/</span> (precision <span class="sc">+</span> recall)</span>
<span id="cb13-35"><a href="#cb13-35"></a>  </span>
<span id="cb13-36"><a href="#cb13-36"></a>  <span class="co"># 计算AUC</span></span>
<span id="cb13-37"><a href="#cb13-37"></a>  calculate_auc <span class="ot">&lt;-</span> <span class="cf">function</span>(actual, prob) {</span>
<span id="cb13-38"><a href="#cb13-38"></a>    <span class="co"># 简单实现AUC计算</span></span>
<span id="cb13-39"><a href="#cb13-39"></a>    positive_probs <span class="ot">&lt;-</span> prob[actual <span class="sc">==</span> <span class="dv">1</span>]</span>
<span id="cb13-40"><a href="#cb13-40"></a>    negative_probs <span class="ot">&lt;-</span> prob[actual <span class="sc">==</span> <span class="dv">0</span>]</span>
<span id="cb13-41"><a href="#cb13-41"></a>    </span>
<span id="cb13-42"><a href="#cb13-42"></a>    comparisons <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb13-43"><a href="#cb13-43"></a>    correct <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb13-44"><a href="#cb13-44"></a>    </span>
<span id="cb13-45"><a href="#cb13-45"></a>    <span class="co"># 抽样计算以加快速度</span></span>
<span id="cb13-46"><a href="#cb13-46"></a>    n_sample <span class="ot">&lt;-</span> <span class="fu">min</span>(<span class="dv">100</span>, <span class="fu">length</span>(positive_probs), <span class="fu">length</span>(negative_probs))</span>
<span id="cb13-47"><a href="#cb13-47"></a>    pos_sample <span class="ot">&lt;-</span> <span class="fu">sample</span>(positive_probs, n_sample)</span>
<span id="cb13-48"><a href="#cb13-48"></a>    neg_sample <span class="ot">&lt;-</span> <span class="fu">sample</span>(negative_probs, n_sample)</span>
<span id="cb13-49"><a href="#cb13-49"></a>    </span>
<span id="cb13-50"><a href="#cb13-50"></a>    <span class="cf">for</span> (p <span class="cf">in</span> pos_sample) {</span>
<span id="cb13-51"><a href="#cb13-51"></a>      <span class="cf">for</span> (n <span class="cf">in</span> neg_sample) {</span>
<span id="cb13-52"><a href="#cb13-52"></a>        comparisons <span class="ot">&lt;-</span> comparisons <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb13-53"><a href="#cb13-53"></a>        <span class="cf">if</span> (p <span class="sc">&gt;</span> n) correct <span class="ot">&lt;-</span> correct <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb13-54"><a href="#cb13-54"></a>        <span class="cf">else</span> <span class="cf">if</span> (p <span class="sc">==</span> n) correct <span class="ot">&lt;-</span> correct <span class="sc">+</span> <span class="fl">0.5</span></span>
<span id="cb13-55"><a href="#cb13-55"></a>      }</span>
<span id="cb13-56"><a href="#cb13-56"></a>    }</span>
<span id="cb13-57"><a href="#cb13-57"></a>    </span>
<span id="cb13-58"><a href="#cb13-58"></a>    <span class="fu">return</span>(correct <span class="sc">/</span> comparisons)</span>
<span id="cb13-59"><a href="#cb13-59"></a>  }</span>
<span id="cb13-60"><a href="#cb13-60"></a>  </span>
<span id="cb13-61"><a href="#cb13-61"></a>  auc_score <span class="ot">&lt;-</span> <span class="fu">calculate_auc</span>(true_labels, pred_prob)</span>
<span id="cb13-62"><a href="#cb13-62"></a>  </span>
<span id="cb13-63"><a href="#cb13-63"></a>  <span class="fu">cat</span>(<span class="st">"分类评估指标:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb13-64"><a href="#cb13-64"></a>  <span class="fu">cat</span>(<span class="st">"准确率:"</span>, <span class="fu">round</span>(accuracy, <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb13-65"><a href="#cb13-65"></a>  <span class="fu">cat</span>(<span class="st">"精确率:"</span>, <span class="fu">round</span>(precision, <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb13-66"><a href="#cb13-66"></a>  <span class="fu">cat</span>(<span class="st">"召回率:"</span>, <span class="fu">round</span>(recall, <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb13-67"><a href="#cb13-67"></a>  <span class="fu">cat</span>(<span class="st">"F1分数:"</span>, <span class="fu">round</span>(f1_score, <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb13-68"><a href="#cb13-68"></a>  <span class="fu">cat</span>(<span class="st">"AUC:"</span>, <span class="fu">round</span>(auc_score, <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb13-69"><a href="#cb13-69"></a>  </span>
<span id="cb13-70"><a href="#cb13-70"></a>  <span class="co"># 打印混淆矩阵</span></span>
<span id="cb13-71"><a href="#cb13-71"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">混淆矩阵:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb13-72"><a href="#cb13-72"></a>  confusion_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb13-73"><a href="#cb13-73"></a>    <span class="at">Actual_0 =</span> <span class="fu">c</span>(cm<span class="sc">$</span>TN, cm<span class="sc">$</span>FN),</span>
<span id="cb13-74"><a href="#cb13-74"></a>    <span class="at">Actual_1 =</span> <span class="fu">c</span>(cm<span class="sc">$</span>FP, cm<span class="sc">$</span>TP)</span>
<span id="cb13-75"><a href="#cb13-75"></a>  )</span>
<span id="cb13-76"><a href="#cb13-76"></a>  <span class="fu">rownames</span>(confusion_df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Predicted_0"</span>, <span class="st">"Predicted_1"</span>)</span>
<span id="cb13-77"><a href="#cb13-77"></a>  <span class="fu">print</span>(confusion_df)</span>
<span id="cb13-78"><a href="#cb13-78"></a>  </span>
<span id="cb13-79"><a href="#cb13-79"></a>  <span class="co"># 可视化ROC曲线</span></span>
<span id="cb13-80"><a href="#cb13-80"></a>  plot_roc_curve <span class="ot">&lt;-</span> <span class="cf">function</span>(actual, prob) {</span>
<span id="cb13-81"><a href="#cb13-81"></a>    thresholds <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.01</span>)</span>
<span id="cb13-82"><a href="#cb13-82"></a>    tpr <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="fu">length</span>(thresholds))</span>
<span id="cb13-83"><a href="#cb13-83"></a>    fpr <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="fu">length</span>(thresholds))</span>
<span id="cb13-84"><a href="#cb13-84"></a>    </span>
<span id="cb13-85"><a href="#cb13-85"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(thresholds)) {</span>
<span id="cb13-86"><a href="#cb13-86"></a>      pred <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(prob <span class="sc">&gt;</span> thresholds[i], <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb13-87"><a href="#cb13-87"></a>      cm_temp <span class="ot">&lt;-</span> <span class="fu">calculate_confusion_matrix</span>(actual, pred)</span>
<span id="cb13-88"><a href="#cb13-88"></a>      tpr[i] <span class="ot">&lt;-</span> cm_temp<span class="sc">$</span>TP <span class="sc">/</span> (cm_temp<span class="sc">$</span>TP <span class="sc">+</span> cm_temp<span class="sc">$</span>FN)  <span class="co"># 真正率</span></span>
<span id="cb13-89"><a href="#cb13-89"></a>      fpr[i] <span class="ot">&lt;-</span> cm_temp<span class="sc">$</span>FP <span class="sc">/</span> (cm_temp<span class="sc">$</span>FP <span class="sc">+</span> cm_temp<span class="sc">$</span>TN)  <span class="co"># 假正率</span></span>
<span id="cb13-90"><a href="#cb13-90"></a>    }</span>
<span id="cb13-91"><a href="#cb13-91"></a>    </span>
<span id="cb13-92"><a href="#cb13-92"></a>    roc_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">FPR =</span> fpr, <span class="at">TPR =</span> tpr)</span>
<span id="cb13-93"><a href="#cb13-93"></a>    </span>
<span id="cb13-94"><a href="#cb13-94"></a>    <span class="fu">ggplot</span>(roc_data, <span class="fu">aes</span>(<span class="at">x =</span> FPR, <span class="at">y =</span> TPR)) <span class="sc">+</span></span>
<span id="cb13-95"><a href="#cb13-95"></a>      <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb13-96"><a href="#cb13-96"></a>      <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>, <span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"gray"</span>) <span class="sc">+</span></span>
<span id="cb13-97"><a href="#cb13-97"></a>      <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"ROC曲线"</span>,</span>
<span id="cb13-98"><a href="#cb13-98"></a>           <span class="at">subtitle =</span> <span class="fu">paste</span>(<span class="st">"AUC ="</span>, <span class="fu">round</span>(auc_score, <span class="dv">4</span>)),</span>
<span id="cb13-99"><a href="#cb13-99"></a>           <span class="at">x =</span> <span class="st">"假正率 (FPR)"</span>, <span class="at">y =</span> <span class="st">"真正率 (TPR)"</span>) <span class="sc">+</span></span>
<span id="cb13-100"><a href="#cb13-100"></a>      <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb13-101"><a href="#cb13-101"></a>      <span class="fu">coord_equal</span>()</span>
<span id="cb13-102"><a href="#cb13-102"></a>  }</span>
<span id="cb13-103"><a href="#cb13-103"></a>  </span>
<span id="cb13-104"><a href="#cb13-104"></a>  roc_plot <span class="ot">&lt;-</span> <span class="fu">plot_roc_curve</span>(true_labels, pred_prob)</span>
<span id="cb13-105"><a href="#cb13-105"></a>  <span class="fu">print</span>(roc_plot)</span>
<span id="cb13-106"><a href="#cb13-106"></a>  </span>
<span id="cb13-107"><a href="#cb13-107"></a>  <span class="fu">return</span>(<span class="fu">list</span>(</span>
<span id="cb13-108"><a href="#cb13-108"></a>    <span class="at">accuracy =</span> accuracy,</span>
<span id="cb13-109"><a href="#cb13-109"></a>    <span class="at">precision =</span> precision,</span>
<span id="cb13-110"><a href="#cb13-110"></a>    <span class="at">recall =</span> recall,</span>
<span id="cb13-111"><a href="#cb13-111"></a>    <span class="at">f1_score =</span> f1_score,</span>
<span id="cb13-112"><a href="#cb13-112"></a>    <span class="at">auc =</span> auc_score,</span>
<span id="cb13-113"><a href="#cb13-113"></a>    <span class="at">confusion_matrix =</span> cm</span>
<span id="cb13-114"><a href="#cb13-114"></a>  ))</span>
<span id="cb13-115"><a href="#cb13-115"></a>}</span>
<span id="cb13-116"><a href="#cb13-116"></a></span>
<span id="cb13-117"><a href="#cb13-117"></a><span class="co"># 运行分类指标演示</span></span>
<span id="cb13-118"><a href="#cb13-118"></a>classification_metrics <span class="ot">&lt;-</span> <span class="fu">demonstrate_classification_metrics</span>()</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>分类评估指标:
准确率: 0.748 
精确率: 0.779 
召回率: 0.8126 
F1分数: 0.7955 
AUC: 0.77 

混淆矩阵:
            Actual_0 Actual_1
Predicted_0      258      139
Predicted_1      113      490</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="1-预测、过拟合与模型评估_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="roc曲线与auc的深入理解" class="level3" data-number="1.5.3"><h3 data-number="1.5.3" class="anchored" data-anchor-id="roc曲线与auc的深入理解">
<span class="header-section-number">1.5.3</span> 1.4.3 ROC曲线与AUC的深入理解</h3>
<p>ROC曲线的绘制： 1. 计算不同分类阈值下的TPR和FPR 2. 以FPR为横轴，TPR为纵轴绘制曲线 3. 曲线越靠近左上角，性能越好</p>
<p>AUC的概率解释： AUC等于随机选取的正样本得分高于随机选取的负样本得分的概率。</p>
<p>AUC的优势： - 与分类阈值无关 - 反映模型整体排序能力 - 适用于不平衡数据</p>
<p>AUC的局限性： - 只关注排序，不关注具体概率值 - 在某些情况下可能过于乐观</p>
<p>精确率-召回率曲线： 在不平衡数据中通常比ROC曲线更有信息量。</p>
</section></section><section id="模型选择原则" class="level2" data-number="1.6"><h2 data-number="1.6" class="anchored" data-anchor-id="模型选择原则">
<span class="header-section-number">1.6</span> 1.5 模型选择原则</h2>
<section id="奥卡姆剃刀原理的统计基础" class="level3" data-number="1.6.1"><h3 data-number="1.6.1" class="anchored" data-anchor-id="奥卡姆剃刀原理的统计基础">
<span class="header-section-number">1.6.1</span> 1.5.1 奥卡姆剃刀原理的统计基础</h3>
<p>简约性原则： 在同样能够解释数据的模型中，选择最简单的模型。</p>
<p>数学形式化： 选择使以下目标函数最小的模型： <span class="math display">\[
\text{Objective} = \text{拟合优度} + \lambda \times \text{模型复杂度}
\]</span></p>
<p>模型复杂度的度量： - 参数个数 - VC维 - 有效参数个数</p>
</section><section id="信息准则的详细推导" class="level3" data-number="1.6.2"><h3 data-number="1.6.2" class="anchored" data-anchor-id="信息准则的详细推导">
<span class="header-section-number">1.6.2</span> 1.5.2 信息准则的详细推导</h3>
<p>AIC的推导： 基于Kullback-Leibler散度，目标是选择最接近真实分布的模型。 <span class="math display">\[
AIC = 2k - 2\ln(\hat{L})
\]</span> 其中： - <span class="math inline">\(k\)</span>：模型参数个数 - <span class="math inline">\(\hat{L}\)</span>：最大似然值</p>
<p>BIC的推导： 基于贝叶斯因子，在样本量较大时的一致性选择。 <span class="math display">\[
BIC = \ln(n)k - 2\ln(\hat{L})
\]</span></p>
<p>AICc： 小样本修正的AIC： <span class="math display">\[
AICc = AIC + \frac{2k(k+1)}{n-k-1}
\]</span></p>
<p>信息准则的比较：</p>
<table class="caption-top table">
<thead><tr class="header">
<th>准则</th>
<th>目标</th>
<th>一致性</th>
<th>效率</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>AIC</td>
<td>预测精度</td>
<td>否</td>
<td>是</td>
</tr>
<tr class="even">
<td>BIC</td>
<td>选择真实模型</td>
<td>是</td>
<td>否</td>
</tr>
<tr class="odd">
<td>AICc</td>
<td>小样本预测</td>
<td>否</td>
<td>是</td>
</tr>
</tbody>
</table></section><section id="实际选择策略" class="level3" data-number="1.6.3"><h3 data-number="1.6.3" class="anchored" data-anchor-id="实际选择策略">
<span class="header-section-number">1.6.3</span> 1.5.3 实际选择策略</h3>
<p>多准则综合评估：</p>
<ol type="1">
<li>计算多个信息准则</li>
</ol>
<p>2. 分析学习曲线</p>
<p>3. 考虑业务约束</p>
<p>4. 评估计算成本</p>
<p>领域知识的作用：</p>
<ul>
<li><p>理解数据的生成机制</p></li>
<li><p>考虑特征的物理意义</p></li>
<li><p>评估模型的可解释性</p></li>
</ul></section></section><section id="综合案例" class="level2" data-number="1.7"><h2 data-number="1.7" class="anchored" data-anchor-id="综合案例">
<span class="header-section-number">1.7</span> 1.6 综合案例</h2>
<section id="综合案例mtcars数据集分析" class="level3" data-number="1.7.1"><h3 data-number="1.7.1" class="anchored" data-anchor-id="综合案例mtcars数据集分析">
<span class="header-section-number">1.7.1</span> 1.6.1 综合案例：mtcars数据集分析</h3>
<p>R语言实现</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="co"># 1.6.1 综合案例：mtcars数据集分析</span></span>
<span id="cb15-2"><a href="#cb15-2"></a>analyze_mtcars_dataset <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb15-3"><a href="#cb15-3"></a>  <span class="co"># 加载数据</span></span>
<span id="cb15-4"><a href="#cb15-4"></a>  <span class="fu">data</span>(mtcars)</span>
<span id="cb15-5"><a href="#cb15-5"></a>  <span class="fu">cat</span>(<span class="st">"mtcars数据集基本信息:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb15-6"><a href="#cb15-6"></a>  <span class="fu">cat</span>(<span class="st">"样本数:"</span>, <span class="fu">nrow</span>(mtcars), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb15-7"><a href="#cb15-7"></a>  <span class="fu">cat</span>(<span class="st">"变量数:"</span>, <span class="fu">ncol</span>(mtcars), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb15-8"><a href="#cb15-8"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">变量名称:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb15-9"><a href="#cb15-9"></a>  <span class="fu">print</span>(<span class="fu">names</span>(mtcars))</span>
<span id="cb15-10"><a href="#cb15-10"></a>  </span>
<span id="cb15-11"><a href="#cb15-11"></a>  <span class="co"># 数据概览</span></span>
<span id="cb15-12"><a href="#cb15-12"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">数据概览:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb15-13"><a href="#cb15-13"></a>  <span class="fu">print</span>(<span class="fu">summary</span>(mtcars))</span>
<span id="cb15-14"><a href="#cb15-14"></a>  </span>
<span id="cb15-15"><a href="#cb15-15"></a>  <span class="co"># 探索性数据分析</span></span>
<span id="cb15-16"><a href="#cb15-16"></a>  <span class="fu">library</span>(ggplot2)</span>
<span id="cb15-17"><a href="#cb15-17"></a>  <span class="fu">library</span>(patchwork)</span>
<span id="cb15-18"><a href="#cb15-18"></a>  </span>
<span id="cb15-19"><a href="#cb15-19"></a>  <span class="co"># 目标变量：mpg（每加仑行驶英里数）</span></span>
<span id="cb15-20"><a href="#cb15-20"></a>  p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(<span class="at">x =</span> mpg)) <span class="sc">+</span></span>
<span id="cb15-21"><a href="#cb15-21"></a>    <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">15</span>, <span class="at">fill =</span> <span class="st">"steelblue"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb15-22"><a href="#cb15-22"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"MPG分布"</span>, <span class="at">x =</span> <span class="st">"MPG"</span>, <span class="at">y =</span> <span class="st">"频数"</span>) <span class="sc">+</span></span>
<span id="cb15-23"><a href="#cb15-23"></a>    <span class="fu">theme_minimal</span>()</span>
<span id="cb15-24"><a href="#cb15-24"></a>  </span>
<span id="cb15-25"><a href="#cb15-25"></a>  p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(<span class="at">x =</span> wt, <span class="at">y =</span> mpg)) <span class="sc">+</span></span>
<span id="cb15-26"><a href="#cb15-26"></a>    <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb15-27"><a href="#cb15-27"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb15-28"><a href="#cb15-28"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"车重与MPG关系"</span>, <span class="at">x =</span> <span class="st">"重量"</span>, <span class="at">y =</span> <span class="st">"MPG"</span>) <span class="sc">+</span></span>
<span id="cb15-29"><a href="#cb15-29"></a>    <span class="fu">theme_minimal</span>()</span>
<span id="cb15-30"><a href="#cb15-30"></a>  </span>
<span id="cb15-31"><a href="#cb15-31"></a>  p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(mtcars, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(cyl), <span class="at">y =</span> mpg)) <span class="sc">+</span></span>
<span id="cb15-32"><a href="#cb15-32"></a>    <span class="fu">geom_boxplot</span>(<span class="at">fill =</span> <span class="st">"lightgreen"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb15-33"><a href="#cb15-33"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"气缸数与MPG关系"</span>, <span class="at">x =</span> <span class="st">"气缸数"</span>, <span class="at">y =</span> <span class="st">"MPG"</span>) <span class="sc">+</span></span>
<span id="cb15-34"><a href="#cb15-34"></a>    <span class="fu">theme_minimal</span>()</span>
<span id="cb15-35"><a href="#cb15-35"></a>  </span>
<span id="cb15-36"><a href="#cb15-36"></a>  <span class="co"># 组合图形</span></span>
<span id="cb15-37"><a href="#cb15-37"></a>  combined_plot <span class="ot">&lt;-</span> (p1 <span class="sc">|</span> p2 <span class="sc">|</span> p3)</span>
<span id="cb15-38"><a href="#cb15-38"></a>  <span class="fu">print</span>(combined_plot)</span>
<span id="cb15-39"><a href="#cb15-39"></a>  </span>
<span id="cb15-40"><a href="#cb15-40"></a>  <span class="co"># 数据划分</span></span>
<span id="cb15-41"><a href="#cb15-41"></a>  <span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb15-42"><a href="#cb15-42"></a>  train_indices <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(mtcars), <span class="fl">0.7</span> <span class="sc">*</span> <span class="fu">nrow</span>(mtcars))</span>
<span id="cb15-43"><a href="#cb15-43"></a>  test_indices <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(mtcars), train_indices)</span>
<span id="cb15-44"><a href="#cb15-44"></a>  </span>
<span id="cb15-45"><a href="#cb15-45"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">数据划分结果:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb15-46"><a href="#cb15-46"></a>  <span class="fu">cat</span>(<span class="st">"训练集大小:"</span>, <span class="fu">length</span>(train_indices), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb15-47"><a href="#cb15-47"></a>  <span class="fu">cat</span>(<span class="st">"测试集大小:"</span>, <span class="fu">length</span>(test_indices), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb15-48"><a href="#cb15-48"></a>  </span>
<span id="cb15-49"><a href="#cb15-49"></a>  <span class="co"># 训练不同复杂度的模型</span></span>
<span id="cb15-50"><a href="#cb15-50"></a>  models <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb15-51"><a href="#cb15-51"></a>  </span>
<span id="cb15-52"><a href="#cb15-52"></a>  <span class="co"># 简单模型</span></span>
<span id="cb15-53"><a href="#cb15-53"></a>  models[[<span class="st">"simple"</span>]] <span class="ot">&lt;-</span> <span class="fu">lm</span>(mpg <span class="sc">~</span> wt, <span class="at">data =</span> mtcars[train_indices, ])</span>
<span id="cb15-54"><a href="#cb15-54"></a>  </span>
<span id="cb15-55"><a href="#cb15-55"></a>  <span class="co"># 中等复杂度模型</span></span>
<span id="cb15-56"><a href="#cb15-56"></a>  models[[<span class="st">"medium"</span>]] <span class="ot">&lt;-</span> <span class="fu">lm</span>(mpg <span class="sc">~</span> wt <span class="sc">+</span> cyl <span class="sc">+</span> hp, <span class="at">data =</span> mtcars[train_indices, ])</span>
<span id="cb15-57"><a href="#cb15-57"></a>  </span>
<span id="cb15-58"><a href="#cb15-58"></a>  <span class="co"># 复杂模型</span></span>
<span id="cb15-59"><a href="#cb15-59"></a>  models[[<span class="st">"complex"</span>]] <span class="ot">&lt;-</span> <span class="fu">lm</span>(mpg <span class="sc">~</span> wt <span class="sc">+</span> cyl <span class="sc">+</span> hp <span class="sc">+</span> disp <span class="sc">+</span> drat <span class="sc">+</span> qsec, </span>
<span id="cb15-60"><a href="#cb15-60"></a>                           <span class="at">data =</span> mtcars[train_indices, ])</span>
<span id="cb15-61"><a href="#cb15-61"></a>  </span>
<span id="cb15-62"><a href="#cb15-62"></a>  <span class="co"># 评估模型性能</span></span>
<span id="cb15-63"><a href="#cb15-63"></a>  evaluate_model <span class="ot">&lt;-</span> <span class="cf">function</span>(model, test_data) {</span>
<span id="cb15-64"><a href="#cb15-64"></a>    predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, <span class="at">newdata =</span> test_data)</span>
<span id="cb15-65"><a href="#cb15-65"></a>    actual <span class="ot">&lt;-</span> test_data<span class="sc">$</span>mpg</span>
<span id="cb15-66"><a href="#cb15-66"></a>    </span>
<span id="cb15-67"><a href="#cb15-67"></a>    mse <span class="ot">&lt;-</span> <span class="fu">mean</span>((actual <span class="sc">-</span> predictions)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb15-68"><a href="#cb15-68"></a>    rmse <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(mse)</span>
<span id="cb15-69"><a href="#cb15-69"></a>    mae <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">abs</span>(actual <span class="sc">-</span> predictions))</span>
<span id="cb15-70"><a href="#cb15-70"></a>    r2 <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">sum</span>((actual <span class="sc">-</span> predictions)<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> <span class="fu">sum</span>((actual <span class="sc">-</span> <span class="fu">mean</span>(actual))<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb15-71"><a href="#cb15-71"></a>    </span>
<span id="cb15-72"><a href="#cb15-72"></a>    <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">MSE =</span> mse, <span class="at">RMSE =</span> rmse, <span class="at">MAE =</span> mae, <span class="at">R2 =</span> r2))</span>
<span id="cb15-73"><a href="#cb15-73"></a>  }</span>
<span id="cb15-74"><a href="#cb15-74"></a>  </span>
<span id="cb15-75"><a href="#cb15-75"></a>  <span class="co"># 比较所有模型</span></span>
<span id="cb15-76"><a href="#cb15-76"></a>  test_data <span class="ot">&lt;-</span> mtcars[test_indices, ]</span>
<span id="cb15-77"><a href="#cb15-77"></a>  performance <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb15-78"><a href="#cb15-78"></a>  </span>
<span id="cb15-79"><a href="#cb15-79"></a>  <span class="cf">for</span> (model_name <span class="cf">in</span> <span class="fu">names</span>(models)) {</span>
<span id="cb15-80"><a href="#cb15-80"></a>    model <span class="ot">&lt;-</span> models[[model_name]]</span>
<span id="cb15-81"><a href="#cb15-81"></a>    perf <span class="ot">&lt;-</span> <span class="fu">evaluate_model</span>(model, test_data)</span>
<span id="cb15-82"><a href="#cb15-82"></a>    </span>
<span id="cb15-83"><a href="#cb15-83"></a>    performance <span class="ot">&lt;-</span> <span class="fu">rbind</span>(performance, <span class="fu">data.frame</span>(</span>
<span id="cb15-84"><a href="#cb15-84"></a>      <span class="at">Model =</span> model_name,</span>
<span id="cb15-85"><a href="#cb15-85"></a>      <span class="at">Parameters =</span> <span class="fu">length</span>(<span class="fu">coef</span>(model)),</span>
<span id="cb15-86"><a href="#cb15-86"></a>      <span class="at">MSE =</span> perf<span class="sc">$</span>MSE,</span>
<span id="cb15-87"><a href="#cb15-87"></a>      <span class="at">RMSE =</span> perf<span class="sc">$</span>RMSE,</span>
<span id="cb15-88"><a href="#cb15-88"></a>      <span class="at">MAE =</span> perf<span class="sc">$</span>MAE,</span>
<span id="cb15-89"><a href="#cb15-89"></a>      <span class="at">R2 =</span> perf<span class="sc">$</span>R2</span>
<span id="cb15-90"><a href="#cb15-90"></a>    ))</span>
<span id="cb15-91"><a href="#cb15-91"></a>  }</span>
<span id="cb15-92"><a href="#cb15-92"></a>  </span>
<span id="cb15-93"><a href="#cb15-93"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">模型性能比较:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb15-94"><a href="#cb15-94"></a>  <span class="fu">print</span>(performance)</span>
<span id="cb15-95"><a href="#cb15-95"></a>  </span>
<span id="cb15-96"><a href="#cb15-96"></a>  <span class="co"># 交叉验证比较</span></span>
<span id="cb15-97"><a href="#cb15-97"></a>  <span class="fu">library</span>(mlr3)</span>
<span id="cb15-98"><a href="#cb15-98"></a>  <span class="fu">library</span>(mlr3verse)</span>
<span id="cb15-99"><a href="#cb15-99"></a>  </span>
<span id="cb15-100"><a href="#cb15-100"></a>  <span class="co"># 创建任务</span></span>
<span id="cb15-101"><a href="#cb15-101"></a>  mtcars_task <span class="ot">&lt;-</span> <span class="fu">as_task_regr</span>(mtcars[, <span class="fu">c</span>(<span class="st">"mpg"</span>, <span class="st">"wt"</span>, <span class="st">"cyl"</span>, <span class="st">"hp"</span>, <span class="st">"disp"</span>, <span class="st">"drat"</span>, <span class="st">"qsec"</span>)], </span>
<span id="cb15-102"><a href="#cb15-102"></a>                             <span class="at">target =</span> <span class="st">"mpg"</span>, <span class="at">id =</span> <span class="st">"mtcars"</span>)</span>
<span id="cb15-103"><a href="#cb15-103"></a>  </span>
<span id="cb15-104"><a href="#cb15-104"></a>  <span class="co"># 定义学习器</span></span>
<span id="cb15-105"><a href="#cb15-105"></a>  learners <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb15-106"><a href="#cb15-106"></a>    <span class="fu">lrn</span>(<span class="st">"regr.lm"</span>, <span class="at">id =</span> <span class="st">"simple_lm"</span>),</span>
<span id="cb15-107"><a href="#cb15-107"></a>    <span class="fu">lrn</span>(<span class="st">"regr.rpart"</span>, <span class="at">id =</span> <span class="st">"tree"</span>),</span>
<span id="cb15-108"><a href="#cb15-108"></a>    <span class="fu">lrn</span>(<span class="st">"regr.kknn"</span>, <span class="at">id =</span> <span class="st">"knn"</span>)</span>
<span id="cb15-109"><a href="#cb15-109"></a>  )</span>
<span id="cb15-110"><a href="#cb15-110"></a>  </span>
<span id="cb15-111"><a href="#cb15-111"></a>  <span class="co"># 交叉验证</span></span>
<span id="cb15-112"><a href="#cb15-112"></a>  resampling <span class="ot">&lt;-</span> <span class="fu">rsmp</span>(<span class="st">"cv"</span>, <span class="at">folds =</span> <span class="dv">5</span>)</span>
<span id="cb15-113"><a href="#cb15-113"></a>  </span>
<span id="cb15-114"><a href="#cb15-114"></a>  cv_results <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb15-115"><a href="#cb15-115"></a>  <span class="cf">for</span> (learner <span class="cf">in</span> learners) {</span>
<span id="cb15-116"><a href="#cb15-116"></a>    rr <span class="ot">&lt;-</span> <span class="fu">resample</span>(mtcars_task, learner, resampling)</span>
<span id="cb15-117"><a href="#cb15-117"></a>    cv_results <span class="ot">&lt;-</span> <span class="fu">rbind</span>(cv_results, <span class="fu">data.frame</span>(</span>
<span id="cb15-118"><a href="#cb15-118"></a>      <span class="at">Model =</span> learner<span class="sc">$</span>id,</span>
<span id="cb15-119"><a href="#cb15-119"></a>      <span class="at">CV_RMSE =</span> <span class="fu">sqrt</span>(rr<span class="sc">$</span><span class="fu">aggregate</span>(<span class="fu">msr</span>(<span class="st">"regr.mse"</span>))),</span>
<span id="cb15-120"><a href="#cb15-120"></a>      <span class="at">CV_MAE =</span> rr<span class="sc">$</span><span class="fu">aggregate</span>(<span class="fu">msr</span>(<span class="st">"regr.mae"</span>)),</span>
<span id="cb15-121"><a href="#cb15-121"></a>      <span class="at">CV_R2 =</span> rr<span class="sc">$</span><span class="fu">aggregate</span>(<span class="fu">msr</span>(<span class="st">"regr.rsq"</span>))</span>
<span id="cb15-122"><a href="#cb15-122"></a>    ))</span>
<span id="cb15-123"><a href="#cb15-123"></a>  }</span>
<span id="cb15-124"><a href="#cb15-124"></a>  </span>
<span id="cb15-125"><a href="#cb15-125"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">交叉验证结果:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb15-126"><a href="#cb15-126"></a>  <span class="fu">print</span>(cv_results)</span>
<span id="cb15-127"><a href="#cb15-127"></a>  </span>
<span id="cb15-128"><a href="#cb15-128"></a>  <span class="co"># 过拟合分析</span></span>
<span id="cb15-129"><a href="#cb15-129"></a>  analyze_overfitting <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb15-130"><a href="#cb15-130"></a>    train_errors <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="dv">3</span>)</span>
<span id="cb15-131"><a href="#cb15-131"></a>    test_errors <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="dv">3</span>)</span>
<span id="cb15-132"><a href="#cb15-132"></a>    model_names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"simple"</span>, <span class="st">"medium"</span>, <span class="st">"complex"</span>)</span>
<span id="cb15-133"><a href="#cb15-133"></a>    </span>
<span id="cb15-134"><a href="#cb15-134"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>) {</span>
<span id="cb15-135"><a href="#cb15-135"></a>      model <span class="ot">&lt;-</span> models[[model_names[i]]]</span>
<span id="cb15-136"><a href="#cb15-136"></a>      </span>
<span id="cb15-137"><a href="#cb15-137"></a>      <span class="co"># 训练误差</span></span>
<span id="cb15-138"><a href="#cb15-138"></a>      train_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, <span class="at">newdata =</span> mtcars[train_indices, ])</span>
<span id="cb15-139"><a href="#cb15-139"></a>      train_errors[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>((mtcars<span class="sc">$</span>mpg[train_indices] <span class="sc">-</span> train_pred)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb15-140"><a href="#cb15-140"></a>      </span>
<span id="cb15-141"><a href="#cb15-141"></a>      <span class="co"># 测试误差</span></span>
<span id="cb15-142"><a href="#cb15-142"></a>      test_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, <span class="at">newdata =</span> test_data)</span>
<span id="cb15-143"><a href="#cb15-143"></a>      test_errors[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>((test_data<span class="sc">$</span>mpg <span class="sc">-</span> test_pred)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb15-144"><a href="#cb15-144"></a>    }</span>
<span id="cb15-145"><a href="#cb15-145"></a>    </span>
<span id="cb15-146"><a href="#cb15-146"></a>    overfitting_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb15-147"><a href="#cb15-147"></a>      <span class="at">Model =</span> model_names,</span>
<span id="cb15-148"><a href="#cb15-148"></a>      <span class="at">Train_MSE =</span> train_errors,</span>
<span id="cb15-149"><a href="#cb15-149"></a>      <span class="at">Test_MSE =</span> test_errors,</span>
<span id="cb15-150"><a href="#cb15-150"></a>      <span class="at">Overfitting_Gap =</span> test_errors <span class="sc">-</span> train_errors</span>
<span id="cb15-151"><a href="#cb15-151"></a>    )</span>
<span id="cb15-152"><a href="#cb15-152"></a>    </span>
<span id="cb15-153"><a href="#cb15-153"></a>    <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">过拟合分析:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb15-154"><a href="#cb15-154"></a>    <span class="fu">print</span>(overfitting_data)</span>
<span id="cb15-155"><a href="#cb15-155"></a>    </span>
<span id="cb15-156"><a href="#cb15-156"></a>    <span class="co"># 可视化过拟合现象</span></span>
<span id="cb15-157"><a href="#cb15-157"></a>    p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(overfitting_data, <span class="fu">aes</span>(<span class="at">x =</span> Model)) <span class="sc">+</span></span>
<span id="cb15-158"><a href="#cb15-158"></a>      <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Train_MSE, <span class="at">color =</span> <span class="st">"训练误差"</span>, <span class="at">group =</span> <span class="dv">1</span>), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb15-159"><a href="#cb15-159"></a>      <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> Test_MSE, <span class="at">color =</span> <span class="st">"测试误差"</span>, <span class="at">group =</span> <span class="dv">1</span>), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb15-160"><a href="#cb15-160"></a>      <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> Train_MSE, <span class="at">color =</span> <span class="st">"训练误差"</span>), <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb15-161"><a href="#cb15-161"></a>      <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> Test_MSE, <span class="at">color =</span> <span class="st">"测试误差"</span>), <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb15-162"><a href="#cb15-162"></a>      <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"过拟合分析：训练误差 vs 测试误差"</span>,</span>
<span id="cb15-163"><a href="#cb15-163"></a>           <span class="at">x =</span> <span class="st">"模型复杂度"</span>, <span class="at">y =</span> <span class="st">"均方误差 (MSE)"</span>,</span>
<span id="cb15-164"><a href="#cb15-164"></a>           <span class="at">color =</span> <span class="st">"误差类型"</span>) <span class="sc">+</span></span>
<span id="cb15-165"><a href="#cb15-165"></a>      <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb15-166"><a href="#cb15-166"></a>      <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"训练误差"</span> <span class="ot">=</span> <span class="st">"blue"</span>, <span class="st">"测试误差"</span> <span class="ot">=</span> <span class="st">"red"</span>))</span>
<span id="cb15-167"><a href="#cb15-167"></a>    </span>
<span id="cb15-168"><a href="#cb15-168"></a>    <span class="fu">print</span>(p)</span>
<span id="cb15-169"><a href="#cb15-169"></a>    </span>
<span id="cb15-170"><a href="#cb15-170"></a>    <span class="fu">return</span>(overfitting_data)</span>
<span id="cb15-171"><a href="#cb15-171"></a>  }</span>
<span id="cb15-172"><a href="#cb15-172"></a>  </span>
<span id="cb15-173"><a href="#cb15-173"></a>  overfitting_analysis <span class="ot">&lt;-</span> <span class="fu">analyze_overfitting</span>()</span>
<span id="cb15-174"><a href="#cb15-174"></a>  </span>
<span id="cb15-175"><a href="#cb15-175"></a>  <span class="fu">return</span>(<span class="fu">list</span>(</span>
<span id="cb15-176"><a href="#cb15-176"></a>    <span class="at">performance =</span> performance,</span>
<span id="cb15-177"><a href="#cb15-177"></a>    <span class="at">cv_results =</span> cv_results,</span>
<span id="cb15-178"><a href="#cb15-178"></a>    <span class="at">overfitting_analysis =</span> overfitting_analysis,</span>
<span id="cb15-179"><a href="#cb15-179"></a>    <span class="at">models =</span> models</span>
<span id="cb15-180"><a href="#cb15-180"></a>  ))</span>
<span id="cb15-181"><a href="#cb15-181"></a>}</span>
<span id="cb15-182"><a href="#cb15-182"></a></span>
<span id="cb15-183"><a href="#cb15-183"></a><span class="co"># 运行综合案例分析</span></span>
<span id="cb15-184"><a href="#cb15-184"></a>mtcars_analysis <span class="ot">&lt;-</span> <span class="fu">analyze_mtcars_dataset</span>()</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>mtcars数据集基本信息:
样本数: 32 
变量数: 11 

变量名称:
 [1] "mpg"  "cyl"  "disp" "hp"   "drat" "wt"   "qsec" "vs"   "am"   "gear"
[11] "carb"

数据概览:
      mpg             cyl             disp             hp       
 Min.   :10.40   Min.   :4.000   Min.   : 71.1   Min.   : 52.0  
 1st Qu.:15.43   1st Qu.:4.000   1st Qu.:120.8   1st Qu.: 96.5  
 Median :19.20   Median :6.000   Median :196.3   Median :123.0  
 Mean   :20.09   Mean   :6.188   Mean   :230.7   Mean   :146.7  
 3rd Qu.:22.80   3rd Qu.:8.000   3rd Qu.:326.0   3rd Qu.:180.0  
 Max.   :33.90   Max.   :8.000   Max.   :472.0   Max.   :335.0  
      drat             wt             qsec             vs        
 Min.   :2.760   Min.   :1.513   Min.   :14.50   Min.   :0.0000  
 1st Qu.:3.080   1st Qu.:2.581   1st Qu.:16.89   1st Qu.:0.0000  
 Median :3.695   Median :3.325   Median :17.71   Median :0.0000  
 Mean   :3.597   Mean   :3.217   Mean   :17.85   Mean   :0.4375  
 3rd Qu.:3.920   3rd Qu.:3.610   3rd Qu.:18.90   3rd Qu.:1.0000  
 Max.   :4.930   Max.   :5.424   Max.   :22.90   Max.   :1.0000  
       am              gear            carb      
 Min.   :0.0000   Min.   :3.000   Min.   :1.000  
 1st Qu.:0.0000   1st Qu.:3.000   1st Qu.:2.000  
 Median :0.0000   Median :4.000   Median :2.000  
 Mean   :0.4062   Mean   :3.688   Mean   :2.812  
 3rd Qu.:1.0000   3rd Qu.:4.000   3rd Qu.:4.000  
 Max.   :1.0000   Max.   :5.000   Max.   :8.000  </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="1-预测、过拟合与模型评估_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
数据划分结果:
训练集大小: 22 
测试集大小: 10 

模型性能比较:
    Model Parameters      MSE     RMSE      MAE        R2
1  simple          2 4.567618 2.137199 1.845953 0.6379045
2  medium          4 5.152415 2.269893 1.877027 0.5915450
3 complex          7 5.345615 2.312059 1.765717 0.5762291

交叉验证结果:
              Model  CV_RMSE   CV_MAE      CV_R2
regr.mse  simple_lm 2.871556 2.279431  0.7249341
regr.mse1      tree 4.899379 3.895609 -0.2874332
regr.mse2       knn 2.723761 2.179108  0.6664141

过拟合分析:
    Model Train_MSE Test_MSE Overfitting_Gap
1  simple 10.762613 4.567618     -6.19499560
2  medium  5.962236 5.152415     -0.80982161
3 complex  5.436092 5.345615     -0.09047663</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="1-预测、过拟合与模型评估_files/figure-html/unnamed-chunk-6-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Python语言实现</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1"></a><span class="co"># 1.6.1 综合案例：mtcars数据集分析 - Python版本</span></span>
<span id="cb19-2"><a href="#cb19-2"></a><span class="kw">def</span> analyze_mtcars_python():</span>
<span id="cb19-3"><a href="#cb19-3"></a>    <span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb19-4"><a href="#cb19-4"></a>    <span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb19-5"><a href="#cb19-5"></a>    <span class="im">import</span> matplotlib</span>
<span id="cb19-6"><a href="#cb19-6"></a>    matplotlib.rc(<span class="st">"font"</span>,family<span class="op">=</span><span class="st">"Microsoft YaHei"</span>)</span>
<span id="cb19-7"><a href="#cb19-7"></a>    <span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb19-8"><a href="#cb19-8"></a>    <span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb19-9"><a href="#cb19-9"></a>    <span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split, cross_val_score</span>
<span id="cb19-10"><a href="#cb19-10"></a>    <span class="im">from</span> sklearn.linear_model <span class="im">import</span> LinearRegression</span>
<span id="cb19-11"><a href="#cb19-11"></a>    <span class="im">from</span> sklearn.tree <span class="im">import</span> DecisionTreeRegressor</span>
<span id="cb19-12"><a href="#cb19-12"></a>    <span class="im">from</span> sklearn.neighbors <span class="im">import</span> KNeighborsRegressor</span>
<span id="cb19-13"><a href="#cb19-13"></a>    <span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error, mean_absolute_error, r2_score</span>
<span id="cb19-14"><a href="#cb19-14"></a>    <span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb19-15"><a href="#cb19-15"></a>    </span>
<span id="cb19-16"><a href="#cb19-16"></a>    <span class="co"># 加载mtcars数据集</span></span>
<span id="cb19-17"><a href="#cb19-17"></a>    <span class="cf">try</span>:</span>
<span id="cb19-18"><a href="#cb19-18"></a>        <span class="co"># 尝试从在线源加载</span></span>
<span id="cb19-19"><a href="#cb19-19"></a>        url <span class="op">=</span> <span class="st">"https://raw.githubusercontent.com/plotly/datasets/master/mtcars.csv"</span></span>
<span id="cb19-20"><a href="#cb19-20"></a>        mtcars <span class="op">=</span> pd.read_csv(url)</span>
<span id="cb19-21"><a href="#cb19-21"></a>    <span class="cf">except</span>:</span>
<span id="cb19-22"><a href="#cb19-22"></a>        <span class="co"># 如果网络不可用，使用内置数据集或创建模拟数据</span></span>
<span id="cb19-23"><a href="#cb19-23"></a>        <span class="bu">print</span>(<span class="st">"网络数据加载失败，使用模拟数据"</span>)</span>
<span id="cb19-24"><a href="#cb19-24"></a>        np.random.seed(<span class="dv">42</span>)</span>
<span id="cb19-25"><a href="#cb19-25"></a>        n <span class="op">=</span> <span class="dv">32</span></span>
<span id="cb19-26"><a href="#cb19-26"></a>        mtcars <span class="op">=</span> pd.DataFrame({</span>
<span id="cb19-27"><a href="#cb19-27"></a>            <span class="st">'mpg'</span>: np.random.normal(<span class="dv">20</span>, <span class="dv">6</span>, n),</span>
<span id="cb19-28"><a href="#cb19-28"></a>            <span class="st">'cyl'</span>: np.random.choice([<span class="dv">4</span>, <span class="dv">6</span>, <span class="dv">8</span>], n),</span>
<span id="cb19-29"><a href="#cb19-29"></a>            <span class="st">'disp'</span>: np.random.normal(<span class="dv">200</span>, <span class="dv">100</span>, n),</span>
<span id="cb19-30"><a href="#cb19-30"></a>            <span class="st">'hp'</span>: np.random.normal(<span class="dv">150</span>, <span class="dv">50</span>, n),</span>
<span id="cb19-31"><a href="#cb19-31"></a>            <span class="st">'wt'</span>: np.random.normal(<span class="dv">3</span>, <span class="dv">1</span>, n),</span>
<span id="cb19-32"><a href="#cb19-32"></a>            <span class="st">'qsec'</span>: np.random.normal(<span class="dv">18</span>, <span class="dv">2</span>, n)</span>
<span id="cb19-33"><a href="#cb19-33"></a>        })</span>
<span id="cb19-34"><a href="#cb19-34"></a>    </span>
<span id="cb19-35"><a href="#cb19-35"></a>    <span class="bu">print</span>(<span class="st">"mtcars数据集基本信息:"</span>)</span>
<span id="cb19-36"><a href="#cb19-36"></a>    <span class="bu">print</span>(<span class="ss">f"样本数: </span><span class="sc">{</span>mtcars<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb19-37"><a href="#cb19-37"></a>    <span class="bu">print</span>(<span class="ss">f"变量数: </span><span class="sc">{</span>mtcars<span class="sc">.</span>shape[<span class="dv">1</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb19-38"><a href="#cb19-38"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">数据概览:"</span>)</span>
<span id="cb19-39"><a href="#cb19-39"></a>    <span class="bu">print</span>(mtcars.describe())</span>
<span id="cb19-40"><a href="#cb19-40"></a>    </span>
<span id="cb19-41"><a href="#cb19-41"></a>    <span class="co"># 数据可视化</span></span>
<span id="cb19-42"><a href="#cb19-42"></a>    fig, axes <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">10</span>))</span>
<span id="cb19-43"><a href="#cb19-43"></a>    </span>
<span id="cb19-44"><a href="#cb19-44"></a>    <span class="co"># MPG分布</span></span>
<span id="cb19-45"><a href="#cb19-45"></a>    axes[<span class="dv">0</span>,<span class="dv">0</span>].hist(mtcars[<span class="st">'mpg'</span>], bins<span class="op">=</span><span class="dv">10</span>, alpha<span class="op">=</span><span class="fl">0.7</span>, color<span class="op">=</span><span class="st">'steelblue'</span>)</span>
<span id="cb19-46"><a href="#cb19-46"></a>    axes[<span class="dv">0</span>,<span class="dv">0</span>].set_title(<span class="st">'MPG分布'</span>)</span>
<span id="cb19-47"><a href="#cb19-47"></a>    axes[<span class="dv">0</span>,<span class="dv">0</span>].set_xlabel(<span class="st">'MPG'</span>)</span>
<span id="cb19-48"><a href="#cb19-48"></a>    axes[<span class="dv">0</span>,<span class="dv">0</span>].set_ylabel(<span class="st">'频数'</span>)</span>
<span id="cb19-49"><a href="#cb19-49"></a>    </span>
<span id="cb19-50"><a href="#cb19-50"></a>    <span class="co"># 车重与MPG关系</span></span>
<span id="cb19-51"><a href="#cb19-51"></a>    axes[<span class="dv">0</span>,<span class="dv">1</span>].scatter(mtcars[<span class="st">'wt'</span>], mtcars[<span class="st">'mpg'</span>], alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb19-52"><a href="#cb19-52"></a>    z <span class="op">=</span> np.polyfit(mtcars[<span class="st">'wt'</span>], mtcars[<span class="st">'mpg'</span>], <span class="dv">1</span>)</span>
<span id="cb19-53"><a href="#cb19-53"></a>    p <span class="op">=</span> np.poly1d(z)</span>
<span id="cb19-54"><a href="#cb19-54"></a>    axes[<span class="dv">0</span>,<span class="dv">1</span>].plot(mtcars[<span class="st">'wt'</span>], p(mtcars[<span class="st">'wt'</span>]), <span class="st">"r--"</span>, alpha<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb19-55"><a href="#cb19-55"></a>    axes[<span class="dv">0</span>,<span class="dv">1</span>].set_title(<span class="st">'车重与MPG关系'</span>)</span>
<span id="cb19-56"><a href="#cb19-56"></a>    axes[<span class="dv">0</span>,<span class="dv">1</span>].set_xlabel(<span class="st">'重量'</span>)</span>
<span id="cb19-57"><a href="#cb19-57"></a>    axes[<span class="dv">0</span>,<span class="dv">1</span>].set_ylabel(<span class="st">'MPG'</span>)</span>
<span id="cb19-58"><a href="#cb19-58"></a>    </span>
<span id="cb19-59"><a href="#cb19-59"></a>    <span class="co"># 马力与MPG关系</span></span>
<span id="cb19-60"><a href="#cb19-60"></a>    axes[<span class="dv">1</span>,<span class="dv">0</span>].scatter(mtcars[<span class="st">'hp'</span>], mtcars[<span class="st">'mpg'</span>], alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb19-61"><a href="#cb19-61"></a>    z <span class="op">=</span> np.polyfit(mtcars[<span class="st">'hp'</span>], mtcars[<span class="st">'mpg'</span>], <span class="dv">1</span>)</span>
<span id="cb19-62"><a href="#cb19-62"></a>    p <span class="op">=</span> np.poly1d(z)</span>
<span id="cb19-63"><a href="#cb19-63"></a>    axes[<span class="dv">1</span>,<span class="dv">0</span>].plot(mtcars[<span class="st">'hp'</span>], p(mtcars[<span class="st">'hp'</span>]), <span class="st">"r--"</span>, alpha<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb19-64"><a href="#cb19-64"></a>    axes[<span class="dv">1</span>,<span class="dv">0</span>].set_title(<span class="st">'马力与MPG关系'</span>)</span>
<span id="cb19-65"><a href="#cb19-65"></a>    axes[<span class="dv">1</span>,<span class="dv">0</span>].set_xlabel(<span class="st">'马力'</span>)</span>
<span id="cb19-66"><a href="#cb19-66"></a>    axes[<span class="dv">1</span>,<span class="dv">0</span>].set_ylabel(<span class="st">'MPG'</span>)</span>
<span id="cb19-67"><a href="#cb19-67"></a>    </span>
<span id="cb19-68"><a href="#cb19-68"></a>    <span class="co"># 气缸数与MPG关系</span></span>
<span id="cb19-69"><a href="#cb19-69"></a>    mtcars.boxplot(column<span class="op">=</span><span class="st">'mpg'</span>, by<span class="op">=</span><span class="st">'cyl'</span>, ax<span class="op">=</span>axes[<span class="dv">1</span>,<span class="dv">1</span>])</span>
<span id="cb19-70"><a href="#cb19-70"></a>    axes[<span class="dv">1</span>,<span class="dv">1</span>].set_title(<span class="st">'气缸数与MPG关系'</span>)</span>
<span id="cb19-71"><a href="#cb19-71"></a>    axes[<span class="dv">1</span>,<span class="dv">1</span>].set_xlabel(<span class="st">'气缸数'</span>)</span>
<span id="cb19-72"><a href="#cb19-72"></a>    </span>
<span id="cb19-73"><a href="#cb19-73"></a>    plt.tight_layout()</span>
<span id="cb19-74"><a href="#cb19-74"></a>    plt.show()</span>
<span id="cb19-75"><a href="#cb19-75"></a>    </span>
<span id="cb19-76"><a href="#cb19-76"></a>    <span class="co"># 准备数据</span></span>
<span id="cb19-77"><a href="#cb19-77"></a>    X <span class="op">=</span> mtcars[[<span class="st">'wt'</span>, <span class="st">'cyl'</span>, <span class="st">'hp'</span>, <span class="st">'disp'</span>, <span class="st">'qsec'</span>]]</span>
<span id="cb19-78"><a href="#cb19-78"></a>    y <span class="op">=</span> mtcars[<span class="st">'mpg'</span>]</span>
<span id="cb19-79"><a href="#cb19-79"></a>    </span>
<span id="cb19-80"><a href="#cb19-80"></a>    <span class="co"># 数据划分</span></span>
<span id="cb19-81"><a href="#cb19-81"></a>    X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(</span>
<span id="cb19-82"><a href="#cb19-82"></a>        X, y, test_size<span class="op">=</span><span class="fl">0.3</span>, random_state<span class="op">=</span><span class="dv">42</span></span>
<span id="cb19-83"><a href="#cb19-83"></a>    )</span>
<span id="cb19-84"><a href="#cb19-84"></a>    </span>
<span id="cb19-85"><a href="#cb19-85"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">数据划分结果:"</span>)</span>
<span id="cb19-86"><a href="#cb19-86"></a>    <span class="bu">print</span>(<span class="ss">f"训练集大小: </span><span class="sc">{</span>X_train<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb19-87"><a href="#cb19-87"></a>    <span class="bu">print</span>(<span class="ss">f"测试集大小: </span><span class="sc">{</span>X_test<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb19-88"><a href="#cb19-88"></a>    </span>
<span id="cb19-89"><a href="#cb19-89"></a>    <span class="co"># 训练不同模型</span></span>
<span id="cb19-90"><a href="#cb19-90"></a>    models <span class="op">=</span> {</span>
<span id="cb19-91"><a href="#cb19-91"></a>        <span class="st">'Linear Regression'</span>: LinearRegression(),</span>
<span id="cb19-92"><a href="#cb19-92"></a>        <span class="st">'Decision Tree'</span>: DecisionTreeRegressor(random_state<span class="op">=</span><span class="dv">42</span>),</span>
<span id="cb19-93"><a href="#cb19-93"></a>        <span class="st">'K-Neighbors'</span>: KNeighborsRegressor()</span>
<span id="cb19-94"><a href="#cb19-94"></a>    }</span>
<span id="cb19-95"><a href="#cb19-95"></a>    </span>
<span id="cb19-96"><a href="#cb19-96"></a>    <span class="co"># 评估函数</span></span>
<span id="cb19-97"><a href="#cb19-97"></a>    <span class="kw">def</span> evaluate_model(model, X_train, X_test, y_train, y_test):</span>
<span id="cb19-98"><a href="#cb19-98"></a>        model.fit(X_train, y_train)</span>
<span id="cb19-99"><a href="#cb19-99"></a>        y_pred_train <span class="op">=</span> model.predict(X_train)</span>
<span id="cb19-100"><a href="#cb19-100"></a>        y_pred_test <span class="op">=</span> model.predict(X_test)</span>
<span id="cb19-101"><a href="#cb19-101"></a>        </span>
<span id="cb19-102"><a href="#cb19-102"></a>        metrics <span class="op">=</span> {</span>
<span id="cb19-103"><a href="#cb19-103"></a>            <span class="st">'Train_MSE'</span>: mean_squared_error(y_train, y_pred_train),</span>
<span id="cb19-104"><a href="#cb19-104"></a>            <span class="st">'Test_MSE'</span>: mean_squared_error(y_test, y_pred_test),</span>
<span id="cb19-105"><a href="#cb19-105"></a>            <span class="st">'Train_R2'</span>: r2_score(y_train, y_pred_train),</span>
<span id="cb19-106"><a href="#cb19-106"></a>            <span class="st">'Test_R2'</span>: r2_score(y_test, y_pred_test),</span>
<span id="cb19-107"><a href="#cb19-107"></a>            <span class="st">'Overfitting_Gap'</span>: mean_squared_error(y_test, y_pred_test) <span class="op">-</span> mean_squared_error(y_train, y_pred_train)</span>
<span id="cb19-108"><a href="#cb19-108"></a>        }</span>
<span id="cb19-109"><a href="#cb19-109"></a>        <span class="cf">return</span> metrics</span>
<span id="cb19-110"><a href="#cb19-110"></a>    </span>
<span id="cb19-111"><a href="#cb19-111"></a>    <span class="co"># 比较模型性能</span></span>
<span id="cb19-112"><a href="#cb19-112"></a>    results <span class="op">=</span> []</span>
<span id="cb19-113"><a href="#cb19-113"></a>    <span class="cf">for</span> name, model <span class="kw">in</span> models.items():</span>
<span id="cb19-114"><a href="#cb19-114"></a>        metrics <span class="op">=</span> evaluate_model(model, X_train, X_test, y_train, y_test)</span>
<span id="cb19-115"><a href="#cb19-115"></a>        results.append({</span>
<span id="cb19-116"><a href="#cb19-116"></a>            <span class="st">'Model'</span>: name,</span>
<span id="cb19-117"><a href="#cb19-117"></a>            <span class="op">**</span>metrics</span>
<span id="cb19-118"><a href="#cb19-118"></a>        })</span>
<span id="cb19-119"><a href="#cb19-119"></a>    </span>
<span id="cb19-120"><a href="#cb19-120"></a>    results_df <span class="op">=</span> pd.DataFrame(results)</span>
<span id="cb19-121"><a href="#cb19-121"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">模型性能比较:"</span>)</span>
<span id="cb19-122"><a href="#cb19-122"></a>    <span class="bu">print</span>(results_df)</span>
<span id="cb19-123"><a href="#cb19-123"></a>    </span>
<span id="cb19-124"><a href="#cb19-124"></a>    <span class="co"># 交叉验证</span></span>
<span id="cb19-125"><a href="#cb19-125"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">交叉验证结果 (5折):"</span>)</span>
<span id="cb19-126"><a href="#cb19-126"></a>    cv_results <span class="op">=</span> []</span>
<span id="cb19-127"><a href="#cb19-127"></a>    <span class="cf">for</span> name, model <span class="kw">in</span> models.items():</span>
<span id="cb19-128"><a href="#cb19-128"></a>        cv_scores <span class="op">=</span> cross_val_score(model, X, y, cv<span class="op">=</span><span class="dv">5</span>, scoring<span class="op">=</span><span class="st">'neg_mean_squared_error'</span>)</span>
<span id="cb19-129"><a href="#cb19-129"></a>        cv_rmse <span class="op">=</span> np.sqrt(<span class="op">-</span>cv_scores)</span>
<span id="cb19-130"><a href="#cb19-130"></a>        cv_results.append({</span>
<span id="cb19-131"><a href="#cb19-131"></a>            <span class="st">'Model'</span>: name,</span>
<span id="cb19-132"><a href="#cb19-132"></a>            <span class="st">'CV_RMSE_mean'</span>: cv_rmse.mean(),</span>
<span id="cb19-133"><a href="#cb19-133"></a>            <span class="st">'CV_RMSE_std'</span>: cv_rmse.std()</span>
<span id="cb19-134"><a href="#cb19-134"></a>        })</span>
<span id="cb19-135"><a href="#cb19-135"></a>    </span>
<span id="cb19-136"><a href="#cb19-136"></a>    cv_df <span class="op">=</span> pd.DataFrame(cv_results)</span>
<span id="cb19-137"><a href="#cb19-137"></a>    <span class="bu">print</span>(cv_df)</span>
<span id="cb19-138"><a href="#cb19-138"></a>    </span>
<span id="cb19-139"><a href="#cb19-139"></a>    <span class="co"># 可视化结果</span></span>
<span id="cb19-140"><a href="#cb19-140"></a>    fig, (ax1, ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">5</span>))</span>
<span id="cb19-141"><a href="#cb19-141"></a>    </span>
<span id="cb19-142"><a href="#cb19-142"></a>    <span class="co"># 过拟合分析</span></span>
<span id="cb19-143"><a href="#cb19-143"></a>    x_pos <span class="op">=</span> np.arange(<span class="bu">len</span>(models))</span>
<span id="cb19-144"><a href="#cb19-144"></a>    width <span class="op">=</span> <span class="fl">0.35</span></span>
<span id="cb19-145"><a href="#cb19-145"></a>    </span>
<span id="cb19-146"><a href="#cb19-146"></a>    train_mse <span class="op">=</span> results_df[<span class="st">'Train_MSE'</span>].values</span>
<span id="cb19-147"><a href="#cb19-147"></a>    test_mse <span class="op">=</span> results_df[<span class="st">'Test_MSE'</span>].values</span>
<span id="cb19-148"><a href="#cb19-148"></a>    </span>
<span id="cb19-149"><a href="#cb19-149"></a>    ax1.bar(x_pos <span class="op">-</span> width<span class="op">/</span><span class="dv">2</span>, train_mse, width, label<span class="op">=</span><span class="st">'训练MSE'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb19-150"><a href="#cb19-150"></a>    ax1.bar(x_pos <span class="op">+</span> width<span class="op">/</span><span class="dv">2</span>, test_mse, width, label<span class="op">=</span><span class="st">'测试MSE'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb19-151"><a href="#cb19-151"></a>    ax1.set_xlabel(<span class="st">'模型'</span>)</span>
<span id="cb19-152"><a href="#cb19-152"></a>    ax1.set_ylabel(<span class="st">'均方误差 (MSE)'</span>)</span>
<span id="cb19-153"><a href="#cb19-153"></a>    ax1.set_title(<span class="st">'过拟合分析'</span>)</span>
<span id="cb19-154"><a href="#cb19-154"></a>    ax1.set_xticks(x_pos)</span>
<span id="cb19-155"><a href="#cb19-155"></a>    ax1.set_xticklabels(results_df[<span class="st">'Model'</span>])</span>
<span id="cb19-156"><a href="#cb19-156"></a>    ax1.legend()</span>
<span id="cb19-157"><a href="#cb19-157"></a>    </span>
<span id="cb19-158"><a href="#cb19-158"></a>    <span class="co"># R²比较</span></span>
<span id="cb19-159"><a href="#cb19-159"></a>    train_r2 <span class="op">=</span> results_df[<span class="st">'Train_R2'</span>].values</span>
<span id="cb19-160"><a href="#cb19-160"></a>    test_r2 <span class="op">=</span> results_df[<span class="st">'Test_R2'</span>].values</span>
<span id="cb19-161"><a href="#cb19-161"></a>    </span>
<span id="cb19-162"><a href="#cb19-162"></a>    ax2.bar(x_pos <span class="op">-</span> width<span class="op">/</span><span class="dv">2</span>, train_r2, width, label<span class="op">=</span><span class="st">'训练R²'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb19-163"><a href="#cb19-163"></a>    ax2.bar(x_pos <span class="op">+</span> width<span class="op">/</span><span class="dv">2</span>, test_r2, width, label<span class="op">=</span><span class="st">'测试R²'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb19-164"><a href="#cb19-164"></a>    ax2.set_xlabel(<span class="st">'模型'</span>)</span>
<span id="cb19-165"><a href="#cb19-165"></a>    ax2.set_ylabel(<span class="st">'R²'</span>)</span>
<span id="cb19-166"><a href="#cb19-166"></a>    ax2.set_title(<span class="st">'拟合优度比较'</span>)</span>
<span id="cb19-167"><a href="#cb19-167"></a>    ax2.set_xticks(x_pos)</span>
<span id="cb19-168"><a href="#cb19-168"></a>    ax2.set_xticklabels(results_df[<span class="st">'Model'</span>])</span>
<span id="cb19-169"><a href="#cb19-169"></a>    ax2.legend()</span>
<span id="cb19-170"><a href="#cb19-170"></a>    </span>
<span id="cb19-171"><a href="#cb19-171"></a>    plt.tight_layout()</span>
<span id="cb19-172"><a href="#cb19-172"></a>    plt.show()</span>
<span id="cb19-173"><a href="#cb19-173"></a>    </span>
<span id="cb19-174"><a href="#cb19-174"></a>    <span class="cf">return</span> {</span>
<span id="cb19-175"><a href="#cb19-175"></a>        <span class="st">'performance'</span>: results_df,</span>
<span id="cb19-176"><a href="#cb19-176"></a>        <span class="st">'cv_results'</span>: cv_df,</span>
<span id="cb19-177"><a href="#cb19-177"></a>        <span class="st">'data'</span>: mtcars</span>
<span id="cb19-178"><a href="#cb19-178"></a>    }</span>
<span id="cb19-179"><a href="#cb19-179"></a></span>
<span id="cb19-180"><a href="#cb19-180"></a><span class="co"># 运行Python分析</span></span>
<span id="cb19-181"><a href="#cb19-181"></a>mtcars_python_analysis <span class="op">=</span> analyze_mtcars_python()</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section><section id="案例总结与最佳实践" class="level3" data-number="1.7.2"><h3 data-number="1.7.2" class="anchored" data-anchor-id="案例总结与最佳实践">
<span class="header-section-number">1.7.2</span> 1.6.2 案例总结与最佳实践</h3>
<p>关键发现总结</p>
<ol type="1">
<li>过拟合验证：在mtcars数据集中，复杂模型在训练集上表现更好，但在测试集上可能表现更差</li>
<li>交叉验证价值：相比单一划分，交叉验证提供更稳定的性能估计</li>
<li>模型选择：不同评估指标可能选择不同的最优模型</li>
<li>数据质量：真实数据集通常包含复杂的变量关系和数据问题</li>
</ol>
<p>最佳实践建议</p>
<ol type="1">
<li>始终使用交叉验证：特别是对于小数据集</li>
<li>监控过拟合：比较训练和测试性能的差异</li>
<li>多指标评估：使用多个评估指标全面评价模型</li>
<li>理解数据：进行充分的探索性数据分析</li>
</ol></section></section><section id="本章总结" class="level2" data-number="1.8"><h2 data-number="1.8" class="anchored" data-anchor-id="本章总结">
<span class="header-section-number">1.8</span> 本章总结</h2>
<p>核心概念回顾</p>
<ol type="1">
<li>预测建模类型：回归分析预测连续值，分类分析预测离散类别</li>
<li>过拟合现象：模型在训练数据上表现过好，但在新数据上表现差</li>
<li>偏差-方差权衡：模型复杂度需要在偏差和方差之间取得平衡</li>
<li>数据划分：训练集用于参数估计，验证集用于模型选择，测试集用于最终评估</li>
<li>交叉验证：k折交叉验证提供更稳定的误差估计</li>
<li>评估指标：回归问题用MSE、RMSE、<span class="math inline">\(R^2\)</span>，分类问题用准确率、精确率、召回率、AUC等</li>
<li>模型选择：基于信息准则和业务需求选择合适模型</li>
</ol>
<p>实践指导原则</p>
<p>数据划分最佳实践：</p>
<p>1. 在数据分析开始前划分测试集</p>
<p>2. 使用随机种子确保结果可重现</p>
<p>3. 对于时间序列数据，按时间顺序划分</p>
<p>4. 对于不平衡数据，使用分层抽样</p>
<p>交叉验证实施要点：</p>
<p>1. 选择合适的k值（通常5或10）</p>
<p>2. 使用分层抽样保持类别比例</p>
<p>3. 多次运行取平均以减少随机性</p>
<p>4. 记录每次交叉验证的结果和标准差</p>
<p>模型评估综合策略：</p>
<p>1. 使用多个评估指标全面评估</p>
<p>2. 考虑业务场景选择重点指标</p>
<p>3. 分析错误案例理解模型局限</p>
<p>4. 比较基准模型确认改进效果</p>
<p>重要数学公式总结</p>
<ol type="1">
<li>偏差-方差分解：<span class="math inline">\(E[(Y-\hat{f})^2] = \text{Bias}^2 + \text{Var} + \sigma_\varepsilon^2\)</span>
</li>
<li>k折交叉验证：<span class="math inline">\(CV(k) = \frac{1}{k}\sum_{i=1}^k \text{Err}(D_{\text{test}}^{(i)})\)</span>
</li>
<li>回归评估：
<ul>
<li><span class="math inline">\(MSE = \frac{1}{n}\sum_{i=1}^n (y_i - \hat{y}_i)^2\)</span></li>
<li><span class="math inline">\(R^2 = 1 - \frac{SS_{res}}{SS_{tot}}\)</span></li>
</ul>
</li>
<li>分类评估：
<ul>
<li><span class="math inline">\(\text{Precision} = \frac{TP}{TP+FP}\)</span></li>
<li><span class="math inline">\(\text{Recall} = \frac{TP}{TP+FN}\)</span></li>
<li><span class="math inline">\(F_1 = 2 \times \frac{\text{Precision} \times \text{Recall}}{\text{Precision} + \text{Recall}}\)</span></li>
</ul>
</li>
<li>信息准则：
<ul>
<li><span class="math inline">\(AIC = 2k - 2\ln(L)\)</span></li>
<li><span class="math inline">\(BIC = \ln(n)k - 2\ln(L)\)</span></li>
</ul>
</li>
</ol></section><section id="与后续章节的联系" class="level2" data-number="1.9"><h2 data-number="1.9" class="anchored" data-anchor-id="与后续章节的联系">
<span class="header-section-number">1.9</span> 与后续章节的联系</h2>
<p>本章建立的评估框架将贯穿整个教材： - 第2-4章：线性模型的评估与选择，重点关注<span class="math inline">\(R^2\)</span>、MSE等指标 - 第5-7章：复杂模型的过拟合控制，应用交叉验证和正则化 - 第8章：集成学习的偏差-方差分析，比较不同集成策略 - 第9-10章：支持向量机和神经网络的调优策略，使用验证集选择超参数</p>
<p>理解本章内容是学习后续所有预测模型的基础，良好的评估习惯是构建有效预测模型的关键。在实际应用中，应该根据具体问题选择合适的评估指标和方法，并始终关注模型的泛化能力。</p>


</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "已复制");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "已复制");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="../index.html" class="pagination-link" aria-label="index.html">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">index.html</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../chapters/2 线性回归.html" class="pagination-link" aria-label="线性回归">
        <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">线性回归</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>