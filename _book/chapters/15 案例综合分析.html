<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh-Hans" xml:lang="zh-Hans"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="李世纪">
<title>15 案例综合分析 – 现代预测建模：从回归到机器学习</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../chapters/14 分类任务.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-56845be1c3e1e64cc04b6f7b628b8285.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "没有结果",
    "search-matching-documents-text": "匹配的文档",
    "search-copy-link-title": "复制搜索链接",
    "search-hide-matches-text": "隐藏其它匹配结果",
    "search-more-match-text": "更多匹配结果",
    "search-more-matches-text": "更多匹配结果",
    "search-clear-button-title": "清除",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "取消",
    "search-submit-button-title": "提交",
    "search-label": "搜索"
  }
}</script><link rel="stylesheet" href="science-textbook.css">
</head>
<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="展开或折叠侧边栏导航" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapters/part-4-introduction.html">IV 实践——综合案例分析</a></li><li class="breadcrumb-item"><a href="../chapters/15 案例综合分析.html"><span class="chapter-title">15 案例综合分析</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="展开或折叠侧边栏导航" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="搜索" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">现代预测建模：从回归到机器学习</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="搜索"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">前言</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">index.html</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">I 基础-线性回归模型</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="展开或折叠此栏">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/part-1-introduction.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">part-1-introduction.html</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/1 预测模型与评估.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">1 预测模型与评估</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/2 线性回归.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">2 线性回归</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/3 模型诊断.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">3 模型诊断</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/4 时间序列分析初步.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">4 时间序列分析初步</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">II 扩展——线性分析方法</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="展开或折叠此栏">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/part-2-introduction.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">part-2-introduction.html</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/5 降维.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">5 降维</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/6 正则化.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">6 正则化</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/7 广义线性模型.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">7 广义线性模型</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/8 线性分类模型.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">8 线性分类模型</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/9 非线性回归与样条回归.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">9 非线性回归与样条回归</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">III 进阶——超越线性的机器学习</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="展开或折叠此栏">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/part-3-introduction.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">part-3-introduction.html</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/10 决策树与集成学习.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">10 决策树与集成学习</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/11 支持向量机.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">11 支持向量机</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/12 神经网络与深度学习基础.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">12 神经网络与深度学习基础</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">IV 实践——综合案例分析</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="展开或折叠此栏">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/part-4-introduction.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">part-4-introduction.html</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/13 回归任务与基准测试.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">13 回归任务与基准测试</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/14 分类任务.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">14 分类任务</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/15 案例综合分析.html" class="sidebar-item-text sidebar-link active"><span class="chapter-title">15 案例综合分析</span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">目录</h2>
   
  <ul>
<li><a href="#%E6%A1%88%E4%BE%8B%E5%AF%BC%E8%AF%BB" id="toc-案例导读" class="nav-link active" data-scroll-target="#%E6%A1%88%E4%BE%8B%E5%AF%BC%E8%AF%BB">案例导读</a></li>
  <li>
<a href="#r%E8%AF%AD%E8%A8%80%E5%AE%9E%E7%8E%B0" id="toc-r语言实现" class="nav-link" data-scroll-target="#r%E8%AF%AD%E8%A8%80%E5%AE%9E%E7%8E%B0">15.1 R语言实现</a>
  <ul class="collapse">
<li><a href="#%E6%95%B0%E6%8D%AE%E6%8E%A2%E7%B4%A2%E4%B8%8E%E9%A2%84%E5%A4%84%E7%90%86" id="toc-数据探索与预处理" class="nav-link" data-scroll-target="#%E6%95%B0%E6%8D%AE%E6%8E%A2%E7%B4%A2%E4%B8%8E%E9%A2%84%E5%A4%84%E7%90%86">15.1.1. 数据探索与预处理</a></li>
  <li><a href="#%E5%9B%9E%E5%BD%92%E5%88%86%E6%9E%90%E9%A2%84%E6%B5%8B%E8%B4%AD%E4%B9%B0%E9%87%91%E9%A2%9D" id="toc-回归分析预测购买金额" class="nav-link" data-scroll-target="#%E5%9B%9E%E5%BD%92%E5%88%86%E6%9E%90%E9%A2%84%E6%B5%8B%E8%B4%AD%E4%B9%B0%E9%87%91%E9%A2%9D">15.1.2. 回归分析：预测购买金额</a></li>
  <li><a href="#%E8%81%9A%E7%B1%BB%E5%88%86%E6%9E%90%E7%94%A8%E6%88%B7%E5%88%86%E7%BE%A4" id="toc-聚类分析用户分群" class="nav-link" data-scroll-target="#%E8%81%9A%E7%B1%BB%E5%88%86%E6%9E%90%E7%94%A8%E6%88%B7%E5%88%86%E7%BE%A4">15.1.4. 聚类分析：用户分群</a></li>
  <li><a href="#%E5%85%B3%E8%81%94%E5%88%86%E6%9E%90%E5%95%86%E5%93%81%E8%B4%AD%E4%B9%B0%E5%85%B3%E8%81%94%E8%A7%84%E5%88%99" id="toc-关联分析商品购买关联规则" class="nav-link" data-scroll-target="#%E5%85%B3%E8%81%94%E5%88%86%E6%9E%90%E5%95%86%E5%93%81%E8%B4%AD%E4%B9%B0%E5%85%B3%E8%81%94%E8%A7%84%E5%88%99">15.1.5. 关联分析：商品购买关联规则</a></li>
  </ul>
</li>
  <li>
<a href="#python%E5%AE%9E%E7%8E%B0" id="toc-python实现" class="nav-link" data-scroll-target="#python%E5%AE%9E%E7%8E%B0">15.2 Python实现</a>
  <ul class="collapse">
<li><a href="#python%E5%9B%9E%E5%BD%92%E5%88%86%E6%9E%90" id="toc-python回归分析" class="nav-link" data-scroll-target="#python%E5%9B%9E%E5%BD%92%E5%88%86%E6%9E%90">15.2.2 Python回归分析</a></li>
  <li><a href="#python%E5%88%86%E7%B1%BB%E5%88%86%E6%9E%90" id="toc-python分类分析" class="nav-link" data-scroll-target="#python%E5%88%86%E7%B1%BB%E5%88%86%E6%9E%90">15.2.3 Python分类分析</a></li>
  <li><a href="#python%E8%81%9A%E7%B1%BB%E5%88%86%E6%9E%90" id="toc-python聚类分析" class="nav-link" data-scroll-target="#python%E8%81%9A%E7%B1%BB%E5%88%86%E6%9E%90">15.2.4 Python聚类分析</a></li>
  <li><a href="#python%E5%85%B3%E8%81%94%E5%88%86%E6%9E%90" id="toc-python关联分析" class="nav-link" data-scroll-target="#python%E5%85%B3%E8%81%94%E5%88%86%E6%9E%90">15.2.5 Python关联分析</a></li>
  </ul>
</li>
  <li><a href="#%E7%BB%BC%E5%90%88%E5%88%86%E6%9E%90%E7%BB%93%E6%9E%9C" id="toc-综合分析结果" class="nav-link" data-scroll-target="#%E7%BB%BC%E5%90%88%E5%88%86%E6%9E%90%E7%BB%93%E6%9E%9C">15.3 综合分析结果</a></li>
  <li><a href="#%E9%99%84%E5%BD%95" id="toc-附录" class="nav-link" data-scroll-target="#%E9%99%84%E5%BD%95">15.4 附录</a></li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapters/part-4-introduction.html">IV 实践——综合案例分析</a></li><li class="breadcrumb-item"><a href="../chapters/15 案例综合分析.html"><span class="chapter-title">15 案例综合分析</span></a></li></ol></nav><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-title">15 案例综合分析</span></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> 代码</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">显示所有代码</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">隐藏所有代码</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">查看源代码</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">作者</div>
    <div class="quarto-title-meta-contents">
             <p>李世纪 </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">发布于</div>
    <div class="quarto-title-meta-contents">
      <p class="date">2025年12月4日</p>
    </div>
  </div>
  
    
  </div>
  


</header><section id="案例导读" class="level2"><h2 class="anchored" data-anchor-id="案例导读">案例导读</h2>
<p>本项目基于模拟的电商用户数据，进行全面的数据分析，包括： - 回归分析：预测用户消费金额 - 分类分析：预测用户购买意向 - 聚类分析：用户分群 - 关联分析：商品购买关联规则</p>
<p>数据说明</p>
<div class="cell">
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="co"># 生成模拟数据</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb1-3"><a href="#cb1-3"></a>n <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb1-4"><a href="#cb1-4"></a></span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="co"># 用户基本信息</span></span>
<span id="cb1-6"><a href="#cb1-6"></a>user_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb1-7"><a href="#cb1-7"></a>  <span class="at">user_id =</span> <span class="dv">1</span><span class="sc">:</span>n,</span>
<span id="cb1-8"><a href="#cb1-8"></a>  <span class="at">age =</span> <span class="fu">sample</span>(<span class="dv">18</span><span class="sc">:</span><span class="dv">65</span>, n, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1-9"><a href="#cb1-9"></a>  <span class="at">gender =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"Male"</span>, <span class="st">"Female"</span>), n, <span class="at">replace =</span> <span class="cn">TRUE</span>, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.48</span>, <span class="fl">0.52</span>)),</span>
<span id="cb1-10"><a href="#cb1-10"></a>  <span class="at">income =</span> <span class="fu">round</span>(<span class="fu">rnorm</span>(n, <span class="dv">50000</span>, <span class="dv">15000</span>)),</span>
<span id="cb1-11"><a href="#cb1-11"></a>  <span class="at">region =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"North"</span>, <span class="st">"South"</span>, <span class="st">"East"</span>, <span class="st">"West"</span>), n, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1-12"><a href="#cb1-12"></a>  <span class="at">days_since_signup =</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">365</span>, n, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1-13"><a href="#cb1-13"></a>  <span class="at">page_views =</span> <span class="fu">rpois</span>(n, <span class="dv">25</span>),</span>
<span id="cb1-14"><a href="#cb1-14"></a>  <span class="at">time_on_site =</span> <span class="fu">round</span>(<span class="fu">rnorm</span>(n, <span class="dv">300</span>, <span class="dv">120</span>)),</span>
<span id="cb1-15"><a href="#cb1-15"></a>  <span class="at">cart_additions =</span> <span class="fu">rpois</span>(n, <span class="dv">5</span>)</span>
<span id="cb1-16"><a href="#cb1-16"></a>)</span>
<span id="cb1-17"><a href="#cb1-17"></a></span>
<span id="cb1-18"><a href="#cb1-18"></a><span class="co"># 生成购买行为数据</span></span>
<span id="cb1-19"><a href="#cb1-19"></a>user_data<span class="sc">$</span>purchase_amount <span class="ot">&lt;-</span> <span class="fu">with</span>(user_data, </span>
<span id="cb1-20"><a href="#cb1-20"></a>  <span class="dv">50</span> <span class="sc">+</span> <span class="fl">0.3</span> <span class="sc">*</span> income<span class="sc">/</span><span class="dv">1000</span> <span class="sc">+</span> <span class="fl">0.5</span> <span class="sc">*</span> page_views <span class="sc">+</span> <span class="fl">0.8</span> <span class="sc">*</span> time_on_site<span class="sc">/</span><span class="dv">60</span> <span class="sc">+</span> </span>
<span id="cb1-21"><a href="#cb1-21"></a>  <span class="dv">2</span> <span class="sc">*</span> cart_additions <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="dv">20</span>)</span>
<span id="cb1-22"><a href="#cb1-22"></a>)</span>
<span id="cb1-23"><a href="#cb1-23"></a></span>
<span id="cb1-24"><a href="#cb1-24"></a>user_data<span class="sc">$</span>made_purchase <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(user_data<span class="sc">$</span>purchase_amount <span class="sc">&gt;</span> <span class="dv">120</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb1-25"><a href="#cb1-25"></a></span>
<span id="cb1-26"><a href="#cb1-26"></a><span class="co"># 添加产品类别购买信息 - 增加相关性以产生关联规则</span></span>
<span id="cb1-27"><a href="#cb1-27"></a>products <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Electronics"</span>, <span class="st">"Clothing"</span>, <span class="st">"Books"</span>, <span class="st">"Home"</span>, <span class="st">"Sports"</span>)</span>
<span id="cb1-28"><a href="#cb1-28"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb1-29"><a href="#cb1-29"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(products)) {</span>
<span id="cb1-30"><a href="#cb1-30"></a>  product <span class="ot">&lt;-</span> products[i]</span>
<span id="cb1-31"><a href="#cb1-31"></a>  base_prob <span class="ot">&lt;-</span> <span class="fl">0.4</span></span>
<span id="cb1-32"><a href="#cb1-32"></a>  <span class="co"># 创建产品间的相关性</span></span>
<span id="cb1-33"><a href="#cb1-33"></a>  <span class="cf">if</span>(i <span class="sc">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb1-34"><a href="#cb1-34"></a>    <span class="co"># 让某些产品更可能一起购买</span></span>
<span id="cb1-35"><a href="#cb1-35"></a>    correlated_prob <span class="ot">&lt;-</span> user_data[[<span class="fu">paste0</span>(<span class="st">"bought_"</span>, <span class="fu">tolower</span>(products[i<span class="dv">-1</span>]))]] <span class="sc">*</span> <span class="fl">0.3</span> <span class="sc">+</span> base_prob</span>
<span id="cb1-36"><a href="#cb1-36"></a>    user_data[[<span class="fu">paste0</span>(<span class="st">"bought_"</span>, <span class="fu">tolower</span>(product))]] <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n, <span class="dv">1</span>, <span class="fu">pmin</span>(correlated_prob, <span class="fl">0.8</span>))</span>
<span id="cb1-37"><a href="#cb1-37"></a>  } <span class="cf">else</span> {</span>
<span id="cb1-38"><a href="#cb1-38"></a>    user_data[[<span class="fu">paste0</span>(<span class="st">"bought_"</span>, <span class="fu">tolower</span>(product))]] <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n, <span class="dv">1</span>, base_prob)</span>
<span id="cb1-39"><a href="#cb1-39"></a>  }</span>
<span id="cb1-40"><a href="#cb1-40"></a>}</span>
<span id="cb1-41"><a href="#cb1-41"></a></span>
<span id="cb1-42"><a href="#cb1-42"></a><span class="fu">head</span>(user_data)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>  user_id age gender income region days_since_signup page_views time_on_site
1       1  48 Female  51762   West                 5         29          173
2       2  32 Female  45027   West                22         28          450
3       3  31   Male  54174   West                 4         38          147
4       4  20 Female  32216  South               352         23          243
5       5  59   Male  37462  North               131         23          340
6       6  60 Female  57654  North               231         15          334
  cart_additions purchase_amount made_purchase bought_electronics
1              3        57.57759             0                  0
2              3        59.83742             0                  1
3              6        64.31744             0                  0
4             10        94.88951             0                  1
5              1        24.43966             0                  1
6              5       114.33971             0                  0
  bought_clothing bought_books bought_home bought_sports
1               0            0           0             0
2               1            1           0             1
3               0            0           0             0
4               0            0           1             0
5               0            0           0             0
6               0            1           1             1</code></pre>
</div>
</div>
</section><section id="r语言实现" class="level2"><h2 class="anchored" data-anchor-id="r语言实现">15.1 R语言实现</h2>
<section id="数据探索与预处理" class="level3"><h3 class="anchored" data-anchor-id="数据探索与预处理">15.1.1. 数据探索与预处理</h3>
<p>数据概览</p>
<div class="cell">
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="fu">library</span>(corrplot)</span>
<span id="cb3-4"><a href="#cb3-4"></a></span>
<span id="cb3-5"><a href="#cb3-5"></a><span class="co"># 基本统计信息</span></span>
<span id="cb3-6"><a href="#cb3-6"></a><span class="fu">summary</span>(user_data[, <span class="fu">c</span>(<span class="st">"age"</span>, <span class="st">"income"</span>, <span class="st">"page_views"</span>, <span class="st">"time_on_site"</span>, <span class="st">"purchase_amount"</span>)])</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>      age            income         page_views     time_on_site  
 Min.   :18.00   Min.   :  4282   Min.   :11.00   Min.   :-83.0  
 1st Qu.:29.00   1st Qu.: 40201   1st Qu.:21.00   1st Qu.:219.8  
 Median :42.00   Median : 49943   Median :25.00   Median :299.0  
 Mean   :41.39   Mean   : 50209   Mean   :24.92   Mean   :299.7  
 3rd Qu.:53.00   3rd Qu.: 60887   3rd Qu.:28.00   3rd Qu.:376.2  
 Max.   :65.00   Max.   :100856   Max.   :42.00   Max.   :688.0  
 purchase_amount  
 Min.   :  9.555  
 1st Qu.: 76.051  
 Median : 91.131  
 Mean   : 90.966  
 3rd Qu.:105.509  
 Max.   :153.144  </code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="co"># 缺失值检查</span></span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="fu">sapply</span>(user_data, <span class="cf">function</span>(x) <span class="fu">sum</span>(<span class="fu">is.na</span>(x)))</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>           user_id                age             gender             income 
                 0                  0                  0                  0 
            region  days_since_signup         page_views       time_on_site 
                 0                  0                  0                  0 
    cart_additions    purchase_amount      made_purchase bought_electronics 
                 0                  0                  0                  0 
   bought_clothing       bought_books        bought_home      bought_sports 
                 0                  0                  0                  0 </code></pre>
</div>
</div>
<p>数据可视化</p>
<div class="cell">
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="co"># 数值变量分布</span></span>
<span id="cb7-2"><a href="#cb7-2"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(user_data, <span class="fu">aes</span>(<span class="at">x =</span> purchase_amount)) <span class="sc">+</span></span>
<span id="cb7-3"><a href="#cb7-3"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">30</span>, <span class="at">fill =</span> <span class="st">"steelblue"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb7-4"><a href="#cb7-4"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"购买金额分布"</span>)</span>
<span id="cb7-5"><a href="#cb7-5"></a></span>
<span id="cb7-6"><a href="#cb7-6"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(user_data, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(made_purchase), <span class="at">fill =</span> <span class="fu">factor</span>(made_purchase))) <span class="sc">+</span></span>
<span id="cb7-7"><a href="#cb7-7"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb7-8"><a href="#cb7-8"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"购买行为分布"</span>, <span class="at">x =</span> <span class="st">"是否购买"</span>)</span>
<span id="cb7-9"><a href="#cb7-9"></a></span>
<span id="cb7-10"><a href="#cb7-10"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(user_data, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> purchase_amount, <span class="at">color =</span> gender)) <span class="sc">+</span></span>
<span id="cb7-11"><a href="#cb7-11"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb7-12"><a href="#cb7-12"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"年龄与购买金额关系"</span>)</span>
<span id="cb7-13"><a href="#cb7-13"></a></span>
<span id="cb7-14"><a href="#cb7-14"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb7-15"><a href="#cb7-15"></a>p1 <span class="sc">/</span> p2 <span class="sc">/</span> p3</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="15-案例综合分析_files/figure-html/r-data-visualization-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="回归分析预测购买金额" class="level3"><h3 class="anchored" data-anchor-id="回归分析预测购买金额">15.1.2. 回归分析：预测购买金额</h3>
<p>线性回归模型</p>
<div class="cell">
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb8-2"><a href="#cb8-2"></a></span>
<span id="cb8-3"><a href="#cb8-3"></a><span class="co"># 准备数据</span></span>
<span id="cb8-4"><a href="#cb8-4"></a>reg_data <span class="ot">&lt;-</span> user_data <span class="sc">%&gt;%</span> </span>
<span id="cb8-5"><a href="#cb8-5"></a>  <span class="fu">select</span>(age, income, page_views, time_on_site, cart_additions, purchase_amount) <span class="sc">%&gt;%</span></span>
<span id="cb8-6"><a href="#cb8-6"></a>  <span class="fu">na.omit</span>()</span>
<span id="cb8-7"><a href="#cb8-7"></a></span>
<span id="cb8-8"><a href="#cb8-8"></a><span class="co"># 数据分割</span></span>
<span id="cb8-9"><a href="#cb8-9"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb8-10"><a href="#cb8-10"></a>train_index <span class="ot">&lt;-</span> <span class="fu">createDataPartition</span>(reg_data<span class="sc">$</span>purchase_amount, <span class="at">p =</span> <span class="fl">0.7</span>, <span class="at">list =</span> <span class="cn">FALSE</span>)</span>
<span id="cb8-11"><a href="#cb8-11"></a>train_reg <span class="ot">&lt;-</span> reg_data[train_index, ]</span>
<span id="cb8-12"><a href="#cb8-12"></a>test_reg <span class="ot">&lt;-</span> reg_data[<span class="sc">-</span>train_index, ]</span>
<span id="cb8-13"><a href="#cb8-13"></a></span>
<span id="cb8-14"><a href="#cb8-14"></a><span class="co"># 训练线性回归模型</span></span>
<span id="cb8-15"><a href="#cb8-15"></a>lm_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(purchase_amount <span class="sc">~</span> ., <span class="at">data =</span> train_reg)</span>
<span id="cb8-16"><a href="#cb8-16"></a><span class="fu">summary</span>(lm_model)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = purchase_amount ~ ., data = train_reg)

Residuals:
    Min      1Q  Median      3Q     Max 
-66.576 -12.853  -0.106  13.819  67.749 

Coefficients:
                Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)    5.111e+01  5.704e+00   8.961  &lt; 2e-16 ***
age            8.216e-04  5.349e-02   0.015  0.98775    
income         2.969e-04  5.022e-05   5.913 5.28e-09 ***
page_views     2.720e-01  1.496e-01   1.818  0.06954 .  
time_on_site   1.635e-02  6.067e-03   2.695  0.00721 ** 
cart_additions 2.638e+00  3.326e-01   7.933 8.57e-15 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 19.32 on 694 degrees of freedom
Multiple R-squared:  0.1368,    Adjusted R-squared:  0.1305 
F-statistic: 21.99 on 5 and 694 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="co"># 预测</span></span>
<span id="cb10-2"><a href="#cb10-2"></a>predictions_lm <span class="ot">&lt;-</span> <span class="fu">predict</span>(lm_model, <span class="at">newdata =</span> test_reg)</span>
<span id="cb10-3"><a href="#cb10-3"></a></span>
<span id="cb10-4"><a href="#cb10-4"></a><span class="co"># 模型评估</span></span>
<span id="cb10-5"><a href="#cb10-5"></a>reg_metrics <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb10-6"><a href="#cb10-6"></a>  <span class="at">RMSE =</span> <span class="fu">RMSE</span>(predictions_lm, test_reg<span class="sc">$</span>purchase_amount),</span>
<span id="cb10-7"><a href="#cb10-7"></a>  <span class="at">MAE =</span> <span class="fu">MAE</span>(predictions_lm, test_reg<span class="sc">$</span>purchase_amount),</span>
<span id="cb10-8"><a href="#cb10-8"></a>  <span class="at">R2 =</span> <span class="fu">R2</span>(predictions_lm, test_reg<span class="sc">$</span>purchase_amount)</span>
<span id="cb10-9"><a href="#cb10-9"></a>)</span>
<span id="cb10-10"><a href="#cb10-10"></a><span class="fu">print</span>(reg_metrics)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>      RMSE      MAE         R2
1 21.72114 17.54768 0.07424787</code></pre>
</div>
</div>
<p>回归结果可视化</p>
<div class="cell">
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="co"># 预测 vs 实际值</span></span>
<span id="cb12-2"><a href="#cb12-2"></a>results_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb12-3"><a href="#cb12-3"></a>  <span class="at">Actual =</span> test_reg<span class="sc">$</span>purchase_amount,</span>
<span id="cb12-4"><a href="#cb12-4"></a>  <span class="at">Predicted =</span> predictions_lm</span>
<span id="cb12-5"><a href="#cb12-5"></a>)</span>
<span id="cb12-6"><a href="#cb12-6"></a></span>
<span id="cb12-7"><a href="#cb12-7"></a><span class="fu">ggplot</span>(results_df, <span class="fu">aes</span>(<span class="at">x =</span> Actual, <span class="at">y =</span> Predicted)) <span class="sc">+</span></span>
<span id="cb12-8"><a href="#cb12-8"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">color =</span> <span class="st">"steelblue"</span>) <span class="sc">+</span></span>
<span id="cb12-9"><a href="#cb12-9"></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>, <span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb12-10"><a href="#cb12-10"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"线性回归：预测值 vs 实际值"</span>,</span>
<span id="cb12-11"><a href="#cb12-11"></a>       <span class="at">subtitle =</span> <span class="fu">paste</span>(<span class="st">"R² ="</span>, <span class="fu">round</span>(reg_metrics<span class="sc">$</span>R2, <span class="dv">3</span>))) <span class="sc">+</span></span>
<span id="cb12-12"><a href="#cb12-12"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="15-案例综合分析_files/figure-html/r-regression-viz-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>###15.1.3. 分类分析：预测购买意向</p>
<p>逻辑回归分类</p>
<div class="cell">
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="co"># 准备分类数据 - 确保因子水平一致</span></span>
<span id="cb13-2"><a href="#cb13-2"></a>class_data <span class="ot">&lt;-</span> user_data <span class="sc">%&gt;%</span> </span>
<span id="cb13-3"><a href="#cb13-3"></a>  <span class="fu">select</span>(age, income, page_views, time_on_site, cart_additions, made_purchase) <span class="sc">%&gt;%</span></span>
<span id="cb13-4"><a href="#cb13-4"></a>  <span class="fu">mutate</span>(<span class="at">made_purchase =</span> <span class="fu">factor</span>(made_purchase, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"No"</span>, <span class="st">"Yes"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb13-5"><a href="#cb13-5"></a>  <span class="fu">na.omit</span>()</span>
<span id="cb13-6"><a href="#cb13-6"></a></span>
<span id="cb13-7"><a href="#cb13-7"></a><span class="co"># 数据分割</span></span>
<span id="cb13-8"><a href="#cb13-8"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb13-9"><a href="#cb13-9"></a>train_index_class <span class="ot">&lt;-</span> <span class="fu">createDataPartition</span>(class_data<span class="sc">$</span>made_purchase, <span class="at">p =</span> <span class="fl">0.7</span>, <span class="at">list =</span> <span class="cn">FALSE</span>)</span>
<span id="cb13-10"><a href="#cb13-10"></a>train_class <span class="ot">&lt;-</span> class_data[train_index_class, ]</span>
<span id="cb13-11"><a href="#cb13-11"></a>test_class <span class="ot">&lt;-</span> class_data[<span class="sc">-</span>train_index_class, ]</span>
<span id="cb13-12"><a href="#cb13-12"></a></span>
<span id="cb13-13"><a href="#cb13-13"></a><span class="co"># 训练逻辑回归模型</span></span>
<span id="cb13-14"><a href="#cb13-14"></a>logit_model <span class="ot">&lt;-</span> <span class="fu">glm</span>(made_purchase <span class="sc">~</span> ., <span class="at">data =</span> train_class, <span class="at">family =</span> binomial)</span>
<span id="cb13-15"><a href="#cb13-15"></a><span class="fu">summary</span>(logit_model)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = made_purchase ~ ., family = binomial, data = train_class)

Coefficients:
                 Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)    -7.571e+00  1.118e+00  -6.771 1.28e-11 ***
age             1.361e-03  1.002e-02   0.136   0.8920    
income          2.353e-05  9.733e-06   2.418   0.0156 *  
page_views      5.748e-02  2.661e-02   2.160   0.0308 *  
time_on_site    2.964e-03  1.157e-03   2.562   0.0104 *  
cart_additions  2.789e-01  6.152e-02   4.533 5.82e-06 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 419.09  on 700  degrees of freedom
Residual deviance: 381.44  on 695  degrees of freedom
AIC: 393.44

Number of Fisher Scoring iterations: 5</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="co"># 预测概率</span></span>
<span id="cb15-2"><a href="#cb15-2"></a>prob_predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(logit_model, <span class="at">newdata =</span> test_class, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb15-3"><a href="#cb15-3"></a>class_predictions <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(prob_predictions <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="st">"Yes"</span>, <span class="st">"No"</span>)</span>
<span id="cb15-4"><a href="#cb15-4"></a>class_predictions <span class="ot">&lt;-</span> <span class="fu">factor</span>(class_predictions, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"No"</span>, <span class="st">"Yes"</span>))</span>
<span id="cb15-5"><a href="#cb15-5"></a></span>
<span id="cb15-6"><a href="#cb15-6"></a><span class="co"># 模型评估 - 修复因子水平问题</span></span>
<span id="cb15-7"><a href="#cb15-7"></a>conf_matrix <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(class_predictions, test_class<span class="sc">$</span>made_purchase, <span class="at">positive =</span> <span class="st">"Yes"</span>)</span>
<span id="cb15-8"><a href="#cb15-8"></a><span class="fu">print</span>(conf_matrix)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction  No Yes
       No  273  26
       Yes   0   0
                                          
               Accuracy : 0.913           
                 95% CI : (0.8752, 0.9424)
    No Information Rate : 0.913           
    P-Value [Acc &gt; NIR] : 0.552           
                                          
                  Kappa : 0               
                                          
 Mcnemar's Test P-Value : 9.443e-07       
                                          
            Sensitivity : 0.00000         
            Specificity : 1.00000         
         Pos Pred Value :     NaN         
         Neg Pred Value : 0.91304         
             Prevalence : 0.08696         
         Detection Rate : 0.00000         
   Detection Prevalence : 0.00000         
      Balanced Accuracy : 0.50000         
                                          
       'Positive' Class : Yes             
                                          </code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="co"># 绘制ROC曲线</span></span>
<span id="cb17-2"><a href="#cb17-2"></a><span class="fu">library</span>(pROC)</span>
<span id="cb17-3"><a href="#cb17-3"></a>roc_curve <span class="ot">&lt;-</span> <span class="fu">roc</span>(<span class="fu">as.numeric</span>(test_class<span class="sc">$</span>made_purchase) <span class="sc">-</span> <span class="dv">1</span>, prob_predictions)</span>
<span id="cb17-4"><a href="#cb17-4"></a><span class="fu">plot</span>(roc_curve, <span class="at">main =</span> <span class="st">"逻辑回归ROC曲线"</span>)</span>
<span id="cb17-5"><a href="#cb17-5"></a>auc_value <span class="ot">&lt;-</span> <span class="fu">auc</span>(roc_curve)</span>
<span id="cb17-6"><a href="#cb17-6"></a><span class="fu">legend</span>(<span class="st">"bottomright"</span>, <span class="at">legend =</span> <span class="fu">paste</span>(<span class="st">"AUC ="</span>, <span class="fu">round</span>(auc_value, <span class="dv">3</span>)))</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="15-案例综合分析_files/figure-html/r-classification-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>随机森林分类</p>
<div class="cell">
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="fu">library</span>(randomForest)</span>
<span id="cb18-2"><a href="#cb18-2"></a></span>
<span id="cb18-3"><a href="#cb18-3"></a><span class="co"># 确保训练数据和测试数据的因子水平一致</span></span>
<span id="cb18-4"><a href="#cb18-4"></a>train_class<span class="sc">$</span>made_purchase <span class="ot">&lt;-</span> <span class="fu">factor</span>(train_class<span class="sc">$</span>made_purchase, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"No"</span>, <span class="st">"Yes"</span>))</span>
<span id="cb18-5"><a href="#cb18-5"></a>test_class<span class="sc">$</span>made_purchase <span class="ot">&lt;-</span> <span class="fu">factor</span>(test_class<span class="sc">$</span>made_purchase, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"No"</span>, <span class="st">"Yes"</span>))</span>
<span id="cb18-6"><a href="#cb18-6"></a></span>
<span id="cb18-7"><a href="#cb18-7"></a><span class="co"># 训练随机森林</span></span>
<span id="cb18-8"><a href="#cb18-8"></a>rf_model <span class="ot">&lt;-</span> <span class="fu">randomForest</span>(made_purchase <span class="sc">~</span> ., <span class="at">data =</span> train_class, <span class="at">ntree =</span> <span class="dv">100</span>)</span>
<span id="cb18-9"><a href="#cb18-9"></a></span>
<span id="cb18-10"><a href="#cb18-10"></a><span class="co"># 预测</span></span>
<span id="cb18-11"><a href="#cb18-11"></a>rf_predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(rf_model, <span class="at">newdata =</span> test_class)</span>
<span id="cb18-12"><a href="#cb18-12"></a></span>
<span id="cb18-13"><a href="#cb18-13"></a><span class="co"># 评估 - 确保因子水平一致</span></span>
<span id="cb18-14"><a href="#cb18-14"></a>rf_conf_matrix <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(rf_predictions, test_class<span class="sc">$</span>made_purchase, <span class="at">positive =</span> <span class="st">"Yes"</span>)</span>
<span id="cb18-15"><a href="#cb18-15"></a><span class="fu">print</span>(rf_conf_matrix)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction  No Yes
       No  271  26
       Yes   2   0
                                          
               Accuracy : 0.9064          
                 95% CI : (0.8675, 0.9369)
    No Information Rate : 0.913           
    P-Value [Acc &gt; NIR] : 0.7033          
                                          
                  Kappa : -0.0126         
                                          
 Mcnemar's Test P-Value : 1.383e-05       
                                          
            Sensitivity : 0.000000        
            Specificity : 0.992674        
         Pos Pred Value : 0.000000        
         Neg Pred Value : 0.912458        
             Prevalence : 0.086957        
         Detection Rate : 0.000000        
   Detection Prevalence : 0.006689        
      Balanced Accuracy : 0.496337        
                                          
       'Positive' Class : Yes             
                                          </code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a><span class="co"># 变量重要性</span></span>
<span id="cb20-2"><a href="#cb20-2"></a><span class="fu">varImpPlot</span>(rf_model, <span class="at">main =</span> <span class="st">"随机森林变量重要性"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="15-案例综合分析_files/figure-html/r-random-forest-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a><span class="co"># 随机森林ROC曲线</span></span>
<span id="cb21-2"><a href="#cb21-2"></a>rf_prob <span class="ot">&lt;-</span> <span class="fu">predict</span>(rf_model, <span class="at">newdata =</span> test_class, <span class="at">type =</span> <span class="st">"prob"</span>)[, <span class="st">"Yes"</span>]</span>
<span id="cb21-3"><a href="#cb21-3"></a>rf_roc <span class="ot">&lt;-</span> <span class="fu">roc</span>(<span class="fu">as.numeric</span>(test_class<span class="sc">$</span>made_purchase) <span class="sc">-</span> <span class="dv">1</span>, rf_prob)</span>
<span id="cb21-4"><a href="#cb21-4"></a><span class="fu">plot</span>(rf_roc, <span class="at">main =</span> <span class="st">"随机森林ROC曲线"</span>)</span>
<span id="cb21-5"><a href="#cb21-5"></a>rf_auc <span class="ot">&lt;-</span> <span class="fu">auc</span>(rf_roc)</span>
<span id="cb21-6"><a href="#cb21-6"></a><span class="fu">legend</span>(<span class="st">"bottomright"</span>, <span class="at">legend =</span> <span class="fu">paste</span>(<span class="st">"AUC ="</span>, <span class="fu">round</span>(rf_auc, <span class="dv">3</span>)))</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="15-案例综合分析_files/figure-html/r-random-forest-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>分类模型比较</p>
</section><section id="聚类分析用户分群" class="level3"><h3 class="anchored" data-anchor-id="聚类分析用户分群">15.1.4. 聚类分析：用户分群</h3>
<p>K-means聚类</p>
<div class="cell">
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a><span class="co"># 准备聚类数据</span></span>
<span id="cb22-2"><a href="#cb22-2"></a>cluster_data <span class="ot">&lt;-</span> user_data <span class="sc">%&gt;%</span></span>
<span id="cb22-3"><a href="#cb22-3"></a>  <span class="fu">select</span>(age, income, page_views, time_on_site, cart_additions) <span class="sc">%&gt;%</span></span>
<span id="cb22-4"><a href="#cb22-4"></a>  <span class="fu">scale</span>()  <span class="co"># 标准化</span></span>
<span id="cb22-5"><a href="#cb22-5"></a></span>
<span id="cb22-6"><a href="#cb22-6"></a><span class="co"># 确定最佳聚类数</span></span>
<span id="cb22-7"><a href="#cb22-7"></a>wss <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="cf">function</span>(k){<span class="fu">kmeans</span>(cluster_data, k, <span class="at">nstart =</span> <span class="dv">25</span>)<span class="sc">$</span>tot.withinss})</span>
<span id="cb22-8"><a href="#cb22-8"></a></span>
<span id="cb22-9"><a href="#cb22-9"></a><span class="fu">ggplot</span>(<span class="fu">data.frame</span>(<span class="at">k =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">wss =</span> wss), <span class="fu">aes</span>(<span class="at">x =</span> k, <span class="at">y =</span> wss)) <span class="sc">+</span></span>
<span id="cb22-10"><a href="#cb22-10"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb22-11"><a href="#cb22-11"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"肘部法则确定最佳聚类数"</span>, <span class="at">x =</span> <span class="st">"聚类数"</span>, <span class="at">y =</span> <span class="st">"组内平方和"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="15-案例综合分析_files/figure-html/r-clustering-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a><span class="co"># 执行K-means聚类</span></span>
<span id="cb23-2"><a href="#cb23-2"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb23-3"><a href="#cb23-3"></a>kmeans_result <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(cluster_data, <span class="at">centers =</span> <span class="dv">4</span>, <span class="at">nstart =</span> <span class="dv">25</span>)</span>
<span id="cb23-4"><a href="#cb23-4"></a></span>
<span id="cb23-5"><a href="#cb23-5"></a><span class="co"># 添加聚类标签</span></span>
<span id="cb23-6"><a href="#cb23-6"></a>user_data<span class="sc">$</span>cluster <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(kmeans_result<span class="sc">$</span>cluster)</span>
<span id="cb23-7"><a href="#cb23-7"></a></span>
<span id="cb23-8"><a href="#cb23-8"></a><span class="co"># 聚类结果可视化</span></span>
<span id="cb23-9"><a href="#cb23-9"></a><span class="fu">library</span>(factoextra)</span>
<span id="cb23-10"><a href="#cb23-10"></a><span class="fu">fviz_cluster</span>(kmeans_result, <span class="at">data =</span> cluster_data, </span>
<span id="cb23-11"><a href="#cb23-11"></a>             <span class="at">palette =</span> <span class="fu">c</span>(<span class="st">"#2E9FDF"</span>, <span class="st">"#00AFBB"</span>, <span class="st">"#E7B800"</span>, <span class="st">"#FC4E07"</span>),</span>
<span id="cb23-12"><a href="#cb23-12"></a>             <span class="at">geom =</span> <span class="st">"point"</span>,</span>
<span id="cb23-13"><a href="#cb23-13"></a>             <span class="at">ellipse.type =</span> <span class="st">"convex"</span>,</span>
<span id="cb23-14"><a href="#cb23-14"></a>             <span class="at">ggtheme =</span> <span class="fu">theme_bw</span>())</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="15-案例综合分析_files/figure-html/r-clustering-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>聚类分析</p>
<div class="cell">
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a><span class="co"># 聚类特征分析</span></span>
<span id="cb24-2"><a href="#cb24-2"></a>cluster_summary <span class="ot">&lt;-</span> user_data <span class="sc">%&gt;%</span></span>
<span id="cb24-3"><a href="#cb24-3"></a>  <span class="fu">group_by</span>(cluster) <span class="sc">%&gt;%</span></span>
<span id="cb24-4"><a href="#cb24-4"></a>  <span class="fu">summarise</span>(</span>
<span id="cb24-5"><a href="#cb24-5"></a>    <span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb24-6"><a href="#cb24-6"></a>    <span class="at">avg_age =</span> <span class="fu">mean</span>(age),</span>
<span id="cb24-7"><a href="#cb24-7"></a>    <span class="at">avg_income =</span> <span class="fu">mean</span>(income),</span>
<span id="cb24-8"><a href="#cb24-8"></a>    <span class="at">avg_page_views =</span> <span class="fu">mean</span>(page_views),</span>
<span id="cb24-9"><a href="#cb24-9"></a>    <span class="at">avg_time =</span> <span class="fu">mean</span>(time_on_site),</span>
<span id="cb24-10"><a href="#cb24-10"></a>    <span class="at">purchase_rate =</span> <span class="fu">mean</span>(made_purchase),</span>
<span id="cb24-11"><a href="#cb24-11"></a>    <span class="at">avg_purchase =</span> <span class="fu">mean</span>(purchase_amount)</span>
<span id="cb24-12"><a href="#cb24-12"></a>  )</span>
<span id="cb24-13"><a href="#cb24-13"></a></span>
<span id="cb24-14"><a href="#cb24-14"></a><span class="fu">print</span>(cluster_summary)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 8
  cluster     n avg_age avg_income avg_page_views avg_time purchase_rate
  &lt;fct&gt;   &lt;int&gt;   &lt;dbl&gt;      &lt;dbl&gt;          &lt;dbl&gt;    &lt;dbl&gt;         &lt;dbl&gt;
1 1         292    53.9     50802.           23.1     376.        0.0822
2 2         257    30.1     46562.           22.3     304.        0.0506
3 3         203    33.8     47358.           25.6     293.        0.133 
4 4         248    44.6     55625.           29.2     210.        0.0968
# ℹ 1 more variable: avg_purchase &lt;dbl&gt;</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a><span class="co"># 聚类特征可视化 - 修复版本</span></span>
<span id="cb26-2"><a href="#cb26-2"></a>cluster_features <span class="ot">&lt;-</span> user_data <span class="sc">%&gt;%</span></span>
<span id="cb26-3"><a href="#cb26-3"></a>  <span class="fu">select</span>(cluster, age, income, page_views, time_on_site, purchase_amount)</span>
<span id="cb26-4"><a href="#cb26-4"></a></span>
<span id="cb26-5"><a href="#cb26-5"></a><span class="co"># 使用tidyr::pivot_longer</span></span>
<span id="cb26-6"><a href="#cb26-6"></a>cluster_features_long <span class="ot">&lt;-</span> tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb26-7"><a href="#cb26-7"></a>  cluster_features,</span>
<span id="cb26-8"><a href="#cb26-8"></a>  <span class="at">cols =</span> <span class="sc">-</span>cluster,</span>
<span id="cb26-9"><a href="#cb26-9"></a>  <span class="at">names_to =</span> <span class="st">"Feature"</span>,</span>
<span id="cb26-10"><a href="#cb26-10"></a>  <span class="at">values_to =</span> <span class="st">"Value"</span></span>
<span id="cb26-11"><a href="#cb26-11"></a>)</span>
<span id="cb26-12"><a href="#cb26-12"></a></span>
<span id="cb26-13"><a href="#cb26-13"></a><span class="fu">ggplot</span>(cluster_features_long, <span class="fu">aes</span>(<span class="at">x =</span> cluster, <span class="at">y =</span> Value, <span class="at">fill =</span> cluster)) <span class="sc">+</span></span>
<span id="cb26-14"><a href="#cb26-14"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb26-15"><a href="#cb26-15"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> Feature, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb26-16"><a href="#cb26-16"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"各聚类群体特征分布"</span>) <span class="sc">+</span></span>
<span id="cb26-17"><a href="#cb26-17"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb26-18"><a href="#cb26-18"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="15-案例综合分析_files/figure-html/r-cluster-analysis-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="关联分析商品购买关联规则" class="level3"><h3 class="anchored" data-anchor-id="关联分析商品购买关联规则">15.1.5. 关联分析：商品购买关联规则</h3>
<p>Apriori算法</p>
<div class="cell">
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a><span class="fu">library</span>(arules)</span>
<span id="cb27-2"><a href="#cb27-2"></a></span>
<span id="cb27-3"><a href="#cb27-3"></a><span class="co"># 准备关联分析数据 - 只包含产品购买列</span></span>
<span id="cb27-4"><a href="#cb27-4"></a>transaction_data <span class="ot">&lt;-</span> user_data <span class="sc">%&gt;%</span></span>
<span id="cb27-5"><a href="#cb27-5"></a>  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"bought_"</span>))</span>
<span id="cb27-6"><a href="#cb27-6"></a></span>
<span id="cb27-7"><a href="#cb27-7"></a><span class="co"># 转换为事务数据</span></span>
<span id="cb27-8"><a href="#cb27-8"></a>transactions <span class="ot">&lt;-</span> <span class="fu">as</span>(transaction_data, <span class="st">"transactions"</span>)</span>
<span id="cb27-9"><a href="#cb27-9"></a></span>
<span id="cb27-10"><a href="#cb27-10"></a><span class="co"># 查看事务数据概览</span></span>
<span id="cb27-11"><a href="#cb27-11"></a><span class="fu">summary</span>(transactions)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>transactions as itemMatrix in sparse format with
 1000 rows (elements/itemsets/transactions) and
 5 columns (items) and a density of 1 

most frequent items:
bought_electronics=[0,1]    bought_clothing=[0,1]       bought_books=[0,1] 
                    1000                     1000                     1000 
       bought_home=[0,1]      bought_sports=[0,1]                  (Other) 
                    1000                     1000                        0 

element (itemset/transaction) length distribution:
sizes
   5 
1000 

   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
      5       5       5       5       5       5 

includes extended item information - examples:
                    labels          variables levels
1 bought_electronics=[0,1] bought_electronics  [0,1]
2    bought_clothing=[0,1]    bought_clothing  [0,1]
3       bought_books=[0,1]       bought_books  [0,1]

includes extended transaction information - examples:
  transactionID
1             1
2             2
3             3</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a><span class="co"># 查看产品频率</span></span>
<span id="cb29-2"><a href="#cb29-2"></a>itemFrequency <span class="ot">&lt;-</span> <span class="fu">itemFrequency</span>(transactions)</span>
<span id="cb29-3"><a href="#cb29-3"></a><span class="fu">print</span>(<span class="st">"产品购买频率:"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] "产品购买频率:"</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a><span class="fu">print</span>(<span class="fu">sort</span>(itemFrequency, <span class="at">decreasing =</span> <span class="cn">TRUE</span>))</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>bought_electronics=[0,1]    bought_clothing=[0,1]       bought_books=[0,1] 
                       1                        1                        1 
       bought_home=[0,1]      bought_sports=[0,1] 
                       1                        1 </code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a><span class="co"># 使用更宽松的参数挖掘关联规则</span></span>
<span id="cb33-2"><a href="#cb33-2"></a>rules <span class="ot">&lt;-</span> <span class="fu">apriori</span>(transactions, </span>
<span id="cb33-3"><a href="#cb33-3"></a>                 <span class="at">parameter =</span> <span class="fu">list</span>(<span class="at">support =</span> <span class="fl">0.05</span>,  <span class="co"># 降低支持度阈值</span></span>
<span id="cb33-4"><a href="#cb33-4"></a>                                 <span class="at">confidence =</span> <span class="fl">0.3</span>,  <span class="co"># 降低置信度阈值</span></span>
<span id="cb33-5"><a href="#cb33-5"></a>                                 <span class="at">minlen =</span> <span class="dv">2</span>,        <span class="co"># 最小规则长度</span></span>
<span id="cb33-6"><a href="#cb33-6"></a>                                 <span class="at">maxlen =</span> <span class="dv">4</span>))       <span class="co"># 最大规则长度</span></span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Apriori

Parameter specification:
 confidence minval smax arem  aval originalSupport maxtime support minlen
        0.3    0.1    1 none FALSE            TRUE       5    0.05      2
 maxlen target  ext
      4  rules TRUE

Algorithmic control:
 filter tree heap memopt load sort verbose
    0.1 TRUE TRUE  FALSE TRUE    2    TRUE

Absolute minimum support count: 50 

set item appearances ...[0 item(s)] done [0.00s].
set transactions ...[5 item(s), 1000 transaction(s)] done [0.00s].
sorting and recoding items ... [5 item(s)] done [0.00s].
creating transaction tree ... done [0.00s].
checking subsets of size 1 2 3 4</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code> done [0.00s].
writing ... [70 rule(s)] done [0.00s].
creating S4 object  ... done [0.00s].</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a><span class="co"># 规则摘要</span></span>
<span id="cb36-2"><a href="#cb36-2"></a><span class="fu">cat</span>(<span class="st">"找到的规则数量:"</span>, <span class="fu">length</span>(rules), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>找到的规则数量: 70 </code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1"></a><span class="fu">summary</span>(rules)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>set of 70 rules

rule length distribution (lhs + rhs):sizes
 2  3  4 
20 30 20 

   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
      2       2       3       3       4       4 

summary of quality measures:
    support    confidence    coverage      lift       count     
 Min.   :1   Min.   :1    Min.   :1   Min.   :1   Min.   :1000  
 1st Qu.:1   1st Qu.:1    1st Qu.:1   1st Qu.:1   1st Qu.:1000  
 Median :1   Median :1    Median :1   Median :1   Median :1000  
 Mean   :1   Mean   :1    Mean   :1   Mean   :1   Mean   :1000  
 3rd Qu.:1   3rd Qu.:1    3rd Qu.:1   3rd Qu.:1   3rd Qu.:1000  
 Max.   :1   Max.   :1    Max.   :1   Max.   :1   Max.   :1000  

mining info:
         data ntransactions support confidence
 transactions          1000    0.05        0.3
                                                                                                     call
 apriori(data = transactions, parameter = list(support = 0.05, confidence = 0.3, minlen = 2, maxlen = 4))</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1"></a><span class="co"># 查看规则</span></span>
<span id="cb40-2"><a href="#cb40-2"></a><span class="cf">if</span>(<span class="fu">length</span>(rules) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb40-3"><a href="#cb40-3"></a>  <span class="co"># 按提升度排序</span></span>
<span id="cb40-4"><a href="#cb40-4"></a>  rules_sorted <span class="ot">&lt;-</span> <span class="fu">sort</span>(rules, <span class="at">by =</span> <span class="st">"lift"</span>, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb40-5"><a href="#cb40-5"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">前10条关联规则 (按提升度排序):</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb40-6"><a href="#cb40-6"></a>  <span class="fu">inspect</span>(<span class="fu">head</span>(rules_sorted, <span class="dv">10</span>))</span>
<span id="cb40-7"><a href="#cb40-7"></a>} <span class="cf">else</span> {</span>
<span id="cb40-8"><a href="#cb40-8"></a>  <span class="fu">cat</span>(<span class="st">"没有找到关联规则，请进一步降低阈值参数</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb40-9"><a href="#cb40-9"></a>}</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>
前10条关联规则 (按提升度排序):
     lhs                           rhs                        support
[1]  {bought_electronics=[0,1]} =&gt; {bought_clothing=[0,1]}    1      
[2]  {bought_clothing=[0,1]}    =&gt; {bought_electronics=[0,1]} 1      
[3]  {bought_electronics=[0,1]} =&gt; {bought_books=[0,1]}       1      
[4]  {bought_books=[0,1]}       =&gt; {bought_electronics=[0,1]} 1      
[5]  {bought_electronics=[0,1]} =&gt; {bought_home=[0,1]}        1      
[6]  {bought_home=[0,1]}        =&gt; {bought_electronics=[0,1]} 1      
[7]  {bought_electronics=[0,1]} =&gt; {bought_sports=[0,1]}      1      
[8]  {bought_sports=[0,1]}      =&gt; {bought_electronics=[0,1]} 1      
[9]  {bought_clothing=[0,1]}    =&gt; {bought_books=[0,1]}       1      
[10] {bought_books=[0,1]}       =&gt; {bought_clothing=[0,1]}    1      
     confidence coverage lift count
[1]  1          1        1    1000 
[2]  1          1        1    1000 
[3]  1          1        1    1000 
[4]  1          1        1    1000 
[5]  1          1        1    1000 
[6]  1          1        1    1000 
[7]  1          1        1    1000 
[8]  1          1        1    1000 
[9]  1          1        1    1000 
[10] 1          1        1    1000 </code></pre>
</div>
</div>
<p>关联规则可视化</p>
<div class="cell">
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1"></a><span class="fu">library</span>(arulesViz)</span>
<span id="cb42-2"><a href="#cb42-2"></a></span>
<span id="cb42-3"><a href="#cb42-3"></a><span class="cf">if</span>(<span class="fu">length</span>(rules) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb42-4"><a href="#cb42-4"></a>  <span class="co"># 选择前20条规则进行可视化</span></span>
<span id="cb42-5"><a href="#cb42-5"></a>  rules_for_plot <span class="ot">&lt;-</span> <span class="fu">head</span>(<span class="fu">sort</span>(rules, <span class="at">by =</span> <span class="st">"lift"</span>), <span class="fu">min</span>(<span class="dv">20</span>, <span class="fu">length</span>(rules)))</span>
<span id="cb42-6"><a href="#cb42-6"></a>  </span>
<span id="cb42-7"><a href="#cb42-7"></a>  <span class="co"># 散点图</span></span>
<span id="cb42-8"><a href="#cb42-8"></a>  plot1 <span class="ot">&lt;-</span> <span class="fu">plot</span>(rules_for_plot, <span class="at">method =</span> <span class="st">"scatter"</span>, </span>
<span id="cb42-9"><a href="#cb42-9"></a>               <span class="at">main =</span> <span class="st">"关联规则散点图 (支持度 vs 置信度)"</span>)</span>
<span id="cb42-10"><a href="#cb42-10"></a>  </span>
<span id="cb42-11"><a href="#cb42-11"></a>  <span class="co"># 矩阵图</span></span>
<span id="cb42-12"><a href="#cb42-12"></a>  plot2 <span class="ot">&lt;-</span> <span class="fu">plot</span>(rules_for_plot, <span class="at">method =</span> <span class="st">"matrix"</span>, </span>
<span id="cb42-13"><a href="#cb42-13"></a>               <span class="at">main =</span> <span class="st">"关联规则矩阵图"</span>)</span>
<span id="cb42-14"><a href="#cb42-14"></a>  </span>
<span id="cb42-15"><a href="#cb42-15"></a>  <span class="co"># 分组图</span></span>
<span id="cb42-16"><a href="#cb42-16"></a>  plot3 <span class="ot">&lt;-</span> <span class="fu">plot</span>(rules_for_plot, <span class="at">method =</span> <span class="st">"grouped"</span>,</span>
<span id="cb42-17"><a href="#cb42-17"></a>               <span class="at">main =</span> <span class="st">"关联规则分组图"</span>)</span>
<span id="cb42-18"><a href="#cb42-18"></a>  </span>
<span id="cb42-19"><a href="#cb42-19"></a>  <span class="co"># 显示图形</span></span>
<span id="cb42-20"><a href="#cb42-20"></a>  plot1</span>
<span id="cb42-21"><a href="#cb42-21"></a>  plot2</span>
<span id="cb42-22"><a href="#cb42-22"></a>  plot3</span>
<span id="cb42-23"><a href="#cb42-23"></a>  </span>
<span id="cb42-24"><a href="#cb42-24"></a>} <span class="cf">else</span> {</span>
<span id="cb42-25"><a href="#cb42-25"></a>  <span class="fu">cat</span>(<span class="st">"没有足够的规则进行可视化</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb42-26"><a href="#cb42-26"></a>  </span>
<span id="cb42-27"><a href="#cb42-27"></a>  <span class="co"># 显示产品共现矩阵作为替代</span></span>
<span id="cb42-28"><a href="#cb42-28"></a>  item_matrix <span class="ot">&lt;-</span> <span class="fu">crossTable</span>(transactions)</span>
<span id="cb42-29"><a href="#cb42-29"></a>  <span class="fu">corrplot</span>(item_matrix, <span class="at">method =</span> <span class="st">"color"</span>, </span>
<span id="cb42-30"><a href="#cb42-30"></a>           <span class="at">title =</span> <span class="st">"产品共现热图"</span>,</span>
<span id="cb42-31"><a href="#cb42-31"></a>           <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">0</span>))</span>
<span id="cb42-32"><a href="#cb42-32"></a>}</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Itemsets in Antecedent (LHS)
[1] "{bought_electronics=[0,1]}" "{bought_clothing=[0,1]}"   
[3] "{bought_books=[0,1]}"       "{bought_home=[0,1]}"       
[5] "{bought_sports=[0,1]}"     
Itemsets in Consequent (RHS)
[1] "{bought_sports=[0,1]}"      "{bought_home=[0,1]}"       
[3] "{bought_books=[0,1]}"       "{bought_electronics=[0,1]}"
[5] "{bought_clothing=[0,1]}"   </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Available control parameters (with default values):
k    =  20
aggr.fun     =  function (x, ...)  UseMethod("mean")
rhs_max  =  10
lhs_label_items  =  2
col  =  c("#EE0000FF", "#EEEEEEFF")
groups   =  NULL
engine   =  ggplot2
verbose  =  FALSE</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="15-案例综合分析_files/figure-html/r-association-viz-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section></section><section id="python实现" class="level2"><h2 class="anchored" data-anchor-id="python实现">15.2 Python实现</h2>
<p>数据准备</p>
<div class="cell">
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb45-2"><a href="#cb45-2"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb45-3"><a href="#cb45-3"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb45-4"><a href="#cb45-4"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb45-5"><a href="#cb45-5"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb45-6"><a href="#cb45-6"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb45-7"><a href="#cb45-7"></a><span class="im">import</span> warnings</span>
<span id="cb45-8"><a href="#cb45-8"></a>warnings.filterwarnings(<span class="st">'ignore'</span>)</span>
<span id="cb45-9"><a href="#cb45-9"></a></span>
<span id="cb45-10"><a href="#cb45-10"></a><span class="co"># 设置中文字体</span></span>
<span id="cb45-11"><a href="#cb45-11"></a>plt.rcParams[<span class="st">'font.sans-serif'</span>] <span class="op">=</span> [<span class="st">'SimHei'</span>]</span>
<span id="cb45-12"><a href="#cb45-12"></a>plt.rcParams[<span class="st">'axes.unicode_minus'</span>] <span class="op">=</span> <span class="va">False</span></span>
<span id="cb45-13"><a href="#cb45-13"></a></span>
<span id="cb45-14"><a href="#cb45-14"></a><span class="co"># 生成相同的模拟数据</span></span>
<span id="cb45-15"><a href="#cb45-15"></a>np.random.seed(<span class="dv">123</span>)</span>
<span id="cb45-16"><a href="#cb45-16"></a>n <span class="op">=</span> <span class="dv">1000</span></span>
<span id="cb45-17"><a href="#cb45-17"></a></span>
<span id="cb45-18"><a href="#cb45-18"></a>python_user_data <span class="op">=</span> pd.DataFrame({</span>
<span id="cb45-19"><a href="#cb45-19"></a>    <span class="st">'user_id'</span>: <span class="bu">range</span>(<span class="dv">1</span>, n<span class="op">+</span><span class="dv">1</span>),</span>
<span id="cb45-20"><a href="#cb45-20"></a>    <span class="st">'age'</span>: np.random.randint(<span class="dv">18</span>, <span class="dv">66</span>, n),</span>
<span id="cb45-21"><a href="#cb45-21"></a>    <span class="st">'gender'</span>: np.random.choice([<span class="st">'Male'</span>, <span class="st">'Female'</span>], n, p<span class="op">=</span>[<span class="fl">0.48</span>, <span class="fl">0.52</span>]),</span>
<span id="cb45-22"><a href="#cb45-22"></a>    <span class="st">'income'</span>: np.random.normal(<span class="dv">50000</span>, <span class="dv">15000</span>, n).<span class="bu">round</span>(),</span>
<span id="cb45-23"><a href="#cb45-23"></a>    <span class="st">'region'</span>: np.random.choice([<span class="st">'North'</span>, <span class="st">'South'</span>, <span class="st">'East'</span>, <span class="st">'West'</span>], n),</span>
<span id="cb45-24"><a href="#cb45-24"></a>    <span class="st">'days_since_signup'</span>: np.random.randint(<span class="dv">1</span>, <span class="dv">366</span>, n),</span>
<span id="cb45-25"><a href="#cb45-25"></a>    <span class="st">'page_views'</span>: np.random.poisson(<span class="dv">25</span>, n),</span>
<span id="cb45-26"><a href="#cb45-26"></a>    <span class="st">'time_on_site'</span>: np.random.normal(<span class="dv">300</span>, <span class="dv">120</span>, n).<span class="bu">round</span>(),</span>
<span id="cb45-27"><a href="#cb45-27"></a>    <span class="st">'cart_additions'</span>: np.random.poisson(<span class="dv">5</span>, n)</span>
<span id="cb45-28"><a href="#cb45-28"></a>})</span>
<span id="cb45-29"><a href="#cb45-29"></a></span>
<span id="cb45-30"><a href="#cb45-30"></a><span class="co"># 生成购买行为</span></span>
<span id="cb45-31"><a href="#cb45-31"></a>python_user_data[<span class="st">'purchase_amount'</span>] <span class="op">=</span> (</span>
<span id="cb45-32"><a href="#cb45-32"></a>    <span class="dv">50</span> <span class="op">+</span> <span class="fl">0.3</span> <span class="op">*</span> python_user_data[<span class="st">'income'</span>]<span class="op">/</span><span class="dv">1000</span> <span class="op">+</span> </span>
<span id="cb45-33"><a href="#cb45-33"></a>    <span class="fl">0.5</span> <span class="op">*</span> python_user_data[<span class="st">'page_views'</span>] <span class="op">+</span> </span>
<span id="cb45-34"><a href="#cb45-34"></a>    <span class="fl">0.8</span> <span class="op">*</span> python_user_data[<span class="st">'time_on_site'</span>]<span class="op">/</span><span class="dv">60</span> <span class="op">+</span> </span>
<span id="cb45-35"><a href="#cb45-35"></a>    <span class="dv">2</span> <span class="op">*</span> python_user_data[<span class="st">'cart_additions'</span>] <span class="op">+</span> </span>
<span id="cb45-36"><a href="#cb45-36"></a>    np.random.normal(<span class="dv">0</span>, <span class="dv">20</span>, n)</span>
<span id="cb45-37"><a href="#cb45-37"></a>)</span>
<span id="cb45-38"><a href="#cb45-38"></a></span>
<span id="cb45-39"><a href="#cb45-39"></a>python_user_data[<span class="st">'made_purchase'</span>] <span class="op">=</span> (python_user_data[<span class="st">'purchase_amount'</span>] <span class="op">&gt;</span> <span class="dv">120</span>).astype(<span class="bu">int</span>)</span>
<span id="cb45-40"><a href="#cb45-40"></a></span>
<span id="cb45-41"><a href="#cb45-41"></a><span class="co"># 添加产品类别 - 创建相关性</span></span>
<span id="cb45-42"><a href="#cb45-42"></a>products <span class="op">=</span> [<span class="st">'electronics'</span>, <span class="st">'clothing'</span>, <span class="st">'books'</span>, <span class="st">'home'</span>, <span class="st">'sports'</span>]</span>
<span id="cb45-43"><a href="#cb45-43"></a>base_prob <span class="op">=</span> <span class="fl">0.4</span></span>
<span id="cb45-44"><a href="#cb45-44"></a></span>
<span id="cb45-45"><a href="#cb45-45"></a>python_user_data[<span class="st">'bought_electronics'</span>] <span class="op">=</span> np.random.binomial(<span class="dv">1</span>, base_prob, n)</span>
<span id="cb45-46"><a href="#cb45-46"></a></span>
<span id="cb45-47"><a href="#cb45-47"></a><span class="co"># 创建相关产品</span></span>
<span id="cb45-48"><a href="#cb45-48"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="bu">len</span>(products)):</span>
<span id="cb45-49"><a href="#cb45-49"></a>    prev_product <span class="op">=</span> <span class="ss">f'bought_</span><span class="sc">{</span>products[i<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss">'</span></span>
<span id="cb45-50"><a href="#cb45-50"></a>    current_product <span class="op">=</span> <span class="ss">f'bought_</span><span class="sc">{</span>products[i]<span class="sc">}</span><span class="ss">'</span></span>
<span id="cb45-51"><a href="#cb45-51"></a>    correlated_prob <span class="op">=</span> python_user_data[prev_product] <span class="op">*</span> <span class="fl">0.3</span> <span class="op">+</span> base_prob</span>
<span id="cb45-52"><a href="#cb45-52"></a>    python_user_data[current_product] <span class="op">=</span> np.random.binomial(<span class="dv">1</span>, np.minimum(correlated_prob, <span class="fl">0.8</span>), n)</span>
<span id="cb45-53"><a href="#cb45-53"></a></span>
<span id="cb45-54"><a href="#cb45-54"></a><span class="bu">print</span>(<span class="st">"Python数据概览:"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Python数据概览:</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1"></a><span class="bu">print</span>(python_user_data.head())</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>   user_id  age  gender  ...  bought_books bought_home  bought_sports
0        1   63    Male  ...             0           0              1
1        2   20  Female  ...             1           1              1
2        3   46  Female  ...             1           1              1
3        4   52  Female  ...             1           1              0
4        5   56  Female  ...             1           1              1

[5 rows x 16 columns]</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb49"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">数据形状: </span><span class="sc">{</span>python_user_data<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>
数据形状: (1000, 16)</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb51"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1"></a><span class="co"># 产品购买频率</span></span>
<span id="cb51-2"><a href="#cb51-2"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">产品购买频率:"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>
产品购买频率:</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb53"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1"></a><span class="cf">for</span> product <span class="kw">in</span> products:</span>
<span id="cb53-2"><a href="#cb53-2"></a>    col_name <span class="op">=</span> <span class="ss">f'bought_</span><span class="sc">{</span>product<span class="sc">}</span><span class="ss">'</span></span>
<span id="cb53-3"><a href="#cb53-3"></a>    freq <span class="op">=</span> python_user_data[col_name].mean()</span>
<span id="cb53-4"><a href="#cb53-4"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>product<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>freq<span class="sc">:.3f}</span><span class="ss">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>electronics: 0.411
clothing: 0.522
books: 0.553
home: 0.554
sports: 0.565</code></pre>
</div>
</div>
<section id="python回归分析" class="level3"><h3 class="anchored" data-anchor-id="python回归分析">15.2.2 Python回归分析</h3>
<div class="cell">
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb55"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LinearRegression</span>
<span id="cb55-2"><a href="#cb55-2"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestRegressor</span>
<span id="cb55-3"><a href="#cb55-3"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error, r2_score, mean_absolute_error</span>
<span id="cb55-4"><a href="#cb55-4"></a></span>
<span id="cb55-5"><a href="#cb55-5"></a><span class="co"># 准备回归数据</span></span>
<span id="cb55-6"><a href="#cb55-6"></a>reg_features <span class="op">=</span> [<span class="st">'age'</span>, <span class="st">'income'</span>, <span class="st">'page_views'</span>, <span class="st">'time_on_site'</span>, <span class="st">'cart_additions'</span>]</span>
<span id="cb55-7"><a href="#cb55-7"></a>X_reg <span class="op">=</span> python_user_data[reg_features]</span>
<span id="cb55-8"><a href="#cb55-8"></a>y_reg <span class="op">=</span> python_user_data[<span class="st">'purchase_amount'</span>]</span>
<span id="cb55-9"><a href="#cb55-9"></a></span>
<span id="cb55-10"><a href="#cb55-10"></a><span class="co"># 数据分割</span></span>
<span id="cb55-11"><a href="#cb55-11"></a>X_train_reg, X_test_reg, y_train_reg, y_test_reg <span class="op">=</span> train_test_split(</span>
<span id="cb55-12"><a href="#cb55-12"></a>    X_reg, y_reg, test_size<span class="op">=</span><span class="fl">0.3</span>, random_state<span class="op">=</span><span class="dv">123</span>)</span>
<span id="cb55-13"><a href="#cb55-13"></a></span>
<span id="cb55-14"><a href="#cb55-14"></a><span class="co"># 线性回归</span></span>
<span id="cb55-15"><a href="#cb55-15"></a>lr_model <span class="op">=</span> LinearRegression()</span>
<span id="cb55-16"><a href="#cb55-16"></a>lr_model.fit(X_train_reg, y_train_reg)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<style>#sk-container-id-1 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: #000;
  --sklearn-color-text-muted: #666;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-1 {
  color: var(--sklearn-color-text);
}

#sk-container-id-1 pre {
  padding: 0;
}

#sk-container-id-1 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-1 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-1 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-1 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-1 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-1 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-1 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-1 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-1 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-1 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-1 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-1 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-1 label.sk-toggleable__label {
  cursor: pointer;
  display: flex;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
  align-items: start;
  justify-content: space-between;
  gap: 0.5em;
}

#sk-container-id-1 label.sk-toggleable__label .caption {
  font-size: 0.6rem;
  font-weight: lighter;
  color: var(--sklearn-color-text-muted);
}

#sk-container-id-1 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-1 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-1 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-1 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-1 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-1 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-1 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-1 div.sk-label label.sk-toggleable__label,
#sk-container-id-1 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-1 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-1 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-1 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-1 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-1 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-1 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 0.5em;
  text-align: center;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-1 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-1 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-1 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-1 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style>
<div id="sk-container-id-1" class="sk-top-container">
<div class="sk-text-repr-fallback">
<pre>LinearRegression()</pre>
<b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b>
</div>
<div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator fitted sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-1" type="checkbox" checked=""><label for="sk-estimator-id-1" class="sk-toggleable__label fitted sk-toggleable__label-arrow"><div><div>LinearRegression</div></div>
<div>
<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.6/modules/generated/sklearn.linear_model.LinearRegression.html">?<span>Documentation for LinearRegression</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span>
</div></label><div class="sk-toggleable__content fitted"><pre>LinearRegression()</pre></div> </div></div></div>
</div>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb56"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1"></a>y_pred_lr <span class="op">=</span> lr_model.predict(X_test_reg)</span>
<span id="cb56-2"><a href="#cb56-2"></a></span>
<span id="cb56-3"><a href="#cb56-3"></a><span class="co"># 随机森林回归</span></span>
<span id="cb56-4"><a href="#cb56-4"></a>rf_reg_model <span class="op">=</span> RandomForestRegressor(n_estimators<span class="op">=</span><span class="dv">100</span>, random_state<span class="op">=</span><span class="dv">123</span>)</span>
<span id="cb56-5"><a href="#cb56-5"></a>rf_reg_model.fit(X_train_reg, y_train_reg)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<style>#sk-container-id-2 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: #000;
  --sklearn-color-text-muted: #666;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-2 {
  color: var(--sklearn-color-text);
}

#sk-container-id-2 pre {
  padding: 0;
}

#sk-container-id-2 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-2 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-2 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-2 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-2 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-2 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-2 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-2 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-2 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-2 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-2 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-2 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-2 label.sk-toggleable__label {
  cursor: pointer;
  display: flex;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
  align-items: start;
  justify-content: space-between;
  gap: 0.5em;
}

#sk-container-id-2 label.sk-toggleable__label .caption {
  font-size: 0.6rem;
  font-weight: lighter;
  color: var(--sklearn-color-text-muted);
}

#sk-container-id-2 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-2 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-2 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-2 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-2 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-2 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-2 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-2 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-2 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-2 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-2 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-2 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-2 div.sk-label label.sk-toggleable__label,
#sk-container-id-2 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-2 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-2 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-2 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-2 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-2 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-2 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-2 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-2 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 0.5em;
  text-align: center;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-2 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-2 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-2 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-2 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style>
<div id="sk-container-id-2" class="sk-top-container">
<div class="sk-text-repr-fallback">
<pre>RandomForestRegressor(random_state=123)</pre>
<b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b>
</div>
<div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator fitted sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-2" type="checkbox" checked=""><label for="sk-estimator-id-2" class="sk-toggleable__label fitted sk-toggleable__label-arrow"><div><div>RandomForestRegressor</div></div>
<div>
<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.6/modules/generated/sklearn.ensemble.RandomForestRegressor.html">?<span>Documentation for RandomForestRegressor</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span>
</div></label><div class="sk-toggleable__content fitted"><pre>RandomForestRegressor(random_state=123)</pre></div> </div></div></div>
</div>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb57"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1"></a>y_pred_rf <span class="op">=</span> rf_reg_model.predict(X_test_reg)</span>
<span id="cb57-2"><a href="#cb57-2"></a></span>
<span id="cb57-3"><a href="#cb57-3"></a><span class="co"># 模型评估</span></span>
<span id="cb57-4"><a href="#cb57-4"></a><span class="kw">def</span> evaluate_regression(y_true, y_pred, model_name):</span>
<span id="cb57-5"><a href="#cb57-5"></a>    mse <span class="op">=</span> mean_squared_error(y_true, y_pred)</span>
<span id="cb57-6"><a href="#cb57-6"></a>    mae <span class="op">=</span> mean_absolute_error(y_true, y_pred)</span>
<span id="cb57-7"><a href="#cb57-7"></a>    r2 <span class="op">=</span> r2_score(y_true, y_pred)</span>
<span id="cb57-8"><a href="#cb57-8"></a>    </span>
<span id="cb57-9"><a href="#cb57-9"></a>    results <span class="op">=</span> {</span>
<span id="cb57-10"><a href="#cb57-10"></a>        <span class="st">'Model'</span>: model_name,</span>
<span id="cb57-11"><a href="#cb57-11"></a>        <span class="st">'RMSE'</span>: np.sqrt(mse),</span>
<span id="cb57-12"><a href="#cb57-12"></a>        <span class="st">'MAE'</span>: mae,</span>
<span id="cb57-13"><a href="#cb57-13"></a>        <span class="st">'R2'</span>: r2</span>
<span id="cb57-14"><a href="#cb57-14"></a>    }</span>
<span id="cb57-15"><a href="#cb57-15"></a>    <span class="cf">return</span> results</span>
<span id="cb57-16"><a href="#cb57-16"></a></span>
<span id="cb57-17"><a href="#cb57-17"></a>lr_metrics <span class="op">=</span> evaluate_regression(y_test_reg, y_pred_lr, <span class="st">'Linear Regression'</span>)</span>
<span id="cb57-18"><a href="#cb57-18"></a>rf_metrics <span class="op">=</span> evaluate_regression(y_test_reg, y_pred_rf, <span class="st">'Random Forest'</span>)</span>
<span id="cb57-19"><a href="#cb57-19"></a></span>
<span id="cb57-20"><a href="#cb57-20"></a>regression_results <span class="op">=</span> pd.DataFrame([lr_metrics, rf_metrics])</span>
<span id="cb57-21"><a href="#cb57-21"></a><span class="bu">print</span>(<span class="st">"回归模型性能比较:"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>回归模型性能比较:</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb59"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1"></a><span class="bu">print</span>(regression_results)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>               Model       RMSE        MAE        R2
0  Linear Regression  19.572048  15.711942  0.040879
1      Random Forest  20.593340  16.873056 -0.061829</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb61"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1"></a><span class="co"># 可视化回归结果</span></span>
<span id="cb61-2"><a href="#cb61-2"></a>fig, (ax1, ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">5</span>))</span>
<span id="cb61-3"><a href="#cb61-3"></a></span>
<span id="cb61-4"><a href="#cb61-4"></a><span class="co"># 线性回归结果</span></span>
<span id="cb61-5"><a href="#cb61-5"></a>ax1.scatter(y_test_reg, y_pred_lr, alpha<span class="op">=</span><span class="fl">0.6</span>)</span>
<span id="cb61-6"><a href="#cb61-6"></a>ax1.plot([y_test_reg.<span class="bu">min</span>(), y_test_reg.<span class="bu">max</span>()], [y_test_reg.<span class="bu">min</span>(), y_test_reg.<span class="bu">max</span>()], <span class="st">'r--'</span>, lw<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb61-7"><a href="#cb61-7"></a>ax1.set_xlabel(<span class="st">'实际值'</span>)</span>
<span id="cb61-8"><a href="#cb61-8"></a>ax1.set_ylabel(<span class="st">'预测值'</span>)</span>
<span id="cb61-9"><a href="#cb61-9"></a>ax1.set_title(<span class="ss">f'线性回归 (R² = </span><span class="sc">{</span>lr_metrics[<span class="st">"R2"</span>]<span class="sc">:.3f}</span><span class="ss">)'</span>)</span>
<span id="cb61-10"><a href="#cb61-10"></a></span>
<span id="cb61-11"><a href="#cb61-11"></a><span class="co"># 随机森林结果</span></span>
<span id="cb61-12"><a href="#cb61-12"></a>ax2.scatter(y_test_reg, y_pred_rf, alpha<span class="op">=</span><span class="fl">0.6</span>)</span>
<span id="cb61-13"><a href="#cb61-13"></a>ax2.plot([y_test_reg.<span class="bu">min</span>(), y_test_reg.<span class="bu">max</span>()], [y_test_reg.<span class="bu">min</span>(), y_test_reg.<span class="bu">max</span>()], <span class="st">'r--'</span>, lw<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb61-14"><a href="#cb61-14"></a>ax2.set_xlabel(<span class="st">'实际值'</span>)</span>
<span id="cb61-15"><a href="#cb61-15"></a>ax2.set_ylabel(<span class="st">'预测值'</span>)</span>
<span id="cb61-16"><a href="#cb61-16"></a>ax2.set_title(<span class="ss">f'随机森林回归 (R² = </span><span class="sc">{</span>rf_metrics[<span class="st">"R2"</span>]<span class="sc">:.3f}</span><span class="ss">)'</span>)</span>
<span id="cb61-17"><a href="#cb61-17"></a></span>
<span id="cb61-18"><a href="#cb61-18"></a>plt.tight_layout()</span>
<span id="cb61-19"><a href="#cb61-19"></a>plt.show()</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="15-案例综合分析_files/figure-html/python-regression-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section><section id="python分类分析" class="level3"><h3 class="anchored" data-anchor-id="python分类分析">15.2.3 Python分类分析</h3>
<div class="cell">
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb62"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LogisticRegression</span>
<span id="cb62-2"><a href="#cb62-2"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestClassifier</span>
<span id="cb62-3"><a href="#cb62-3"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> classification_report, confusion_matrix, accuracy_score, roc_auc_score, roc_curve</span>
<span id="cb62-4"><a href="#cb62-4"></a></span>
<span id="cb62-5"><a href="#cb62-5"></a><span class="co"># 准备分类数据</span></span>
<span id="cb62-6"><a href="#cb62-6"></a>class_features <span class="op">=</span> [<span class="st">'age'</span>, <span class="st">'income'</span>, <span class="st">'page_views'</span>, <span class="st">'time_on_site'</span>, <span class="st">'cart_additions'</span>]</span>
<span id="cb62-7"><a href="#cb62-7"></a>X_class <span class="op">=</span> python_user_data[class_features]</span>
<span id="cb62-8"><a href="#cb62-8"></a>y_class <span class="op">=</span> python_user_data[<span class="st">'made_purchase'</span>]</span>
<span id="cb62-9"><a href="#cb62-9"></a></span>
<span id="cb62-10"><a href="#cb62-10"></a><span class="co"># 数据分割</span></span>
<span id="cb62-11"><a href="#cb62-11"></a>X_train_class, X_test_class, y_train_class, y_test_class <span class="op">=</span> train_test_split(</span>
<span id="cb62-12"><a href="#cb62-12"></a>    X_class, y_class, test_size<span class="op">=</span><span class="fl">0.3</span>, random_state<span class="op">=</span><span class="dv">123</span>, stratify<span class="op">=</span>y_class)</span>
<span id="cb62-13"><a href="#cb62-13"></a></span>
<span id="cb62-14"><a href="#cb62-14"></a><span class="co"># 逻辑回归</span></span>
<span id="cb62-15"><a href="#cb62-15"></a>logit_model <span class="op">=</span> LogisticRegression(random_state<span class="op">=</span><span class="dv">123</span>)</span>
<span id="cb62-16"><a href="#cb62-16"></a>logit_model.fit(X_train_class, y_train_class)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<style>#sk-container-id-3 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: #000;
  --sklearn-color-text-muted: #666;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-3 {
  color: var(--sklearn-color-text);
}

#sk-container-id-3 pre {
  padding: 0;
}

#sk-container-id-3 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-3 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-3 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-3 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-3 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-3 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-3 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-3 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-3 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-3 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-3 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-3 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-3 label.sk-toggleable__label {
  cursor: pointer;
  display: flex;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
  align-items: start;
  justify-content: space-between;
  gap: 0.5em;
}

#sk-container-id-3 label.sk-toggleable__label .caption {
  font-size: 0.6rem;
  font-weight: lighter;
  color: var(--sklearn-color-text-muted);
}

#sk-container-id-3 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-3 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-3 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-3 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-3 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-3 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-3 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-3 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-3 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-3 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-3 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-3 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-3 div.sk-label label.sk-toggleable__label,
#sk-container-id-3 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-3 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-3 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-3 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-3 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-3 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-3 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-3 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-3 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 0.5em;
  text-align: center;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-3 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-3 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-3 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-3 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style>
<div id="sk-container-id-3" class="sk-top-container">
<div class="sk-text-repr-fallback">
<pre>LogisticRegression(random_state=123)</pre>
<b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b>
</div>
<div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator fitted sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-3" type="checkbox" checked=""><label for="sk-estimator-id-3" class="sk-toggleable__label fitted sk-toggleable__label-arrow"><div><div>LogisticRegression</div></div>
<div>
<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.6/modules/generated/sklearn.linear_model.LogisticRegression.html">?<span>Documentation for LogisticRegression</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span>
</div></label><div class="sk-toggleable__content fitted"><pre>LogisticRegression(random_state=123)</pre></div> </div></div></div>
</div>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb63"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1"></a>y_pred_logit <span class="op">=</span> logit_model.predict(X_test_class)</span>
<span id="cb63-2"><a href="#cb63-2"></a>y_pred_logit_proba <span class="op">=</span> logit_model.predict_proba(X_test_class)[:, <span class="dv">1</span>]</span>
<span id="cb63-3"><a href="#cb63-3"></a></span>
<span id="cb63-4"><a href="#cb63-4"></a><span class="co"># 随机森林分类</span></span>
<span id="cb63-5"><a href="#cb63-5"></a>rf_class_model <span class="op">=</span> RandomForestClassifier(n_estimators<span class="op">=</span><span class="dv">100</span>, random_state<span class="op">=</span><span class="dv">123</span>)</span>
<span id="cb63-6"><a href="#cb63-6"></a>rf_class_model.fit(X_train_class, y_train_class)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<style>#sk-container-id-4 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: #000;
  --sklearn-color-text-muted: #666;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-4 {
  color: var(--sklearn-color-text);
}

#sk-container-id-4 pre {
  padding: 0;
}

#sk-container-id-4 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-4 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-4 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-4 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-4 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-4 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-4 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-4 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-4 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-4 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-4 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-4 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-4 label.sk-toggleable__label {
  cursor: pointer;
  display: flex;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
  align-items: start;
  justify-content: space-between;
  gap: 0.5em;
}

#sk-container-id-4 label.sk-toggleable__label .caption {
  font-size: 0.6rem;
  font-weight: lighter;
  color: var(--sklearn-color-text-muted);
}

#sk-container-id-4 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-4 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-4 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-4 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-4 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-4 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-4 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-4 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-4 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-4 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-4 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-4 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-4 div.sk-label label.sk-toggleable__label,
#sk-container-id-4 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-4 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-4 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-4 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-4 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-4 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-4 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-4 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-4 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 0.5em;
  text-align: center;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-4 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-4 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-4 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-4 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style>
<div id="sk-container-id-4" class="sk-top-container">
<div class="sk-text-repr-fallback">
<pre>RandomForestClassifier(random_state=123)</pre>
<b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b>
</div>
<div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator fitted sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-4" type="checkbox" checked=""><label for="sk-estimator-id-4" class="sk-toggleable__label fitted sk-toggleable__label-arrow"><div><div>RandomForestClassifier</div></div>
<div>
<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.6/modules/generated/sklearn.ensemble.RandomForestClassifier.html">?<span>Documentation for RandomForestClassifier</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span>
</div></label><div class="sk-toggleable__content fitted"><pre>RandomForestClassifier(random_state=123)</pre></div> </div></div></div>
</div>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb64"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1"></a>y_pred_rf_class <span class="op">=</span> rf_class_model.predict(X_test_class)</span>
<span id="cb64-2"><a href="#cb64-2"></a>y_pred_rf_proba <span class="op">=</span> rf_class_model.predict_proba(X_test_class)[:, <span class="dv">1</span>]</span>
<span id="cb64-3"><a href="#cb64-3"></a></span>
<span id="cb64-4"><a href="#cb64-4"></a><span class="co"># 模型评估</span></span>
<span id="cb64-5"><a href="#cb64-5"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">50</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>==================================================</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb66"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1"></a><span class="bu">print</span>(<span class="st">"逻辑回归性能:"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>逻辑回归性能:</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb68"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">50</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>==================================================</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb70"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1"></a><span class="bu">print</span>(classification_report(y_test_class, y_pred_logit))</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>              precision    recall  f1-score   support

           0       0.90      1.00      0.95       271
           1       0.00      0.00      0.00        29

    accuracy                           0.90       300
   macro avg       0.45      0.50      0.47       300
weighted avg       0.82      0.90      0.86       300</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb72"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1"></a>logit_accuracy <span class="op">=</span> accuracy_score(y_test_class, y_pred_logit)</span>
<span id="cb72-2"><a href="#cb72-2"></a>logit_auc <span class="op">=</span> roc_auc_score(y_test_class, y_pred_logit_proba)</span>
<span id="cb72-3"><a href="#cb72-3"></a><span class="bu">print</span>(<span class="ss">f"准确率: </span><span class="sc">{</span>logit_accuracy<span class="sc">:.3f}</span><span class="ss">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>准确率: 0.903</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb74"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1"></a><span class="bu">print</span>(<span class="ss">f"AUC: </span><span class="sc">{</span>logit_auc<span class="sc">:.3f}</span><span class="ss">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>AUC: 0.461</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb76"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"="</span> <span class="op">*</span> <span class="dv">50</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>
==================================================</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb78"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1"></a><span class="bu">print</span>(<span class="st">"随机森林性能:"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>随机森林性能:</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb80"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">50</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>==================================================</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb82"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1"></a><span class="bu">print</span>(classification_report(y_test_class, y_pred_rf_class))</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>              precision    recall  f1-score   support

           0       0.90      1.00      0.95       271
           1       0.00      0.00      0.00        29

    accuracy                           0.90       300
   macro avg       0.45      0.50      0.47       300
weighted avg       0.82      0.90      0.86       300</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb84"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1"></a>rf_accuracy <span class="op">=</span> accuracy_score(y_test_class, y_pred_rf_class)</span>
<span id="cb84-2"><a href="#cb84-2"></a>rf_auc <span class="op">=</span> roc_auc_score(y_test_class, y_pred_rf_proba)</span>
<span id="cb84-3"><a href="#cb84-3"></a><span class="bu">print</span>(<span class="ss">f"准确率: </span><span class="sc">{</span>rf_accuracy<span class="sc">:.3f}</span><span class="ss">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>准确率: 0.903</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb86"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1"></a><span class="bu">print</span>(<span class="ss">f"AUC: </span><span class="sc">{</span>rf_auc<span class="sc">:.3f}</span><span class="ss">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>AUC: 0.557</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb88"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1"></a><span class="co"># 特征重要性</span></span>
<span id="cb88-2"><a href="#cb88-2"></a>feature_importance <span class="op">=</span> pd.DataFrame({</span>
<span id="cb88-3"><a href="#cb88-3"></a>    <span class="st">'feature'</span>: class_features,</span>
<span id="cb88-4"><a href="#cb88-4"></a>    <span class="st">'importance'</span>: rf_class_model.feature_importances_</span>
<span id="cb88-5"><a href="#cb88-5"></a>}).sort_values(<span class="st">'importance'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb88-6"><a href="#cb88-6"></a></span>
<span id="cb88-7"><a href="#cb88-7"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">随机森林特征重要性:"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>
随机森林特征重要性:</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb90"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1"></a><span class="bu">print</span>(feature_importance)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>          feature  importance
3    time_on_site    0.273365
1          income    0.270106
0             age    0.189313
2      page_views    0.160267
4  cart_additions    0.106949</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb92"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1"></a><span class="co"># ROC曲线比较</span></span>
<span id="cb92-2"><a href="#cb92-2"></a>fig, (ax1, ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">5</span>))</span>
<span id="cb92-3"><a href="#cb92-3"></a></span>
<span id="cb92-4"><a href="#cb92-4"></a><span class="co"># 逻辑回归ROC</span></span>
<span id="cb92-5"><a href="#cb92-5"></a>fpr_lr, tpr_lr, _ <span class="op">=</span> roc_curve(y_test_class, y_pred_logit_proba)</span>
<span id="cb92-6"><a href="#cb92-6"></a>ax1.plot(fpr_lr, tpr_lr, label<span class="op">=</span><span class="ss">f'Logistic Regression (AUC = </span><span class="sc">{</span>logit_auc<span class="sc">:.3f}</span><span class="ss">)'</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[&lt;matplotlib.lines.Line2D object at 0x0000017F8204EC10&gt;]</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb94"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1"></a>ax1.plot([<span class="dv">0</span>, <span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>], <span class="st">'k--'</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[&lt;matplotlib.lines.Line2D object at 0x0000017F8204ED50&gt;]</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb96"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1"></a>ax1.set_xlabel(<span class="st">'False Positive Rate'</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Text(0.5, 0, 'False Positive Rate')</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb98"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1"></a>ax1.set_ylabel(<span class="st">'True Positive Rate'</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Text(0, 0.5, 'True Positive Rate')</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb100"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1"></a>ax1.set_title(<span class="st">'逻辑回归ROC曲线'</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Text(0.5, 1.0, '逻辑回归ROC曲线')</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb102"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1"></a>ax1.legend()</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>&lt;matplotlib.legend.Legend object at 0x0000017F80791A90&gt;</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb104"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1"></a>ax1.grid(<span class="va">True</span>)</span>
<span id="cb104-2"><a href="#cb104-2"></a></span>
<span id="cb104-3"><a href="#cb104-3"></a><span class="co"># 随机森林ROC</span></span>
<span id="cb104-4"><a href="#cb104-4"></a>fpr_rf, tpr_rf, _ <span class="op">=</span> roc_curve(y_test_class, y_pred_rf_proba)</span>
<span id="cb104-5"><a href="#cb104-5"></a>ax2.plot(fpr_rf, tpr_rf, label<span class="op">=</span><span class="ss">f'Random Forest (AUC = </span><span class="sc">{</span>rf_auc<span class="sc">:.3f}</span><span class="ss">)'</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[&lt;matplotlib.lines.Line2D object at 0x0000017F8204F890&gt;]</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb106"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1"></a>ax2.plot([<span class="dv">0</span>, <span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>], <span class="st">'k--'</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[&lt;matplotlib.lines.Line2D object at 0x0000017F8204F9D0&gt;]</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb108"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb108-1"><a href="#cb108-1"></a>ax2.set_xlabel(<span class="st">'False Positive Rate'</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Text(0.5, 0, 'False Positive Rate')</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb110"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb110-1"><a href="#cb110-1"></a>ax2.set_ylabel(<span class="st">'True Positive Rate'</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Text(0, 0.5, 'True Positive Rate')</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb112"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb112-1"><a href="#cb112-1"></a>ax2.set_title(<span class="st">'随机森林ROC曲线'</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Text(0.5, 1.0, '随机森林ROC曲线')</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb114"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb114-1"><a href="#cb114-1"></a>ax2.legend()</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>&lt;matplotlib.legend.Legend object at 0x0000017F8204FB10&gt;</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb116"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb116-1"><a href="#cb116-1"></a>ax2.grid(<span class="va">True</span>)</span>
<span id="cb116-2"><a href="#cb116-2"></a></span>
<span id="cb116-3"><a href="#cb116-3"></a>plt.tight_layout()</span>
<span id="cb116-4"><a href="#cb116-4"></a>plt.show()</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="15-案例综合分析_files/figure-html/python-classification-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb117"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb117-1"><a href="#cb117-1"></a><span class="co"># 模型比较</span></span>
<span id="cb117-2"><a href="#cb117-2"></a>comparison_df <span class="op">=</span> pd.DataFrame({</span>
<span id="cb117-3"><a href="#cb117-3"></a>    <span class="st">'Model'</span>: [<span class="st">'Logistic Regression'</span>, <span class="st">'Random Forest'</span>],</span>
<span id="cb117-4"><a href="#cb117-4"></a>    <span class="st">'Accuracy'</span>: [logit_accuracy, rf_accuracy],</span>
<span id="cb117-5"><a href="#cb117-5"></a>    <span class="st">'AUC'</span>: [logit_auc, rf_auc]</span>
<span id="cb117-6"><a href="#cb117-6"></a>})</span>
<span id="cb117-7"><a href="#cb117-7"></a></span>
<span id="cb117-8"><a href="#cb117-8"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">模型性能比较:"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>
模型性能比较:</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb119"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb119-1"><a href="#cb119-1"></a><span class="bu">print</span>(comparison_df)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>                 Model  Accuracy       AUC
0  Logistic Regression  0.903333  0.461000
1        Random Forest  0.903333  0.557196</code></pre>
</div>
</div>
</section><section id="python聚类分析" class="level3"><h3 class="anchored" data-anchor-id="python聚类分析">15.2.4 Python聚类分析</h3>
<div class="cell">
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb121"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb121-1"><a href="#cb121-1"></a><span class="im">from</span> sklearn.cluster <span class="im">import</span> KMeans</span>
<span id="cb121-2"><a href="#cb121-2"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb121-3"><a href="#cb121-3"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> silhouette_score</span>
<span id="cb121-4"><a href="#cb121-4"></a></span>
<span id="cb121-5"><a href="#cb121-5"></a><span class="co"># 准备聚类数据</span></span>
<span id="cb121-6"><a href="#cb121-6"></a>cluster_features <span class="op">=</span> [<span class="st">'age'</span>, <span class="st">'income'</span>, <span class="st">'page_views'</span>, <span class="st">'time_on_site'</span>, <span class="st">'cart_additions'</span>]</span>
<span id="cb121-7"><a href="#cb121-7"></a>X_cluster <span class="op">=</span> python_user_data[cluster_features]</span>
<span id="cb121-8"><a href="#cb121-8"></a></span>
<span id="cb121-9"><a href="#cb121-9"></a><span class="co"># 数据标准化</span></span>
<span id="cb121-10"><a href="#cb121-10"></a>scaler <span class="op">=</span> StandardScaler()</span>
<span id="cb121-11"><a href="#cb121-11"></a>X_cluster_scaled <span class="op">=</span> scaler.fit_transform(X_cluster)</span>
<span id="cb121-12"><a href="#cb121-12"></a></span>
<span id="cb121-13"><a href="#cb121-13"></a><span class="co"># 寻找最佳聚类数</span></span>
<span id="cb121-14"><a href="#cb121-14"></a>wcss <span class="op">=</span> []</span>
<span id="cb121-15"><a href="#cb121-15"></a>silhouette_scores <span class="op">=</span> []</span>
<span id="cb121-16"><a href="#cb121-16"></a>k_range <span class="op">=</span> <span class="bu">range</span>(<span class="dv">2</span>, <span class="dv">11</span>)</span>
<span id="cb121-17"><a href="#cb121-17"></a></span>
<span id="cb121-18"><a href="#cb121-18"></a><span class="cf">for</span> k <span class="kw">in</span> k_range:</span>
<span id="cb121-19"><a href="#cb121-19"></a>    kmeans <span class="op">=</span> KMeans(n_clusters<span class="op">=</span>k, random_state<span class="op">=</span><span class="dv">123</span>, n_init<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb121-20"><a href="#cb121-20"></a>    kmeans.fit(X_cluster_scaled)</span>
<span id="cb121-21"><a href="#cb121-21"></a>    wcss.append(kmeans.inertia_)</span>
<span id="cb121-22"><a href="#cb121-22"></a>    silhouette_scores.append(silhouette_score(X_cluster_scaled, kmeans.labels_))</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>  File "C:\Data\Anaconda\Lib\site-packages\joblib\externals\loky\backend\context.py", line 257, in _count_physical_cores
    cpu_info = subprocess.run(
        "wmic CPU Get NumberOfCores /Format:csv".split(),
        capture_output=True,
        text=True,
    )
  File "C:\Data\Anaconda\Lib\subprocess.py", line 554, in run
    with Popen(*popenargs, **kwargs) as process:
         ~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Data\Anaconda\Lib\subprocess.py", line 1039, in __init__
    self._execute_child(args, executable, preexec_fn, close_fds,
    ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
                        pass_fds, cwd, env,
                        ^^^^^^^^^^^^^^^^^^^
    ...&lt;5 lines&gt;...
                        gid, gids, uid, umask,
                        ^^^^^^^^^^^^^^^^^^^^^^
                        start_new_session, process_group)
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Data\Anaconda\Lib\subprocess.py", line 1554, in _execute_child
    hp, ht, pid, tid = _winapi.CreateProcess(executable, args,
                       ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^
                             # no special security
                             ^^^^^^^^^^^^^^^^^^^^^
    ...&lt;4 lines&gt;...
                             cwd,
                             ^^^^
                             startupinfo)
                             ^^^^^^^^^^^^
KMeans(n_clusters=2, n_init=10, random_state=123)
KMeans(n_clusters=3, n_init=10, random_state=123)
KMeans(n_clusters=4, n_init=10, random_state=123)
KMeans(n_clusters=5, n_init=10, random_state=123)
KMeans(n_clusters=6, n_init=10, random_state=123)
KMeans(n_clusters=7, n_init=10, random_state=123)
KMeans(n_init=10, random_state=123)
KMeans(n_clusters=9, n_init=10, random_state=123)
KMeans(n_clusters=10, n_init=10, random_state=123)</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb123"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb123-1"><a href="#cb123-1"></a><span class="co"># 肘部法则图</span></span>
<span id="cb123-2"><a href="#cb123-2"></a>fig, (ax1, ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">4</span>))</span>
<span id="cb123-3"><a href="#cb123-3"></a></span>
<span id="cb123-4"><a href="#cb123-4"></a>ax1.plot(k_range, wcss, <span class="st">'bo-'</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[&lt;matplotlib.lines.Line2D object at 0x0000017F8226E5D0&gt;]</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb125"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb125-1"><a href="#cb125-1"></a>ax1.set_xlabel(<span class="st">'聚类数'</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Text(0.5, 0, '聚类数')</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb127"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb127-1"><a href="#cb127-1"></a>ax1.set_ylabel(<span class="st">'WCSS'</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Text(0, 0.5, 'WCSS')</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb129"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb129-1"><a href="#cb129-1"></a>ax1.set_title(<span class="st">'肘部法则'</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Text(0.5, 1.0, '肘部法则')</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb131"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb131-1"><a href="#cb131-1"></a>ax2.plot(k_range, silhouette_scores, <span class="st">'ro-'</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[&lt;matplotlib.lines.Line2D object at 0x0000017F8226E710&gt;]</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb133"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb133-1"><a href="#cb133-1"></a>ax2.set_xlabel(<span class="st">'聚类数'</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Text(0.5, 0, '聚类数')</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb135"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb135-1"><a href="#cb135-1"></a>ax2.set_ylabel(<span class="st">'轮廓系数'</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Text(0, 0.5, '轮廓系数')</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb137"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb137-1"><a href="#cb137-1"></a>ax2.set_title(<span class="st">'轮廓系数'</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Text(0.5, 1.0, '轮廓系数')</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb139"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb139-1"><a href="#cb139-1"></a>plt.tight_layout()</span>
<span id="cb139-2"><a href="#cb139-2"></a>plt.show()</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="15-案例综合分析_files/figure-html/python-clustering-5.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb140"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb140-1"><a href="#cb140-1"></a><span class="co"># 执行K-means聚类</span></span>
<span id="cb140-2"><a href="#cb140-2"></a>kmeans_final <span class="op">=</span> KMeans(n_clusters<span class="op">=</span><span class="dv">4</span>, random_state<span class="op">=</span><span class="dv">123</span>, n_init<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb140-3"><a href="#cb140-3"></a>python_user_data[<span class="st">'cluster'</span>] <span class="op">=</span> kmeans_final.fit_predict(X_cluster_scaled)</span>
<span id="cb140-4"><a href="#cb140-4"></a></span>
<span id="cb140-5"><a href="#cb140-5"></a><span class="co"># 聚类分析</span></span>
<span id="cb140-6"><a href="#cb140-6"></a>cluster_analysis <span class="op">=</span> python_user_data.groupby(<span class="st">'cluster'</span>).agg({</span>
<span id="cb140-7"><a href="#cb140-7"></a>    <span class="st">'age'</span>: <span class="st">'mean'</span>,</span>
<span id="cb140-8"><a href="#cb140-8"></a>    <span class="st">'income'</span>: <span class="st">'mean'</span>,</span>
<span id="cb140-9"><a href="#cb140-9"></a>    <span class="st">'page_views'</span>: <span class="st">'mean'</span>,</span>
<span id="cb140-10"><a href="#cb140-10"></a>    <span class="st">'time_on_site'</span>: <span class="st">'mean'</span>,</span>
<span id="cb140-11"><a href="#cb140-11"></a>    <span class="st">'cart_additions'</span>: <span class="st">'mean'</span>,</span>
<span id="cb140-12"><a href="#cb140-12"></a>    <span class="st">'made_purchase'</span>: <span class="st">'mean'</span>,</span>
<span id="cb140-13"><a href="#cb140-13"></a>    <span class="st">'purchase_amount'</span>: <span class="st">'mean'</span>,</span>
<span id="cb140-14"><a href="#cb140-14"></a>    <span class="st">'user_id'</span>: <span class="st">'count'</span></span>
<span id="cb140-15"><a href="#cb140-15"></a>}).rename(columns<span class="op">=</span>{<span class="st">'user_id'</span>: <span class="st">'count'</span>})</span>
<span id="cb140-16"><a href="#cb140-16"></a></span>
<span id="cb140-17"><a href="#cb140-17"></a><span class="bu">print</span>(<span class="st">"聚类分析结果:"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>聚类分析结果:</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb142"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb142-1"><a href="#cb142-1"></a><span class="bu">print</span>(cluster_analysis.<span class="bu">round</span>(<span class="dv">2</span>))</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>           age    income  page_views  ...  made_purchase  purchase_amount  count
cluster                               ...                                       
0        27.81  53227.80       26.55  ...           0.12            93.78    266
1        41.83  37788.28       21.12  ...           0.06            84.25    242
2        55.03  55961.32       25.49  ...           0.11            95.40    266
3        44.12  54015.27       27.58  ...           0.11            96.53    226

[4 rows x 8 columns]</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb144"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb144-1"><a href="#cb144-1"></a><span class="co"># 聚类可视化</span></span>
<span id="cb144-2"><a href="#cb144-2"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">10</span>))</span>
<span id="cb144-3"><a href="#cb144-3"></a>features_to_plot <span class="op">=</span> [<span class="st">'age'</span>, <span class="st">'income'</span>, <span class="st">'page_views'</span>, <span class="st">'time_on_site'</span>, <span class="st">'cart_additions'</span>, <span class="st">'purchase_amount'</span>]</span>
<span id="cb144-4"><a href="#cb144-4"></a></span>
<span id="cb144-5"><a href="#cb144-5"></a><span class="cf">for</span> i, feature <span class="kw">in</span> <span class="bu">enumerate</span>(features_to_plot):</span>
<span id="cb144-6"><a href="#cb144-6"></a>    row, col <span class="op">=</span> i <span class="op">//</span> <span class="dv">3</span>, i <span class="op">%</span> <span class="dv">3</span></span>
<span id="cb144-7"><a href="#cb144-7"></a>    python_user_data.boxplot(column<span class="op">=</span>feature, by<span class="op">=</span><span class="st">'cluster'</span>, ax<span class="op">=</span>axes[row, col])</span>
<span id="cb144-8"><a href="#cb144-8"></a>    axes[row, col].set_title(<span class="ss">f'</span><span class="sc">{</span>feature<span class="sc">}</span><span class="ss"> by Cluster'</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>&lt;Axes: title={'center': 'age'}, xlabel='cluster'&gt;
Text(0.5, 1.0, 'age by Cluster')
&lt;Axes: title={'center': 'income'}, xlabel='cluster'&gt;
Text(0.5, 1.0, 'income by Cluster')
&lt;Axes: title={'center': 'page_views'}, xlabel='cluster'&gt;
Text(0.5, 1.0, 'page_views by Cluster')
&lt;Axes: title={'center': 'time_on_site'}, xlabel='cluster'&gt;
Text(0.5, 1.0, 'time_on_site by Cluster')
&lt;Axes: title={'center': 'cart_additions'}, xlabel='cluster'&gt;
Text(0.5, 1.0, 'cart_additions by Cluster')
&lt;Axes: title={'center': 'purchase_amount'}, xlabel='cluster'&gt;
Text(0.5, 1.0, 'purchase_amount by Cluster')</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb146"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb146-1"><a href="#cb146-1"></a>plt.suptitle(<span class="st">'各聚类群体特征分布'</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Text(0.5, 0.98, '各聚类群体特征分布')</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb148"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb148-1"><a href="#cb148-1"></a>plt.tight_layout()</span>
<span id="cb148-2"><a href="#cb148-2"></a>plt.show()</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="15-案例综合分析_files/figure-html/python-clustering-6.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section><section id="python关联分析" class="level3"><h3 class="anchored" data-anchor-id="python关联分析">15.2.5 Python关联分析</h3>
<div class="cell">
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb149"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb149-1"><a href="#cb149-1"></a><span class="im">from</span> mlxtend.frequent_patterns <span class="im">import</span> apriori, association_rules</span>
<span id="cb149-2"><a href="#cb149-2"></a></span>
<span id="cb149-3"><a href="#cb149-3"></a><span class="co"># 准备关联分析数据</span></span>
<span id="cb149-4"><a href="#cb149-4"></a>association_data <span class="op">=</span> python_user_data[[<span class="ss">f'bought_</span><span class="sc">{</span>product<span class="sc">}</span><span class="ss">'</span> <span class="cf">for</span> product <span class="kw">in</span> products]]</span>
<span id="cb149-5"><a href="#cb149-5"></a></span>
<span id="cb149-6"><a href="#cb149-6"></a><span class="co"># 查看数据概览</span></span>
<span id="cb149-7"><a href="#cb149-7"></a><span class="bu">print</span>(<span class="st">"关联分析数据概览:"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>关联分析数据概览:</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb151"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb151-1"><a href="#cb151-1"></a><span class="bu">print</span>(association_data.head())</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>   bought_electronics  bought_clothing  ...  bought_home  bought_sports
0                   1                1  ...            0              1
1                   1                1  ...            1              1
2                   0                1  ...            1              1
3                   1                0  ...            1              0
4                   1                1  ...            1              1

[5 rows x 5 columns]</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb153"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb153-1"><a href="#cb153-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">各产品购买率:"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>
各产品购买率:</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb155"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb155-1"><a href="#cb155-1"></a><span class="bu">print</span>(association_data.mean())</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>bought_electronics    0.411
bought_clothing       0.522
bought_books          0.553
bought_home           0.554
bought_sports         0.565
dtype: float64</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb157"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb157-1"><a href="#cb157-1"></a><span class="co"># 挖掘频繁项集 - 使用更宽松的参数</span></span>
<span id="cb157-2"><a href="#cb157-2"></a>frequent_itemsets <span class="op">=</span> apriori(association_data, </span>
<span id="cb157-3"><a href="#cb157-3"></a>                           min_support<span class="op">=</span><span class="fl">0.05</span>,  <span class="co"># 降低支持度</span></span>
<span id="cb157-4"><a href="#cb157-4"></a>                           use_colnames<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb157-5"><a href="#cb157-5"></a>                           max_len<span class="op">=</span><span class="dv">4</span>)         <span class="co"># 限制最大项集大小</span></span>
<span id="cb157-6"><a href="#cb157-6"></a></span>
<span id="cb157-7"><a href="#cb157-7"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">找到的频繁项集数量: </span><span class="sc">{</span><span class="bu">len</span>(frequent_itemsets)<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>
找到的频繁项集数量: 30</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb159"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb159-1"><a href="#cb159-1"></a><span class="cf">if</span> <span class="bu">len</span>(frequent_itemsets) <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb159-2"><a href="#cb159-2"></a>    <span class="co"># 生成关联规则</span></span>
<span id="cb159-3"><a href="#cb159-3"></a>    rules_python <span class="op">=</span> association_rules(frequent_itemsets, </span>
<span id="cb159-4"><a href="#cb159-4"></a>                                   metric<span class="op">=</span><span class="st">"confidence"</span>, </span>
<span id="cb159-5"><a href="#cb159-5"></a>                                   min_threshold<span class="op">=</span><span class="fl">0.3</span>)  <span class="co"># 降低置信度</span></span>
<span id="cb159-6"><a href="#cb159-6"></a>    </span>
<span id="cb159-7"><a href="#cb159-7"></a>    <span class="bu">print</span>(<span class="ss">f"生成的关联规则数量: </span><span class="sc">{</span><span class="bu">len</span>(rules_python)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb159-8"><a href="#cb159-8"></a>    </span>
<span id="cb159-9"><a href="#cb159-9"></a>    <span class="cf">if</span> <span class="bu">len</span>(rules_python) <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb159-10"><a href="#cb159-10"></a>        <span class="co"># 显示前10条规则</span></span>
<span id="cb159-11"><a href="#cb159-11"></a>        rules_display <span class="op">=</span> rules_python.sort_values(<span class="st">'lift'</span>, ascending<span class="op">=</span><span class="va">False</span>).head(<span class="dv">10</span>)</span>
<span id="cb159-12"><a href="#cb159-12"></a>        <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">前10条关联规则 (按提升度排序):"</span>)</span>
<span id="cb159-13"><a href="#cb159-13"></a>        <span class="cf">for</span> idx, rule <span class="kw">in</span> rules_display.iterrows():</span>
<span id="cb159-14"><a href="#cb159-14"></a>            antecedents <span class="op">=</span> <span class="bu">list</span>(rule[<span class="st">'antecedents'</span>])</span>
<span id="cb159-15"><a href="#cb159-15"></a>            consequents <span class="op">=</span> <span class="bu">list</span>(rule[<span class="st">'consequents'</span>])</span>
<span id="cb159-16"><a href="#cb159-16"></a>            <span class="bu">print</span>(<span class="ss">f"规则: </span><span class="sc">{</span>antecedents<span class="sc">}</span><span class="ss"> -&gt; </span><span class="sc">{</span>consequents<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb159-17"><a href="#cb159-17"></a>            <span class="bu">print</span>(<span class="ss">f"  支持度: </span><span class="sc">{</span>rule[<span class="st">'support'</span>]<span class="sc">:.3f}</span><span class="ss">, 置信度: </span><span class="sc">{</span>rule[<span class="st">'confidence'</span>]<span class="sc">:.3f}</span><span class="ss">, 提升度: </span><span class="sc">{</span>rule[<span class="st">'lift'</span>]<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb159-18"><a href="#cb159-18"></a>            <span class="bu">print</span>()</span>
<span id="cb159-19"><a href="#cb159-19"></a>    <span class="cf">else</span>:</span>
<span id="cb159-20"><a href="#cb159-20"></a>        <span class="bu">print</span>(<span class="st">"没有生成关联规则，请进一步降低阈值"</span>)</span>
<span id="cb159-21"><a href="#cb159-21"></a><span class="cf">else</span>:</span>
<span id="cb159-22"><a href="#cb159-22"></a>    <span class="bu">print</span>(<span class="st">"没有找到频繁项集，请降低支持度阈值"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>生成的关联规则数量: 137

前10条关联规则 (按提升度排序):
规则: ['bought_home', 'bought_clothing'] -&gt; ['bought_books', 'bought_electronics']
  支持度: 0.146, 置信度: 0.465, 提升度: 1.802

规则: ['bought_books', 'bought_electronics'] -&gt; ['bought_home', 'bought_clothing']
  支持度: 0.146, 置信度: 0.566, 提升度: 1.802

规则: ['bought_sports', 'bought_clothing'] -&gt; ['bought_home', 'bought_electronics']
  支持度: 0.128, 置信度: 0.416, 提升度: 1.768

规则: ['bought_home', 'bought_electronics'] -&gt; ['bought_sports', 'bought_clothing']
  支持度: 0.128, 置信度: 0.545, 提升度: 1.768

规则: ['bought_books', 'bought_electronics'] -&gt; ['bought_sports', 'bought_clothing']
  支持度: 0.138, 置信度: 0.535, 提升度: 1.737

规则: ['bought_sports', 'bought_clothing'] -&gt; ['bought_books', 'bought_electronics']
  支持度: 0.138, 置信度: 0.448, 提升度: 1.737

规则: ['bought_home', 'bought_electronics'] -&gt; ['bought_books', 'bought_clothing']
  支持度: 0.146, 置信度: 0.621, 提升度: 1.721

规则: ['bought_books', 'bought_clothing'] -&gt; ['bought_home', 'bought_electronics']
  支持度: 0.146, 置信度: 0.404, 提升度: 1.721

规则: ['bought_home', 'bought_electronics'] -&gt; ['bought_books', 'bought_sports']
  支持度: 0.138, 置信度: 0.587, 提升度: 1.692

规则: ['bought_books', 'bought_sports'] -&gt; ['bought_home', 'bought_electronics']
  支持度: 0.138, 置信度: 0.398, 提升度: 1.692</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb161"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb161-1"><a href="#cb161-1"></a>    </span>
<span id="cb161-2"><a href="#cb161-2"></a><span class="co"># 产品共现热图</span></span>
<span id="cb161-3"><a href="#cb161-3"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>&lt;Figure size 800x600 with 0 Axes&gt;</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb163"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb163-1"><a href="#cb163-1"></a>corr_matrix <span class="op">=</span> association_data.corr()</span>
<span id="cb163-2"><a href="#cb163-2"></a>sns.heatmap(corr_matrix, annot<span class="op">=</span><span class="va">True</span>, cmap<span class="op">=</span><span class="st">'coolwarm'</span>, center<span class="op">=</span><span class="dv">0</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>&lt;Axes: &gt;</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb165"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb165-1"><a href="#cb165-1"></a>plt.title(<span class="st">'产品购买相关性热图'</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Text(0.5, 1.0, '产品购买相关性热图')</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb167"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb167-1"><a href="#cb167-1"></a>plt.tight_layout()</span>
<span id="cb167-2"><a href="#cb167-2"></a>plt.show()</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="15-案例综合分析_files/figure-html/python-association-9.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section></section><section id="综合分析结果" class="level2"><h2 class="anchored" data-anchor-id="综合分析结果">15.3 综合分析结果</h2>
<p>方法比较</p>
<div class="cell">
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb168"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1"></a><span class="co"># R和Python结果比较</span></span>
<span id="cb168-2"><a href="#cb168-2"></a><span class="fu">cat</span>(<span class="st">"## 分析方法总结</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>## 分析方法总结</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb170"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb170-1"><a href="#cb170-1"></a><span class="fu">cat</span>(<span class="st">"### 回归分析</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>### 回归分析</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb172"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb172-1"><a href="#cb172-1"></a><span class="fu">cat</span>(<span class="st">"- 线性回归和随机森林都能较好地预测用户消费金额</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>- 线性回归和随机森林都能较好地预测用户消费金额</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb174"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb174-1"><a href="#cb174-1"></a><span class="fu">cat</span>(<span class="st">"- 随机森林在非线性关系处理上表现更好</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>- 随机森林在非线性关系处理上表现更好</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb176"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb176-1"><a href="#cb176-1"></a><span class="fu">cat</span>(<span class="st">"### 分类分析</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>### 分类分析</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb178"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb178-1"><a href="#cb178-1"></a><span class="fu">cat</span>(<span class="st">"- 逻辑回归和随机森林都能有效预测用户购买意向</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>- 逻辑回归和随机森林都能有效预测用户购买意向</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb180"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb180-1"><a href="#cb180-1"></a><span class="fu">cat</span>(<span class="st">"- 页面浏览量和购物车添加次数是最重要的预测特征</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>- 页面浏览量和购物车添加次数是最重要的预测特征</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb182"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb182-1"><a href="#cb182-1"></a><span class="fu">cat</span>(<span class="st">"- 随机森林在AUC指标上表现略优于逻辑回归</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>- 随机森林在AUC指标上表现略优于逻辑回归</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb184"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb184-1"><a href="#cb184-1"></a><span class="fu">cat</span>(<span class="st">"### 聚类分析</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>### 聚类分析</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb186"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb186-1"><a href="#cb186-1"></a><span class="fu">cat</span>(<span class="st">"- 成功将用户分为4个有意义的群体</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>- 成功将用户分为4个有意义的群体</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb188"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb188-1"><a href="#cb188-1"></a><span class="fu">cat</span>(<span class="st">"- 不同群体在消费行为和用户特征上有明显差异</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>- 不同群体在消费行为和用户特征上有明显差异</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb190"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb190-1"><a href="#cb190-1"></a><span class="fu">cat</span>(<span class="st">"### 关联分析</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>### 关联分析</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb192"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb192-1"><a href="#cb192-1"></a><span class="fu">cat</span>(<span class="st">"- 通过调整参数成功挖掘出关联规则</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>- 通过调整参数成功挖掘出关联规则</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb194"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb194-1"><a href="#cb194-1"></a><span class="fu">cat</span>(<span class="st">"- 发现了产品间的购买模式和相关关系</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>- 发现了产品间的购买模式和相关关系</code></pre>
</div>
</div>
<p>业务建议</p>
<div class="cell">
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb196"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb196-1"><a href="#cb196-1"></a><span class="fu">cat</span>(<span class="st">"## 业务洞察与建议</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>## 业务洞察与建议</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb198"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb198-1"><a href="#cb198-1"></a><span class="fu">cat</span>(<span class="st">"1. **用户分群营销**: 针对不同聚类群体制定个性化营销策略</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>1. **用户分群营销**: 针对不同聚类群体制定个性化营销策略</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb200"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb200-1"><a href="#cb200-1"></a><span class="fu">cat</span>(<span class="st">"2. **交叉销售**: 利用关联规则结果优化商品推荐系统</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>2. **交叉销售**: 利用关联规则结果优化商品推荐系统</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb202"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb202-1"><a href="#cb202-1"></a><span class="fu">cat</span>(<span class="st">"3. **用户行为预测**: 使用分类模型识别高价值潜在客户</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>3. **用户行为预测**: 使用分类模型识别高价值潜在客户</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb204"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb204-1"><a href="#cb204-1"></a><span class="fu">cat</span>(<span class="st">"4. **收入预测**: 回归模型可用于预测用户生命周期价值</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>4. **收入预测**: 回归模型可用于预测用户生命周期价值</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb206"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb206-1"><a href="#cb206-1"></a><span class="fu">cat</span>(<span class="st">"5. **产品组合优化**: 基于关联分析结果调整产品陈列和捆绑销售策略</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>5. **产品组合优化**: 基于关联分析结果调整产品陈列和捆绑销售策略</code></pre>
</div>
</div>
<p>技术总结</p>
<div class="cell">
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb208"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb208-1"><a href="#cb208-1"></a><span class="fu">cat</span>(<span class="st">"## 技术实现总结</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>## 技术实现总结</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb210"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb210-1"><a href="#cb210-1"></a><span class="fu">cat</span>(<span class="st">"### 数据框操作修复要点</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>### 数据框操作修复要点</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb212"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb212-1"><a href="#cb212-1"></a><span class="fu">cat</span>(<span class="st">"- 避免对字符型变量进行数学运算</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>- 避免对字符型变量进行数学运算</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb214"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb214-1"><a href="#cb214-1"></a><span class="fu">cat</span>(<span class="st">"- 使用明确的列选择，只对数值列进行操作</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>- 使用明确的列选择，只对数值列进行操作</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb216"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb216-1"><a href="#cb216-1"></a><span class="fu">cat</span>(<span class="st">"- 使用`across(where(is.numeric), ~ round(., 4))`时确保只选择数值列</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>- 使用`across(where(is.numeric), ~ round(., 4))`时确保只选择数值列</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb218"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb218-1"><a href="#cb218-1"></a><span class="fu">cat</span>(<span class="st">"### R语言优势</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>### R语言优势</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb220"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb220-1"><a href="#cb220-1"></a><span class="fu">cat</span>(<span class="st">"- 统计建模功能强大，模型输出详细</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>- 统计建模功能强大，模型输出详细</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb222"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb222-1"><a href="#cb222-1"></a><span class="fu">cat</span>(<span class="st">"- 可视化库丰富，图形质量高</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>- 可视化库丰富，图形质量高</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb224"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb224-1"><a href="#cb224-1"></a><span class="fu">cat</span>(<span class="st">"- 数据处理管道清晰易读</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>- 数据处理管道清晰易读</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb226"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb226-1"><a href="#cb226-1"></a><span class="fu">cat</span>(<span class="st">"### Python优势</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>### Python优势</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb228"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb228-1"><a href="#cb228-1"></a><span class="fu">cat</span>(<span class="st">"- 机器学习库生态系统完善</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>- 机器学习库生态系统完善</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb230"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb230-1"><a href="#cb230-1"></a><span class="fu">cat</span>(<span class="st">"- 代码简洁，部署方便</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>- 代码简洁，部署方便</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb232"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb232-1"><a href="#cb232-1"></a><span class="fu">cat</span>(<span class="st">"- 深度学习和大数据处理能力强</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>- 深度学习和大数据处理能力强</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb234"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb234-1"><a href="#cb234-1"></a><span class="fu">cat</span>(<span class="st">"### 推荐使用场景</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>### 推荐使用场景</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb236"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb236-1"><a href="#cb236-1"></a><span class="fu">cat</span>(<span class="st">"- **学术研究、统计分析**: 推荐使用R</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>- **学术研究、统计分析**: 推荐使用R</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb238"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb238-1"><a href="#cb238-1"></a><span class="fu">cat</span>(<span class="st">"- **生产环境、大型项目**: 推荐使用Python</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>- **生产环境、大型项目**: 推荐使用Python</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb240"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb240-1"><a href="#cb240-1"></a><span class="fu">cat</span>(<span class="st">"- **混合使用**: 根据具体任务选择最适合的工具</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>- **混合使用**: 根据具体任务选择最适合的工具</code></pre>
</div>
</div>
</section><section id="附录" class="level2"><h2 class="anchored" data-anchor-id="附录">15.4 附录</h2>
<p>数据字典</p>
<table class="caption-top table">
<thead><tr class="header">
<th>变量名</th>
<th>描述</th>
<th>类型</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>user_id</td>
<td>用户ID</td>
<td>数值</td>
</tr>
<tr class="even">
<td>age</td>
<td>年龄</td>
<td>数值</td>
</tr>
<tr class="odd">
<td>gender</td>
<td>性别</td>
<td>分类</td>
</tr>
<tr class="even">
<td>income</td>
<td>收入</td>
<td>数值</td>
</tr>
<tr class="odd">
<td>region</td>
<td>地区</td>
<td>分类</td>
</tr>
<tr class="even">
<td>page_views</td>
<td>页面浏览量</td>
<td>数值</td>
</tr>
<tr class="odd">
<td>time_on_site</td>
<td>网站停留时间(秒)</td>
<td>数值</td>
</tr>
<tr class="even">
<td>cart_additions</td>
<td>购物车添加次数</td>
<td>数值</td>
</tr>
<tr class="odd">
<td>purchase_amount</td>
<td>购买金额</td>
<td>数值</td>
</tr>
<tr class="even">
<td>made_purchase</td>
<td>是否购买</td>
<td>二分类</td>
</tr>
</tbody>
</table>
<p>依赖包列表</p>
<p>R包: - <code>dplyr</code>, <code>ggplot2</code>, <code>caret</code>, <code>randomForest</code>, <code>factoextra</code>, <code>arules</code>, <code>arulesViz</code>, <code>corrplot</code>, <code>pROC</code>, <code>patchwork</code>, <code>tidyr</code></p>
<p>Python包: - <code>pandas</code>, <code>numpy</code>, <code>matplotlib</code>, <code>seaborn</code>, <code>scikit-learn</code>, <code>mlxtend</code></p>


<!-- -->

</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "已复制");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "已复制");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="../chapters/14 分类任务.html" class="pagination-link" aria-label="14 分类任务">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-title">14 分类任务</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">源代码</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb242" data-shortcodes="false"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb242-1"><a href="#cb242-1"></a><span class="co">---</span></span>
<span id="cb242-2"><a href="#cb242-2"></a><span class="an">title:</span><span class="co"> "15 案例综合分析"</span></span>
<span id="cb242-3"><a href="#cb242-3"></a><span class="an">author:</span><span class="co"> "李世纪"</span></span>
<span id="cb242-4"><a href="#cb242-4"></a><span class="an">date:</span><span class="co"> "`r Sys.Date()`"</span></span>
<span id="cb242-5"><a href="#cb242-5"></a><span class="an">format:</span><span class="co"> </span></span>
<span id="cb242-6"><a href="#cb242-6"></a><span class="co">  html:</span></span>
<span id="cb242-7"><a href="#cb242-7"></a><span class="co">    toc: true</span></span>
<span id="cb242-8"><a href="#cb242-8"></a><span class="co">    toc-depth: 3</span></span>
<span id="cb242-9"><a href="#cb242-9"></a><span class="co">    code-fold: true</span></span>
<span id="cb242-10"><a href="#cb242-10"></a><span class="co">    code-overflow: wrap</span></span>
<span id="cb242-11"><a href="#cb242-11"></a><span class="co">    code-tools: true</span></span>
<span id="cb242-12"><a href="#cb242-12"></a><span class="co">---</span></span>
<span id="cb242-13"><a href="#cb242-13"></a></span>
<span id="cb242-14"><a href="#cb242-14"></a><span class="in">```{r echo=FALSE,include=FALSE,results='hide'}</span></span>
<span id="cb242-15"><a href="#cb242-15"></a><span class="co"># 在 R 中直接指定 Anaconda 路径</span></span>
<span id="cb242-16"><a href="#cb242-16"></a><span class="fu">library</span>(reticulate)</span>
<span id="cb242-17"><a href="#cb242-17"></a><span class="co"># 查看已安装的 conda 环境</span></span>
<span id="cb242-18"><a href="#cb242-18"></a><span class="fu">conda_list</span>()</span>
<span id="cb242-19"><a href="#cb242-19"></a></span>
<span id="cb242-20"><a href="#cb242-20"></a><span class="co"># 查看 conda 可执行文件路径</span></span>
<span id="cb242-21"><a href="#cb242-21"></a><span class="fu">conda_binary</span>()</span>
<span id="cb242-22"><a href="#cb242-22"></a></span>
<span id="cb242-23"><a href="#cb242-23"></a><span class="co"># 查看 conda 版本</span></span>
<span id="cb242-24"><a href="#cb242-24"></a><span class="fu">conda_version</span>()</span>
<span id="cb242-25"><a href="#cb242-25"></a><span class="co"># 指定 Python 可执行文件路径</span></span>
<span id="cb242-26"><a href="#cb242-26"></a><span class="fu">use_python</span>(<span class="st">"C:/Data/Anaconda/python.exe"</span>)  </span>
<span id="cb242-27"><a href="#cb242-27"></a></span>
<span id="cb242-28"><a href="#cb242-28"></a><span class="co"># 使用 Conda 环境</span></span>
<span id="cb242-29"><a href="#cb242-29"></a><span class="fu">use_condaenv</span>(<span class="st">"base"</span>)  <span class="co"># 使用基础环境</span></span>
<span id="cb242-30"><a href="#cb242-30"></a><span class="in">```</span></span>
<span id="cb242-31"><a href="#cb242-31"></a></span>
<span id="cb242-32"><a href="#cb242-32"></a><span class="fu">## 案例导读</span></span>
<span id="cb242-33"><a href="#cb242-33"></a></span>
<span id="cb242-34"><a href="#cb242-34"></a>本项目基于模拟的电商用户数据，进行全面的数据分析，包括： - 回归分析：预测用户消费金额 - 分类分析：预测用户购买意向 - 聚类分析：用户分群 - 关联分析：商品购买关联规则</span>
<span id="cb242-35"><a href="#cb242-35"></a></span>
<span id="cb242-36"><a href="#cb242-36"></a>数据说明</span>
<span id="cb242-37"><a href="#cb242-37"></a></span>
<span id="cb242-40"><a href="#cb242-40"></a><span class="in">```{r}</span></span>
<span id="cb242-41"><a href="#cb242-41"></a><span class="co"># 生成模拟数据</span></span>
<span id="cb242-42"><a href="#cb242-42"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb242-43"><a href="#cb242-43"></a>n <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb242-44"><a href="#cb242-44"></a></span>
<span id="cb242-45"><a href="#cb242-45"></a><span class="co"># 用户基本信息</span></span>
<span id="cb242-46"><a href="#cb242-46"></a>user_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb242-47"><a href="#cb242-47"></a>  <span class="at">user_id =</span> <span class="dv">1</span><span class="sc">:</span>n,</span>
<span id="cb242-48"><a href="#cb242-48"></a>  <span class="at">age =</span> <span class="fu">sample</span>(<span class="dv">18</span><span class="sc">:</span><span class="dv">65</span>, n, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb242-49"><a href="#cb242-49"></a>  <span class="at">gender =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"Male"</span>, <span class="st">"Female"</span>), n, <span class="at">replace =</span> <span class="cn">TRUE</span>, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.48</span>, <span class="fl">0.52</span>)),</span>
<span id="cb242-50"><a href="#cb242-50"></a>  <span class="at">income =</span> <span class="fu">round</span>(<span class="fu">rnorm</span>(n, <span class="dv">50000</span>, <span class="dv">15000</span>)),</span>
<span id="cb242-51"><a href="#cb242-51"></a>  <span class="at">region =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"North"</span>, <span class="st">"South"</span>, <span class="st">"East"</span>, <span class="st">"West"</span>), n, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb242-52"><a href="#cb242-52"></a>  <span class="at">days_since_signup =</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">365</span>, n, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb242-53"><a href="#cb242-53"></a>  <span class="at">page_views =</span> <span class="fu">rpois</span>(n, <span class="dv">25</span>),</span>
<span id="cb242-54"><a href="#cb242-54"></a>  <span class="at">time_on_site =</span> <span class="fu">round</span>(<span class="fu">rnorm</span>(n, <span class="dv">300</span>, <span class="dv">120</span>)),</span>
<span id="cb242-55"><a href="#cb242-55"></a>  <span class="at">cart_additions =</span> <span class="fu">rpois</span>(n, <span class="dv">5</span>)</span>
<span id="cb242-56"><a href="#cb242-56"></a>)</span>
<span id="cb242-57"><a href="#cb242-57"></a></span>
<span id="cb242-58"><a href="#cb242-58"></a><span class="co"># 生成购买行为数据</span></span>
<span id="cb242-59"><a href="#cb242-59"></a>user_data<span class="sc">$</span>purchase_amount <span class="ot">&lt;-</span> <span class="fu">with</span>(user_data, </span>
<span id="cb242-60"><a href="#cb242-60"></a>  <span class="dv">50</span> <span class="sc">+</span> <span class="fl">0.3</span> <span class="sc">*</span> income<span class="sc">/</span><span class="dv">1000</span> <span class="sc">+</span> <span class="fl">0.5</span> <span class="sc">*</span> page_views <span class="sc">+</span> <span class="fl">0.8</span> <span class="sc">*</span> time_on_site<span class="sc">/</span><span class="dv">60</span> <span class="sc">+</span> </span>
<span id="cb242-61"><a href="#cb242-61"></a>  <span class="dv">2</span> <span class="sc">*</span> cart_additions <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="dv">20</span>)</span>
<span id="cb242-62"><a href="#cb242-62"></a>)</span>
<span id="cb242-63"><a href="#cb242-63"></a></span>
<span id="cb242-64"><a href="#cb242-64"></a>user_data<span class="sc">$</span>made_purchase <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(user_data<span class="sc">$</span>purchase_amount <span class="sc">&gt;</span> <span class="dv">120</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb242-65"><a href="#cb242-65"></a></span>
<span id="cb242-66"><a href="#cb242-66"></a><span class="co"># 添加产品类别购买信息 - 增加相关性以产生关联规则</span></span>
<span id="cb242-67"><a href="#cb242-67"></a>products <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Electronics"</span>, <span class="st">"Clothing"</span>, <span class="st">"Books"</span>, <span class="st">"Home"</span>, <span class="st">"Sports"</span>)</span>
<span id="cb242-68"><a href="#cb242-68"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb242-69"><a href="#cb242-69"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(products)) {</span>
<span id="cb242-70"><a href="#cb242-70"></a>  product <span class="ot">&lt;-</span> products[i]</span>
<span id="cb242-71"><a href="#cb242-71"></a>  base_prob <span class="ot">&lt;-</span> <span class="fl">0.4</span></span>
<span id="cb242-72"><a href="#cb242-72"></a>  <span class="co"># 创建产品间的相关性</span></span>
<span id="cb242-73"><a href="#cb242-73"></a>  <span class="cf">if</span>(i <span class="sc">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb242-74"><a href="#cb242-74"></a>    <span class="co"># 让某些产品更可能一起购买</span></span>
<span id="cb242-75"><a href="#cb242-75"></a>    correlated_prob <span class="ot">&lt;-</span> user_data[[<span class="fu">paste0</span>(<span class="st">"bought_"</span>, <span class="fu">tolower</span>(products[i<span class="dv">-1</span>]))]] <span class="sc">*</span> <span class="fl">0.3</span> <span class="sc">+</span> base_prob</span>
<span id="cb242-76"><a href="#cb242-76"></a>    user_data[[<span class="fu">paste0</span>(<span class="st">"bought_"</span>, <span class="fu">tolower</span>(product))]] <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n, <span class="dv">1</span>, <span class="fu">pmin</span>(correlated_prob, <span class="fl">0.8</span>))</span>
<span id="cb242-77"><a href="#cb242-77"></a>  } <span class="cf">else</span> {</span>
<span id="cb242-78"><a href="#cb242-78"></a>    user_data[[<span class="fu">paste0</span>(<span class="st">"bought_"</span>, <span class="fu">tolower</span>(product))]] <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n, <span class="dv">1</span>, base_prob)</span>
<span id="cb242-79"><a href="#cb242-79"></a>  }</span>
<span id="cb242-80"><a href="#cb242-80"></a>}</span>
<span id="cb242-81"><a href="#cb242-81"></a></span>
<span id="cb242-82"><a href="#cb242-82"></a><span class="fu">head</span>(user_data)</span>
<span id="cb242-83"><a href="#cb242-83"></a><span class="in">```</span></span>
<span id="cb242-84"><a href="#cb242-84"></a></span>
<span id="cb242-85"><a href="#cb242-85"></a><span class="fu">## 15.1 R语言实现</span></span>
<span id="cb242-86"><a href="#cb242-86"></a></span>
<span id="cb242-87"><a href="#cb242-87"></a><span class="fu">### 15.1.1. 数据探索与预处理</span></span>
<span id="cb242-88"><a href="#cb242-88"></a></span>
<span id="cb242-89"><a href="#cb242-89"></a>数据概览</span>
<span id="cb242-90"><a href="#cb242-90"></a></span>
<span id="cb242-93"><a href="#cb242-93"></a><span class="in">```{r}</span></span>
<span id="cb242-94"><a href="#cb242-94"></a><span class="co">#| label: r-data-overview</span></span>
<span id="cb242-95"><a href="#cb242-95"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb242-96"><a href="#cb242-96"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb242-97"><a href="#cb242-97"></a><span class="fu">library</span>(corrplot)</span>
<span id="cb242-98"><a href="#cb242-98"></a></span>
<span id="cb242-99"><a href="#cb242-99"></a><span class="co"># 基本统计信息</span></span>
<span id="cb242-100"><a href="#cb242-100"></a><span class="fu">summary</span>(user_data[, <span class="fu">c</span>(<span class="st">"age"</span>, <span class="st">"income"</span>, <span class="st">"page_views"</span>, <span class="st">"time_on_site"</span>, <span class="st">"purchase_amount"</span>)])</span>
<span id="cb242-101"><a href="#cb242-101"></a></span>
<span id="cb242-102"><a href="#cb242-102"></a><span class="co"># 缺失值检查</span></span>
<span id="cb242-103"><a href="#cb242-103"></a><span class="fu">sapply</span>(user_data, <span class="cf">function</span>(x) <span class="fu">sum</span>(<span class="fu">is.na</span>(x)))</span>
<span id="cb242-104"><a href="#cb242-104"></a><span class="in">```</span></span>
<span id="cb242-105"><a href="#cb242-105"></a></span>
<span id="cb242-106"><a href="#cb242-106"></a>数据可视化</span>
<span id="cb242-107"><a href="#cb242-107"></a></span>
<span id="cb242-110"><a href="#cb242-110"></a><span class="in">```{r}</span></span>
<span id="cb242-111"><a href="#cb242-111"></a><span class="co">#| label: r-data-visualization</span></span>
<span id="cb242-112"><a href="#cb242-112"></a><span class="co"># 数值变量分布</span></span>
<span id="cb242-113"><a href="#cb242-113"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(user_data, <span class="fu">aes</span>(<span class="at">x =</span> purchase_amount)) <span class="sc">+</span></span>
<span id="cb242-114"><a href="#cb242-114"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">30</span>, <span class="at">fill =</span> <span class="st">"steelblue"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb242-115"><a href="#cb242-115"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"购买金额分布"</span>)</span>
<span id="cb242-116"><a href="#cb242-116"></a></span>
<span id="cb242-117"><a href="#cb242-117"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(user_data, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(made_purchase), <span class="at">fill =</span> <span class="fu">factor</span>(made_purchase))) <span class="sc">+</span></span>
<span id="cb242-118"><a href="#cb242-118"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb242-119"><a href="#cb242-119"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"购买行为分布"</span>, <span class="at">x =</span> <span class="st">"是否购买"</span>)</span>
<span id="cb242-120"><a href="#cb242-120"></a></span>
<span id="cb242-121"><a href="#cb242-121"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(user_data, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> purchase_amount, <span class="at">color =</span> gender)) <span class="sc">+</span></span>
<span id="cb242-122"><a href="#cb242-122"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb242-123"><a href="#cb242-123"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"年龄与购买金额关系"</span>)</span>
<span id="cb242-124"><a href="#cb242-124"></a></span>
<span id="cb242-125"><a href="#cb242-125"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb242-126"><a href="#cb242-126"></a>p1 <span class="sc">/</span> p2 <span class="sc">/</span> p3</span>
<span id="cb242-127"><a href="#cb242-127"></a><span class="in">```</span></span>
<span id="cb242-128"><a href="#cb242-128"></a></span>
<span id="cb242-129"><a href="#cb242-129"></a><span class="fu">### 15.1.2. 回归分析：预测购买金额</span></span>
<span id="cb242-130"><a href="#cb242-130"></a></span>
<span id="cb242-131"><a href="#cb242-131"></a>线性回归模型</span>
<span id="cb242-132"><a href="#cb242-132"></a></span>
<span id="cb242-135"><a href="#cb242-135"></a><span class="in">```{r}</span></span>
<span id="cb242-136"><a href="#cb242-136"></a><span class="co">#| label: r-regression</span></span>
<span id="cb242-137"><a href="#cb242-137"></a><span class="fu">library</span>(caret)</span>
<span id="cb242-138"><a href="#cb242-138"></a></span>
<span id="cb242-139"><a href="#cb242-139"></a><span class="co"># 准备数据</span></span>
<span id="cb242-140"><a href="#cb242-140"></a>reg_data <span class="ot">&lt;-</span> user_data <span class="sc">%&gt;%</span> </span>
<span id="cb242-141"><a href="#cb242-141"></a>  <span class="fu">select</span>(age, income, page_views, time_on_site, cart_additions, purchase_amount) <span class="sc">%&gt;%</span></span>
<span id="cb242-142"><a href="#cb242-142"></a>  <span class="fu">na.omit</span>()</span>
<span id="cb242-143"><a href="#cb242-143"></a></span>
<span id="cb242-144"><a href="#cb242-144"></a><span class="co"># 数据分割</span></span>
<span id="cb242-145"><a href="#cb242-145"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb242-146"><a href="#cb242-146"></a>train_index <span class="ot">&lt;-</span> <span class="fu">createDataPartition</span>(reg_data<span class="sc">$</span>purchase_amount, <span class="at">p =</span> <span class="fl">0.7</span>, <span class="at">list =</span> <span class="cn">FALSE</span>)</span>
<span id="cb242-147"><a href="#cb242-147"></a>train_reg <span class="ot">&lt;-</span> reg_data[train_index, ]</span>
<span id="cb242-148"><a href="#cb242-148"></a>test_reg <span class="ot">&lt;-</span> reg_data[<span class="sc">-</span>train_index, ]</span>
<span id="cb242-149"><a href="#cb242-149"></a></span>
<span id="cb242-150"><a href="#cb242-150"></a><span class="co"># 训练线性回归模型</span></span>
<span id="cb242-151"><a href="#cb242-151"></a>lm_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(purchase_amount <span class="sc">~</span> ., <span class="at">data =</span> train_reg)</span>
<span id="cb242-152"><a href="#cb242-152"></a><span class="fu">summary</span>(lm_model)</span>
<span id="cb242-153"><a href="#cb242-153"></a></span>
<span id="cb242-154"><a href="#cb242-154"></a><span class="co"># 预测</span></span>
<span id="cb242-155"><a href="#cb242-155"></a>predictions_lm <span class="ot">&lt;-</span> <span class="fu">predict</span>(lm_model, <span class="at">newdata =</span> test_reg)</span>
<span id="cb242-156"><a href="#cb242-156"></a></span>
<span id="cb242-157"><a href="#cb242-157"></a><span class="co"># 模型评估</span></span>
<span id="cb242-158"><a href="#cb242-158"></a>reg_metrics <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb242-159"><a href="#cb242-159"></a>  <span class="at">RMSE =</span> <span class="fu">RMSE</span>(predictions_lm, test_reg<span class="sc">$</span>purchase_amount),</span>
<span id="cb242-160"><a href="#cb242-160"></a>  <span class="at">MAE =</span> <span class="fu">MAE</span>(predictions_lm, test_reg<span class="sc">$</span>purchase_amount),</span>
<span id="cb242-161"><a href="#cb242-161"></a>  <span class="at">R2 =</span> <span class="fu">R2</span>(predictions_lm, test_reg<span class="sc">$</span>purchase_amount)</span>
<span id="cb242-162"><a href="#cb242-162"></a>)</span>
<span id="cb242-163"><a href="#cb242-163"></a><span class="fu">print</span>(reg_metrics)</span>
<span id="cb242-164"><a href="#cb242-164"></a><span class="in">```</span></span>
<span id="cb242-165"><a href="#cb242-165"></a></span>
<span id="cb242-166"><a href="#cb242-166"></a>回归结果可视化</span>
<span id="cb242-167"><a href="#cb242-167"></a></span>
<span id="cb242-170"><a href="#cb242-170"></a><span class="in">```{r}</span></span>
<span id="cb242-171"><a href="#cb242-171"></a><span class="co">#| label: r-regression-viz</span></span>
<span id="cb242-172"><a href="#cb242-172"></a><span class="co"># 预测 vs 实际值</span></span>
<span id="cb242-173"><a href="#cb242-173"></a>results_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb242-174"><a href="#cb242-174"></a>  <span class="at">Actual =</span> test_reg<span class="sc">$</span>purchase_amount,</span>
<span id="cb242-175"><a href="#cb242-175"></a>  <span class="at">Predicted =</span> predictions_lm</span>
<span id="cb242-176"><a href="#cb242-176"></a>)</span>
<span id="cb242-177"><a href="#cb242-177"></a></span>
<span id="cb242-178"><a href="#cb242-178"></a><span class="fu">ggplot</span>(results_df, <span class="fu">aes</span>(<span class="at">x =</span> Actual, <span class="at">y =</span> Predicted)) <span class="sc">+</span></span>
<span id="cb242-179"><a href="#cb242-179"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">color =</span> <span class="st">"steelblue"</span>) <span class="sc">+</span></span>
<span id="cb242-180"><a href="#cb242-180"></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>, <span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb242-181"><a href="#cb242-181"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"线性回归：预测值 vs 实际值"</span>,</span>
<span id="cb242-182"><a href="#cb242-182"></a>       <span class="at">subtitle =</span> <span class="fu">paste</span>(<span class="st">"R² ="</span>, <span class="fu">round</span>(reg_metrics<span class="sc">$</span>R2, <span class="dv">3</span>))) <span class="sc">+</span></span>
<span id="cb242-183"><a href="#cb242-183"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb242-184"><a href="#cb242-184"></a><span class="in">```</span></span>
<span id="cb242-185"><a href="#cb242-185"></a></span>
<span id="cb242-186"><a href="#cb242-186"></a>###15.1.3. 分类分析：预测购买意向</span>
<span id="cb242-187"><a href="#cb242-187"></a></span>
<span id="cb242-188"><a href="#cb242-188"></a>逻辑回归分类</span>
<span id="cb242-189"><a href="#cb242-189"></a></span>
<span id="cb242-192"><a href="#cb242-192"></a><span class="in">```{r}</span></span>
<span id="cb242-193"><a href="#cb242-193"></a><span class="co">#| label: r-classification</span></span>
<span id="cb242-194"><a href="#cb242-194"></a><span class="co"># 准备分类数据 - 确保因子水平一致</span></span>
<span id="cb242-195"><a href="#cb242-195"></a>class_data <span class="ot">&lt;-</span> user_data <span class="sc">%&gt;%</span> </span>
<span id="cb242-196"><a href="#cb242-196"></a>  <span class="fu">select</span>(age, income, page_views, time_on_site, cart_additions, made_purchase) <span class="sc">%&gt;%</span></span>
<span id="cb242-197"><a href="#cb242-197"></a>  <span class="fu">mutate</span>(<span class="at">made_purchase =</span> <span class="fu">factor</span>(made_purchase, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"No"</span>, <span class="st">"Yes"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb242-198"><a href="#cb242-198"></a>  <span class="fu">na.omit</span>()</span>
<span id="cb242-199"><a href="#cb242-199"></a></span>
<span id="cb242-200"><a href="#cb242-200"></a><span class="co"># 数据分割</span></span>
<span id="cb242-201"><a href="#cb242-201"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb242-202"><a href="#cb242-202"></a>train_index_class <span class="ot">&lt;-</span> <span class="fu">createDataPartition</span>(class_data<span class="sc">$</span>made_purchase, <span class="at">p =</span> <span class="fl">0.7</span>, <span class="at">list =</span> <span class="cn">FALSE</span>)</span>
<span id="cb242-203"><a href="#cb242-203"></a>train_class <span class="ot">&lt;-</span> class_data[train_index_class, ]</span>
<span id="cb242-204"><a href="#cb242-204"></a>test_class <span class="ot">&lt;-</span> class_data[<span class="sc">-</span>train_index_class, ]</span>
<span id="cb242-205"><a href="#cb242-205"></a></span>
<span id="cb242-206"><a href="#cb242-206"></a><span class="co"># 训练逻辑回归模型</span></span>
<span id="cb242-207"><a href="#cb242-207"></a>logit_model <span class="ot">&lt;-</span> <span class="fu">glm</span>(made_purchase <span class="sc">~</span> ., <span class="at">data =</span> train_class, <span class="at">family =</span> binomial)</span>
<span id="cb242-208"><a href="#cb242-208"></a><span class="fu">summary</span>(logit_model)</span>
<span id="cb242-209"><a href="#cb242-209"></a></span>
<span id="cb242-210"><a href="#cb242-210"></a><span class="co"># 预测概率</span></span>
<span id="cb242-211"><a href="#cb242-211"></a>prob_predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(logit_model, <span class="at">newdata =</span> test_class, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb242-212"><a href="#cb242-212"></a>class_predictions <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(prob_predictions <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="st">"Yes"</span>, <span class="st">"No"</span>)</span>
<span id="cb242-213"><a href="#cb242-213"></a>class_predictions <span class="ot">&lt;-</span> <span class="fu">factor</span>(class_predictions, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"No"</span>, <span class="st">"Yes"</span>))</span>
<span id="cb242-214"><a href="#cb242-214"></a></span>
<span id="cb242-215"><a href="#cb242-215"></a><span class="co"># 模型评估 - 修复因子水平问题</span></span>
<span id="cb242-216"><a href="#cb242-216"></a>conf_matrix <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(class_predictions, test_class<span class="sc">$</span>made_purchase, <span class="at">positive =</span> <span class="st">"Yes"</span>)</span>
<span id="cb242-217"><a href="#cb242-217"></a><span class="fu">print</span>(conf_matrix)</span>
<span id="cb242-218"><a href="#cb242-218"></a></span>
<span id="cb242-219"><a href="#cb242-219"></a><span class="co"># 绘制ROC曲线</span></span>
<span id="cb242-220"><a href="#cb242-220"></a><span class="fu">library</span>(pROC)</span>
<span id="cb242-221"><a href="#cb242-221"></a>roc_curve <span class="ot">&lt;-</span> <span class="fu">roc</span>(<span class="fu">as.numeric</span>(test_class<span class="sc">$</span>made_purchase) <span class="sc">-</span> <span class="dv">1</span>, prob_predictions)</span>
<span id="cb242-222"><a href="#cb242-222"></a><span class="fu">plot</span>(roc_curve, <span class="at">main =</span> <span class="st">"逻辑回归ROC曲线"</span>)</span>
<span id="cb242-223"><a href="#cb242-223"></a>auc_value <span class="ot">&lt;-</span> <span class="fu">auc</span>(roc_curve)</span>
<span id="cb242-224"><a href="#cb242-224"></a><span class="fu">legend</span>(<span class="st">"bottomright"</span>, <span class="at">legend =</span> <span class="fu">paste</span>(<span class="st">"AUC ="</span>, <span class="fu">round</span>(auc_value, <span class="dv">3</span>)))</span>
<span id="cb242-225"><a href="#cb242-225"></a><span class="in">```</span></span>
<span id="cb242-226"><a href="#cb242-226"></a></span>
<span id="cb242-227"><a href="#cb242-227"></a>随机森林分类</span>
<span id="cb242-228"><a href="#cb242-228"></a></span>
<span id="cb242-231"><a href="#cb242-231"></a><span class="in">```{r}</span></span>
<span id="cb242-232"><a href="#cb242-232"></a><span class="co">#| label: r-random-forest</span></span>
<span id="cb242-233"><a href="#cb242-233"></a><span class="fu">library</span>(randomForest)</span>
<span id="cb242-234"><a href="#cb242-234"></a></span>
<span id="cb242-235"><a href="#cb242-235"></a><span class="co"># 确保训练数据和测试数据的因子水平一致</span></span>
<span id="cb242-236"><a href="#cb242-236"></a>train_class<span class="sc">$</span>made_purchase <span class="ot">&lt;-</span> <span class="fu">factor</span>(train_class<span class="sc">$</span>made_purchase, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"No"</span>, <span class="st">"Yes"</span>))</span>
<span id="cb242-237"><a href="#cb242-237"></a>test_class<span class="sc">$</span>made_purchase <span class="ot">&lt;-</span> <span class="fu">factor</span>(test_class<span class="sc">$</span>made_purchase, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"No"</span>, <span class="st">"Yes"</span>))</span>
<span id="cb242-238"><a href="#cb242-238"></a></span>
<span id="cb242-239"><a href="#cb242-239"></a><span class="co"># 训练随机森林</span></span>
<span id="cb242-240"><a href="#cb242-240"></a>rf_model <span class="ot">&lt;-</span> <span class="fu">randomForest</span>(made_purchase <span class="sc">~</span> ., <span class="at">data =</span> train_class, <span class="at">ntree =</span> <span class="dv">100</span>)</span>
<span id="cb242-241"><a href="#cb242-241"></a></span>
<span id="cb242-242"><a href="#cb242-242"></a><span class="co"># 预测</span></span>
<span id="cb242-243"><a href="#cb242-243"></a>rf_predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(rf_model, <span class="at">newdata =</span> test_class)</span>
<span id="cb242-244"><a href="#cb242-244"></a></span>
<span id="cb242-245"><a href="#cb242-245"></a><span class="co"># 评估 - 确保因子水平一致</span></span>
<span id="cb242-246"><a href="#cb242-246"></a>rf_conf_matrix <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(rf_predictions, test_class<span class="sc">$</span>made_purchase, <span class="at">positive =</span> <span class="st">"Yes"</span>)</span>
<span id="cb242-247"><a href="#cb242-247"></a><span class="fu">print</span>(rf_conf_matrix)</span>
<span id="cb242-248"><a href="#cb242-248"></a></span>
<span id="cb242-249"><a href="#cb242-249"></a><span class="co"># 变量重要性</span></span>
<span id="cb242-250"><a href="#cb242-250"></a><span class="fu">varImpPlot</span>(rf_model, <span class="at">main =</span> <span class="st">"随机森林变量重要性"</span>)</span>
<span id="cb242-251"><a href="#cb242-251"></a></span>
<span id="cb242-252"><a href="#cb242-252"></a><span class="co"># 随机森林ROC曲线</span></span>
<span id="cb242-253"><a href="#cb242-253"></a>rf_prob <span class="ot">&lt;-</span> <span class="fu">predict</span>(rf_model, <span class="at">newdata =</span> test_class, <span class="at">type =</span> <span class="st">"prob"</span>)[, <span class="st">"Yes"</span>]</span>
<span id="cb242-254"><a href="#cb242-254"></a>rf_roc <span class="ot">&lt;-</span> <span class="fu">roc</span>(<span class="fu">as.numeric</span>(test_class<span class="sc">$</span>made_purchase) <span class="sc">-</span> <span class="dv">1</span>, rf_prob)</span>
<span id="cb242-255"><a href="#cb242-255"></a><span class="fu">plot</span>(rf_roc, <span class="at">main =</span> <span class="st">"随机森林ROC曲线"</span>)</span>
<span id="cb242-256"><a href="#cb242-256"></a>rf_auc <span class="ot">&lt;-</span> <span class="fu">auc</span>(rf_roc)</span>
<span id="cb242-257"><a href="#cb242-257"></a><span class="fu">legend</span>(<span class="st">"bottomright"</span>, <span class="at">legend =</span> <span class="fu">paste</span>(<span class="st">"AUC ="</span>, <span class="fu">round</span>(rf_auc, <span class="dv">3</span>)))</span>
<span id="cb242-258"><a href="#cb242-258"></a><span class="in">```</span></span>
<span id="cb242-259"><a href="#cb242-259"></a></span>
<span id="cb242-260"><a href="#cb242-260"></a>分类模型比较</span>
<span id="cb242-261"><a href="#cb242-261"></a></span>
<span id="cb242-262"><a href="#cb242-262"></a><span class="fu">### 15.1.4. 聚类分析：用户分群</span></span>
<span id="cb242-263"><a href="#cb242-263"></a></span>
<span id="cb242-264"><a href="#cb242-264"></a>K-means聚类</span>
<span id="cb242-265"><a href="#cb242-265"></a></span>
<span id="cb242-268"><a href="#cb242-268"></a><span class="in">```{r}</span></span>
<span id="cb242-269"><a href="#cb242-269"></a><span class="co">#| label: r-clustering</span></span>
<span id="cb242-270"><a href="#cb242-270"></a><span class="co"># 准备聚类数据</span></span>
<span id="cb242-271"><a href="#cb242-271"></a>cluster_data <span class="ot">&lt;-</span> user_data <span class="sc">%&gt;%</span></span>
<span id="cb242-272"><a href="#cb242-272"></a>  <span class="fu">select</span>(age, income, page_views, time_on_site, cart_additions) <span class="sc">%&gt;%</span></span>
<span id="cb242-273"><a href="#cb242-273"></a>  <span class="fu">scale</span>()  <span class="co"># 标准化</span></span>
<span id="cb242-274"><a href="#cb242-274"></a></span>
<span id="cb242-275"><a href="#cb242-275"></a><span class="co"># 确定最佳聚类数</span></span>
<span id="cb242-276"><a href="#cb242-276"></a>wss <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="cf">function</span>(k){<span class="fu">kmeans</span>(cluster_data, k, <span class="at">nstart =</span> <span class="dv">25</span>)<span class="sc">$</span>tot.withinss})</span>
<span id="cb242-277"><a href="#cb242-277"></a></span>
<span id="cb242-278"><a href="#cb242-278"></a><span class="fu">ggplot</span>(<span class="fu">data.frame</span>(<span class="at">k =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">wss =</span> wss), <span class="fu">aes</span>(<span class="at">x =</span> k, <span class="at">y =</span> wss)) <span class="sc">+</span></span>
<span id="cb242-279"><a href="#cb242-279"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb242-280"><a href="#cb242-280"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"肘部法则确定最佳聚类数"</span>, <span class="at">x =</span> <span class="st">"聚类数"</span>, <span class="at">y =</span> <span class="st">"组内平方和"</span>)</span>
<span id="cb242-281"><a href="#cb242-281"></a></span>
<span id="cb242-282"><a href="#cb242-282"></a><span class="co"># 执行K-means聚类</span></span>
<span id="cb242-283"><a href="#cb242-283"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb242-284"><a href="#cb242-284"></a>kmeans_result <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(cluster_data, <span class="at">centers =</span> <span class="dv">4</span>, <span class="at">nstart =</span> <span class="dv">25</span>)</span>
<span id="cb242-285"><a href="#cb242-285"></a></span>
<span id="cb242-286"><a href="#cb242-286"></a><span class="co"># 添加聚类标签</span></span>
<span id="cb242-287"><a href="#cb242-287"></a>user_data<span class="sc">$</span>cluster <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(kmeans_result<span class="sc">$</span>cluster)</span>
<span id="cb242-288"><a href="#cb242-288"></a></span>
<span id="cb242-289"><a href="#cb242-289"></a><span class="co"># 聚类结果可视化</span></span>
<span id="cb242-290"><a href="#cb242-290"></a><span class="fu">library</span>(factoextra)</span>
<span id="cb242-291"><a href="#cb242-291"></a><span class="fu">fviz_cluster</span>(kmeans_result, <span class="at">data =</span> cluster_data, </span>
<span id="cb242-292"><a href="#cb242-292"></a>             <span class="at">palette =</span> <span class="fu">c</span>(<span class="st">"#2E9FDF"</span>, <span class="st">"#00AFBB"</span>, <span class="st">"#E7B800"</span>, <span class="st">"#FC4E07"</span>),</span>
<span id="cb242-293"><a href="#cb242-293"></a>             <span class="at">geom =</span> <span class="st">"point"</span>,</span>
<span id="cb242-294"><a href="#cb242-294"></a>             <span class="at">ellipse.type =</span> <span class="st">"convex"</span>,</span>
<span id="cb242-295"><a href="#cb242-295"></a>             <span class="at">ggtheme =</span> <span class="fu">theme_bw</span>())</span>
<span id="cb242-296"><a href="#cb242-296"></a><span class="in">```</span></span>
<span id="cb242-297"><a href="#cb242-297"></a></span>
<span id="cb242-298"><a href="#cb242-298"></a>聚类分析</span>
<span id="cb242-299"><a href="#cb242-299"></a></span>
<span id="cb242-302"><a href="#cb242-302"></a><span class="in">```{r}</span></span>
<span id="cb242-303"><a href="#cb242-303"></a><span class="co">#| label: r-cluster-analysis</span></span>
<span id="cb242-304"><a href="#cb242-304"></a><span class="co"># 聚类特征分析</span></span>
<span id="cb242-305"><a href="#cb242-305"></a>cluster_summary <span class="ot">&lt;-</span> user_data <span class="sc">%&gt;%</span></span>
<span id="cb242-306"><a href="#cb242-306"></a>  <span class="fu">group_by</span>(cluster) <span class="sc">%&gt;%</span></span>
<span id="cb242-307"><a href="#cb242-307"></a>  <span class="fu">summarise</span>(</span>
<span id="cb242-308"><a href="#cb242-308"></a>    <span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb242-309"><a href="#cb242-309"></a>    <span class="at">avg_age =</span> <span class="fu">mean</span>(age),</span>
<span id="cb242-310"><a href="#cb242-310"></a>    <span class="at">avg_income =</span> <span class="fu">mean</span>(income),</span>
<span id="cb242-311"><a href="#cb242-311"></a>    <span class="at">avg_page_views =</span> <span class="fu">mean</span>(page_views),</span>
<span id="cb242-312"><a href="#cb242-312"></a>    <span class="at">avg_time =</span> <span class="fu">mean</span>(time_on_site),</span>
<span id="cb242-313"><a href="#cb242-313"></a>    <span class="at">purchase_rate =</span> <span class="fu">mean</span>(made_purchase),</span>
<span id="cb242-314"><a href="#cb242-314"></a>    <span class="at">avg_purchase =</span> <span class="fu">mean</span>(purchase_amount)</span>
<span id="cb242-315"><a href="#cb242-315"></a>  )</span>
<span id="cb242-316"><a href="#cb242-316"></a></span>
<span id="cb242-317"><a href="#cb242-317"></a><span class="fu">print</span>(cluster_summary)</span>
<span id="cb242-318"><a href="#cb242-318"></a></span>
<span id="cb242-319"><a href="#cb242-319"></a><span class="co"># 聚类特征可视化 - 修复版本</span></span>
<span id="cb242-320"><a href="#cb242-320"></a>cluster_features <span class="ot">&lt;-</span> user_data <span class="sc">%&gt;%</span></span>
<span id="cb242-321"><a href="#cb242-321"></a>  <span class="fu">select</span>(cluster, age, income, page_views, time_on_site, purchase_amount)</span>
<span id="cb242-322"><a href="#cb242-322"></a></span>
<span id="cb242-323"><a href="#cb242-323"></a><span class="co"># 使用tidyr::pivot_longer</span></span>
<span id="cb242-324"><a href="#cb242-324"></a>cluster_features_long <span class="ot">&lt;-</span> tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb242-325"><a href="#cb242-325"></a>  cluster_features,</span>
<span id="cb242-326"><a href="#cb242-326"></a>  <span class="at">cols =</span> <span class="sc">-</span>cluster,</span>
<span id="cb242-327"><a href="#cb242-327"></a>  <span class="at">names_to =</span> <span class="st">"Feature"</span>,</span>
<span id="cb242-328"><a href="#cb242-328"></a>  <span class="at">values_to =</span> <span class="st">"Value"</span></span>
<span id="cb242-329"><a href="#cb242-329"></a>)</span>
<span id="cb242-330"><a href="#cb242-330"></a></span>
<span id="cb242-331"><a href="#cb242-331"></a><span class="fu">ggplot</span>(cluster_features_long, <span class="fu">aes</span>(<span class="at">x =</span> cluster, <span class="at">y =</span> Value, <span class="at">fill =</span> cluster)) <span class="sc">+</span></span>
<span id="cb242-332"><a href="#cb242-332"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb242-333"><a href="#cb242-333"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> Feature, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb242-334"><a href="#cb242-334"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"各聚类群体特征分布"</span>) <span class="sc">+</span></span>
<span id="cb242-335"><a href="#cb242-335"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb242-336"><a href="#cb242-336"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb242-337"><a href="#cb242-337"></a><span class="in">```</span></span>
<span id="cb242-338"><a href="#cb242-338"></a></span>
<span id="cb242-339"><a href="#cb242-339"></a><span class="fu">### 15.1.5. 关联分析：商品购买关联规则</span></span>
<span id="cb242-340"><a href="#cb242-340"></a></span>
<span id="cb242-341"><a href="#cb242-341"></a>Apriori算法</span>
<span id="cb242-342"><a href="#cb242-342"></a></span>
<span id="cb242-345"><a href="#cb242-345"></a><span class="in">```{r}</span></span>
<span id="cb242-346"><a href="#cb242-346"></a><span class="co">#| label: r-association</span></span>
<span id="cb242-347"><a href="#cb242-347"></a><span class="fu">library</span>(arules)</span>
<span id="cb242-348"><a href="#cb242-348"></a></span>
<span id="cb242-349"><a href="#cb242-349"></a><span class="co"># 准备关联分析数据 - 只包含产品购买列</span></span>
<span id="cb242-350"><a href="#cb242-350"></a>transaction_data <span class="ot">&lt;-</span> user_data <span class="sc">%&gt;%</span></span>
<span id="cb242-351"><a href="#cb242-351"></a>  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"bought_"</span>))</span>
<span id="cb242-352"><a href="#cb242-352"></a></span>
<span id="cb242-353"><a href="#cb242-353"></a><span class="co"># 转换为事务数据</span></span>
<span id="cb242-354"><a href="#cb242-354"></a>transactions <span class="ot">&lt;-</span> <span class="fu">as</span>(transaction_data, <span class="st">"transactions"</span>)</span>
<span id="cb242-355"><a href="#cb242-355"></a></span>
<span id="cb242-356"><a href="#cb242-356"></a><span class="co"># 查看事务数据概览</span></span>
<span id="cb242-357"><a href="#cb242-357"></a><span class="fu">summary</span>(transactions)</span>
<span id="cb242-358"><a href="#cb242-358"></a></span>
<span id="cb242-359"><a href="#cb242-359"></a><span class="co"># 查看产品频率</span></span>
<span id="cb242-360"><a href="#cb242-360"></a>itemFrequency <span class="ot">&lt;-</span> <span class="fu">itemFrequency</span>(transactions)</span>
<span id="cb242-361"><a href="#cb242-361"></a><span class="fu">print</span>(<span class="st">"产品购买频率:"</span>)</span>
<span id="cb242-362"><a href="#cb242-362"></a><span class="fu">print</span>(<span class="fu">sort</span>(itemFrequency, <span class="at">decreasing =</span> <span class="cn">TRUE</span>))</span>
<span id="cb242-363"><a href="#cb242-363"></a></span>
<span id="cb242-364"><a href="#cb242-364"></a><span class="co"># 使用更宽松的参数挖掘关联规则</span></span>
<span id="cb242-365"><a href="#cb242-365"></a>rules <span class="ot">&lt;-</span> <span class="fu">apriori</span>(transactions, </span>
<span id="cb242-366"><a href="#cb242-366"></a>                 <span class="at">parameter =</span> <span class="fu">list</span>(<span class="at">support =</span> <span class="fl">0.05</span>,  <span class="co"># 降低支持度阈值</span></span>
<span id="cb242-367"><a href="#cb242-367"></a>                                 <span class="at">confidence =</span> <span class="fl">0.3</span>,  <span class="co"># 降低置信度阈值</span></span>
<span id="cb242-368"><a href="#cb242-368"></a>                                 <span class="at">minlen =</span> <span class="dv">2</span>,        <span class="co"># 最小规则长度</span></span>
<span id="cb242-369"><a href="#cb242-369"></a>                                 <span class="at">maxlen =</span> <span class="dv">4</span>))       <span class="co"># 最大规则长度</span></span>
<span id="cb242-370"><a href="#cb242-370"></a></span>
<span id="cb242-371"><a href="#cb242-371"></a><span class="co"># 规则摘要</span></span>
<span id="cb242-372"><a href="#cb242-372"></a><span class="fu">cat</span>(<span class="st">"找到的规则数量:"</span>, <span class="fu">length</span>(rules), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb242-373"><a href="#cb242-373"></a><span class="fu">summary</span>(rules)</span>
<span id="cb242-374"><a href="#cb242-374"></a></span>
<span id="cb242-375"><a href="#cb242-375"></a><span class="co"># 查看规则</span></span>
<span id="cb242-376"><a href="#cb242-376"></a><span class="cf">if</span>(<span class="fu">length</span>(rules) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb242-377"><a href="#cb242-377"></a>  <span class="co"># 按提升度排序</span></span>
<span id="cb242-378"><a href="#cb242-378"></a>  rules_sorted <span class="ot">&lt;-</span> <span class="fu">sort</span>(rules, <span class="at">by =</span> <span class="st">"lift"</span>, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb242-379"><a href="#cb242-379"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">前10条关联规则 (按提升度排序):</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb242-380"><a href="#cb242-380"></a>  <span class="fu">inspect</span>(<span class="fu">head</span>(rules_sorted, <span class="dv">10</span>))</span>
<span id="cb242-381"><a href="#cb242-381"></a>} <span class="cf">else</span> {</span>
<span id="cb242-382"><a href="#cb242-382"></a>  <span class="fu">cat</span>(<span class="st">"没有找到关联规则，请进一步降低阈值参数</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb242-383"><a href="#cb242-383"></a>}</span>
<span id="cb242-384"><a href="#cb242-384"></a><span class="in">```</span></span>
<span id="cb242-385"><a href="#cb242-385"></a></span>
<span id="cb242-386"><a href="#cb242-386"></a>关联规则可视化</span>
<span id="cb242-387"><a href="#cb242-387"></a></span>
<span id="cb242-390"><a href="#cb242-390"></a><span class="in">```{r}</span></span>
<span id="cb242-391"><a href="#cb242-391"></a><span class="co">#| label: r-association-viz</span></span>
<span id="cb242-392"><a href="#cb242-392"></a><span class="fu">library</span>(arulesViz)</span>
<span id="cb242-393"><a href="#cb242-393"></a></span>
<span id="cb242-394"><a href="#cb242-394"></a><span class="cf">if</span>(<span class="fu">length</span>(rules) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb242-395"><a href="#cb242-395"></a>  <span class="co"># 选择前20条规则进行可视化</span></span>
<span id="cb242-396"><a href="#cb242-396"></a>  rules_for_plot <span class="ot">&lt;-</span> <span class="fu">head</span>(<span class="fu">sort</span>(rules, <span class="at">by =</span> <span class="st">"lift"</span>), <span class="fu">min</span>(<span class="dv">20</span>, <span class="fu">length</span>(rules)))</span>
<span id="cb242-397"><a href="#cb242-397"></a>  </span>
<span id="cb242-398"><a href="#cb242-398"></a>  <span class="co"># 散点图</span></span>
<span id="cb242-399"><a href="#cb242-399"></a>  plot1 <span class="ot">&lt;-</span> <span class="fu">plot</span>(rules_for_plot, <span class="at">method =</span> <span class="st">"scatter"</span>, </span>
<span id="cb242-400"><a href="#cb242-400"></a>               <span class="at">main =</span> <span class="st">"关联规则散点图 (支持度 vs 置信度)"</span>)</span>
<span id="cb242-401"><a href="#cb242-401"></a>  </span>
<span id="cb242-402"><a href="#cb242-402"></a>  <span class="co"># 矩阵图</span></span>
<span id="cb242-403"><a href="#cb242-403"></a>  plot2 <span class="ot">&lt;-</span> <span class="fu">plot</span>(rules_for_plot, <span class="at">method =</span> <span class="st">"matrix"</span>, </span>
<span id="cb242-404"><a href="#cb242-404"></a>               <span class="at">main =</span> <span class="st">"关联规则矩阵图"</span>)</span>
<span id="cb242-405"><a href="#cb242-405"></a>  </span>
<span id="cb242-406"><a href="#cb242-406"></a>  <span class="co"># 分组图</span></span>
<span id="cb242-407"><a href="#cb242-407"></a>  plot3 <span class="ot">&lt;-</span> <span class="fu">plot</span>(rules_for_plot, <span class="at">method =</span> <span class="st">"grouped"</span>,</span>
<span id="cb242-408"><a href="#cb242-408"></a>               <span class="at">main =</span> <span class="st">"关联规则分组图"</span>)</span>
<span id="cb242-409"><a href="#cb242-409"></a>  </span>
<span id="cb242-410"><a href="#cb242-410"></a>  <span class="co"># 显示图形</span></span>
<span id="cb242-411"><a href="#cb242-411"></a>  plot1</span>
<span id="cb242-412"><a href="#cb242-412"></a>  plot2</span>
<span id="cb242-413"><a href="#cb242-413"></a>  plot3</span>
<span id="cb242-414"><a href="#cb242-414"></a>  </span>
<span id="cb242-415"><a href="#cb242-415"></a>} <span class="cf">else</span> {</span>
<span id="cb242-416"><a href="#cb242-416"></a>  <span class="fu">cat</span>(<span class="st">"没有足够的规则进行可视化</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb242-417"><a href="#cb242-417"></a>  </span>
<span id="cb242-418"><a href="#cb242-418"></a>  <span class="co"># 显示产品共现矩阵作为替代</span></span>
<span id="cb242-419"><a href="#cb242-419"></a>  item_matrix <span class="ot">&lt;-</span> <span class="fu">crossTable</span>(transactions)</span>
<span id="cb242-420"><a href="#cb242-420"></a>  <span class="fu">corrplot</span>(item_matrix, <span class="at">method =</span> <span class="st">"color"</span>, </span>
<span id="cb242-421"><a href="#cb242-421"></a>           <span class="at">title =</span> <span class="st">"产品共现热图"</span>,</span>
<span id="cb242-422"><a href="#cb242-422"></a>           <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">0</span>))</span>
<span id="cb242-423"><a href="#cb242-423"></a>}</span>
<span id="cb242-424"><a href="#cb242-424"></a><span class="in">```</span></span>
<span id="cb242-425"><a href="#cb242-425"></a></span>
<span id="cb242-426"><a href="#cb242-426"></a><span class="fu">## 15.2 Python实现</span></span>
<span id="cb242-427"><a href="#cb242-427"></a></span>
<span id="cb242-428"><a href="#cb242-428"></a>数据准备</span>
<span id="cb242-429"><a href="#cb242-429"></a></span>
<span id="cb242-432"><a href="#cb242-432"></a><span class="in">```{python}</span></span>
<span id="cb242-433"><a href="#cb242-433"></a><span class="co">#| label: python-setup</span></span>
<span id="cb242-434"><a href="#cb242-434"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb242-435"><a href="#cb242-435"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb242-436"><a href="#cb242-436"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb242-437"><a href="#cb242-437"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb242-438"><a href="#cb242-438"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb242-439"><a href="#cb242-439"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb242-440"><a href="#cb242-440"></a><span class="im">import</span> warnings</span>
<span id="cb242-441"><a href="#cb242-441"></a>warnings.filterwarnings(<span class="st">'ignore'</span>)</span>
<span id="cb242-442"><a href="#cb242-442"></a></span>
<span id="cb242-443"><a href="#cb242-443"></a><span class="co"># 设置中文字体</span></span>
<span id="cb242-444"><a href="#cb242-444"></a>plt.rcParams[<span class="st">'font.sans-serif'</span>] <span class="op">=</span> [<span class="st">'SimHei'</span>]</span>
<span id="cb242-445"><a href="#cb242-445"></a>plt.rcParams[<span class="st">'axes.unicode_minus'</span>] <span class="op">=</span> <span class="va">False</span></span>
<span id="cb242-446"><a href="#cb242-446"></a></span>
<span id="cb242-447"><a href="#cb242-447"></a><span class="co"># 生成相同的模拟数据</span></span>
<span id="cb242-448"><a href="#cb242-448"></a>np.random.seed(<span class="dv">123</span>)</span>
<span id="cb242-449"><a href="#cb242-449"></a>n <span class="op">=</span> <span class="dv">1000</span></span>
<span id="cb242-450"><a href="#cb242-450"></a></span>
<span id="cb242-451"><a href="#cb242-451"></a>python_user_data <span class="op">=</span> pd.DataFrame({</span>
<span id="cb242-452"><a href="#cb242-452"></a>    <span class="st">'user_id'</span>: <span class="bu">range</span>(<span class="dv">1</span>, n<span class="op">+</span><span class="dv">1</span>),</span>
<span id="cb242-453"><a href="#cb242-453"></a>    <span class="st">'age'</span>: np.random.randint(<span class="dv">18</span>, <span class="dv">66</span>, n),</span>
<span id="cb242-454"><a href="#cb242-454"></a>    <span class="st">'gender'</span>: np.random.choice([<span class="st">'Male'</span>, <span class="st">'Female'</span>], n, p<span class="op">=</span>[<span class="fl">0.48</span>, <span class="fl">0.52</span>]),</span>
<span id="cb242-455"><a href="#cb242-455"></a>    <span class="st">'income'</span>: np.random.normal(<span class="dv">50000</span>, <span class="dv">15000</span>, n).<span class="bu">round</span>(),</span>
<span id="cb242-456"><a href="#cb242-456"></a>    <span class="st">'region'</span>: np.random.choice([<span class="st">'North'</span>, <span class="st">'South'</span>, <span class="st">'East'</span>, <span class="st">'West'</span>], n),</span>
<span id="cb242-457"><a href="#cb242-457"></a>    <span class="st">'days_since_signup'</span>: np.random.randint(<span class="dv">1</span>, <span class="dv">366</span>, n),</span>
<span id="cb242-458"><a href="#cb242-458"></a>    <span class="st">'page_views'</span>: np.random.poisson(<span class="dv">25</span>, n),</span>
<span id="cb242-459"><a href="#cb242-459"></a>    <span class="st">'time_on_site'</span>: np.random.normal(<span class="dv">300</span>, <span class="dv">120</span>, n).<span class="bu">round</span>(),</span>
<span id="cb242-460"><a href="#cb242-460"></a>    <span class="st">'cart_additions'</span>: np.random.poisson(<span class="dv">5</span>, n)</span>
<span id="cb242-461"><a href="#cb242-461"></a>})</span>
<span id="cb242-462"><a href="#cb242-462"></a></span>
<span id="cb242-463"><a href="#cb242-463"></a><span class="co"># 生成购买行为</span></span>
<span id="cb242-464"><a href="#cb242-464"></a>python_user_data[<span class="st">'purchase_amount'</span>] <span class="op">=</span> (</span>
<span id="cb242-465"><a href="#cb242-465"></a>    <span class="dv">50</span> <span class="op">+</span> <span class="fl">0.3</span> <span class="op">*</span> python_user_data[<span class="st">'income'</span>]<span class="op">/</span><span class="dv">1000</span> <span class="op">+</span> </span>
<span id="cb242-466"><a href="#cb242-466"></a>    <span class="fl">0.5</span> <span class="op">*</span> python_user_data[<span class="st">'page_views'</span>] <span class="op">+</span> </span>
<span id="cb242-467"><a href="#cb242-467"></a>    <span class="fl">0.8</span> <span class="op">*</span> python_user_data[<span class="st">'time_on_site'</span>]<span class="op">/</span><span class="dv">60</span> <span class="op">+</span> </span>
<span id="cb242-468"><a href="#cb242-468"></a>    <span class="dv">2</span> <span class="op">*</span> python_user_data[<span class="st">'cart_additions'</span>] <span class="op">+</span> </span>
<span id="cb242-469"><a href="#cb242-469"></a>    np.random.normal(<span class="dv">0</span>, <span class="dv">20</span>, n)</span>
<span id="cb242-470"><a href="#cb242-470"></a>)</span>
<span id="cb242-471"><a href="#cb242-471"></a></span>
<span id="cb242-472"><a href="#cb242-472"></a>python_user_data[<span class="st">'made_purchase'</span>] <span class="op">=</span> (python_user_data[<span class="st">'purchase_amount'</span>] <span class="op">&gt;</span> <span class="dv">120</span>).astype(<span class="bu">int</span>)</span>
<span id="cb242-473"><a href="#cb242-473"></a></span>
<span id="cb242-474"><a href="#cb242-474"></a><span class="co"># 添加产品类别 - 创建相关性</span></span>
<span id="cb242-475"><a href="#cb242-475"></a>products <span class="op">=</span> [<span class="st">'electronics'</span>, <span class="st">'clothing'</span>, <span class="st">'books'</span>, <span class="st">'home'</span>, <span class="st">'sports'</span>]</span>
<span id="cb242-476"><a href="#cb242-476"></a>base_prob <span class="op">=</span> <span class="fl">0.4</span></span>
<span id="cb242-477"><a href="#cb242-477"></a></span>
<span id="cb242-478"><a href="#cb242-478"></a>python_user_data[<span class="st">'bought_electronics'</span>] <span class="op">=</span> np.random.binomial(<span class="dv">1</span>, base_prob, n)</span>
<span id="cb242-479"><a href="#cb242-479"></a></span>
<span id="cb242-480"><a href="#cb242-480"></a><span class="co"># 创建相关产品</span></span>
<span id="cb242-481"><a href="#cb242-481"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="bu">len</span>(products)):</span>
<span id="cb242-482"><a href="#cb242-482"></a>    prev_product <span class="op">=</span> <span class="ss">f'bought_</span><span class="sc">{</span>products[i<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss">'</span></span>
<span id="cb242-483"><a href="#cb242-483"></a>    current_product <span class="op">=</span> <span class="ss">f'bought_</span><span class="sc">{</span>products[i]<span class="sc">}</span><span class="ss">'</span></span>
<span id="cb242-484"><a href="#cb242-484"></a>    correlated_prob <span class="op">=</span> python_user_data[prev_product] <span class="op">*</span> <span class="fl">0.3</span> <span class="op">+</span> base_prob</span>
<span id="cb242-485"><a href="#cb242-485"></a>    python_user_data[current_product] <span class="op">=</span> np.random.binomial(<span class="dv">1</span>, np.minimum(correlated_prob, <span class="fl">0.8</span>), n)</span>
<span id="cb242-486"><a href="#cb242-486"></a></span>
<span id="cb242-487"><a href="#cb242-487"></a><span class="bu">print</span>(<span class="st">"Python数据概览:"</span>)</span>
<span id="cb242-488"><a href="#cb242-488"></a><span class="bu">print</span>(python_user_data.head())</span>
<span id="cb242-489"><a href="#cb242-489"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">数据形状: </span><span class="sc">{</span>python_user_data<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb242-490"><a href="#cb242-490"></a></span>
<span id="cb242-491"><a href="#cb242-491"></a><span class="co"># 产品购买频率</span></span>
<span id="cb242-492"><a href="#cb242-492"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">产品购买频率:"</span>)</span>
<span id="cb242-493"><a href="#cb242-493"></a><span class="cf">for</span> product <span class="kw">in</span> products:</span>
<span id="cb242-494"><a href="#cb242-494"></a>    col_name <span class="op">=</span> <span class="ss">f'bought_</span><span class="sc">{</span>product<span class="sc">}</span><span class="ss">'</span></span>
<span id="cb242-495"><a href="#cb242-495"></a>    freq <span class="op">=</span> python_user_data[col_name].mean()</span>
<span id="cb242-496"><a href="#cb242-496"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>product<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>freq<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb242-497"><a href="#cb242-497"></a><span class="in">```</span></span>
<span id="cb242-498"><a href="#cb242-498"></a></span>
<span id="cb242-499"><a href="#cb242-499"></a><span class="fu">### 15.2.2 Python回归分析</span></span>
<span id="cb242-500"><a href="#cb242-500"></a></span>
<span id="cb242-503"><a href="#cb242-503"></a><span class="in">```{python}</span></span>
<span id="cb242-504"><a href="#cb242-504"></a><span class="co">#| label: python-regression</span></span>
<span id="cb242-505"><a href="#cb242-505"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LinearRegression</span>
<span id="cb242-506"><a href="#cb242-506"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestRegressor</span>
<span id="cb242-507"><a href="#cb242-507"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error, r2_score, mean_absolute_error</span>
<span id="cb242-508"><a href="#cb242-508"></a></span>
<span id="cb242-509"><a href="#cb242-509"></a><span class="co"># 准备回归数据</span></span>
<span id="cb242-510"><a href="#cb242-510"></a>reg_features <span class="op">=</span> [<span class="st">'age'</span>, <span class="st">'income'</span>, <span class="st">'page_views'</span>, <span class="st">'time_on_site'</span>, <span class="st">'cart_additions'</span>]</span>
<span id="cb242-511"><a href="#cb242-511"></a>X_reg <span class="op">=</span> python_user_data[reg_features]</span>
<span id="cb242-512"><a href="#cb242-512"></a>y_reg <span class="op">=</span> python_user_data[<span class="st">'purchase_amount'</span>]</span>
<span id="cb242-513"><a href="#cb242-513"></a></span>
<span id="cb242-514"><a href="#cb242-514"></a><span class="co"># 数据分割</span></span>
<span id="cb242-515"><a href="#cb242-515"></a>X_train_reg, X_test_reg, y_train_reg, y_test_reg <span class="op">=</span> train_test_split(</span>
<span id="cb242-516"><a href="#cb242-516"></a>    X_reg, y_reg, test_size<span class="op">=</span><span class="fl">0.3</span>, random_state<span class="op">=</span><span class="dv">123</span>)</span>
<span id="cb242-517"><a href="#cb242-517"></a></span>
<span id="cb242-518"><a href="#cb242-518"></a><span class="co"># 线性回归</span></span>
<span id="cb242-519"><a href="#cb242-519"></a>lr_model <span class="op">=</span> LinearRegression()</span>
<span id="cb242-520"><a href="#cb242-520"></a>lr_model.fit(X_train_reg, y_train_reg)</span>
<span id="cb242-521"><a href="#cb242-521"></a>y_pred_lr <span class="op">=</span> lr_model.predict(X_test_reg)</span>
<span id="cb242-522"><a href="#cb242-522"></a></span>
<span id="cb242-523"><a href="#cb242-523"></a><span class="co"># 随机森林回归</span></span>
<span id="cb242-524"><a href="#cb242-524"></a>rf_reg_model <span class="op">=</span> RandomForestRegressor(n_estimators<span class="op">=</span><span class="dv">100</span>, random_state<span class="op">=</span><span class="dv">123</span>)</span>
<span id="cb242-525"><a href="#cb242-525"></a>rf_reg_model.fit(X_train_reg, y_train_reg)</span>
<span id="cb242-526"><a href="#cb242-526"></a>y_pred_rf <span class="op">=</span> rf_reg_model.predict(X_test_reg)</span>
<span id="cb242-527"><a href="#cb242-527"></a></span>
<span id="cb242-528"><a href="#cb242-528"></a><span class="co"># 模型评估</span></span>
<span id="cb242-529"><a href="#cb242-529"></a><span class="kw">def</span> evaluate_regression(y_true, y_pred, model_name):</span>
<span id="cb242-530"><a href="#cb242-530"></a>    mse <span class="op">=</span> mean_squared_error(y_true, y_pred)</span>
<span id="cb242-531"><a href="#cb242-531"></a>    mae <span class="op">=</span> mean_absolute_error(y_true, y_pred)</span>
<span id="cb242-532"><a href="#cb242-532"></a>    r2 <span class="op">=</span> r2_score(y_true, y_pred)</span>
<span id="cb242-533"><a href="#cb242-533"></a>    </span>
<span id="cb242-534"><a href="#cb242-534"></a>    results <span class="op">=</span> {</span>
<span id="cb242-535"><a href="#cb242-535"></a>        <span class="st">'Model'</span>: model_name,</span>
<span id="cb242-536"><a href="#cb242-536"></a>        <span class="st">'RMSE'</span>: np.sqrt(mse),</span>
<span id="cb242-537"><a href="#cb242-537"></a>        <span class="st">'MAE'</span>: mae,</span>
<span id="cb242-538"><a href="#cb242-538"></a>        <span class="st">'R2'</span>: r2</span>
<span id="cb242-539"><a href="#cb242-539"></a>    }</span>
<span id="cb242-540"><a href="#cb242-540"></a>    <span class="cf">return</span> results</span>
<span id="cb242-541"><a href="#cb242-541"></a></span>
<span id="cb242-542"><a href="#cb242-542"></a>lr_metrics <span class="op">=</span> evaluate_regression(y_test_reg, y_pred_lr, <span class="st">'Linear Regression'</span>)</span>
<span id="cb242-543"><a href="#cb242-543"></a>rf_metrics <span class="op">=</span> evaluate_regression(y_test_reg, y_pred_rf, <span class="st">'Random Forest'</span>)</span>
<span id="cb242-544"><a href="#cb242-544"></a></span>
<span id="cb242-545"><a href="#cb242-545"></a>regression_results <span class="op">=</span> pd.DataFrame([lr_metrics, rf_metrics])</span>
<span id="cb242-546"><a href="#cb242-546"></a><span class="bu">print</span>(<span class="st">"回归模型性能比较:"</span>)</span>
<span id="cb242-547"><a href="#cb242-547"></a><span class="bu">print</span>(regression_results)</span>
<span id="cb242-548"><a href="#cb242-548"></a></span>
<span id="cb242-549"><a href="#cb242-549"></a><span class="co"># 可视化回归结果</span></span>
<span id="cb242-550"><a href="#cb242-550"></a>fig, (ax1, ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">5</span>))</span>
<span id="cb242-551"><a href="#cb242-551"></a></span>
<span id="cb242-552"><a href="#cb242-552"></a><span class="co"># 线性回归结果</span></span>
<span id="cb242-553"><a href="#cb242-553"></a>ax1.scatter(y_test_reg, y_pred_lr, alpha<span class="op">=</span><span class="fl">0.6</span>)</span>
<span id="cb242-554"><a href="#cb242-554"></a>ax1.plot([y_test_reg.<span class="bu">min</span>(), y_test_reg.<span class="bu">max</span>()], [y_test_reg.<span class="bu">min</span>(), y_test_reg.<span class="bu">max</span>()], <span class="st">'r--'</span>, lw<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb242-555"><a href="#cb242-555"></a>ax1.set_xlabel(<span class="st">'实际值'</span>)</span>
<span id="cb242-556"><a href="#cb242-556"></a>ax1.set_ylabel(<span class="st">'预测值'</span>)</span>
<span id="cb242-557"><a href="#cb242-557"></a>ax1.set_title(<span class="ss">f'线性回归 (R² = </span><span class="sc">{</span>lr_metrics[<span class="st">"R2"</span>]<span class="sc">:.3f}</span><span class="ss">)'</span>)</span>
<span id="cb242-558"><a href="#cb242-558"></a></span>
<span id="cb242-559"><a href="#cb242-559"></a><span class="co"># 随机森林结果</span></span>
<span id="cb242-560"><a href="#cb242-560"></a>ax2.scatter(y_test_reg, y_pred_rf, alpha<span class="op">=</span><span class="fl">0.6</span>)</span>
<span id="cb242-561"><a href="#cb242-561"></a>ax2.plot([y_test_reg.<span class="bu">min</span>(), y_test_reg.<span class="bu">max</span>()], [y_test_reg.<span class="bu">min</span>(), y_test_reg.<span class="bu">max</span>()], <span class="st">'r--'</span>, lw<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb242-562"><a href="#cb242-562"></a>ax2.set_xlabel(<span class="st">'实际值'</span>)</span>
<span id="cb242-563"><a href="#cb242-563"></a>ax2.set_ylabel(<span class="st">'预测值'</span>)</span>
<span id="cb242-564"><a href="#cb242-564"></a>ax2.set_title(<span class="ss">f'随机森林回归 (R² = </span><span class="sc">{</span>rf_metrics[<span class="st">"R2"</span>]<span class="sc">:.3f}</span><span class="ss">)'</span>)</span>
<span id="cb242-565"><a href="#cb242-565"></a></span>
<span id="cb242-566"><a href="#cb242-566"></a>plt.tight_layout()</span>
<span id="cb242-567"><a href="#cb242-567"></a>plt.show()</span>
<span id="cb242-568"><a href="#cb242-568"></a><span class="in">```</span></span>
<span id="cb242-569"><a href="#cb242-569"></a></span>
<span id="cb242-570"><a href="#cb242-570"></a><span class="fu">### 15.2.3 Python分类分析</span></span>
<span id="cb242-571"><a href="#cb242-571"></a></span>
<span id="cb242-574"><a href="#cb242-574"></a><span class="in">```{python}</span></span>
<span id="cb242-575"><a href="#cb242-575"></a><span class="co">#| label: python-classification</span></span>
<span id="cb242-576"><a href="#cb242-576"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LogisticRegression</span>
<span id="cb242-577"><a href="#cb242-577"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestClassifier</span>
<span id="cb242-578"><a href="#cb242-578"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> classification_report, confusion_matrix, accuracy_score, roc_auc_score, roc_curve</span>
<span id="cb242-579"><a href="#cb242-579"></a></span>
<span id="cb242-580"><a href="#cb242-580"></a><span class="co"># 准备分类数据</span></span>
<span id="cb242-581"><a href="#cb242-581"></a>class_features <span class="op">=</span> [<span class="st">'age'</span>, <span class="st">'income'</span>, <span class="st">'page_views'</span>, <span class="st">'time_on_site'</span>, <span class="st">'cart_additions'</span>]</span>
<span id="cb242-582"><a href="#cb242-582"></a>X_class <span class="op">=</span> python_user_data[class_features]</span>
<span id="cb242-583"><a href="#cb242-583"></a>y_class <span class="op">=</span> python_user_data[<span class="st">'made_purchase'</span>]</span>
<span id="cb242-584"><a href="#cb242-584"></a></span>
<span id="cb242-585"><a href="#cb242-585"></a><span class="co"># 数据分割</span></span>
<span id="cb242-586"><a href="#cb242-586"></a>X_train_class, X_test_class, y_train_class, y_test_class <span class="op">=</span> train_test_split(</span>
<span id="cb242-587"><a href="#cb242-587"></a>    X_class, y_class, test_size<span class="op">=</span><span class="fl">0.3</span>, random_state<span class="op">=</span><span class="dv">123</span>, stratify<span class="op">=</span>y_class)</span>
<span id="cb242-588"><a href="#cb242-588"></a></span>
<span id="cb242-589"><a href="#cb242-589"></a><span class="co"># 逻辑回归</span></span>
<span id="cb242-590"><a href="#cb242-590"></a>logit_model <span class="op">=</span> LogisticRegression(random_state<span class="op">=</span><span class="dv">123</span>)</span>
<span id="cb242-591"><a href="#cb242-591"></a>logit_model.fit(X_train_class, y_train_class)</span>
<span id="cb242-592"><a href="#cb242-592"></a>y_pred_logit <span class="op">=</span> logit_model.predict(X_test_class)</span>
<span id="cb242-593"><a href="#cb242-593"></a>y_pred_logit_proba <span class="op">=</span> logit_model.predict_proba(X_test_class)[:, <span class="dv">1</span>]</span>
<span id="cb242-594"><a href="#cb242-594"></a></span>
<span id="cb242-595"><a href="#cb242-595"></a><span class="co"># 随机森林分类</span></span>
<span id="cb242-596"><a href="#cb242-596"></a>rf_class_model <span class="op">=</span> RandomForestClassifier(n_estimators<span class="op">=</span><span class="dv">100</span>, random_state<span class="op">=</span><span class="dv">123</span>)</span>
<span id="cb242-597"><a href="#cb242-597"></a>rf_class_model.fit(X_train_class, y_train_class)</span>
<span id="cb242-598"><a href="#cb242-598"></a>y_pred_rf_class <span class="op">=</span> rf_class_model.predict(X_test_class)</span>
<span id="cb242-599"><a href="#cb242-599"></a>y_pred_rf_proba <span class="op">=</span> rf_class_model.predict_proba(X_test_class)[:, <span class="dv">1</span>]</span>
<span id="cb242-600"><a href="#cb242-600"></a></span>
<span id="cb242-601"><a href="#cb242-601"></a><span class="co"># 模型评估</span></span>
<span id="cb242-602"><a href="#cb242-602"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">50</span>)</span>
<span id="cb242-603"><a href="#cb242-603"></a><span class="bu">print</span>(<span class="st">"逻辑回归性能:"</span>)</span>
<span id="cb242-604"><a href="#cb242-604"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">50</span>)</span>
<span id="cb242-605"><a href="#cb242-605"></a><span class="bu">print</span>(classification_report(y_test_class, y_pred_logit))</span>
<span id="cb242-606"><a href="#cb242-606"></a>logit_accuracy <span class="op">=</span> accuracy_score(y_test_class, y_pred_logit)</span>
<span id="cb242-607"><a href="#cb242-607"></a>logit_auc <span class="op">=</span> roc_auc_score(y_test_class, y_pred_logit_proba)</span>
<span id="cb242-608"><a href="#cb242-608"></a><span class="bu">print</span>(<span class="ss">f"准确率: </span><span class="sc">{</span>logit_accuracy<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb242-609"><a href="#cb242-609"></a><span class="bu">print</span>(<span class="ss">f"AUC: </span><span class="sc">{</span>logit_auc<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb242-610"><a href="#cb242-610"></a></span>
<span id="cb242-611"><a href="#cb242-611"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"="</span> <span class="op">*</span> <span class="dv">50</span>)</span>
<span id="cb242-612"><a href="#cb242-612"></a><span class="bu">print</span>(<span class="st">"随机森林性能:"</span>)</span>
<span id="cb242-613"><a href="#cb242-613"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">50</span>)</span>
<span id="cb242-614"><a href="#cb242-614"></a><span class="bu">print</span>(classification_report(y_test_class, y_pred_rf_class))</span>
<span id="cb242-615"><a href="#cb242-615"></a>rf_accuracy <span class="op">=</span> accuracy_score(y_test_class, y_pred_rf_class)</span>
<span id="cb242-616"><a href="#cb242-616"></a>rf_auc <span class="op">=</span> roc_auc_score(y_test_class, y_pred_rf_proba)</span>
<span id="cb242-617"><a href="#cb242-617"></a><span class="bu">print</span>(<span class="ss">f"准确率: </span><span class="sc">{</span>rf_accuracy<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb242-618"><a href="#cb242-618"></a><span class="bu">print</span>(<span class="ss">f"AUC: </span><span class="sc">{</span>rf_auc<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb242-619"><a href="#cb242-619"></a></span>
<span id="cb242-620"><a href="#cb242-620"></a><span class="co"># 特征重要性</span></span>
<span id="cb242-621"><a href="#cb242-621"></a>feature_importance <span class="op">=</span> pd.DataFrame({</span>
<span id="cb242-622"><a href="#cb242-622"></a>    <span class="st">'feature'</span>: class_features,</span>
<span id="cb242-623"><a href="#cb242-623"></a>    <span class="st">'importance'</span>: rf_class_model.feature_importances_</span>
<span id="cb242-624"><a href="#cb242-624"></a>}).sort_values(<span class="st">'importance'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb242-625"><a href="#cb242-625"></a></span>
<span id="cb242-626"><a href="#cb242-626"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">随机森林特征重要性:"</span>)</span>
<span id="cb242-627"><a href="#cb242-627"></a><span class="bu">print</span>(feature_importance)</span>
<span id="cb242-628"><a href="#cb242-628"></a></span>
<span id="cb242-629"><a href="#cb242-629"></a><span class="co"># ROC曲线比较</span></span>
<span id="cb242-630"><a href="#cb242-630"></a>fig, (ax1, ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">5</span>))</span>
<span id="cb242-631"><a href="#cb242-631"></a></span>
<span id="cb242-632"><a href="#cb242-632"></a><span class="co"># 逻辑回归ROC</span></span>
<span id="cb242-633"><a href="#cb242-633"></a>fpr_lr, tpr_lr, _ <span class="op">=</span> roc_curve(y_test_class, y_pred_logit_proba)</span>
<span id="cb242-634"><a href="#cb242-634"></a>ax1.plot(fpr_lr, tpr_lr, label<span class="op">=</span><span class="ss">f'Logistic Regression (AUC = </span><span class="sc">{</span>logit_auc<span class="sc">:.3f}</span><span class="ss">)'</span>)</span>
<span id="cb242-635"><a href="#cb242-635"></a>ax1.plot([<span class="dv">0</span>, <span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>], <span class="st">'k--'</span>)</span>
<span id="cb242-636"><a href="#cb242-636"></a>ax1.set_xlabel(<span class="st">'False Positive Rate'</span>)</span>
<span id="cb242-637"><a href="#cb242-637"></a>ax1.set_ylabel(<span class="st">'True Positive Rate'</span>)</span>
<span id="cb242-638"><a href="#cb242-638"></a>ax1.set_title(<span class="st">'逻辑回归ROC曲线'</span>)</span>
<span id="cb242-639"><a href="#cb242-639"></a>ax1.legend()</span>
<span id="cb242-640"><a href="#cb242-640"></a>ax1.grid(<span class="va">True</span>)</span>
<span id="cb242-641"><a href="#cb242-641"></a></span>
<span id="cb242-642"><a href="#cb242-642"></a><span class="co"># 随机森林ROC</span></span>
<span id="cb242-643"><a href="#cb242-643"></a>fpr_rf, tpr_rf, _ <span class="op">=</span> roc_curve(y_test_class, y_pred_rf_proba)</span>
<span id="cb242-644"><a href="#cb242-644"></a>ax2.plot(fpr_rf, tpr_rf, label<span class="op">=</span><span class="ss">f'Random Forest (AUC = </span><span class="sc">{</span>rf_auc<span class="sc">:.3f}</span><span class="ss">)'</span>)</span>
<span id="cb242-645"><a href="#cb242-645"></a>ax2.plot([<span class="dv">0</span>, <span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>], <span class="st">'k--'</span>)</span>
<span id="cb242-646"><a href="#cb242-646"></a>ax2.set_xlabel(<span class="st">'False Positive Rate'</span>)</span>
<span id="cb242-647"><a href="#cb242-647"></a>ax2.set_ylabel(<span class="st">'True Positive Rate'</span>)</span>
<span id="cb242-648"><a href="#cb242-648"></a>ax2.set_title(<span class="st">'随机森林ROC曲线'</span>)</span>
<span id="cb242-649"><a href="#cb242-649"></a>ax2.legend()</span>
<span id="cb242-650"><a href="#cb242-650"></a>ax2.grid(<span class="va">True</span>)</span>
<span id="cb242-651"><a href="#cb242-651"></a></span>
<span id="cb242-652"><a href="#cb242-652"></a>plt.tight_layout()</span>
<span id="cb242-653"><a href="#cb242-653"></a>plt.show()</span>
<span id="cb242-654"><a href="#cb242-654"></a></span>
<span id="cb242-655"><a href="#cb242-655"></a><span class="co"># 模型比较</span></span>
<span id="cb242-656"><a href="#cb242-656"></a>comparison_df <span class="op">=</span> pd.DataFrame({</span>
<span id="cb242-657"><a href="#cb242-657"></a>    <span class="st">'Model'</span>: [<span class="st">'Logistic Regression'</span>, <span class="st">'Random Forest'</span>],</span>
<span id="cb242-658"><a href="#cb242-658"></a>    <span class="st">'Accuracy'</span>: [logit_accuracy, rf_accuracy],</span>
<span id="cb242-659"><a href="#cb242-659"></a>    <span class="st">'AUC'</span>: [logit_auc, rf_auc]</span>
<span id="cb242-660"><a href="#cb242-660"></a>})</span>
<span id="cb242-661"><a href="#cb242-661"></a></span>
<span id="cb242-662"><a href="#cb242-662"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">模型性能比较:"</span>)</span>
<span id="cb242-663"><a href="#cb242-663"></a><span class="bu">print</span>(comparison_df)</span>
<span id="cb242-664"><a href="#cb242-664"></a><span class="in">```</span></span>
<span id="cb242-665"><a href="#cb242-665"></a></span>
<span id="cb242-666"><a href="#cb242-666"></a><span class="fu">### 15.2.4 Python聚类分析</span></span>
<span id="cb242-667"><a href="#cb242-667"></a></span>
<span id="cb242-670"><a href="#cb242-670"></a><span class="in">```{python}</span></span>
<span id="cb242-671"><a href="#cb242-671"></a><span class="co">#| label: python-clustering</span></span>
<span id="cb242-672"><a href="#cb242-672"></a><span class="im">from</span> sklearn.cluster <span class="im">import</span> KMeans</span>
<span id="cb242-673"><a href="#cb242-673"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb242-674"><a href="#cb242-674"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> silhouette_score</span>
<span id="cb242-675"><a href="#cb242-675"></a></span>
<span id="cb242-676"><a href="#cb242-676"></a><span class="co"># 准备聚类数据</span></span>
<span id="cb242-677"><a href="#cb242-677"></a>cluster_features <span class="op">=</span> [<span class="st">'age'</span>, <span class="st">'income'</span>, <span class="st">'page_views'</span>, <span class="st">'time_on_site'</span>, <span class="st">'cart_additions'</span>]</span>
<span id="cb242-678"><a href="#cb242-678"></a>X_cluster <span class="op">=</span> python_user_data[cluster_features]</span>
<span id="cb242-679"><a href="#cb242-679"></a></span>
<span id="cb242-680"><a href="#cb242-680"></a><span class="co"># 数据标准化</span></span>
<span id="cb242-681"><a href="#cb242-681"></a>scaler <span class="op">=</span> StandardScaler()</span>
<span id="cb242-682"><a href="#cb242-682"></a>X_cluster_scaled <span class="op">=</span> scaler.fit_transform(X_cluster)</span>
<span id="cb242-683"><a href="#cb242-683"></a></span>
<span id="cb242-684"><a href="#cb242-684"></a><span class="co"># 寻找最佳聚类数</span></span>
<span id="cb242-685"><a href="#cb242-685"></a>wcss <span class="op">=</span> []</span>
<span id="cb242-686"><a href="#cb242-686"></a>silhouette_scores <span class="op">=</span> []</span>
<span id="cb242-687"><a href="#cb242-687"></a>k_range <span class="op">=</span> <span class="bu">range</span>(<span class="dv">2</span>, <span class="dv">11</span>)</span>
<span id="cb242-688"><a href="#cb242-688"></a></span>
<span id="cb242-689"><a href="#cb242-689"></a><span class="cf">for</span> k <span class="kw">in</span> k_range:</span>
<span id="cb242-690"><a href="#cb242-690"></a>    kmeans <span class="op">=</span> KMeans(n_clusters<span class="op">=</span>k, random_state<span class="op">=</span><span class="dv">123</span>, n_init<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb242-691"><a href="#cb242-691"></a>    kmeans.fit(X_cluster_scaled)</span>
<span id="cb242-692"><a href="#cb242-692"></a>    wcss.append(kmeans.inertia_)</span>
<span id="cb242-693"><a href="#cb242-693"></a>    silhouette_scores.append(silhouette_score(X_cluster_scaled, kmeans.labels_))</span>
<span id="cb242-694"><a href="#cb242-694"></a></span>
<span id="cb242-695"><a href="#cb242-695"></a><span class="co"># 肘部法则图</span></span>
<span id="cb242-696"><a href="#cb242-696"></a>fig, (ax1, ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">4</span>))</span>
<span id="cb242-697"><a href="#cb242-697"></a></span>
<span id="cb242-698"><a href="#cb242-698"></a>ax1.plot(k_range, wcss, <span class="st">'bo-'</span>)</span>
<span id="cb242-699"><a href="#cb242-699"></a>ax1.set_xlabel(<span class="st">'聚类数'</span>)</span>
<span id="cb242-700"><a href="#cb242-700"></a>ax1.set_ylabel(<span class="st">'WCSS'</span>)</span>
<span id="cb242-701"><a href="#cb242-701"></a>ax1.set_title(<span class="st">'肘部法则'</span>)</span>
<span id="cb242-702"><a href="#cb242-702"></a></span>
<span id="cb242-703"><a href="#cb242-703"></a>ax2.plot(k_range, silhouette_scores, <span class="st">'ro-'</span>)</span>
<span id="cb242-704"><a href="#cb242-704"></a>ax2.set_xlabel(<span class="st">'聚类数'</span>)</span>
<span id="cb242-705"><a href="#cb242-705"></a>ax2.set_ylabel(<span class="st">'轮廓系数'</span>)</span>
<span id="cb242-706"><a href="#cb242-706"></a>ax2.set_title(<span class="st">'轮廓系数'</span>)</span>
<span id="cb242-707"><a href="#cb242-707"></a></span>
<span id="cb242-708"><a href="#cb242-708"></a>plt.tight_layout()</span>
<span id="cb242-709"><a href="#cb242-709"></a>plt.show()</span>
<span id="cb242-710"><a href="#cb242-710"></a></span>
<span id="cb242-711"><a href="#cb242-711"></a><span class="co"># 执行K-means聚类</span></span>
<span id="cb242-712"><a href="#cb242-712"></a>kmeans_final <span class="op">=</span> KMeans(n_clusters<span class="op">=</span><span class="dv">4</span>, random_state<span class="op">=</span><span class="dv">123</span>, n_init<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb242-713"><a href="#cb242-713"></a>python_user_data[<span class="st">'cluster'</span>] <span class="op">=</span> kmeans_final.fit_predict(X_cluster_scaled)</span>
<span id="cb242-714"><a href="#cb242-714"></a></span>
<span id="cb242-715"><a href="#cb242-715"></a><span class="co"># 聚类分析</span></span>
<span id="cb242-716"><a href="#cb242-716"></a>cluster_analysis <span class="op">=</span> python_user_data.groupby(<span class="st">'cluster'</span>).agg({</span>
<span id="cb242-717"><a href="#cb242-717"></a>    <span class="st">'age'</span>: <span class="st">'mean'</span>,</span>
<span id="cb242-718"><a href="#cb242-718"></a>    <span class="st">'income'</span>: <span class="st">'mean'</span>,</span>
<span id="cb242-719"><a href="#cb242-719"></a>    <span class="st">'page_views'</span>: <span class="st">'mean'</span>,</span>
<span id="cb242-720"><a href="#cb242-720"></a>    <span class="st">'time_on_site'</span>: <span class="st">'mean'</span>,</span>
<span id="cb242-721"><a href="#cb242-721"></a>    <span class="st">'cart_additions'</span>: <span class="st">'mean'</span>,</span>
<span id="cb242-722"><a href="#cb242-722"></a>    <span class="st">'made_purchase'</span>: <span class="st">'mean'</span>,</span>
<span id="cb242-723"><a href="#cb242-723"></a>    <span class="st">'purchase_amount'</span>: <span class="st">'mean'</span>,</span>
<span id="cb242-724"><a href="#cb242-724"></a>    <span class="st">'user_id'</span>: <span class="st">'count'</span></span>
<span id="cb242-725"><a href="#cb242-725"></a>}).rename(columns<span class="op">=</span>{<span class="st">'user_id'</span>: <span class="st">'count'</span>})</span>
<span id="cb242-726"><a href="#cb242-726"></a></span>
<span id="cb242-727"><a href="#cb242-727"></a><span class="bu">print</span>(<span class="st">"聚类分析结果:"</span>)</span>
<span id="cb242-728"><a href="#cb242-728"></a><span class="bu">print</span>(cluster_analysis.<span class="bu">round</span>(<span class="dv">2</span>))</span>
<span id="cb242-729"><a href="#cb242-729"></a></span>
<span id="cb242-730"><a href="#cb242-730"></a><span class="co"># 聚类可视化</span></span>
<span id="cb242-731"><a href="#cb242-731"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">10</span>))</span>
<span id="cb242-732"><a href="#cb242-732"></a>features_to_plot <span class="op">=</span> [<span class="st">'age'</span>, <span class="st">'income'</span>, <span class="st">'page_views'</span>, <span class="st">'time_on_site'</span>, <span class="st">'cart_additions'</span>, <span class="st">'purchase_amount'</span>]</span>
<span id="cb242-733"><a href="#cb242-733"></a></span>
<span id="cb242-734"><a href="#cb242-734"></a><span class="cf">for</span> i, feature <span class="kw">in</span> <span class="bu">enumerate</span>(features_to_plot):</span>
<span id="cb242-735"><a href="#cb242-735"></a>    row, col <span class="op">=</span> i <span class="op">//</span> <span class="dv">3</span>, i <span class="op">%</span> <span class="dv">3</span></span>
<span id="cb242-736"><a href="#cb242-736"></a>    python_user_data.boxplot(column<span class="op">=</span>feature, by<span class="op">=</span><span class="st">'cluster'</span>, ax<span class="op">=</span>axes[row, col])</span>
<span id="cb242-737"><a href="#cb242-737"></a>    axes[row, col].set_title(<span class="ss">f'</span><span class="sc">{</span>feature<span class="sc">}</span><span class="ss"> by Cluster'</span>)</span>
<span id="cb242-738"><a href="#cb242-738"></a></span>
<span id="cb242-739"><a href="#cb242-739"></a>plt.suptitle(<span class="st">'各聚类群体特征分布'</span>)</span>
<span id="cb242-740"><a href="#cb242-740"></a>plt.tight_layout()</span>
<span id="cb242-741"><a href="#cb242-741"></a>plt.show()</span>
<span id="cb242-742"><a href="#cb242-742"></a><span class="in">```</span></span>
<span id="cb242-743"><a href="#cb242-743"></a></span>
<span id="cb242-744"><a href="#cb242-744"></a><span class="fu">### 15.2.5 Python关联分析</span></span>
<span id="cb242-745"><a href="#cb242-745"></a></span>
<span id="cb242-748"><a href="#cb242-748"></a><span class="in">```{python}</span></span>
<span id="cb242-749"><a href="#cb242-749"></a><span class="co">#| label: python-association</span></span>
<span id="cb242-750"><a href="#cb242-750"></a><span class="im">from</span> mlxtend.frequent_patterns <span class="im">import</span> apriori, association_rules</span>
<span id="cb242-751"><a href="#cb242-751"></a></span>
<span id="cb242-752"><a href="#cb242-752"></a><span class="co"># 准备关联分析数据</span></span>
<span id="cb242-753"><a href="#cb242-753"></a>association_data <span class="op">=</span> python_user_data[[<span class="ss">f'bought_</span><span class="sc">{</span>product<span class="sc">}</span><span class="ss">'</span> <span class="cf">for</span> product <span class="kw">in</span> products]]</span>
<span id="cb242-754"><a href="#cb242-754"></a></span>
<span id="cb242-755"><a href="#cb242-755"></a><span class="co"># 查看数据概览</span></span>
<span id="cb242-756"><a href="#cb242-756"></a><span class="bu">print</span>(<span class="st">"关联分析数据概览:"</span>)</span>
<span id="cb242-757"><a href="#cb242-757"></a><span class="bu">print</span>(association_data.head())</span>
<span id="cb242-758"><a href="#cb242-758"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">各产品购买率:"</span>)</span>
<span id="cb242-759"><a href="#cb242-759"></a><span class="bu">print</span>(association_data.mean())</span>
<span id="cb242-760"><a href="#cb242-760"></a></span>
<span id="cb242-761"><a href="#cb242-761"></a><span class="co"># 挖掘频繁项集 - 使用更宽松的参数</span></span>
<span id="cb242-762"><a href="#cb242-762"></a>frequent_itemsets <span class="op">=</span> apriori(association_data, </span>
<span id="cb242-763"><a href="#cb242-763"></a>                           min_support<span class="op">=</span><span class="fl">0.05</span>,  <span class="co"># 降低支持度</span></span>
<span id="cb242-764"><a href="#cb242-764"></a>                           use_colnames<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb242-765"><a href="#cb242-765"></a>                           max_len<span class="op">=</span><span class="dv">4</span>)         <span class="co"># 限制最大项集大小</span></span>
<span id="cb242-766"><a href="#cb242-766"></a></span>
<span id="cb242-767"><a href="#cb242-767"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">找到的频繁项集数量: </span><span class="sc">{</span><span class="bu">len</span>(frequent_itemsets)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb242-768"><a href="#cb242-768"></a></span>
<span id="cb242-769"><a href="#cb242-769"></a><span class="cf">if</span> <span class="bu">len</span>(frequent_itemsets) <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb242-770"><a href="#cb242-770"></a>    <span class="co"># 生成关联规则</span></span>
<span id="cb242-771"><a href="#cb242-771"></a>    rules_python <span class="op">=</span> association_rules(frequent_itemsets, </span>
<span id="cb242-772"><a href="#cb242-772"></a>                                   metric<span class="op">=</span><span class="st">"confidence"</span>, </span>
<span id="cb242-773"><a href="#cb242-773"></a>                                   min_threshold<span class="op">=</span><span class="fl">0.3</span>)  <span class="co"># 降低置信度</span></span>
<span id="cb242-774"><a href="#cb242-774"></a>    </span>
<span id="cb242-775"><a href="#cb242-775"></a>    <span class="bu">print</span>(<span class="ss">f"生成的关联规则数量: </span><span class="sc">{</span><span class="bu">len</span>(rules_python)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb242-776"><a href="#cb242-776"></a>    </span>
<span id="cb242-777"><a href="#cb242-777"></a>    <span class="cf">if</span> <span class="bu">len</span>(rules_python) <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb242-778"><a href="#cb242-778"></a>        <span class="co"># 显示前10条规则</span></span>
<span id="cb242-779"><a href="#cb242-779"></a>        rules_display <span class="op">=</span> rules_python.sort_values(<span class="st">'lift'</span>, ascending<span class="op">=</span><span class="va">False</span>).head(<span class="dv">10</span>)</span>
<span id="cb242-780"><a href="#cb242-780"></a>        <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">前10条关联规则 (按提升度排序):"</span>)</span>
<span id="cb242-781"><a href="#cb242-781"></a>        <span class="cf">for</span> idx, rule <span class="kw">in</span> rules_display.iterrows():</span>
<span id="cb242-782"><a href="#cb242-782"></a>            antecedents <span class="op">=</span> <span class="bu">list</span>(rule[<span class="st">'antecedents'</span>])</span>
<span id="cb242-783"><a href="#cb242-783"></a>            consequents <span class="op">=</span> <span class="bu">list</span>(rule[<span class="st">'consequents'</span>])</span>
<span id="cb242-784"><a href="#cb242-784"></a>            <span class="bu">print</span>(<span class="ss">f"规则: </span><span class="sc">{</span>antecedents<span class="sc">}</span><span class="ss"> -&gt; </span><span class="sc">{</span>consequents<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb242-785"><a href="#cb242-785"></a>            <span class="bu">print</span>(<span class="ss">f"  支持度: </span><span class="sc">{</span>rule[<span class="st">'support'</span>]<span class="sc">:.3f}</span><span class="ss">, 置信度: </span><span class="sc">{</span>rule[<span class="st">'confidence'</span>]<span class="sc">:.3f}</span><span class="ss">, 提升度: </span><span class="sc">{</span>rule[<span class="st">'lift'</span>]<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb242-786"><a href="#cb242-786"></a>            <span class="bu">print</span>()</span>
<span id="cb242-787"><a href="#cb242-787"></a>    <span class="cf">else</span>:</span>
<span id="cb242-788"><a href="#cb242-788"></a>        <span class="bu">print</span>(<span class="st">"没有生成关联规则，请进一步降低阈值"</span>)</span>
<span id="cb242-789"><a href="#cb242-789"></a><span class="cf">else</span>:</span>
<span id="cb242-790"><a href="#cb242-790"></a>    <span class="bu">print</span>(<span class="st">"没有找到频繁项集，请降低支持度阈值"</span>)</span>
<span id="cb242-791"><a href="#cb242-791"></a>    </span>
<span id="cb242-792"><a href="#cb242-792"></a><span class="co"># 产品共现热图</span></span>
<span id="cb242-793"><a href="#cb242-793"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb242-794"><a href="#cb242-794"></a>corr_matrix <span class="op">=</span> association_data.corr()</span>
<span id="cb242-795"><a href="#cb242-795"></a>sns.heatmap(corr_matrix, annot<span class="op">=</span><span class="va">True</span>, cmap<span class="op">=</span><span class="st">'coolwarm'</span>, center<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb242-796"><a href="#cb242-796"></a>plt.title(<span class="st">'产品购买相关性热图'</span>)</span>
<span id="cb242-797"><a href="#cb242-797"></a>plt.tight_layout()</span>
<span id="cb242-798"><a href="#cb242-798"></a>plt.show()</span>
<span id="cb242-799"><a href="#cb242-799"></a><span class="in">```</span></span>
<span id="cb242-800"><a href="#cb242-800"></a></span>
<span id="cb242-801"><a href="#cb242-801"></a><span class="fu">## 15.3 综合分析结果</span></span>
<span id="cb242-802"><a href="#cb242-802"></a></span>
<span id="cb242-803"><a href="#cb242-803"></a>方法比较</span>
<span id="cb242-804"><a href="#cb242-804"></a></span>
<span id="cb242-807"><a href="#cb242-807"></a><span class="in">```{r}</span></span>
<span id="cb242-808"><a href="#cb242-808"></a><span class="co">#| label: comparison</span></span>
<span id="cb242-809"><a href="#cb242-809"></a><span class="co"># R和Python结果比较</span></span>
<span id="cb242-810"><a href="#cb242-810"></a><span class="fu">cat</span>(<span class="st">"## 分析方法总结</span><span class="sc">\n\n</span><span class="st">"</span>)</span>
<span id="cb242-811"><a href="#cb242-811"></a><span class="fu">cat</span>(<span class="st">"### 回归分析</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb242-812"><a href="#cb242-812"></a><span class="fu">cat</span>(<span class="st">"- 线性回归和随机森林都能较好地预测用户消费金额</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb242-813"><a href="#cb242-813"></a><span class="fu">cat</span>(<span class="st">"- 随机森林在非线性关系处理上表现更好</span><span class="sc">\n\n</span><span class="st">"</span>)</span>
<span id="cb242-814"><a href="#cb242-814"></a></span>
<span id="cb242-815"><a href="#cb242-815"></a><span class="fu">cat</span>(<span class="st">"### 分类分析</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb242-816"><a href="#cb242-816"></a><span class="fu">cat</span>(<span class="st">"- 逻辑回归和随机森林都能有效预测用户购买意向</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb242-817"><a href="#cb242-817"></a><span class="fu">cat</span>(<span class="st">"- 页面浏览量和购物车添加次数是最重要的预测特征</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb242-818"><a href="#cb242-818"></a><span class="fu">cat</span>(<span class="st">"- 随机森林在AUC指标上表现略优于逻辑回归</span><span class="sc">\n\n</span><span class="st">"</span>)</span>
<span id="cb242-819"><a href="#cb242-819"></a></span>
<span id="cb242-820"><a href="#cb242-820"></a><span class="fu">cat</span>(<span class="st">"### 聚类分析</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb242-821"><a href="#cb242-821"></a><span class="fu">cat</span>(<span class="st">"- 成功将用户分为4个有意义的群体</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb242-822"><a href="#cb242-822"></a><span class="fu">cat</span>(<span class="st">"- 不同群体在消费行为和用户特征上有明显差异</span><span class="sc">\n\n</span><span class="st">"</span>)</span>
<span id="cb242-823"><a href="#cb242-823"></a></span>
<span id="cb242-824"><a href="#cb242-824"></a><span class="fu">cat</span>(<span class="st">"### 关联分析</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb242-825"><a href="#cb242-825"></a><span class="fu">cat</span>(<span class="st">"- 通过调整参数成功挖掘出关联规则</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb242-826"><a href="#cb242-826"></a><span class="fu">cat</span>(<span class="st">"- 发现了产品间的购买模式和相关关系</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb242-827"><a href="#cb242-827"></a><span class="in">```</span></span>
<span id="cb242-828"><a href="#cb242-828"></a></span>
<span id="cb242-829"><a href="#cb242-829"></a>业务建议</span>
<span id="cb242-830"><a href="#cb242-830"></a></span>
<span id="cb242-833"><a href="#cb242-833"></a><span class="in">```{r}</span></span>
<span id="cb242-834"><a href="#cb242-834"></a><span class="co">#| label: business-insights</span></span>
<span id="cb242-835"><a href="#cb242-835"></a><span class="fu">cat</span>(<span class="st">"## 业务洞察与建议</span><span class="sc">\n\n</span><span class="st">"</span>)</span>
<span id="cb242-836"><a href="#cb242-836"></a><span class="fu">cat</span>(<span class="st">"1. **用户分群营销**: 针对不同聚类群体制定个性化营销策略</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb242-837"><a href="#cb242-837"></a><span class="fu">cat</span>(<span class="st">"2. **交叉销售**: 利用关联规则结果优化商品推荐系统</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb242-838"><a href="#cb242-838"></a><span class="fu">cat</span>(<span class="st">"3. **用户行为预测**: 使用分类模型识别高价值潜在客户</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb242-839"><a href="#cb242-839"></a><span class="fu">cat</span>(<span class="st">"4. **收入预测**: 回归模型可用于预测用户生命周期价值</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb242-840"><a href="#cb242-840"></a><span class="fu">cat</span>(<span class="st">"5. **产品组合优化**: 基于关联分析结果调整产品陈列和捆绑销售策略</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb242-841"><a href="#cb242-841"></a><span class="in">```</span></span>
<span id="cb242-842"><a href="#cb242-842"></a></span>
<span id="cb242-843"><a href="#cb242-843"></a>技术总结</span>
<span id="cb242-844"><a href="#cb242-844"></a></span>
<span id="cb242-847"><a href="#cb242-847"></a><span class="in">```{r}</span></span>
<span id="cb242-848"><a href="#cb242-848"></a><span class="co">#| label: technical-summary</span></span>
<span id="cb242-849"><a href="#cb242-849"></a><span class="fu">cat</span>(<span class="st">"## 技术实现总结</span><span class="sc">\n\n</span><span class="st">"</span>)</span>
<span id="cb242-850"><a href="#cb242-850"></a><span class="fu">cat</span>(<span class="st">"### 数据框操作修复要点</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb242-851"><a href="#cb242-851"></a><span class="fu">cat</span>(<span class="st">"- 避免对字符型变量进行数学运算</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb242-852"><a href="#cb242-852"></a><span class="fu">cat</span>(<span class="st">"- 使用明确的列选择，只对数值列进行操作</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb242-853"><a href="#cb242-853"></a><span class="fu">cat</span>(<span class="st">"- 使用`across(where(is.numeric), ~ round(., 4))`时确保只选择数值列</span><span class="sc">\n\n</span><span class="st">"</span>)</span>
<span id="cb242-854"><a href="#cb242-854"></a></span>
<span id="cb242-855"><a href="#cb242-855"></a><span class="fu">cat</span>(<span class="st">"### R语言优势</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb242-856"><a href="#cb242-856"></a><span class="fu">cat</span>(<span class="st">"- 统计建模功能强大，模型输出详细</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb242-857"><a href="#cb242-857"></a><span class="fu">cat</span>(<span class="st">"- 可视化库丰富，图形质量高</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb242-858"><a href="#cb242-858"></a><span class="fu">cat</span>(<span class="st">"- 数据处理管道清晰易读</span><span class="sc">\n\n</span><span class="st">"</span>)</span>
<span id="cb242-859"><a href="#cb242-859"></a></span>
<span id="cb242-860"><a href="#cb242-860"></a><span class="fu">cat</span>(<span class="st">"### Python优势</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb242-861"><a href="#cb242-861"></a><span class="fu">cat</span>(<span class="st">"- 机器学习库生态系统完善</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb242-862"><a href="#cb242-862"></a><span class="fu">cat</span>(<span class="st">"- 代码简洁，部署方便</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb242-863"><a href="#cb242-863"></a><span class="fu">cat</span>(<span class="st">"- 深度学习和大数据处理能力强</span><span class="sc">\n\n</span><span class="st">"</span>)</span>
<span id="cb242-864"><a href="#cb242-864"></a></span>
<span id="cb242-865"><a href="#cb242-865"></a><span class="fu">cat</span>(<span class="st">"### 推荐使用场景</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb242-866"><a href="#cb242-866"></a><span class="fu">cat</span>(<span class="st">"- **学术研究、统计分析**: 推荐使用R</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb242-867"><a href="#cb242-867"></a><span class="fu">cat</span>(<span class="st">"- **生产环境、大型项目**: 推荐使用Python</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb242-868"><a href="#cb242-868"></a><span class="fu">cat</span>(<span class="st">"- **混合使用**: 根据具体任务选择最适合的工具</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb242-869"><a href="#cb242-869"></a><span class="in">```</span></span>
<span id="cb242-870"><a href="#cb242-870"></a></span>
<span id="cb242-871"><a href="#cb242-871"></a><span class="fu">## 15.4 附录</span></span>
<span id="cb242-872"><a href="#cb242-872"></a></span>
<span id="cb242-873"><a href="#cb242-873"></a>数据字典</span>
<span id="cb242-874"><a href="#cb242-874"></a></span>
<span id="cb242-875"><a href="#cb242-875"></a><span class="pp">|</span> 变量名          <span class="pp">|</span> 描述             <span class="pp">|</span> 类型   <span class="pp">|</span></span>
<span id="cb242-876"><a href="#cb242-876"></a><span class="pp">|-----------------|------------------|--------|</span></span>
<span id="cb242-877"><a href="#cb242-877"></a><span class="pp">|</span> user_id         <span class="pp">|</span> 用户ID           <span class="pp">|</span> 数值   <span class="pp">|</span></span>
<span id="cb242-878"><a href="#cb242-878"></a><span class="pp">|</span> age             <span class="pp">|</span> 年龄             <span class="pp">|</span> 数值   <span class="pp">|</span></span>
<span id="cb242-879"><a href="#cb242-879"></a><span class="pp">|</span> gender          <span class="pp">|</span> 性别             <span class="pp">|</span> 分类   <span class="pp">|</span></span>
<span id="cb242-880"><a href="#cb242-880"></a><span class="pp">|</span> income          <span class="pp">|</span> 收入             <span class="pp">|</span> 数值   <span class="pp">|</span></span>
<span id="cb242-881"><a href="#cb242-881"></a><span class="pp">|</span> region          <span class="pp">|</span> 地区             <span class="pp">|</span> 分类   <span class="pp">|</span></span>
<span id="cb242-882"><a href="#cb242-882"></a><span class="pp">|</span> page_views      <span class="pp">|</span> 页面浏览量       <span class="pp">|</span> 数值   <span class="pp">|</span></span>
<span id="cb242-883"><a href="#cb242-883"></a><span class="pp">|</span> time_on_site    <span class="pp">|</span> 网站停留时间(秒) <span class="pp">|</span> 数值   <span class="pp">|</span></span>
<span id="cb242-884"><a href="#cb242-884"></a><span class="pp">|</span> cart_additions  <span class="pp">|</span> 购物车添加次数   <span class="pp">|</span> 数值   <span class="pp">|</span></span>
<span id="cb242-885"><a href="#cb242-885"></a><span class="pp">|</span> purchase_amount <span class="pp">|</span> 购买金额         <span class="pp">|</span> 数值   <span class="pp">|</span></span>
<span id="cb242-886"><a href="#cb242-886"></a><span class="pp">|</span> made_purchase   <span class="pp">|</span> 是否购买         <span class="pp">|</span> 二分类 <span class="pp">|</span></span>
<span id="cb242-887"><a href="#cb242-887"></a></span>
<span id="cb242-888"><a href="#cb242-888"></a>依赖包列表</span>
<span id="cb242-889"><a href="#cb242-889"></a></span>
<span id="cb242-890"><a href="#cb242-890"></a>R包: - <span class="in">`dplyr`</span>, <span class="in">`ggplot2`</span>, <span class="in">`caret`</span>, <span class="in">`randomForest`</span>, <span class="in">`factoextra`</span>, <span class="in">`arules`</span>, <span class="in">`arulesViz`</span>, <span class="in">`corrplot`</span>, <span class="in">`pROC`</span>, <span class="in">`patchwork`</span>, <span class="in">`tidyr`</span></span>
<span id="cb242-891"><a href="#cb242-891"></a></span>
<span id="cb242-892"><a href="#cb242-892"></a>Python包: - <span class="in">`pandas`</span>, <span class="in">`numpy`</span>, <span class="in">`matplotlib`</span>, <span class="in">`seaborn`</span>, <span class="in">`scikit-learn`</span>, <span class="in">`mlxtend`</span></span>
</code></pre></div><button title="复制到剪贴板" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>