<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh-Hans" xml:lang="zh-Hans"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="李世纪">
<title>14&nbsp; 综合数据分析 – 现代预测建模：从回归到机器学习</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../chapters/13 分类任务.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-56845be1c3e1e64cc04b6f7b628b8285.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "没有结果",
    "search-matching-documents-text": "匹配的文档",
    "search-copy-link-title": "复制搜索链接",
    "search-hide-matches-text": "隐藏其它匹配结果",
    "search-more-match-text": "更多匹配结果",
    "search-more-matches-text": "更多匹配结果",
    "search-clear-button-title": "清除",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "取消",
    "search-submit-button-title": "提交",
    "search-label": "搜索"
  }
}</script><link rel="stylesheet" href="science-textbook.css">
</head>
<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="展开或折叠侧边栏导航" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapters/11 基准测试.html">实训——综合案例建模实践</a></li><li class="breadcrumb-item"><a href="../chapters/14 案例综合分析.html"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">综合数据分析</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="展开或折叠侧边栏导航" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="搜索" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">现代预测建模：从回归到机器学习</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="搜索"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">前言</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">index.html</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">起步-线性回归分析</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="展开或折叠此栏">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/1 预测、过拟合与模型评估.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">预测、过拟合与模型评估</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/2 线性回归.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">线性回归</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/3 模型诊断.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">模型诊断</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/4 时间序列分析初步.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">时间序列分析初步</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">扩展——线性分析模型及其超越</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="展开或折叠此栏">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/5 高维线性模型：正则化与降维.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">高维线性模型：正则化与降维</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/6 广义线性模型与线性分类.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">广义线性模型与线性分类</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/7 多项式回归与样条回归.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">多项式与样条回归</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">进阶——超越线性的机器学习</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="展开或折叠此栏">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/8 决策树与集成学习.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">决策树与集成学习</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/9 支持向量机.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">支持向量机</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/10 神经网络与深度学习基础.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">神经网络与深度学习基础</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">实训——综合案例建模实践</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="展开或折叠此栏">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/11 基准测试.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">基准测试</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/12 回归任务.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">回归任务</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/13 分类任务.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">分类任务</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/14 案例综合分析.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">综合数据分析</span></span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">目录</h2>
   
  <ul>
<li><a href="#%E6%A1%88%E4%BE%8B%E5%AF%BC%E8%AF%BB" id="toc-案例导读" class="nav-link active" data-scroll-target="#%E6%A1%88%E4%BE%8B%E5%AF%BC%E8%AF%BB"><span class="header-section-number">14.1</span> 案例导读</a></li>
  <li><a href="#r%E8%AF%AD%E8%A8%80%E5%AE%9E%E7%8E%B0" id="toc-r语言实现" class="nav-link" data-scroll-target="#r%E8%AF%AD%E8%A8%80%E5%AE%9E%E7%8E%B0"><span class="header-section-number">14.2</span> R语言实现</a></li>
  <li>
<a href="#%E6%95%B0%E6%8D%AE%E6%8E%A2%E7%B4%A2%E4%B8%8E%E9%A2%84%E5%A4%84%E7%90%86" id="toc-数据探索与预处理" class="nav-link" data-scroll-target="#%E6%95%B0%E6%8D%AE%E6%8E%A2%E7%B4%A2%E4%B8%8E%E9%A2%84%E5%A4%84%E7%90%86"><span class="header-section-number">14.3</span> 1. 数据探索与预处理</a>
  <ul class="collapse">
<li><a href="#%E6%95%B0%E6%8D%AE%E6%A6%82%E8%A7%88" id="toc-数据概览" class="nav-link" data-scroll-target="#%E6%95%B0%E6%8D%AE%E6%A6%82%E8%A7%88"><span class="header-section-number">14.3.1</span> 1.1 数据概览</a></li>
  <li><a href="#%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96" id="toc-数据可视化" class="nav-link" data-scroll-target="#%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96"><span class="header-section-number">14.3.2</span> 1.2 数据可视化</a></li>
  </ul>
</li>
  <li>
<a href="#%E5%9B%9E%E5%BD%92%E5%88%86%E6%9E%90%E9%A2%84%E6%B5%8B%E8%B4%AD%E4%B9%B0%E9%87%91%E9%A2%9D" id="toc-回归分析预测购买金额" class="nav-link" data-scroll-target="#%E5%9B%9E%E5%BD%92%E5%88%86%E6%9E%90%E9%A2%84%E6%B5%8B%E8%B4%AD%E4%B9%B0%E9%87%91%E9%A2%9D"><span class="header-section-number">14.4</span> 2. 回归分析：预测购买金额</a>
  <ul class="collapse">
<li><a href="#%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92%E6%A8%A1%E5%9E%8B" id="toc-线性回归模型" class="nav-link" data-scroll-target="#%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92%E6%A8%A1%E5%9E%8B"><span class="header-section-number">14.4.1</span> 2.1 线性回归模型</a></li>
  <li><a href="#%E5%9B%9E%E5%BD%92%E7%BB%93%E6%9E%9C%E5%8F%AF%E8%A7%86%E5%8C%96" id="toc-回归结果可视化" class="nav-link" data-scroll-target="#%E5%9B%9E%E5%BD%92%E7%BB%93%E6%9E%9C%E5%8F%AF%E8%A7%86%E5%8C%96"><span class="header-section-number">14.4.2</span> 2.2 回归结果可视化</a></li>
  </ul>
</li>
  <li>
<a href="#%E5%88%86%E7%B1%BB%E5%88%86%E6%9E%90%E9%A2%84%E6%B5%8B%E8%B4%AD%E4%B9%B0%E6%84%8F%E5%90%91" id="toc-分类分析预测购买意向" class="nav-link" data-scroll-target="#%E5%88%86%E7%B1%BB%E5%88%86%E6%9E%90%E9%A2%84%E6%B5%8B%E8%B4%AD%E4%B9%B0%E6%84%8F%E5%90%91"><span class="header-section-number">14.5</span> 3. 分类分析：预测购买意向</a>
  <ul class="collapse">
<li><a href="#%E9%80%BB%E8%BE%91%E5%9B%9E%E5%BD%92%E5%88%86%E7%B1%BB" id="toc-逻辑回归分类" class="nav-link" data-scroll-target="#%E9%80%BB%E8%BE%91%E5%9B%9E%E5%BD%92%E5%88%86%E7%B1%BB"><span class="header-section-number">14.5.1</span> 3.1 逻辑回归分类</a></li>
  <li><a href="#%E9%9A%8F%E6%9C%BA%E6%A3%AE%E6%9E%97%E5%88%86%E7%B1%BB" id="toc-随机森林分类" class="nav-link" data-scroll-target="#%E9%9A%8F%E6%9C%BA%E6%A3%AE%E6%9E%97%E5%88%86%E7%B1%BB"><span class="header-section-number">14.5.2</span> 3.2 随机森林分类</a></li>
  <li><a href="#%E5%88%86%E7%B1%BB%E6%A8%A1%E5%9E%8B%E6%AF%94%E8%BE%83---%E4%BF%AE%E5%A4%8D%E7%89%88%E6%9C%AC" id="toc-分类模型比较---修复版本" class="nav-link" data-scroll-target="#%E5%88%86%E7%B1%BB%E6%A8%A1%E5%9E%8B%E6%AF%94%E8%BE%83---%E4%BF%AE%E5%A4%8D%E7%89%88%E6%9C%AC"><span class="header-section-number">14.5.3</span> 3.3 分类模型比较 - 修复版本</a></li>
  </ul>
</li>
  <li>
<a href="#%E8%81%9A%E7%B1%BB%E5%88%86%E6%9E%90%E7%94%A8%E6%88%B7%E5%88%86%E7%BE%A4" id="toc-聚类分析用户分群" class="nav-link" data-scroll-target="#%E8%81%9A%E7%B1%BB%E5%88%86%E6%9E%90%E7%94%A8%E6%88%B7%E5%88%86%E7%BE%A4"><span class="header-section-number">14.6</span> 4. 聚类分析：用户分群</a>
  <ul class="collapse">
<li><a href="#k-means%E8%81%9A%E7%B1%BB" id="toc-k-means聚类" class="nav-link" data-scroll-target="#k-means%E8%81%9A%E7%B1%BB"><span class="header-section-number">14.6.1</span> 4.1 K-means聚类</a></li>
  <li><a href="#%E8%81%9A%E7%B1%BB%E5%88%86%E6%9E%90---%E4%BF%AE%E5%A4%8D%E7%89%88%E6%9C%AC" id="toc-聚类分析---修复版本" class="nav-link" data-scroll-target="#%E8%81%9A%E7%B1%BB%E5%88%86%E6%9E%90---%E4%BF%AE%E5%A4%8D%E7%89%88%E6%9C%AC"><span class="header-section-number">14.6.2</span> 4.2 聚类分析 - 修复版本</a></li>
  </ul>
</li>
  <li>
<a href="#%E5%85%B3%E8%81%94%E5%88%86%E6%9E%90%E5%95%86%E5%93%81%E8%B4%AD%E4%B9%B0%E5%85%B3%E8%81%94%E8%A7%84%E5%88%99" id="toc-关联分析商品购买关联规则" class="nav-link" data-scroll-target="#%E5%85%B3%E8%81%94%E5%88%86%E6%9E%90%E5%95%86%E5%93%81%E8%B4%AD%E4%B9%B0%E5%85%B3%E8%81%94%E8%A7%84%E5%88%99"><span class="header-section-number">14.7</span> 5. 关联分析：商品购买关联规则</a>
  <ul class="collapse">
<li><a href="#apriori%E7%AE%97%E6%B3%95" id="toc-apriori算法" class="nav-link" data-scroll-target="#apriori%E7%AE%97%E6%B3%95"><span class="header-section-number">14.7.1</span> 5.1 Apriori算法</a></li>
  <li><a href="#%E5%85%B3%E8%81%94%E8%A7%84%E5%88%99%E5%8F%AF%E8%A7%86%E5%8C%96" id="toc-关联规则可视化" class="nav-link" data-scroll-target="#%E5%85%B3%E8%81%94%E8%A7%84%E5%88%99%E5%8F%AF%E8%A7%86%E5%8C%96"><span class="header-section-number">14.7.2</span> 5.2 关联规则可视化</a></li>
  </ul>
</li>
  <li>
<a href="#python%E5%AE%9E%E7%8E%B0" id="toc-python实现" class="nav-link" data-scroll-target="#python%E5%AE%9E%E7%8E%B0"><span class="header-section-number">15</span> Python实现</a>
  <ul class="collapse">
<li><a href="#%E6%95%B0%E6%8D%AE%E5%87%86%E5%A4%87" id="toc-数据准备" class="nav-link" data-scroll-target="#%E6%95%B0%E6%8D%AE%E5%87%86%E5%A4%87"><span class="header-section-number">15.1</span> 1. 数据准备</a></li>
  <li><a href="#python%E5%9B%9E%E5%BD%92%E5%88%86%E6%9E%90" id="toc-python回归分析" class="nav-link" data-scroll-target="#python%E5%9B%9E%E5%BD%92%E5%88%86%E6%9E%90"><span class="header-section-number">15.2</span> 2. Python回归分析</a></li>
  <li><a href="#python%E5%88%86%E7%B1%BB%E5%88%86%E6%9E%90" id="toc-python分类分析" class="nav-link" data-scroll-target="#python%E5%88%86%E7%B1%BB%E5%88%86%E6%9E%90"><span class="header-section-number">15.3</span> 3. Python分类分析</a></li>
  <li><a href="#python%E8%81%9A%E7%B1%BB%E5%88%86%E6%9E%90" id="toc-python聚类分析" class="nav-link" data-scroll-target="#python%E8%81%9A%E7%B1%BB%E5%88%86%E6%9E%90"><span class="header-section-number">15.4</span> 4. Python聚类分析</a></li>
  <li><a href="#python%E5%85%B3%E8%81%94%E5%88%86%E6%9E%90" id="toc-python关联分析" class="nav-link" data-scroll-target="#python%E5%85%B3%E8%81%94%E5%88%86%E6%9E%90"><span class="header-section-number">15.5</span> 5. Python关联分析</a></li>
  </ul>
</li>
  <li>
<a href="#%E7%BB%BC%E5%90%88%E5%88%86%E6%9E%90%E7%BB%93%E6%9E%9C" id="toc-综合分析结果" class="nav-link" data-scroll-target="#%E7%BB%BC%E5%90%88%E5%88%86%E6%9E%90%E7%BB%93%E6%9E%9C"><span class="header-section-number">16</span> 综合分析结果</a>
  <ul class="collapse">
<li><a href="#%E6%96%B9%E6%B3%95%E6%AF%94%E8%BE%83" id="toc-方法比较" class="nav-link" data-scroll-target="#%E6%96%B9%E6%B3%95%E6%AF%94%E8%BE%83"><span class="header-section-number">16.1</span> 方法比较</a></li>
  <li><a href="#%E4%B8%9A%E5%8A%A1%E5%BB%BA%E8%AE%AE" id="toc-业务建议" class="nav-link" data-scroll-target="#%E4%B8%9A%E5%8A%A1%E5%BB%BA%E8%AE%AE"><span class="header-section-number">16.2</span> 业务建议</a></li>
  <li><a href="#%E6%8A%80%E6%9C%AF%E6%80%BB%E7%BB%93" id="toc-技术总结" class="nav-link" data-scroll-target="#%E6%8A%80%E6%9C%AF%E6%80%BB%E7%BB%93"><span class="header-section-number">16.3</span> 技术总结</a></li>
  </ul>
</li>
  <li>
<a href="#%E9%99%84%E5%BD%95" id="toc-附录" class="nav-link" data-scroll-target="#%E9%99%84%E5%BD%95"><span class="header-section-number">17</span> 附录</a>
  <ul class="collapse">
<li><a href="#%E6%95%B0%E6%8D%AE%E5%AD%97%E5%85%B8" id="toc-数据字典" class="nav-link" data-scroll-target="#%E6%95%B0%E6%8D%AE%E5%AD%97%E5%85%B8"><span class="header-section-number">17.1</span> 数据字典</a></li>
  <li><a href="#%E4%BE%9D%E8%B5%96%E5%8C%85%E5%88%97%E8%A1%A8" id="toc-依赖包列表" class="nav-link" data-scroll-target="#%E4%BE%9D%E8%B5%96%E5%8C%85%E5%88%97%E8%A1%A8"><span class="header-section-number">17.2</span> 依赖包列表</a></li>
  </ul>
</li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapters/11 基准测试.html">实训——综合案例建模实践</a></li><li class="breadcrumb-item"><a href="../chapters/14 案例综合分析.html"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">综合数据分析</span></a></li></ol></nav><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">
<span class="chapter-number">14</span>&nbsp; <span class="chapter-title">综合数据分析</span>
</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> 代码</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">显示所有代码</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">隐藏所有代码</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">查看源代码</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">作者</div>
    <div class="quarto-title-meta-contents">
             <p>李世纪 </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">发布于</div>
    <div class="quarto-title-meta-contents">
      <p class="date">2025年11月29日</p>
    </div>
  </div>
  
    
  </div>
  


</header><section id="案例导读" class="level2" data-number="14.1"><h2 data-number="14.1" class="anchored" data-anchor-id="案例导读">
<span class="header-section-number">14.1</span> 案例导读</h2>
<p>本项目基于模拟的电商用户数据，进行全面的数据分析，包括： - <strong>回归分析</strong>：预测用户消费金额 - <strong>分类分析</strong>：预测用户购买意向 - <strong>聚类分析</strong>：用户分群 - <strong>关联分析</strong>：商品购买关联规则</p>
<p>数据说明</p>
<div class="cell">
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="co"># 生成模拟数据</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb1-3"><a href="#cb1-3"></a>n <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb1-4"><a href="#cb1-4"></a></span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="co"># 用户基本信息</span></span>
<span id="cb1-6"><a href="#cb1-6"></a>user_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb1-7"><a href="#cb1-7"></a>  <span class="at">user_id =</span> <span class="dv">1</span><span class="sc">:</span>n,</span>
<span id="cb1-8"><a href="#cb1-8"></a>  <span class="at">age =</span> <span class="fu">sample</span>(<span class="dv">18</span><span class="sc">:</span><span class="dv">65</span>, n, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1-9"><a href="#cb1-9"></a>  <span class="at">gender =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"Male"</span>, <span class="st">"Female"</span>), n, <span class="at">replace =</span> <span class="cn">TRUE</span>, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.48</span>, <span class="fl">0.52</span>)),</span>
<span id="cb1-10"><a href="#cb1-10"></a>  <span class="at">income =</span> <span class="fu">round</span>(<span class="fu">rnorm</span>(n, <span class="dv">50000</span>, <span class="dv">15000</span>)),</span>
<span id="cb1-11"><a href="#cb1-11"></a>  <span class="at">region =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"North"</span>, <span class="st">"South"</span>, <span class="st">"East"</span>, <span class="st">"West"</span>), n, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1-12"><a href="#cb1-12"></a>  <span class="at">days_since_signup =</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">365</span>, n, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1-13"><a href="#cb1-13"></a>  <span class="at">page_views =</span> <span class="fu">rpois</span>(n, <span class="dv">25</span>),</span>
<span id="cb1-14"><a href="#cb1-14"></a>  <span class="at">time_on_site =</span> <span class="fu">round</span>(<span class="fu">rnorm</span>(n, <span class="dv">300</span>, <span class="dv">120</span>)),</span>
<span id="cb1-15"><a href="#cb1-15"></a>  <span class="at">cart_additions =</span> <span class="fu">rpois</span>(n, <span class="dv">5</span>)</span>
<span id="cb1-16"><a href="#cb1-16"></a>)</span>
<span id="cb1-17"><a href="#cb1-17"></a></span>
<span id="cb1-18"><a href="#cb1-18"></a><span class="co"># 生成购买行为数据</span></span>
<span id="cb1-19"><a href="#cb1-19"></a>user_data<span class="sc">$</span>purchase_amount <span class="ot">&lt;-</span> <span class="fu">with</span>(user_data, </span>
<span id="cb1-20"><a href="#cb1-20"></a>  <span class="dv">50</span> <span class="sc">+</span> <span class="fl">0.3</span> <span class="sc">*</span> income<span class="sc">/</span><span class="dv">1000</span> <span class="sc">+</span> <span class="fl">0.5</span> <span class="sc">*</span> page_views <span class="sc">+</span> <span class="fl">0.8</span> <span class="sc">*</span> time_on_site<span class="sc">/</span><span class="dv">60</span> <span class="sc">+</span> </span>
<span id="cb1-21"><a href="#cb1-21"></a>  <span class="dv">2</span> <span class="sc">*</span> cart_additions <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="dv">20</span>)</span>
<span id="cb1-22"><a href="#cb1-22"></a>)</span>
<span id="cb1-23"><a href="#cb1-23"></a></span>
<span id="cb1-24"><a href="#cb1-24"></a>user_data<span class="sc">$</span>made_purchase <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(user_data<span class="sc">$</span>purchase_amount <span class="sc">&gt;</span> <span class="dv">120</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb1-25"><a href="#cb1-25"></a></span>
<span id="cb1-26"><a href="#cb1-26"></a><span class="co"># 添加产品类别购买信息 - 增加相关性以产生关联规则</span></span>
<span id="cb1-27"><a href="#cb1-27"></a>products <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Electronics"</span>, <span class="st">"Clothing"</span>, <span class="st">"Books"</span>, <span class="st">"Home"</span>, <span class="st">"Sports"</span>)</span>
<span id="cb1-28"><a href="#cb1-28"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb1-29"><a href="#cb1-29"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(products)) {</span>
<span id="cb1-30"><a href="#cb1-30"></a>  product <span class="ot">&lt;-</span> products[i]</span>
<span id="cb1-31"><a href="#cb1-31"></a>  base_prob <span class="ot">&lt;-</span> <span class="fl">0.4</span></span>
<span id="cb1-32"><a href="#cb1-32"></a>  <span class="co"># 创建产品间的相关性</span></span>
<span id="cb1-33"><a href="#cb1-33"></a>  <span class="cf">if</span>(i <span class="sc">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb1-34"><a href="#cb1-34"></a>    <span class="co"># 让某些产品更可能一起购买</span></span>
<span id="cb1-35"><a href="#cb1-35"></a>    correlated_prob <span class="ot">&lt;-</span> user_data[[<span class="fu">paste0</span>(<span class="st">"bought_"</span>, <span class="fu">tolower</span>(products[i<span class="dv">-1</span>]))]] <span class="sc">*</span> <span class="fl">0.3</span> <span class="sc">+</span> base_prob</span>
<span id="cb1-36"><a href="#cb1-36"></a>    user_data[[<span class="fu">paste0</span>(<span class="st">"bought_"</span>, <span class="fu">tolower</span>(product))]] <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n, <span class="dv">1</span>, <span class="fu">pmin</span>(correlated_prob, <span class="fl">0.8</span>))</span>
<span id="cb1-37"><a href="#cb1-37"></a>  } <span class="cf">else</span> {</span>
<span id="cb1-38"><a href="#cb1-38"></a>    user_data[[<span class="fu">paste0</span>(<span class="st">"bought_"</span>, <span class="fu">tolower</span>(product))]] <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n, <span class="dv">1</span>, base_prob)</span>
<span id="cb1-39"><a href="#cb1-39"></a>  }</span>
<span id="cb1-40"><a href="#cb1-40"></a>}</span>
<span id="cb1-41"><a href="#cb1-41"></a></span>
<span id="cb1-42"><a href="#cb1-42"></a><span class="fu">head</span>(user_data)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>  user_id age gender income region days_since_signup page_views time_on_site
1       1  48 Female  51762   West                 5         29          173
2       2  32 Female  45027   West                22         28          450
3       3  31   Male  54174   West                 4         38          147
4       4  20 Female  32216  South               352         23          243
5       5  59   Male  37462  North               131         23          340
6       6  60 Female  57654  North               231         15          334
  cart_additions purchase_amount made_purchase bought_electronics
1              3        57.57759             0                  0
2              3        59.83742             0                  1
3              6        64.31744             0                  0
4             10        94.88951             0                  1
5              1        24.43966             0                  1
6              5       114.33971             0                  0
  bought_clothing bought_books bought_home bought_sports
1               0            0           0             0
2               1            1           0             1
3               0            0           0             0
4               0            0           1             0
5               0            0           0             0
6               0            1           1             1</code></pre>
</div>
</div>
</section><section id="r语言实现" class="level2" data-number="14.2"><h2 data-number="14.2" class="anchored" data-anchor-id="r语言实现">
<span class="header-section-number">14.2</span> R语言实现</h2>
</section><section id="数据探索与预处理" class="level2" data-number="14.3"><h2 data-number="14.3" class="anchored" data-anchor-id="数据探索与预处理">
<span class="header-section-number">14.3</span> 1. 数据探索与预处理</h2>
<section id="数据概览" class="level3" data-number="14.3.1"><h3 data-number="14.3.1" class="anchored" data-anchor-id="数据概览">
<span class="header-section-number">14.3.1</span> 1.1 数据概览</h3>
<div class="cell">
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="fu">library</span>(dplyr)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'dplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="fu">library</span>(corrplot)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stderr">
<pre><code>corrplot 0.95 loaded</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="co"># 基本统计信息</span></span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="fu">summary</span>(user_data[, <span class="fu">c</span>(<span class="st">"age"</span>, <span class="st">"income"</span>, <span class="st">"page_views"</span>, <span class="st">"time_on_site"</span>, <span class="st">"purchase_amount"</span>)])</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>      age            income         page_views     time_on_site  
 Min.   :18.00   Min.   :  4282   Min.   :11.00   Min.   :-83.0  
 1st Qu.:29.00   1st Qu.: 40201   1st Qu.:21.00   1st Qu.:219.8  
 Median :42.00   Median : 49943   Median :25.00   Median :299.0  
 Mean   :41.39   Mean   : 50209   Mean   :24.92   Mean   :299.7  
 3rd Qu.:53.00   3rd Qu.: 60887   3rd Qu.:28.00   3rd Qu.:376.2  
 Max.   :65.00   Max.   :100856   Max.   :42.00   Max.   :688.0  
 purchase_amount  
 Min.   :  9.555  
 1st Qu.: 76.051  
 Median : 91.131  
 Mean   : 90.966  
 3rd Qu.:105.509  
 Max.   :153.144  </code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="co"># 缺失值检查</span></span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="fu">sapply</span>(user_data, <span class="cf">function</span>(x) <span class="fu">sum</span>(<span class="fu">is.na</span>(x)))</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>           user_id                age             gender             income 
                 0                  0                  0                  0 
            region  days_since_signup         page_views       time_on_site 
                 0                  0                  0                  0 
    cart_additions    purchase_amount      made_purchase bought_electronics 
                 0                  0                  0                  0 
   bought_clothing       bought_books        bought_home      bought_sports 
                 0                  0                  0                  0 </code></pre>
</div>
</div>
</section><section id="数据可视化" class="level3" data-number="14.3.2"><h3 data-number="14.3.2" class="anchored" data-anchor-id="数据可视化">
<span class="header-section-number">14.3.2</span> 1.2 数据可视化</h3>
<div class="cell">
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="co"># 数值变量分布</span></span>
<span id="cb13-2"><a href="#cb13-2"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(user_data, <span class="fu">aes</span>(<span class="at">x =</span> purchase_amount)) <span class="sc">+</span></span>
<span id="cb13-3"><a href="#cb13-3"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">30</span>, <span class="at">fill =</span> <span class="st">"steelblue"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb13-4"><a href="#cb13-4"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"购买金额分布"</span>)</span>
<span id="cb13-5"><a href="#cb13-5"></a></span>
<span id="cb13-6"><a href="#cb13-6"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(user_data, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(made_purchase), <span class="at">fill =</span> <span class="fu">factor</span>(made_purchase))) <span class="sc">+</span></span>
<span id="cb13-7"><a href="#cb13-7"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb13-8"><a href="#cb13-8"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"购买行为分布"</span>, <span class="at">x =</span> <span class="st">"是否购买"</span>)</span>
<span id="cb13-9"><a href="#cb13-9"></a></span>
<span id="cb13-10"><a href="#cb13-10"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(user_data, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> purchase_amount, <span class="at">color =</span> gender)) <span class="sc">+</span></span>
<span id="cb13-11"><a href="#cb13-11"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb13-12"><a href="#cb13-12"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"年龄与购买金额关系"</span>)</span>
<span id="cb13-13"><a href="#cb13-13"></a></span>
<span id="cb13-14"><a href="#cb13-14"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb13-15"><a href="#cb13-15"></a>p1 <span class="sc">/</span> p2 <span class="sc">/</span> p3</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="14-案例综合分析_files/figure-html/r-data-visualization-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section></section><section id="回归分析预测购买金额" class="level2" data-number="14.4"><h2 data-number="14.4" class="anchored" data-anchor-id="回归分析预测购买金额">
<span class="header-section-number">14.4</span> 2. 回归分析：预测购买金额</h2>
<section id="线性回归模型" class="level3" data-number="14.4.1"><h3 data-number="14.4.1" class="anchored" data-anchor-id="线性回归模型">
<span class="header-section-number">14.4.1</span> 2.1 线性回归模型</h3>
<div class="cell">
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="fu">library</span>(caret)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stderr">
<pre><code>Loading required package: lattice</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="co"># 准备数据</span></span>
<span id="cb16-2"><a href="#cb16-2"></a>reg_data <span class="ot">&lt;-</span> user_data <span class="sc">%&gt;%</span> </span>
<span id="cb16-3"><a href="#cb16-3"></a>  <span class="fu">select</span>(age, income, page_views, time_on_site, cart_additions, purchase_amount) <span class="sc">%&gt;%</span></span>
<span id="cb16-4"><a href="#cb16-4"></a>  <span class="fu">na.omit</span>()</span>
<span id="cb16-5"><a href="#cb16-5"></a></span>
<span id="cb16-6"><a href="#cb16-6"></a><span class="co"># 数据分割</span></span>
<span id="cb16-7"><a href="#cb16-7"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb16-8"><a href="#cb16-8"></a>train_index <span class="ot">&lt;-</span> <span class="fu">createDataPartition</span>(reg_data<span class="sc">$</span>purchase_amount, <span class="at">p =</span> <span class="fl">0.7</span>, <span class="at">list =</span> <span class="cn">FALSE</span>)</span>
<span id="cb16-9"><a href="#cb16-9"></a>train_reg <span class="ot">&lt;-</span> reg_data[train_index, ]</span>
<span id="cb16-10"><a href="#cb16-10"></a>test_reg <span class="ot">&lt;-</span> reg_data[<span class="sc">-</span>train_index, ]</span>
<span id="cb16-11"><a href="#cb16-11"></a></span>
<span id="cb16-12"><a href="#cb16-12"></a><span class="co"># 训练线性回归模型</span></span>
<span id="cb16-13"><a href="#cb16-13"></a>lm_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(purchase_amount <span class="sc">~</span> ., <span class="at">data =</span> train_reg)</span>
<span id="cb16-14"><a href="#cb16-14"></a><span class="fu">summary</span>(lm_model)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = purchase_amount ~ ., data = train_reg)

Residuals:
    Min      1Q  Median      3Q     Max 
-66.576 -12.853  -0.106  13.819  67.749 

Coefficients:
                Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)    5.111e+01  5.704e+00   8.961  &lt; 2e-16 ***
age            8.216e-04  5.349e-02   0.015  0.98775    
income         2.969e-04  5.022e-05   5.913 5.28e-09 ***
page_views     2.720e-01  1.496e-01   1.818  0.06954 .  
time_on_site   1.635e-02  6.067e-03   2.695  0.00721 ** 
cart_additions 2.638e+00  3.326e-01   7.933 8.57e-15 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 19.32 on 694 degrees of freedom
Multiple R-squared:  0.1368,    Adjusted R-squared:  0.1305 
F-statistic: 21.99 on 5 and 694 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="co"># 预测</span></span>
<span id="cb18-2"><a href="#cb18-2"></a>predictions_lm <span class="ot">&lt;-</span> <span class="fu">predict</span>(lm_model, <span class="at">newdata =</span> test_reg)</span>
<span id="cb18-3"><a href="#cb18-3"></a></span>
<span id="cb18-4"><a href="#cb18-4"></a><span class="co"># 模型评估</span></span>
<span id="cb18-5"><a href="#cb18-5"></a>reg_metrics <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb18-6"><a href="#cb18-6"></a>  <span class="at">RMSE =</span> <span class="fu">RMSE</span>(predictions_lm, test_reg<span class="sc">$</span>purchase_amount),</span>
<span id="cb18-7"><a href="#cb18-7"></a>  <span class="at">MAE =</span> <span class="fu">MAE</span>(predictions_lm, test_reg<span class="sc">$</span>purchase_amount),</span>
<span id="cb18-8"><a href="#cb18-8"></a>  <span class="at">R2 =</span> <span class="fu">R2</span>(predictions_lm, test_reg<span class="sc">$</span>purchase_amount)</span>
<span id="cb18-9"><a href="#cb18-9"></a>)</span>
<span id="cb18-10"><a href="#cb18-10"></a><span class="fu">print</span>(reg_metrics)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>      RMSE      MAE         R2
1 21.72114 17.54768 0.07424787</code></pre>
</div>
</div>
</section><section id="回归结果可视化" class="level3" data-number="14.4.2"><h3 data-number="14.4.2" class="anchored" data-anchor-id="回归结果可视化">
<span class="header-section-number">14.4.2</span> 2.2 回归结果可视化</h3>
<div class="cell">
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a><span class="co"># 预测 vs 实际值</span></span>
<span id="cb20-2"><a href="#cb20-2"></a>results_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb20-3"><a href="#cb20-3"></a>  <span class="at">Actual =</span> test_reg<span class="sc">$</span>purchase_amount,</span>
<span id="cb20-4"><a href="#cb20-4"></a>  <span class="at">Predicted =</span> predictions_lm</span>
<span id="cb20-5"><a href="#cb20-5"></a>)</span>
<span id="cb20-6"><a href="#cb20-6"></a></span>
<span id="cb20-7"><a href="#cb20-7"></a><span class="fu">ggplot</span>(results_df, <span class="fu">aes</span>(<span class="at">x =</span> Actual, <span class="at">y =</span> Predicted)) <span class="sc">+</span></span>
<span id="cb20-8"><a href="#cb20-8"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">color =</span> <span class="st">"steelblue"</span>) <span class="sc">+</span></span>
<span id="cb20-9"><a href="#cb20-9"></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>, <span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb20-10"><a href="#cb20-10"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"线性回归：预测值 vs 实际值"</span>,</span>
<span id="cb20-11"><a href="#cb20-11"></a>       <span class="at">subtitle =</span> <span class="fu">paste</span>(<span class="st">"R² ="</span>, <span class="fu">round</span>(reg_metrics<span class="sc">$</span>R2, <span class="dv">3</span>))) <span class="sc">+</span></span>
<span id="cb20-12"><a href="#cb20-12"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="14-案例综合分析_files/figure-html/r-regression-viz-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section></section><section id="分类分析预测购买意向" class="level2" data-number="14.5"><h2 data-number="14.5" class="anchored" data-anchor-id="分类分析预测购买意向">
<span class="header-section-number">14.5</span> 3. 分类分析：预测购买意向</h2>
<section id="逻辑回归分类" class="level3" data-number="14.5.1"><h3 data-number="14.5.1" class="anchored" data-anchor-id="逻辑回归分类">
<span class="header-section-number">14.5.1</span> 3.1 逻辑回归分类</h3>
<div class="cell">
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a><span class="co"># 准备分类数据 - 确保因子水平一致</span></span>
<span id="cb21-2"><a href="#cb21-2"></a>class_data <span class="ot">&lt;-</span> user_data <span class="sc">%&gt;%</span> </span>
<span id="cb21-3"><a href="#cb21-3"></a>  <span class="fu">select</span>(age, income, page_views, time_on_site, cart_additions, made_purchase) <span class="sc">%&gt;%</span></span>
<span id="cb21-4"><a href="#cb21-4"></a>  <span class="fu">mutate</span>(<span class="at">made_purchase =</span> <span class="fu">factor</span>(made_purchase, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"No"</span>, <span class="st">"Yes"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb21-5"><a href="#cb21-5"></a>  <span class="fu">na.omit</span>()</span>
<span id="cb21-6"><a href="#cb21-6"></a></span>
<span id="cb21-7"><a href="#cb21-7"></a><span class="co"># 数据分割</span></span>
<span id="cb21-8"><a href="#cb21-8"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb21-9"><a href="#cb21-9"></a>train_index_class <span class="ot">&lt;-</span> <span class="fu">createDataPartition</span>(class_data<span class="sc">$</span>made_purchase, <span class="at">p =</span> <span class="fl">0.7</span>, <span class="at">list =</span> <span class="cn">FALSE</span>)</span>
<span id="cb21-10"><a href="#cb21-10"></a>train_class <span class="ot">&lt;-</span> class_data[train_index_class, ]</span>
<span id="cb21-11"><a href="#cb21-11"></a>test_class <span class="ot">&lt;-</span> class_data[<span class="sc">-</span>train_index_class, ]</span>
<span id="cb21-12"><a href="#cb21-12"></a></span>
<span id="cb21-13"><a href="#cb21-13"></a><span class="co"># 训练逻辑回归模型</span></span>
<span id="cb21-14"><a href="#cb21-14"></a>logit_model <span class="ot">&lt;-</span> <span class="fu">glm</span>(made_purchase <span class="sc">~</span> ., <span class="at">data =</span> train_class, <span class="at">family =</span> binomial)</span>
<span id="cb21-15"><a href="#cb21-15"></a><span class="fu">summary</span>(logit_model)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = made_purchase ~ ., family = binomial, data = train_class)

Coefficients:
                 Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)    -7.571e+00  1.118e+00  -6.771 1.28e-11 ***
age             1.361e-03  1.002e-02   0.136   0.8920    
income          2.353e-05  9.733e-06   2.418   0.0156 *  
page_views      5.748e-02  2.661e-02   2.160   0.0308 *  
time_on_site    2.964e-03  1.157e-03   2.562   0.0104 *  
cart_additions  2.789e-01  6.152e-02   4.533 5.82e-06 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 419.09  on 700  degrees of freedom
Residual deviance: 381.44  on 695  degrees of freedom
AIC: 393.44

Number of Fisher Scoring iterations: 5</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a><span class="co"># 预测概率</span></span>
<span id="cb23-2"><a href="#cb23-2"></a>prob_predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(logit_model, <span class="at">newdata =</span> test_class, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb23-3"><a href="#cb23-3"></a>class_predictions <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(prob_predictions <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="st">"Yes"</span>, <span class="st">"No"</span>)</span>
<span id="cb23-4"><a href="#cb23-4"></a>class_predictions <span class="ot">&lt;-</span> <span class="fu">factor</span>(class_predictions, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"No"</span>, <span class="st">"Yes"</span>))</span>
<span id="cb23-5"><a href="#cb23-5"></a></span>
<span id="cb23-6"><a href="#cb23-6"></a><span class="co"># 模型评估 - 修复因子水平问题</span></span>
<span id="cb23-7"><a href="#cb23-7"></a>conf_matrix <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(class_predictions, test_class<span class="sc">$</span>made_purchase, <span class="at">positive =</span> <span class="st">"Yes"</span>)</span>
<span id="cb23-8"><a href="#cb23-8"></a><span class="fu">print</span>(conf_matrix)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction  No Yes
       No  273  26
       Yes   0   0
                                          
               Accuracy : 0.913           
                 95% CI : (0.8752, 0.9424)
    No Information Rate : 0.913           
    P-Value [Acc &gt; NIR] : 0.552           
                                          
                  Kappa : 0               
                                          
 Mcnemar's Test P-Value : 9.443e-07       
                                          
            Sensitivity : 0.00000         
            Specificity : 1.00000         
         Pos Pred Value :     NaN         
         Neg Pred Value : 0.91304         
             Prevalence : 0.08696         
         Detection Rate : 0.00000         
   Detection Prevalence : 0.00000         
      Balanced Accuracy : 0.50000         
                                          
       'Positive' Class : Yes             
                                          </code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a><span class="co"># 绘制ROC曲线</span></span>
<span id="cb25-2"><a href="#cb25-2"></a><span class="fu">library</span>(pROC)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stderr">
<pre><code>Type 'citation("pROC")' for a citation.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'pROC'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    cov, smooth, var</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a>roc_curve <span class="ot">&lt;-</span> <span class="fu">roc</span>(<span class="fu">as.numeric</span>(test_class<span class="sc">$</span>made_purchase) <span class="sc">-</span> <span class="dv">1</span>, prob_predictions)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = 0, case = 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a><span class="fu">plot</span>(roc_curve, <span class="at">main =</span> <span class="st">"逻辑回归ROC曲线"</span>)</span>
<span id="cb32-2"><a href="#cb32-2"></a>auc_value <span class="ot">&lt;-</span> <span class="fu">auc</span>(roc_curve)</span>
<span id="cb32-3"><a href="#cb32-3"></a><span class="fu">legend</span>(<span class="st">"bottomright"</span>, <span class="at">legend =</span> <span class="fu">paste</span>(<span class="st">"AUC ="</span>, <span class="fu">round</span>(auc_value, <span class="dv">3</span>)))</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="14-案例综合分析_files/figure-html/r-classification-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="随机森林分类" class="level3" data-number="14.5.2"><h3 data-number="14.5.2" class="anchored" data-anchor-id="随机森林分类">
<span class="header-section-number">14.5.2</span> 3.2 随机森林分类</h3>
<div class="cell">
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a><span class="fu">library</span>(randomForest)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stderr">
<pre><code>randomForest 4.7-1.2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Type rfNews() to see new features/changes/bug fixes.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'randomForest'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:ggplot2':

    margin</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:dplyr':

    combine</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a><span class="co"># 确保训练数据和测试数据的因子水平一致</span></span>
<span id="cb39-2"><a href="#cb39-2"></a>train_class<span class="sc">$</span>made_purchase <span class="ot">&lt;-</span> <span class="fu">factor</span>(train_class<span class="sc">$</span>made_purchase, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"No"</span>, <span class="st">"Yes"</span>))</span>
<span id="cb39-3"><a href="#cb39-3"></a>test_class<span class="sc">$</span>made_purchase <span class="ot">&lt;-</span> <span class="fu">factor</span>(test_class<span class="sc">$</span>made_purchase, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"No"</span>, <span class="st">"Yes"</span>))</span>
<span id="cb39-4"><a href="#cb39-4"></a></span>
<span id="cb39-5"><a href="#cb39-5"></a><span class="co"># 训练随机森林</span></span>
<span id="cb39-6"><a href="#cb39-6"></a>rf_model <span class="ot">&lt;-</span> <span class="fu">randomForest</span>(made_purchase <span class="sc">~</span> ., <span class="at">data =</span> train_class, <span class="at">ntree =</span> <span class="dv">100</span>)</span>
<span id="cb39-7"><a href="#cb39-7"></a></span>
<span id="cb39-8"><a href="#cb39-8"></a><span class="co"># 预测</span></span>
<span id="cb39-9"><a href="#cb39-9"></a>rf_predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(rf_model, <span class="at">newdata =</span> test_class)</span>
<span id="cb39-10"><a href="#cb39-10"></a></span>
<span id="cb39-11"><a href="#cb39-11"></a><span class="co"># 评估 - 确保因子水平一致</span></span>
<span id="cb39-12"><a href="#cb39-12"></a>rf_conf_matrix <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(rf_predictions, test_class<span class="sc">$</span>made_purchase, <span class="at">positive =</span> <span class="st">"Yes"</span>)</span>
<span id="cb39-13"><a href="#cb39-13"></a><span class="fu">print</span>(rf_conf_matrix)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction  No Yes
       No  271  26
       Yes   2   0
                                          
               Accuracy : 0.9064          
                 95% CI : (0.8675, 0.9369)
    No Information Rate : 0.913           
    P-Value [Acc &gt; NIR] : 0.7033          
                                          
                  Kappa : -0.0126         
                                          
 Mcnemar's Test P-Value : 1.383e-05       
                                          
            Sensitivity : 0.000000        
            Specificity : 0.992674        
         Pos Pred Value : 0.000000        
         Neg Pred Value : 0.912458        
             Prevalence : 0.086957        
         Detection Rate : 0.000000        
   Detection Prevalence : 0.006689        
      Balanced Accuracy : 0.496337        
                                          
       'Positive' Class : Yes             
                                          </code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a><span class="co"># 变量重要性</span></span>
<span id="cb41-2"><a href="#cb41-2"></a><span class="fu">varImpPlot</span>(rf_model, <span class="at">main =</span> <span class="st">"随机森林变量重要性"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="14-案例综合分析_files/figure-html/r-random-forest-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1"></a><span class="co"># 随机森林ROC曲线</span></span>
<span id="cb42-2"><a href="#cb42-2"></a>rf_prob <span class="ot">&lt;-</span> <span class="fu">predict</span>(rf_model, <span class="at">newdata =</span> test_class, <span class="at">type =</span> <span class="st">"prob"</span>)[, <span class="st">"Yes"</span>]</span>
<span id="cb42-3"><a href="#cb42-3"></a>rf_roc <span class="ot">&lt;-</span> <span class="fu">roc</span>(<span class="fu">as.numeric</span>(test_class<span class="sc">$</span>made_purchase) <span class="sc">-</span> <span class="dv">1</span>, rf_prob)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = 0, case = 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1"></a><span class="fu">plot</span>(rf_roc, <span class="at">main =</span> <span class="st">"随机森林ROC曲线"</span>)</span>
<span id="cb45-2"><a href="#cb45-2"></a>rf_auc <span class="ot">&lt;-</span> <span class="fu">auc</span>(rf_roc)</span>
<span id="cb45-3"><a href="#cb45-3"></a><span class="fu">legend</span>(<span class="st">"bottomright"</span>, <span class="at">legend =</span> <span class="fu">paste</span>(<span class="st">"AUC ="</span>, <span class="fu">round</span>(rf_auc, <span class="dv">3</span>)))</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="14-案例综合分析_files/figure-html/r-random-forest-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="分类模型比较---修复版本" class="level3" data-number="14.5.3"><h3 data-number="14.5.3" class="anchored" data-anchor-id="分类模型比较---修复版本">
<span class="header-section-number">14.5.3</span> 3.3 分类模型比较 - 修复版本</h3>
<div class="cell">
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1"></a><span class="co"># 加载必要的包</span></span>
<span id="cb46-2"><a href="#cb46-2"></a><span class="fu">library</span>(tidyr)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section></section><section id="聚类分析用户分群" class="level2" data-number="14.6"><h2 data-number="14.6" class="anchored" data-anchor-id="聚类分析用户分群">
<span class="header-section-number">14.6</span> 4. 聚类分析：用户分群</h2>
<section id="k-means聚类" class="level3" data-number="14.6.1"><h3 data-number="14.6.1" class="anchored" data-anchor-id="k-means聚类">
<span class="header-section-number">14.6.1</span> 4.1 K-means聚类</h3>
<div class="cell">
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1"></a><span class="co"># 准备聚类数据</span></span>
<span id="cb47-2"><a href="#cb47-2"></a>cluster_data <span class="ot">&lt;-</span> user_data <span class="sc">%&gt;%</span></span>
<span id="cb47-3"><a href="#cb47-3"></a>  <span class="fu">select</span>(age, income, page_views, time_on_site, cart_additions) <span class="sc">%&gt;%</span></span>
<span id="cb47-4"><a href="#cb47-4"></a>  <span class="fu">scale</span>()  <span class="co"># 标准化</span></span>
<span id="cb47-5"><a href="#cb47-5"></a></span>
<span id="cb47-6"><a href="#cb47-6"></a><span class="co"># 确定最佳聚类数</span></span>
<span id="cb47-7"><a href="#cb47-7"></a>wss <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="cf">function</span>(k){<span class="fu">kmeans</span>(cluster_data, k, <span class="at">nstart =</span> <span class="dv">25</span>)<span class="sc">$</span>tot.withinss})</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stderr">
<pre><code>Warning: did not converge in 10 iterations
Warning: did not converge in 10 iterations</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb49"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1"></a><span class="fu">ggplot</span>(<span class="fu">data.frame</span>(<span class="at">k =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">wss =</span> wss), <span class="fu">aes</span>(<span class="at">x =</span> k, <span class="at">y =</span> wss)) <span class="sc">+</span></span>
<span id="cb49-2"><a href="#cb49-2"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb49-3"><a href="#cb49-3"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"肘部法则确定最佳聚类数"</span>, <span class="at">x =</span> <span class="st">"聚类数"</span>, <span class="at">y =</span> <span class="st">"组内平方和"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="14-案例综合分析_files/figure-html/r-clustering-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb50"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1"></a><span class="co"># 执行K-means聚类</span></span>
<span id="cb50-2"><a href="#cb50-2"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb50-3"><a href="#cb50-3"></a>kmeans_result <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(cluster_data, <span class="at">centers =</span> <span class="dv">4</span>, <span class="at">nstart =</span> <span class="dv">25</span>)</span>
<span id="cb50-4"><a href="#cb50-4"></a></span>
<span id="cb50-5"><a href="#cb50-5"></a><span class="co"># 添加聚类标签</span></span>
<span id="cb50-6"><a href="#cb50-6"></a>user_data<span class="sc">$</span>cluster <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(kmeans_result<span class="sc">$</span>cluster)</span>
<span id="cb50-7"><a href="#cb50-7"></a></span>
<span id="cb50-8"><a href="#cb50-8"></a><span class="co"># 聚类结果可视化</span></span>
<span id="cb50-9"><a href="#cb50-9"></a><span class="fu">library</span>(factoextra)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stderr">
<pre><code>Welcome! Want to learn more? See two factoextra-related books at https://goo.gl/ve3WBa</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb52"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1"></a><span class="fu">fviz_cluster</span>(kmeans_result, <span class="at">data =</span> cluster_data, </span>
<span id="cb52-2"><a href="#cb52-2"></a>             <span class="at">palette =</span> <span class="fu">c</span>(<span class="st">"#2E9FDF"</span>, <span class="st">"#00AFBB"</span>, <span class="st">"#E7B800"</span>, <span class="st">"#FC4E07"</span>),</span>
<span id="cb52-3"><a href="#cb52-3"></a>             <span class="at">geom =</span> <span class="st">"point"</span>,</span>
<span id="cb52-4"><a href="#cb52-4"></a>             <span class="at">ellipse.type =</span> <span class="st">"convex"</span>,</span>
<span id="cb52-5"><a href="#cb52-5"></a>             <span class="at">ggtheme =</span> <span class="fu">theme_bw</span>())</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="14-案例综合分析_files/figure-html/r-clustering-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="聚类分析---修复版本" class="level3" data-number="14.6.2"><h3 data-number="14.6.2" class="anchored" data-anchor-id="聚类分析---修复版本">
<span class="header-section-number">14.6.2</span> 4.2 聚类分析 - 修复版本</h3>
<div class="cell">
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb53"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1"></a><span class="co"># 聚类特征分析</span></span>
<span id="cb53-2"><a href="#cb53-2"></a>cluster_summary <span class="ot">&lt;-</span> user_data <span class="sc">%&gt;%</span></span>
<span id="cb53-3"><a href="#cb53-3"></a>  <span class="fu">group_by</span>(cluster) <span class="sc">%&gt;%</span></span>
<span id="cb53-4"><a href="#cb53-4"></a>  <span class="fu">summarise</span>(</span>
<span id="cb53-5"><a href="#cb53-5"></a>    <span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb53-6"><a href="#cb53-6"></a>    <span class="at">avg_age =</span> <span class="fu">mean</span>(age),</span>
<span id="cb53-7"><a href="#cb53-7"></a>    <span class="at">avg_income =</span> <span class="fu">mean</span>(income),</span>
<span id="cb53-8"><a href="#cb53-8"></a>    <span class="at">avg_page_views =</span> <span class="fu">mean</span>(page_views),</span>
<span id="cb53-9"><a href="#cb53-9"></a>    <span class="at">avg_time =</span> <span class="fu">mean</span>(time_on_site),</span>
<span id="cb53-10"><a href="#cb53-10"></a>    <span class="at">purchase_rate =</span> <span class="fu">mean</span>(made_purchase),</span>
<span id="cb53-11"><a href="#cb53-11"></a>    <span class="at">avg_purchase =</span> <span class="fu">mean</span>(purchase_amount)</span>
<span id="cb53-12"><a href="#cb53-12"></a>  )</span>
<span id="cb53-13"><a href="#cb53-13"></a></span>
<span id="cb53-14"><a href="#cb53-14"></a><span class="fu">print</span>(cluster_summary)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 8
  cluster     n avg_age avg_income avg_page_views avg_time purchase_rate
  &lt;fct&gt;   &lt;int&gt;   &lt;dbl&gt;      &lt;dbl&gt;          &lt;dbl&gt;    &lt;dbl&gt;         &lt;dbl&gt;
1 1         292    53.9     50802.           23.1     376.        0.0822
2 2         257    30.1     46562.           22.3     304.        0.0506
3 3         203    33.8     47358.           25.6     293.        0.133 
4 4         248    44.6     55625.           29.2     210.        0.0968
# ℹ 1 more variable: avg_purchase &lt;dbl&gt;</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb55"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1"></a><span class="co"># 聚类特征可视化 - 修复版本</span></span>
<span id="cb55-2"><a href="#cb55-2"></a>cluster_features <span class="ot">&lt;-</span> user_data <span class="sc">%&gt;%</span></span>
<span id="cb55-3"><a href="#cb55-3"></a>  <span class="fu">select</span>(cluster, age, income, page_views, time_on_site, purchase_amount)</span>
<span id="cb55-4"><a href="#cb55-4"></a></span>
<span id="cb55-5"><a href="#cb55-5"></a><span class="co"># 使用tidyr::pivot_longer</span></span>
<span id="cb55-6"><a href="#cb55-6"></a>cluster_features_long <span class="ot">&lt;-</span> tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb55-7"><a href="#cb55-7"></a>  cluster_features,</span>
<span id="cb55-8"><a href="#cb55-8"></a>  <span class="at">cols =</span> <span class="sc">-</span>cluster,</span>
<span id="cb55-9"><a href="#cb55-9"></a>  <span class="at">names_to =</span> <span class="st">"Feature"</span>,</span>
<span id="cb55-10"><a href="#cb55-10"></a>  <span class="at">values_to =</span> <span class="st">"Value"</span></span>
<span id="cb55-11"><a href="#cb55-11"></a>)</span>
<span id="cb55-12"><a href="#cb55-12"></a></span>
<span id="cb55-13"><a href="#cb55-13"></a><span class="fu">ggplot</span>(cluster_features_long, <span class="fu">aes</span>(<span class="at">x =</span> cluster, <span class="at">y =</span> Value, <span class="at">fill =</span> cluster)) <span class="sc">+</span></span>
<span id="cb55-14"><a href="#cb55-14"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb55-15"><a href="#cb55-15"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> Feature, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb55-16"><a href="#cb55-16"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"各聚类群体特征分布"</span>) <span class="sc">+</span></span>
<span id="cb55-17"><a href="#cb55-17"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb55-18"><a href="#cb55-18"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="14-案例综合分析_files/figure-html/r-cluster-analysis-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section></section><section id="关联分析商品购买关联规则" class="level2" data-number="14.7"><h2 data-number="14.7" class="anchored" data-anchor-id="关联分析商品购买关联规则">
<span class="header-section-number">14.7</span> 5. 关联分析：商品购买关联规则</h2>
<section id="apriori算法" class="level3" data-number="14.7.1"><h3 data-number="14.7.1" class="anchored" data-anchor-id="apriori算法">
<span class="header-section-number">14.7.1</span> 5.1 Apriori算法</h3>
<div class="cell">
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb56"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1"></a><span class="fu">library</span>(arules)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stderr">
<pre><code>Loading required package: Matrix</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'Matrix'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:tidyr':

    expand, pack, unpack</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'arules'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:dplyr':

    recode</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    abbreviate, write</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb63"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1"></a><span class="co"># 准备关联分析数据 - 只包含产品购买列</span></span>
<span id="cb63-2"><a href="#cb63-2"></a>transaction_data <span class="ot">&lt;-</span> user_data <span class="sc">%&gt;%</span></span>
<span id="cb63-3"><a href="#cb63-3"></a>  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"bought_"</span>))</span>
<span id="cb63-4"><a href="#cb63-4"></a></span>
<span id="cb63-5"><a href="#cb63-5"></a><span class="co"># 转换为事务数据</span></span>
<span id="cb63-6"><a href="#cb63-6"></a>transactions <span class="ot">&lt;-</span> <span class="fu">as</span>(transaction_data, <span class="st">"transactions"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stderr">
<pre><code>Warning: Column(s) 1, 2, 3, 4, 5 not logical or factor. Applying default
discretization (see '? discretizeDF').</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in discretize(x = c(0L, 1L, 0L, 1L, 1L, 0L, 0L, 1L, 0L, 0L, 1L, : The calculated breaks are: 0, 0, 1, 1
  Only unique breaks are used reducing the number of intervals. Look at ? discretize for details.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in discretize(x = c(0L, 1L, 0L, 0L, 0L, 0L, 1L, 1L, 0L, 0L, 1L, : The calculated breaks are: 0, 0, 1, 1
  Only unique breaks are used reducing the number of intervals. Look at ? discretize for details.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in discretize(x = c(0L, 1L, 0L, 0L, 0L, 1L, 1L, 1L, 0L, 0L, 0L, : The calculated breaks are: 0, 0, 1, 1
  Only unique breaks are used reducing the number of intervals. Look at ? discretize for details.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in discretize(x = c(0L, 0L, 0L, 1L, 0L, 1L, 0L, 1L, 1L, 1L, 1L, : The calculated breaks are: 0, 0, 1, 1
  Only unique breaks are used reducing the number of intervals. Look at ? discretize for details.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in discretize(x = c(0L, 1L, 0L, 0L, 0L, 1L, 1L, 1L, 1L, 0L, 1L, : The calculated breaks are: 0, 0, 1, 1
  Only unique breaks are used reducing the number of intervals. Look at ? discretize for details.</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb70"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1"></a><span class="co"># 查看事务数据概览</span></span>
<span id="cb70-2"><a href="#cb70-2"></a><span class="fu">summary</span>(transactions)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>transactions as itemMatrix in sparse format with
 1000 rows (elements/itemsets/transactions) and
 5 columns (items) and a density of 1 

most frequent items:
bought_electronics=[0,1]    bought_clothing=[0,1]       bought_books=[0,1] 
                    1000                     1000                     1000 
       bought_home=[0,1]      bought_sports=[0,1]                  (Other) 
                    1000                     1000                        0 

element (itemset/transaction) length distribution:
sizes
   5 
1000 

   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
      5       5       5       5       5       5 

includes extended item information - examples:
                    labels          variables levels
1 bought_electronics=[0,1] bought_electronics  [0,1]
2    bought_clothing=[0,1]    bought_clothing  [0,1]
3       bought_books=[0,1]       bought_books  [0,1]

includes extended transaction information - examples:
  transactionID
1             1
2             2
3             3</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb72"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1"></a><span class="co"># 查看产品频率</span></span>
<span id="cb72-2"><a href="#cb72-2"></a>itemFrequency <span class="ot">&lt;-</span> <span class="fu">itemFrequency</span>(transactions)</span>
<span id="cb72-3"><a href="#cb72-3"></a><span class="fu">print</span>(<span class="st">"产品购买频率:"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[1] "产品购买频率:"</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb74"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1"></a><span class="fu">print</span>(<span class="fu">sort</span>(itemFrequency, <span class="at">decreasing =</span> <span class="cn">TRUE</span>))</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>bought_electronics=[0,1]    bought_clothing=[0,1]       bought_books=[0,1] 
                       1                        1                        1 
       bought_home=[0,1]      bought_sports=[0,1] 
                       1                        1 </code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb76"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1"></a><span class="co"># 使用更宽松的参数挖掘关联规则</span></span>
<span id="cb76-2"><a href="#cb76-2"></a>rules <span class="ot">&lt;-</span> <span class="fu">apriori</span>(transactions, </span>
<span id="cb76-3"><a href="#cb76-3"></a>                 <span class="at">parameter =</span> <span class="fu">list</span>(<span class="at">support =</span> <span class="fl">0.05</span>,  <span class="co"># 降低支持度阈值</span></span>
<span id="cb76-4"><a href="#cb76-4"></a>                                 <span class="at">confidence =</span> <span class="fl">0.3</span>,  <span class="co"># 降低置信度阈值</span></span>
<span id="cb76-5"><a href="#cb76-5"></a>                                 <span class="at">minlen =</span> <span class="dv">2</span>,        <span class="co"># 最小规则长度</span></span>
<span id="cb76-6"><a href="#cb76-6"></a>                                 <span class="at">maxlen =</span> <span class="dv">4</span>))       <span class="co"># 最大规则长度</span></span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Apriori

Parameter specification:
 confidence minval smax arem  aval originalSupport maxtime support minlen
        0.3    0.1    1 none FALSE            TRUE       5    0.05      2
 maxlen target  ext
      4  rules TRUE

Algorithmic control:
 filter tree heap memopt load sort verbose
    0.1 TRUE TRUE  FALSE TRUE    2    TRUE

Absolute minimum support count: 50 

set item appearances ...[0 item(s)] done [0.00s].
set transactions ...[5 item(s), 1000 transaction(s)] done [0.00s].
sorting and recoding items ... [5 item(s)] done [0.00s].
creating transaction tree ... done [0.00s].
checking subsets of size 1 2 3 4</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in apriori(transactions, parameter = list(support = 0.05, confidence =
0.3, : Mining stopped (maxlen reached). Only patterns up to a length of 4
returned!</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code> done [0.00s].
writing ... [70 rule(s)] done [0.00s].
creating S4 object  ... done [0.00s].</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb80"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1"></a><span class="co"># 规则摘要</span></span>
<span id="cb80-2"><a href="#cb80-2"></a><span class="fu">cat</span>(<span class="st">"找到的规则数量:"</span>, <span class="fu">length</span>(rules), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>找到的规则数量: 70 </code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb82"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1"></a><span class="fu">summary</span>(rules)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>set of 70 rules

rule length distribution (lhs + rhs):sizes
 2  3  4 
20 30 20 

   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
      2       2       3       3       4       4 

summary of quality measures:
    support    confidence    coverage      lift       count     
 Min.   :1   Min.   :1    Min.   :1   Min.   :1   Min.   :1000  
 1st Qu.:1   1st Qu.:1    1st Qu.:1   1st Qu.:1   1st Qu.:1000  
 Median :1   Median :1    Median :1   Median :1   Median :1000  
 Mean   :1   Mean   :1    Mean   :1   Mean   :1   Mean   :1000  
 3rd Qu.:1   3rd Qu.:1    3rd Qu.:1   3rd Qu.:1   3rd Qu.:1000  
 Max.   :1   Max.   :1    Max.   :1   Max.   :1   Max.   :1000  

mining info:
         data ntransactions support confidence
 transactions          1000    0.05        0.3
                                                                                                     call
 apriori(data = transactions, parameter = list(support = 0.05, confidence = 0.3, minlen = 2, maxlen = 4))</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb84"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1"></a><span class="co"># 查看规则</span></span>
<span id="cb84-2"><a href="#cb84-2"></a><span class="cf">if</span>(<span class="fu">length</span>(rules) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb84-3"><a href="#cb84-3"></a>  <span class="co"># 按提升度排序</span></span>
<span id="cb84-4"><a href="#cb84-4"></a>  rules_sorted <span class="ot">&lt;-</span> <span class="fu">sort</span>(rules, <span class="at">by =</span> <span class="st">"lift"</span>, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb84-5"><a href="#cb84-5"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">前10条关联规则 (按提升度排序):</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb84-6"><a href="#cb84-6"></a>  <span class="fu">inspect</span>(<span class="fu">head</span>(rules_sorted, <span class="dv">10</span>))</span>
<span id="cb84-7"><a href="#cb84-7"></a>} <span class="cf">else</span> {</span>
<span id="cb84-8"><a href="#cb84-8"></a>  <span class="fu">cat</span>(<span class="st">"没有找到关联规则，请进一步降低阈值参数</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb84-9"><a href="#cb84-9"></a>}</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>
前10条关联规则 (按提升度排序):
     lhs                           rhs                        support
[1]  {bought_electronics=[0,1]} =&gt; {bought_clothing=[0,1]}    1      
[2]  {bought_clothing=[0,1]}    =&gt; {bought_electronics=[0,1]} 1      
[3]  {bought_electronics=[0,1]} =&gt; {bought_books=[0,1]}       1      
[4]  {bought_books=[0,1]}       =&gt; {bought_electronics=[0,1]} 1      
[5]  {bought_electronics=[0,1]} =&gt; {bought_home=[0,1]}        1      
[6]  {bought_home=[0,1]}        =&gt; {bought_electronics=[0,1]} 1      
[7]  {bought_electronics=[0,1]} =&gt; {bought_sports=[0,1]}      1      
[8]  {bought_sports=[0,1]}      =&gt; {bought_electronics=[0,1]} 1      
[9]  {bought_clothing=[0,1]}    =&gt; {bought_books=[0,1]}       1      
[10] {bought_books=[0,1]}       =&gt; {bought_clothing=[0,1]}    1      
     confidence coverage lift count
[1]  1          1        1    1000 
[2]  1          1        1    1000 
[3]  1          1        1    1000 
[4]  1          1        1    1000 
[5]  1          1        1    1000 
[6]  1          1        1    1000 
[7]  1          1        1    1000 
[8]  1          1        1    1000 
[9]  1          1        1    1000 
[10] 1          1        1    1000 </code></pre>
</div>
</div>
</section><section id="关联规则可视化" class="level3" data-number="14.7.2"><h3 data-number="14.7.2" class="anchored" data-anchor-id="关联规则可视化">
<span class="header-section-number">14.7.2</span> 5.2 关联规则可视化</h3>
<div class="cell">
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb86"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1"></a><span class="fu">library</span>(arulesViz)</span>
<span id="cb86-2"><a href="#cb86-2"></a></span>
<span id="cb86-3"><a href="#cb86-3"></a><span class="cf">if</span>(<span class="fu">length</span>(rules) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb86-4"><a href="#cb86-4"></a>  <span class="co"># 选择前20条规则进行可视化</span></span>
<span id="cb86-5"><a href="#cb86-5"></a>  rules_for_plot <span class="ot">&lt;-</span> <span class="fu">head</span>(<span class="fu">sort</span>(rules, <span class="at">by =</span> <span class="st">"lift"</span>), <span class="fu">min</span>(<span class="dv">20</span>, <span class="fu">length</span>(rules)))</span>
<span id="cb86-6"><a href="#cb86-6"></a>  </span>
<span id="cb86-7"><a href="#cb86-7"></a>  <span class="co"># 散点图</span></span>
<span id="cb86-8"><a href="#cb86-8"></a>  plot1 <span class="ot">&lt;-</span> <span class="fu">plot</span>(rules_for_plot, <span class="at">method =</span> <span class="st">"scatter"</span>, </span>
<span id="cb86-9"><a href="#cb86-9"></a>               <span class="at">main =</span> <span class="st">"关联规则散点图 (支持度 vs 置信度)"</span>)</span>
<span id="cb86-10"><a href="#cb86-10"></a>  </span>
<span id="cb86-11"><a href="#cb86-11"></a>  <span class="co"># 矩阵图</span></span>
<span id="cb86-12"><a href="#cb86-12"></a>  plot2 <span class="ot">&lt;-</span> <span class="fu">plot</span>(rules_for_plot, <span class="at">method =</span> <span class="st">"matrix"</span>, </span>
<span id="cb86-13"><a href="#cb86-13"></a>               <span class="at">main =</span> <span class="st">"关联规则矩阵图"</span>)</span>
<span id="cb86-14"><a href="#cb86-14"></a>  </span>
<span id="cb86-15"><a href="#cb86-15"></a>  <span class="co"># 分组图</span></span>
<span id="cb86-16"><a href="#cb86-16"></a>  plot3 <span class="ot">&lt;-</span> <span class="fu">plot</span>(rules_for_plot, <span class="at">method =</span> <span class="st">"grouped"</span>,</span>
<span id="cb86-17"><a href="#cb86-17"></a>               <span class="at">main =</span> <span class="st">"关联规则分组图"</span>)</span>
<span id="cb86-18"><a href="#cb86-18"></a>  </span>
<span id="cb86-19"><a href="#cb86-19"></a>  <span class="co"># 显示图形</span></span>
<span id="cb86-20"><a href="#cb86-20"></a>  plot1</span>
<span id="cb86-21"><a href="#cb86-21"></a>  plot2</span>
<span id="cb86-22"><a href="#cb86-22"></a>  plot3</span>
<span id="cb86-23"><a href="#cb86-23"></a>  </span>
<span id="cb86-24"><a href="#cb86-24"></a>} <span class="cf">else</span> {</span>
<span id="cb86-25"><a href="#cb86-25"></a>  <span class="fu">cat</span>(<span class="st">"没有足够的规则进行可视化</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb86-26"><a href="#cb86-26"></a>  </span>
<span id="cb86-27"><a href="#cb86-27"></a>  <span class="co"># 显示产品共现矩阵作为替代</span></span>
<span id="cb86-28"><a href="#cb86-28"></a>  item_matrix <span class="ot">&lt;-</span> <span class="fu">crossTable</span>(transactions)</span>
<span id="cb86-29"><a href="#cb86-29"></a>  <span class="fu">corrplot</span>(item_matrix, <span class="at">method =</span> <span class="st">"color"</span>, </span>
<span id="cb86-30"><a href="#cb86-30"></a>           <span class="at">title =</span> <span class="st">"产品共现热图"</span>,</span>
<span id="cb86-31"><a href="#cb86-31"></a>           <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">0</span>))</span>
<span id="cb86-32"><a href="#cb86-32"></a>}</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stderr">
<pre><code>To reduce overplotting, jitter is added! Use jitter = 0 to prevent jitter.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Itemsets in Antecedent (LHS)
[1] "{bought_electronics=[0,1]}" "{bought_clothing=[0,1]}"   
[3] "{bought_books=[0,1]}"       "{bought_home=[0,1]}"       
[5] "{bought_sports=[0,1]}"     
Itemsets in Consequent (RHS)
[1] "{bought_sports=[0,1]}"      "{bought_home=[0,1]}"       
[3] "{bought_books=[0,1]}"       "{bought_electronics=[0,1]}"
[5] "{bought_clothing=[0,1]}"   </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Unknown control parameters: main</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Available control parameters (with default values):
k    =  20
aggr.fun     =  function (x, ...)  UseMethod("mean")
rhs_max  =  10
lhs_label_items  =  2
col  =  c("#EE0000FF", "#EEEEEEFF")
groups   =  NULL
engine   =  ggplot2
verbose  =  FALSE</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Registered S3 methods overwritten by 'registry':
  method               from 
  print.registry_field proxy
  print.registry_entry proxy</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="14-案例综合分析_files/figure-html/r-association-viz-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section></section><section id="python实现" class="level1" data-number="15"><h1 data-number="15">
<span class="header-section-number">15</span> Python实现</h1>
<section id="数据准备" class="level2" data-number="15.1"><h2 data-number="15.1" class="anchored" data-anchor-id="数据准备">
<span class="header-section-number">15.1</span> 1. 数据准备</h2>
<div class="cell">
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb92"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb92-2"><a href="#cb92-2"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb92-3"><a href="#cb92-3"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb92-4"><a href="#cb92-4"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb92-5"><a href="#cb92-5"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb92-6"><a href="#cb92-6"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb92-7"><a href="#cb92-7"></a><span class="im">import</span> warnings</span>
<span id="cb92-8"><a href="#cb92-8"></a>warnings.filterwarnings(<span class="st">'ignore'</span>)</span>
<span id="cb92-9"><a href="#cb92-9"></a></span>
<span id="cb92-10"><a href="#cb92-10"></a><span class="co"># 设置中文字体</span></span>
<span id="cb92-11"><a href="#cb92-11"></a>plt.rcParams[<span class="st">'font.sans-serif'</span>] <span class="op">=</span> [<span class="st">'SimHei'</span>]</span>
<span id="cb92-12"><a href="#cb92-12"></a>plt.rcParams[<span class="st">'axes.unicode_minus'</span>] <span class="op">=</span> <span class="va">False</span></span>
<span id="cb92-13"><a href="#cb92-13"></a></span>
<span id="cb92-14"><a href="#cb92-14"></a><span class="co"># 生成相同的模拟数据</span></span>
<span id="cb92-15"><a href="#cb92-15"></a>np.random.seed(<span class="dv">123</span>)</span>
<span id="cb92-16"><a href="#cb92-16"></a>n <span class="op">=</span> <span class="dv">1000</span></span>
<span id="cb92-17"><a href="#cb92-17"></a></span>
<span id="cb92-18"><a href="#cb92-18"></a>python_user_data <span class="op">=</span> pd.DataFrame({</span>
<span id="cb92-19"><a href="#cb92-19"></a>    <span class="st">'user_id'</span>: <span class="bu">range</span>(<span class="dv">1</span>, n<span class="op">+</span><span class="dv">1</span>),</span>
<span id="cb92-20"><a href="#cb92-20"></a>    <span class="st">'age'</span>: np.random.randint(<span class="dv">18</span>, <span class="dv">66</span>, n),</span>
<span id="cb92-21"><a href="#cb92-21"></a>    <span class="st">'gender'</span>: np.random.choice([<span class="st">'Male'</span>, <span class="st">'Female'</span>], n, p<span class="op">=</span>[<span class="fl">0.48</span>, <span class="fl">0.52</span>]),</span>
<span id="cb92-22"><a href="#cb92-22"></a>    <span class="st">'income'</span>: np.random.normal(<span class="dv">50000</span>, <span class="dv">15000</span>, n).<span class="bu">round</span>(),</span>
<span id="cb92-23"><a href="#cb92-23"></a>    <span class="st">'region'</span>: np.random.choice([<span class="st">'North'</span>, <span class="st">'South'</span>, <span class="st">'East'</span>, <span class="st">'West'</span>], n),</span>
<span id="cb92-24"><a href="#cb92-24"></a>    <span class="st">'days_since_signup'</span>: np.random.randint(<span class="dv">1</span>, <span class="dv">366</span>, n),</span>
<span id="cb92-25"><a href="#cb92-25"></a>    <span class="st">'page_views'</span>: np.random.poisson(<span class="dv">25</span>, n),</span>
<span id="cb92-26"><a href="#cb92-26"></a>    <span class="st">'time_on_site'</span>: np.random.normal(<span class="dv">300</span>, <span class="dv">120</span>, n).<span class="bu">round</span>(),</span>
<span id="cb92-27"><a href="#cb92-27"></a>    <span class="st">'cart_additions'</span>: np.random.poisson(<span class="dv">5</span>, n)</span>
<span id="cb92-28"><a href="#cb92-28"></a>})</span>
<span id="cb92-29"><a href="#cb92-29"></a></span>
<span id="cb92-30"><a href="#cb92-30"></a><span class="co"># 生成购买行为</span></span>
<span id="cb92-31"><a href="#cb92-31"></a>python_user_data[<span class="st">'purchase_amount'</span>] <span class="op">=</span> (</span>
<span id="cb92-32"><a href="#cb92-32"></a>    <span class="dv">50</span> <span class="op">+</span> <span class="fl">0.3</span> <span class="op">*</span> python_user_data[<span class="st">'income'</span>]<span class="op">/</span><span class="dv">1000</span> <span class="op">+</span> </span>
<span id="cb92-33"><a href="#cb92-33"></a>    <span class="fl">0.5</span> <span class="op">*</span> python_user_data[<span class="st">'page_views'</span>] <span class="op">+</span> </span>
<span id="cb92-34"><a href="#cb92-34"></a>    <span class="fl">0.8</span> <span class="op">*</span> python_user_data[<span class="st">'time_on_site'</span>]<span class="op">/</span><span class="dv">60</span> <span class="op">+</span> </span>
<span id="cb92-35"><a href="#cb92-35"></a>    <span class="dv">2</span> <span class="op">*</span> python_user_data[<span class="st">'cart_additions'</span>] <span class="op">+</span> </span>
<span id="cb92-36"><a href="#cb92-36"></a>    np.random.normal(<span class="dv">0</span>, <span class="dv">20</span>, n)</span>
<span id="cb92-37"><a href="#cb92-37"></a>)</span>
<span id="cb92-38"><a href="#cb92-38"></a></span>
<span id="cb92-39"><a href="#cb92-39"></a>python_user_data[<span class="st">'made_purchase'</span>] <span class="op">=</span> (python_user_data[<span class="st">'purchase_amount'</span>] <span class="op">&gt;</span> <span class="dv">120</span>).astype(<span class="bu">int</span>)</span>
<span id="cb92-40"><a href="#cb92-40"></a></span>
<span id="cb92-41"><a href="#cb92-41"></a><span class="co"># 添加产品类别 - 创建相关性</span></span>
<span id="cb92-42"><a href="#cb92-42"></a>products <span class="op">=</span> [<span class="st">'electronics'</span>, <span class="st">'clothing'</span>, <span class="st">'books'</span>, <span class="st">'home'</span>, <span class="st">'sports'</span>]</span>
<span id="cb92-43"><a href="#cb92-43"></a>base_prob <span class="op">=</span> <span class="fl">0.4</span></span>
<span id="cb92-44"><a href="#cb92-44"></a></span>
<span id="cb92-45"><a href="#cb92-45"></a>python_user_data[<span class="st">'bought_electronics'</span>] <span class="op">=</span> np.random.binomial(<span class="dv">1</span>, base_prob, n)</span>
<span id="cb92-46"><a href="#cb92-46"></a></span>
<span id="cb92-47"><a href="#cb92-47"></a><span class="co"># 创建相关产品</span></span>
<span id="cb92-48"><a href="#cb92-48"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="bu">len</span>(products)):</span>
<span id="cb92-49"><a href="#cb92-49"></a>    prev_product <span class="op">=</span> <span class="ss">f'bought_</span><span class="sc">{</span>products[i<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss">'</span></span>
<span id="cb92-50"><a href="#cb92-50"></a>    current_product <span class="op">=</span> <span class="ss">f'bought_</span><span class="sc">{</span>products[i]<span class="sc">}</span><span class="ss">'</span></span>
<span id="cb92-51"><a href="#cb92-51"></a>    correlated_prob <span class="op">=</span> python_user_data[prev_product] <span class="op">*</span> <span class="fl">0.3</span> <span class="op">+</span> base_prob</span>
<span id="cb92-52"><a href="#cb92-52"></a>    python_user_data[current_product] <span class="op">=</span> np.random.binomial(<span class="dv">1</span>, np.minimum(correlated_prob, <span class="fl">0.8</span>), n)</span>
<span id="cb92-53"><a href="#cb92-53"></a></span>
<span id="cb92-54"><a href="#cb92-54"></a><span class="bu">print</span>(<span class="st">"Python数据概览:"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Python数据概览:</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb94"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1"></a><span class="bu">print</span>(python_user_data.head())</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>   user_id  age  gender  ...  bought_books bought_home  bought_sports
0        1   63    Male  ...             0           0              1
1        2   20  Female  ...             1           1              1
2        3   46  Female  ...             1           1              1
3        4   52  Female  ...             1           1              0
4        5   56  Female  ...             1           1              1

[5 rows x 16 columns]</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb96"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">数据形状: </span><span class="sc">{</span>python_user_data<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>
数据形状: (1000, 16)</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb98"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1"></a><span class="co"># 产品购买频率</span></span>
<span id="cb98-2"><a href="#cb98-2"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">产品购买频率:"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>
产品购买频率:</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb100"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1"></a><span class="cf">for</span> product <span class="kw">in</span> products:</span>
<span id="cb100-2"><a href="#cb100-2"></a>    col_name <span class="op">=</span> <span class="ss">f'bought_</span><span class="sc">{</span>product<span class="sc">}</span><span class="ss">'</span></span>
<span id="cb100-3"><a href="#cb100-3"></a>    freq <span class="op">=</span> python_user_data[col_name].mean()</span>
<span id="cb100-4"><a href="#cb100-4"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>product<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>freq<span class="sc">:.3f}</span><span class="ss">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>electronics: 0.411
clothing: 0.522
books: 0.553
home: 0.554
sports: 0.565</code></pre>
</div>
</div>
</section><section id="python回归分析" class="level2" data-number="15.2"><h2 data-number="15.2" class="anchored" data-anchor-id="python回归分析">
<span class="header-section-number">15.2</span> 2. Python回归分析</h2>
<div class="cell">
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb102"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LinearRegression</span>
<span id="cb102-2"><a href="#cb102-2"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestRegressor</span>
<span id="cb102-3"><a href="#cb102-3"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error, r2_score, mean_absolute_error</span>
<span id="cb102-4"><a href="#cb102-4"></a></span>
<span id="cb102-5"><a href="#cb102-5"></a><span class="co"># 准备回归数据</span></span>
<span id="cb102-6"><a href="#cb102-6"></a>reg_features <span class="op">=</span> [<span class="st">'age'</span>, <span class="st">'income'</span>, <span class="st">'page_views'</span>, <span class="st">'time_on_site'</span>, <span class="st">'cart_additions'</span>]</span>
<span id="cb102-7"><a href="#cb102-7"></a>X_reg <span class="op">=</span> python_user_data[reg_features]</span>
<span id="cb102-8"><a href="#cb102-8"></a>y_reg <span class="op">=</span> python_user_data[<span class="st">'purchase_amount'</span>]</span>
<span id="cb102-9"><a href="#cb102-9"></a></span>
<span id="cb102-10"><a href="#cb102-10"></a><span class="co"># 数据分割</span></span>
<span id="cb102-11"><a href="#cb102-11"></a>X_train_reg, X_test_reg, y_train_reg, y_test_reg <span class="op">=</span> train_test_split(</span>
<span id="cb102-12"><a href="#cb102-12"></a>    X_reg, y_reg, test_size<span class="op">=</span><span class="fl">0.3</span>, random_state<span class="op">=</span><span class="dv">123</span>)</span>
<span id="cb102-13"><a href="#cb102-13"></a></span>
<span id="cb102-14"><a href="#cb102-14"></a><span class="co"># 线性回归</span></span>
<span id="cb102-15"><a href="#cb102-15"></a>lr_model <span class="op">=</span> LinearRegression()</span>
<span id="cb102-16"><a href="#cb102-16"></a>lr_model.fit(X_train_reg, y_train_reg)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<style>#sk-container-id-1 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: #000;
  --sklearn-color-text-muted: #666;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-1 {
  color: var(--sklearn-color-text);
}

#sk-container-id-1 pre {
  padding: 0;
}

#sk-container-id-1 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-1 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-1 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-1 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-1 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-1 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-1 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-1 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-1 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-1 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-1 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-1 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-1 label.sk-toggleable__label {
  cursor: pointer;
  display: flex;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
  align-items: start;
  justify-content: space-between;
  gap: 0.5em;
}

#sk-container-id-1 label.sk-toggleable__label .caption {
  font-size: 0.6rem;
  font-weight: lighter;
  color: var(--sklearn-color-text-muted);
}

#sk-container-id-1 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-1 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-1 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-1 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-1 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-1 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-1 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-1 div.sk-label label.sk-toggleable__label,
#sk-container-id-1 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-1 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-1 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-1 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-1 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-1 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-1 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 0.5em;
  text-align: center;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-1 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-1 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-1 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-1 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style>
<div id="sk-container-id-1" class="sk-top-container">
<div class="sk-text-repr-fallback">
<pre>LinearRegression()</pre>
<b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b>
</div>
<div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator fitted sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-1" type="checkbox" checked=""><label for="sk-estimator-id-1" class="sk-toggleable__label fitted sk-toggleable__label-arrow"><div><div>LinearRegression</div></div>
<div>
<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.6/modules/generated/sklearn.linear_model.LinearRegression.html">?<span>Documentation for LinearRegression</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span>
</div></label><div class="sk-toggleable__content fitted"><pre>LinearRegression()</pre></div> </div></div></div>
</div>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb103"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1"></a>y_pred_lr <span class="op">=</span> lr_model.predict(X_test_reg)</span>
<span id="cb103-2"><a href="#cb103-2"></a></span>
<span id="cb103-3"><a href="#cb103-3"></a><span class="co"># 随机森林回归</span></span>
<span id="cb103-4"><a href="#cb103-4"></a>rf_reg_model <span class="op">=</span> RandomForestRegressor(n_estimators<span class="op">=</span><span class="dv">100</span>, random_state<span class="op">=</span><span class="dv">123</span>)</span>
<span id="cb103-5"><a href="#cb103-5"></a>rf_reg_model.fit(X_train_reg, y_train_reg)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<style>#sk-container-id-2 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: #000;
  --sklearn-color-text-muted: #666;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-2 {
  color: var(--sklearn-color-text);
}

#sk-container-id-2 pre {
  padding: 0;
}

#sk-container-id-2 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-2 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-2 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-2 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-2 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-2 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-2 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-2 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-2 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-2 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-2 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-2 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-2 label.sk-toggleable__label {
  cursor: pointer;
  display: flex;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
  align-items: start;
  justify-content: space-between;
  gap: 0.5em;
}

#sk-container-id-2 label.sk-toggleable__label .caption {
  font-size: 0.6rem;
  font-weight: lighter;
  color: var(--sklearn-color-text-muted);
}

#sk-container-id-2 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-2 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-2 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-2 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-2 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-2 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-2 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-2 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-2 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-2 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-2 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-2 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-2 div.sk-label label.sk-toggleable__label,
#sk-container-id-2 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-2 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-2 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-2 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-2 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-2 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-2 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-2 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-2 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 0.5em;
  text-align: center;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-2 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-2 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-2 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-2 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style>
<div id="sk-container-id-2" class="sk-top-container">
<div class="sk-text-repr-fallback">
<pre>RandomForestRegressor(random_state=123)</pre>
<b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b>
</div>
<div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator fitted sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-2" type="checkbox" checked=""><label for="sk-estimator-id-2" class="sk-toggleable__label fitted sk-toggleable__label-arrow"><div><div>RandomForestRegressor</div></div>
<div>
<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.6/modules/generated/sklearn.ensemble.RandomForestRegressor.html">?<span>Documentation for RandomForestRegressor</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span>
</div></label><div class="sk-toggleable__content fitted"><pre>RandomForestRegressor(random_state=123)</pre></div> </div></div></div>
</div>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb104"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1"></a>y_pred_rf <span class="op">=</span> rf_reg_model.predict(X_test_reg)</span>
<span id="cb104-2"><a href="#cb104-2"></a></span>
<span id="cb104-3"><a href="#cb104-3"></a><span class="co"># 模型评估</span></span>
<span id="cb104-4"><a href="#cb104-4"></a><span class="kw">def</span> evaluate_regression(y_true, y_pred, model_name):</span>
<span id="cb104-5"><a href="#cb104-5"></a>    mse <span class="op">=</span> mean_squared_error(y_true, y_pred)</span>
<span id="cb104-6"><a href="#cb104-6"></a>    mae <span class="op">=</span> mean_absolute_error(y_true, y_pred)</span>
<span id="cb104-7"><a href="#cb104-7"></a>    r2 <span class="op">=</span> r2_score(y_true, y_pred)</span>
<span id="cb104-8"><a href="#cb104-8"></a>    </span>
<span id="cb104-9"><a href="#cb104-9"></a>    results <span class="op">=</span> {</span>
<span id="cb104-10"><a href="#cb104-10"></a>        <span class="st">'Model'</span>: model_name,</span>
<span id="cb104-11"><a href="#cb104-11"></a>        <span class="st">'RMSE'</span>: np.sqrt(mse),</span>
<span id="cb104-12"><a href="#cb104-12"></a>        <span class="st">'MAE'</span>: mae,</span>
<span id="cb104-13"><a href="#cb104-13"></a>        <span class="st">'R2'</span>: r2</span>
<span id="cb104-14"><a href="#cb104-14"></a>    }</span>
<span id="cb104-15"><a href="#cb104-15"></a>    <span class="cf">return</span> results</span>
<span id="cb104-16"><a href="#cb104-16"></a></span>
<span id="cb104-17"><a href="#cb104-17"></a>lr_metrics <span class="op">=</span> evaluate_regression(y_test_reg, y_pred_lr, <span class="st">'Linear Regression'</span>)</span>
<span id="cb104-18"><a href="#cb104-18"></a>rf_metrics <span class="op">=</span> evaluate_regression(y_test_reg, y_pred_rf, <span class="st">'Random Forest'</span>)</span>
<span id="cb104-19"><a href="#cb104-19"></a></span>
<span id="cb104-20"><a href="#cb104-20"></a>regression_results <span class="op">=</span> pd.DataFrame([lr_metrics, rf_metrics])</span>
<span id="cb104-21"><a href="#cb104-21"></a><span class="bu">print</span>(<span class="st">"回归模型性能比较:"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>回归模型性能比较:</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb106"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1"></a><span class="bu">print</span>(regression_results)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>               Model       RMSE        MAE        R2
0  Linear Regression  19.572048  15.711942  0.040879
1      Random Forest  20.593340  16.873056 -0.061829</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb108"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb108-1"><a href="#cb108-1"></a><span class="co"># 可视化回归结果</span></span>
<span id="cb108-2"><a href="#cb108-2"></a>fig, (ax1, ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">5</span>))</span>
<span id="cb108-3"><a href="#cb108-3"></a></span>
<span id="cb108-4"><a href="#cb108-4"></a><span class="co"># 线性回归结果</span></span>
<span id="cb108-5"><a href="#cb108-5"></a>ax1.scatter(y_test_reg, y_pred_lr, alpha<span class="op">=</span><span class="fl">0.6</span>)</span>
<span id="cb108-6"><a href="#cb108-6"></a>ax1.plot([y_test_reg.<span class="bu">min</span>(), y_test_reg.<span class="bu">max</span>()], [y_test_reg.<span class="bu">min</span>(), y_test_reg.<span class="bu">max</span>()], <span class="st">'r--'</span>, lw<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb108-7"><a href="#cb108-7"></a>ax1.set_xlabel(<span class="st">'实际值'</span>)</span>
<span id="cb108-8"><a href="#cb108-8"></a>ax1.set_ylabel(<span class="st">'预测值'</span>)</span>
<span id="cb108-9"><a href="#cb108-9"></a>ax1.set_title(<span class="ss">f'线性回归 (R² = </span><span class="sc">{</span>lr_metrics[<span class="st">"R2"</span>]<span class="sc">:.3f}</span><span class="ss">)'</span>)</span>
<span id="cb108-10"><a href="#cb108-10"></a></span>
<span id="cb108-11"><a href="#cb108-11"></a><span class="co"># 随机森林结果</span></span>
<span id="cb108-12"><a href="#cb108-12"></a>ax2.scatter(y_test_reg, y_pred_rf, alpha<span class="op">=</span><span class="fl">0.6</span>)</span>
<span id="cb108-13"><a href="#cb108-13"></a>ax2.plot([y_test_reg.<span class="bu">min</span>(), y_test_reg.<span class="bu">max</span>()], [y_test_reg.<span class="bu">min</span>(), y_test_reg.<span class="bu">max</span>()], <span class="st">'r--'</span>, lw<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb108-14"><a href="#cb108-14"></a>ax2.set_xlabel(<span class="st">'实际值'</span>)</span>
<span id="cb108-15"><a href="#cb108-15"></a>ax2.set_ylabel(<span class="st">'预测值'</span>)</span>
<span id="cb108-16"><a href="#cb108-16"></a>ax2.set_title(<span class="ss">f'随机森林回归 (R² = </span><span class="sc">{</span>rf_metrics[<span class="st">"R2"</span>]<span class="sc">:.3f}</span><span class="ss">)'</span>)</span>
<span id="cb108-17"><a href="#cb108-17"></a></span>
<span id="cb108-18"><a href="#cb108-18"></a>plt.tight_layout()</span>
<span id="cb108-19"><a href="#cb108-19"></a>plt.show()</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="14-案例综合分析_files/figure-html/python-regression-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
</section><section id="python分类分析" class="level2" data-number="15.3"><h2 data-number="15.3" class="anchored" data-anchor-id="python分类分析">
<span class="header-section-number">15.3</span> 3. Python分类分析</h2>
<div class="cell">
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb109"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LogisticRegression</span>
<span id="cb109-2"><a href="#cb109-2"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestClassifier</span>
<span id="cb109-3"><a href="#cb109-3"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> classification_report, confusion_matrix, accuracy_score, roc_auc_score, roc_curve</span>
<span id="cb109-4"><a href="#cb109-4"></a></span>
<span id="cb109-5"><a href="#cb109-5"></a><span class="co"># 准备分类数据</span></span>
<span id="cb109-6"><a href="#cb109-6"></a>class_features <span class="op">=</span> [<span class="st">'age'</span>, <span class="st">'income'</span>, <span class="st">'page_views'</span>, <span class="st">'time_on_site'</span>, <span class="st">'cart_additions'</span>]</span>
<span id="cb109-7"><a href="#cb109-7"></a>X_class <span class="op">=</span> python_user_data[class_features]</span>
<span id="cb109-8"><a href="#cb109-8"></a>y_class <span class="op">=</span> python_user_data[<span class="st">'made_purchase'</span>]</span>
<span id="cb109-9"><a href="#cb109-9"></a></span>
<span id="cb109-10"><a href="#cb109-10"></a><span class="co"># 数据分割</span></span>
<span id="cb109-11"><a href="#cb109-11"></a>X_train_class, X_test_class, y_train_class, y_test_class <span class="op">=</span> train_test_split(</span>
<span id="cb109-12"><a href="#cb109-12"></a>    X_class, y_class, test_size<span class="op">=</span><span class="fl">0.3</span>, random_state<span class="op">=</span><span class="dv">123</span>, stratify<span class="op">=</span>y_class)</span>
<span id="cb109-13"><a href="#cb109-13"></a></span>
<span id="cb109-14"><a href="#cb109-14"></a><span class="co"># 逻辑回归</span></span>
<span id="cb109-15"><a href="#cb109-15"></a>logit_model <span class="op">=</span> LogisticRegression(random_state<span class="op">=</span><span class="dv">123</span>)</span>
<span id="cb109-16"><a href="#cb109-16"></a>logit_model.fit(X_train_class, y_train_class)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<style>#sk-container-id-3 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: #000;
  --sklearn-color-text-muted: #666;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-3 {
  color: var(--sklearn-color-text);
}

#sk-container-id-3 pre {
  padding: 0;
}

#sk-container-id-3 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-3 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-3 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-3 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-3 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-3 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-3 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-3 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-3 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-3 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-3 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-3 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-3 label.sk-toggleable__label {
  cursor: pointer;
  display: flex;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
  align-items: start;
  justify-content: space-between;
  gap: 0.5em;
}

#sk-container-id-3 label.sk-toggleable__label .caption {
  font-size: 0.6rem;
  font-weight: lighter;
  color: var(--sklearn-color-text-muted);
}

#sk-container-id-3 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-3 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-3 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-3 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-3 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-3 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-3 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-3 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-3 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-3 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-3 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-3 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-3 div.sk-label label.sk-toggleable__label,
#sk-container-id-3 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-3 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-3 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-3 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-3 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-3 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-3 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-3 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-3 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 0.5em;
  text-align: center;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-3 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-3 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-3 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-3 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style>
<div id="sk-container-id-3" class="sk-top-container">
<div class="sk-text-repr-fallback">
<pre>LogisticRegression(random_state=123)</pre>
<b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b>
</div>
<div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator fitted sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-3" type="checkbox" checked=""><label for="sk-estimator-id-3" class="sk-toggleable__label fitted sk-toggleable__label-arrow"><div><div>LogisticRegression</div></div>
<div>
<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.6/modules/generated/sklearn.linear_model.LogisticRegression.html">?<span>Documentation for LogisticRegression</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span>
</div></label><div class="sk-toggleable__content fitted"><pre>LogisticRegression(random_state=123)</pre></div> </div></div></div>
</div>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb110"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb110-1"><a href="#cb110-1"></a>y_pred_logit <span class="op">=</span> logit_model.predict(X_test_class)</span>
<span id="cb110-2"><a href="#cb110-2"></a>y_pred_logit_proba <span class="op">=</span> logit_model.predict_proba(X_test_class)[:, <span class="dv">1</span>]</span>
<span id="cb110-3"><a href="#cb110-3"></a></span>
<span id="cb110-4"><a href="#cb110-4"></a><span class="co"># 随机森林分类</span></span>
<span id="cb110-5"><a href="#cb110-5"></a>rf_class_model <span class="op">=</span> RandomForestClassifier(n_estimators<span class="op">=</span><span class="dv">100</span>, random_state<span class="op">=</span><span class="dv">123</span>)</span>
<span id="cb110-6"><a href="#cb110-6"></a>rf_class_model.fit(X_train_class, y_train_class)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<style>#sk-container-id-4 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: #000;
  --sklearn-color-text-muted: #666;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-4 {
  color: var(--sklearn-color-text);
}

#sk-container-id-4 pre {
  padding: 0;
}

#sk-container-id-4 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-4 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-4 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-4 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-4 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-4 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-4 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-4 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-4 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-4 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-4 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-4 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-4 label.sk-toggleable__label {
  cursor: pointer;
  display: flex;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
  align-items: start;
  justify-content: space-between;
  gap: 0.5em;
}

#sk-container-id-4 label.sk-toggleable__label .caption {
  font-size: 0.6rem;
  font-weight: lighter;
  color: var(--sklearn-color-text-muted);
}

#sk-container-id-4 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-4 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-4 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-4 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-4 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-4 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-4 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-4 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-4 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-4 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-4 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-4 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-4 div.sk-label label.sk-toggleable__label,
#sk-container-id-4 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-4 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-4 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-4 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-4 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-4 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-4 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-4 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-4 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 0.5em;
  text-align: center;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-4 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-4 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-4 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-4 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style>
<div id="sk-container-id-4" class="sk-top-container">
<div class="sk-text-repr-fallback">
<pre>RandomForestClassifier(random_state=123)</pre>
<b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b>
</div>
<div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator fitted sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-4" type="checkbox" checked=""><label for="sk-estimator-id-4" class="sk-toggleable__label fitted sk-toggleable__label-arrow"><div><div>RandomForestClassifier</div></div>
<div>
<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.6/modules/generated/sklearn.ensemble.RandomForestClassifier.html">?<span>Documentation for RandomForestClassifier</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span>
</div></label><div class="sk-toggleable__content fitted"><pre>RandomForestClassifier(random_state=123)</pre></div> </div></div></div>
</div>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb111"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb111-1"><a href="#cb111-1"></a>y_pred_rf_class <span class="op">=</span> rf_class_model.predict(X_test_class)</span>
<span id="cb111-2"><a href="#cb111-2"></a>y_pred_rf_proba <span class="op">=</span> rf_class_model.predict_proba(X_test_class)[:, <span class="dv">1</span>]</span>
<span id="cb111-3"><a href="#cb111-3"></a></span>
<span id="cb111-4"><a href="#cb111-4"></a><span class="co"># 模型评估</span></span>
<span id="cb111-5"><a href="#cb111-5"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">50</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>==================================================</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb113"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1"></a><span class="bu">print</span>(<span class="st">"逻辑回归性能:"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>逻辑回归性能:</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb115"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb115-1"><a href="#cb115-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">50</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>==================================================</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb117"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb117-1"><a href="#cb117-1"></a><span class="bu">print</span>(classification_report(y_test_class, y_pred_logit))</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>              precision    recall  f1-score   support

           0       0.90      1.00      0.95       271
           1       0.00      0.00      0.00        29

    accuracy                           0.90       300
   macro avg       0.45      0.50      0.47       300
weighted avg       0.82      0.90      0.86       300</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb119"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb119-1"><a href="#cb119-1"></a>logit_accuracy <span class="op">=</span> accuracy_score(y_test_class, y_pred_logit)</span>
<span id="cb119-2"><a href="#cb119-2"></a>logit_auc <span class="op">=</span> roc_auc_score(y_test_class, y_pred_logit_proba)</span>
<span id="cb119-3"><a href="#cb119-3"></a><span class="bu">print</span>(<span class="ss">f"准确率: </span><span class="sc">{</span>logit_accuracy<span class="sc">:.3f}</span><span class="ss">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>准确率: 0.903</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb121"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb121-1"><a href="#cb121-1"></a><span class="bu">print</span>(<span class="ss">f"AUC: </span><span class="sc">{</span>logit_auc<span class="sc">:.3f}</span><span class="ss">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>AUC: 0.461</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb123"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb123-1"><a href="#cb123-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"="</span> <span class="op">*</span> <span class="dv">50</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>
==================================================</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb125"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb125-1"><a href="#cb125-1"></a><span class="bu">print</span>(<span class="st">"随机森林性能:"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>随机森林性能:</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb127"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb127-1"><a href="#cb127-1"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">50</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>==================================================</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb129"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb129-1"><a href="#cb129-1"></a><span class="bu">print</span>(classification_report(y_test_class, y_pred_rf_class))</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>              precision    recall  f1-score   support

           0       0.90      1.00      0.95       271
           1       0.00      0.00      0.00        29

    accuracy                           0.90       300
   macro avg       0.45      0.50      0.47       300
weighted avg       0.82      0.90      0.86       300</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb131"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb131-1"><a href="#cb131-1"></a>rf_accuracy <span class="op">=</span> accuracy_score(y_test_class, y_pred_rf_class)</span>
<span id="cb131-2"><a href="#cb131-2"></a>rf_auc <span class="op">=</span> roc_auc_score(y_test_class, y_pred_rf_proba)</span>
<span id="cb131-3"><a href="#cb131-3"></a><span class="bu">print</span>(<span class="ss">f"准确率: </span><span class="sc">{</span>rf_accuracy<span class="sc">:.3f}</span><span class="ss">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>准确率: 0.903</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb133"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb133-1"><a href="#cb133-1"></a><span class="bu">print</span>(<span class="ss">f"AUC: </span><span class="sc">{</span>rf_auc<span class="sc">:.3f}</span><span class="ss">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>AUC: 0.557</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb135"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb135-1"><a href="#cb135-1"></a><span class="co"># 特征重要性</span></span>
<span id="cb135-2"><a href="#cb135-2"></a>feature_importance <span class="op">=</span> pd.DataFrame({</span>
<span id="cb135-3"><a href="#cb135-3"></a>    <span class="st">'feature'</span>: class_features,</span>
<span id="cb135-4"><a href="#cb135-4"></a>    <span class="st">'importance'</span>: rf_class_model.feature_importances_</span>
<span id="cb135-5"><a href="#cb135-5"></a>}).sort_values(<span class="st">'importance'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb135-6"><a href="#cb135-6"></a></span>
<span id="cb135-7"><a href="#cb135-7"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">随机森林特征重要性:"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>
随机森林特征重要性:</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb137"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb137-1"><a href="#cb137-1"></a><span class="bu">print</span>(feature_importance)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>          feature  importance
3    time_on_site    0.273365
1          income    0.270106
0             age    0.189313
2      page_views    0.160267
4  cart_additions    0.106949</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb139"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb139-1"><a href="#cb139-1"></a><span class="co"># ROC曲线比较</span></span>
<span id="cb139-2"><a href="#cb139-2"></a>fig, (ax1, ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">5</span>))</span>
<span id="cb139-3"><a href="#cb139-3"></a></span>
<span id="cb139-4"><a href="#cb139-4"></a><span class="co"># 逻辑回归ROC</span></span>
<span id="cb139-5"><a href="#cb139-5"></a>fpr_lr, tpr_lr, _ <span class="op">=</span> roc_curve(y_test_class, y_pred_logit_proba)</span>
<span id="cb139-6"><a href="#cb139-6"></a>ax1.plot(fpr_lr, tpr_lr, label<span class="op">=</span><span class="ss">f'Logistic Regression (AUC = </span><span class="sc">{</span>logit_auc<span class="sc">:.3f}</span><span class="ss">)'</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[&lt;matplotlib.lines.Line2D object at 0x000001676CE72C10&gt;]</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb141"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb141-1"><a href="#cb141-1"></a>ax1.plot([<span class="dv">0</span>, <span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>], <span class="st">'k--'</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[&lt;matplotlib.lines.Line2D object at 0x000001676CE72D50&gt;]</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb143"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb143-1"><a href="#cb143-1"></a>ax1.set_xlabel(<span class="st">'False Positive Rate'</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Text(0.5, 0, 'False Positive Rate')</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb145"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb145-1"><a href="#cb145-1"></a>ax1.set_ylabel(<span class="st">'True Positive Rate'</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Text(0, 0.5, 'True Positive Rate')</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb147"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb147-1"><a href="#cb147-1"></a>ax1.set_title(<span class="st">'逻辑回归ROC曲线'</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Text(0.5, 1.0, '逻辑回归ROC曲线')</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb149"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb149-1"><a href="#cb149-1"></a>ax1.legend()</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>&lt;matplotlib.legend.Legend object at 0x000001676C679400&gt;</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb151"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb151-1"><a href="#cb151-1"></a>ax1.grid(<span class="va">True</span>)</span>
<span id="cb151-2"><a href="#cb151-2"></a></span>
<span id="cb151-3"><a href="#cb151-3"></a><span class="co"># 随机森林ROC</span></span>
<span id="cb151-4"><a href="#cb151-4"></a>fpr_rf, tpr_rf, _ <span class="op">=</span> roc_curve(y_test_class, y_pred_rf_proba)</span>
<span id="cb151-5"><a href="#cb151-5"></a>ax2.plot(fpr_rf, tpr_rf, label<span class="op">=</span><span class="ss">f'Random Forest (AUC = </span><span class="sc">{</span>rf_auc<span class="sc">:.3f}</span><span class="ss">)'</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[&lt;matplotlib.lines.Line2D object at 0x000001676CE73890&gt;]</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb153"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb153-1"><a href="#cb153-1"></a>ax2.plot([<span class="dv">0</span>, <span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>], <span class="st">'k--'</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[&lt;matplotlib.lines.Line2D object at 0x000001676CE739D0&gt;]</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb155"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb155-1"><a href="#cb155-1"></a>ax2.set_xlabel(<span class="st">'False Positive Rate'</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Text(0.5, 0, 'False Positive Rate')</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb157"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb157-1"><a href="#cb157-1"></a>ax2.set_ylabel(<span class="st">'True Positive Rate'</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Text(0, 0.5, 'True Positive Rate')</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb159"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb159-1"><a href="#cb159-1"></a>ax2.set_title(<span class="st">'随机森林ROC曲线'</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Text(0.5, 1.0, '随机森林ROC曲线')</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb161"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb161-1"><a href="#cb161-1"></a>ax2.legend()</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>&lt;matplotlib.legend.Legend object at 0x000001676CE73B10&gt;</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb163"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb163-1"><a href="#cb163-1"></a>ax2.grid(<span class="va">True</span>)</span>
<span id="cb163-2"><a href="#cb163-2"></a></span>
<span id="cb163-3"><a href="#cb163-3"></a>plt.tight_layout()</span>
<span id="cb163-4"><a href="#cb163-4"></a>plt.show()</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="14-案例综合分析_files/figure-html/python-classification-3.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb164"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb164-1"><a href="#cb164-1"></a><span class="co"># 模型比较</span></span>
<span id="cb164-2"><a href="#cb164-2"></a>comparison_df <span class="op">=</span> pd.DataFrame({</span>
<span id="cb164-3"><a href="#cb164-3"></a>    <span class="st">'Model'</span>: [<span class="st">'Logistic Regression'</span>, <span class="st">'Random Forest'</span>],</span>
<span id="cb164-4"><a href="#cb164-4"></a>    <span class="st">'Accuracy'</span>: [logit_accuracy, rf_accuracy],</span>
<span id="cb164-5"><a href="#cb164-5"></a>    <span class="st">'AUC'</span>: [logit_auc, rf_auc]</span>
<span id="cb164-6"><a href="#cb164-6"></a>})</span>
<span id="cb164-7"><a href="#cb164-7"></a></span>
<span id="cb164-8"><a href="#cb164-8"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">模型性能比较:"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>
模型性能比较:</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb166"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb166-1"><a href="#cb166-1"></a><span class="bu">print</span>(comparison_df)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>                 Model  Accuracy       AUC
0  Logistic Regression  0.903333  0.461000
1        Random Forest  0.903333  0.557196</code></pre>
</div>
</div>
</section><section id="python聚类分析" class="level2" data-number="15.4"><h2 data-number="15.4" class="anchored" data-anchor-id="python聚类分析">
<span class="header-section-number">15.4</span> 4. Python聚类分析</h2>
<div class="cell">
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb168"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb168-1"><a href="#cb168-1"></a><span class="im">from</span> sklearn.cluster <span class="im">import</span> KMeans</span>
<span id="cb168-2"><a href="#cb168-2"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb168-3"><a href="#cb168-3"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> silhouette_score</span>
<span id="cb168-4"><a href="#cb168-4"></a></span>
<span id="cb168-5"><a href="#cb168-5"></a><span class="co"># 准备聚类数据</span></span>
<span id="cb168-6"><a href="#cb168-6"></a>cluster_features <span class="op">=</span> [<span class="st">'age'</span>, <span class="st">'income'</span>, <span class="st">'page_views'</span>, <span class="st">'time_on_site'</span>, <span class="st">'cart_additions'</span>]</span>
<span id="cb168-7"><a href="#cb168-7"></a>X_cluster <span class="op">=</span> python_user_data[cluster_features]</span>
<span id="cb168-8"><a href="#cb168-8"></a></span>
<span id="cb168-9"><a href="#cb168-9"></a><span class="co"># 数据标准化</span></span>
<span id="cb168-10"><a href="#cb168-10"></a>scaler <span class="op">=</span> StandardScaler()</span>
<span id="cb168-11"><a href="#cb168-11"></a>X_cluster_scaled <span class="op">=</span> scaler.fit_transform(X_cluster)</span>
<span id="cb168-12"><a href="#cb168-12"></a></span>
<span id="cb168-13"><a href="#cb168-13"></a><span class="co"># 寻找最佳聚类数</span></span>
<span id="cb168-14"><a href="#cb168-14"></a>wcss <span class="op">=</span> []</span>
<span id="cb168-15"><a href="#cb168-15"></a>silhouette_scores <span class="op">=</span> []</span>
<span id="cb168-16"><a href="#cb168-16"></a>k_range <span class="op">=</span> <span class="bu">range</span>(<span class="dv">2</span>, <span class="dv">11</span>)</span>
<span id="cb168-17"><a href="#cb168-17"></a></span>
<span id="cb168-18"><a href="#cb168-18"></a><span class="cf">for</span> k <span class="kw">in</span> k_range:</span>
<span id="cb168-19"><a href="#cb168-19"></a>    kmeans <span class="op">=</span> KMeans(n_clusters<span class="op">=</span>k, random_state<span class="op">=</span><span class="dv">123</span>, n_init<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb168-20"><a href="#cb168-20"></a>    kmeans.fit(X_cluster_scaled)</span>
<span id="cb168-21"><a href="#cb168-21"></a>    wcss.append(kmeans.inertia_)</span>
<span id="cb168-22"><a href="#cb168-22"></a>    silhouette_scores.append(silhouette_score(X_cluster_scaled, kmeans.labels_))</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>  File "C:\Data\Anaconda\Lib\site-packages\joblib\externals\loky\backend\context.py", line 257, in _count_physical_cores
    cpu_info = subprocess.run(
        "wmic CPU Get NumberOfCores /Format:csv".split(),
        capture_output=True,
        text=True,
    )
  File "C:\Data\Anaconda\Lib\subprocess.py", line 554, in run
    with Popen(*popenargs, **kwargs) as process:
         ~~~~~^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Data\Anaconda\Lib\subprocess.py", line 1039, in __init__
    self._execute_child(args, executable, preexec_fn, close_fds,
    ~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
                        pass_fds, cwd, env,
                        ^^^^^^^^^^^^^^^^^^^
    ...&lt;5 lines&gt;...
                        gid, gids, uid, umask,
                        ^^^^^^^^^^^^^^^^^^^^^^
                        start_new_session, process_group)
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Data\Anaconda\Lib\subprocess.py", line 1554, in _execute_child
    hp, ht, pid, tid = _winapi.CreateProcess(executable, args,
                       ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^
                             # no special security
                             ^^^^^^^^^^^^^^^^^^^^^
    ...&lt;4 lines&gt;...
                             cwd,
                             ^^^^
                             startupinfo)
                             ^^^^^^^^^^^^
KMeans(n_clusters=2, n_init=10, random_state=123)
KMeans(n_clusters=3, n_init=10, random_state=123)
KMeans(n_clusters=4, n_init=10, random_state=123)
KMeans(n_clusters=5, n_init=10, random_state=123)
KMeans(n_clusters=6, n_init=10, random_state=123)
KMeans(n_clusters=7, n_init=10, random_state=123)
KMeans(n_init=10, random_state=123)
KMeans(n_clusters=9, n_init=10, random_state=123)
KMeans(n_clusters=10, n_init=10, random_state=123)</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb170"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb170-1"><a href="#cb170-1"></a><span class="co"># 肘部法则图</span></span>
<span id="cb170-2"><a href="#cb170-2"></a>fig, (ax1, ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">4</span>))</span>
<span id="cb170-3"><a href="#cb170-3"></a></span>
<span id="cb170-4"><a href="#cb170-4"></a>ax1.plot(k_range, wcss, <span class="st">'bo-'</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[&lt;matplotlib.lines.Line2D object at 0x0000016771122490&gt;]</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb172"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb172-1"><a href="#cb172-1"></a>ax1.set_xlabel(<span class="st">'聚类数'</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Text(0.5, 0, '聚类数')</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb174"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb174-1"><a href="#cb174-1"></a>ax1.set_ylabel(<span class="st">'WCSS'</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Text(0, 0.5, 'WCSS')</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb176"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb176-1"><a href="#cb176-1"></a>ax1.set_title(<span class="st">'肘部法则'</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Text(0.5, 1.0, '肘部法则')</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb178"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb178-1"><a href="#cb178-1"></a>ax2.plot(k_range, silhouette_scores, <span class="st">'ro-'</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>[&lt;matplotlib.lines.Line2D object at 0x00000167711225D0&gt;]</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb180"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb180-1"><a href="#cb180-1"></a>ax2.set_xlabel(<span class="st">'聚类数'</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Text(0.5, 0, '聚类数')</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb182"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb182-1"><a href="#cb182-1"></a>ax2.set_ylabel(<span class="st">'轮廓系数'</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Text(0, 0.5, '轮廓系数')</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb184"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb184-1"><a href="#cb184-1"></a>ax2.set_title(<span class="st">'轮廓系数'</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Text(0.5, 1.0, '轮廓系数')</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb186"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb186-1"><a href="#cb186-1"></a>plt.tight_layout()</span>
<span id="cb186-2"><a href="#cb186-2"></a>plt.show()</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="14-案例综合分析_files/figure-html/python-clustering-5.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb187"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb187-1"><a href="#cb187-1"></a><span class="co"># 执行K-means聚类</span></span>
<span id="cb187-2"><a href="#cb187-2"></a>kmeans_final <span class="op">=</span> KMeans(n_clusters<span class="op">=</span><span class="dv">4</span>, random_state<span class="op">=</span><span class="dv">123</span>, n_init<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb187-3"><a href="#cb187-3"></a>python_user_data[<span class="st">'cluster'</span>] <span class="op">=</span> kmeans_final.fit_predict(X_cluster_scaled)</span>
<span id="cb187-4"><a href="#cb187-4"></a></span>
<span id="cb187-5"><a href="#cb187-5"></a><span class="co"># 聚类分析</span></span>
<span id="cb187-6"><a href="#cb187-6"></a>cluster_analysis <span class="op">=</span> python_user_data.groupby(<span class="st">'cluster'</span>).agg({</span>
<span id="cb187-7"><a href="#cb187-7"></a>    <span class="st">'age'</span>: <span class="st">'mean'</span>,</span>
<span id="cb187-8"><a href="#cb187-8"></a>    <span class="st">'income'</span>: <span class="st">'mean'</span>,</span>
<span id="cb187-9"><a href="#cb187-9"></a>    <span class="st">'page_views'</span>: <span class="st">'mean'</span>,</span>
<span id="cb187-10"><a href="#cb187-10"></a>    <span class="st">'time_on_site'</span>: <span class="st">'mean'</span>,</span>
<span id="cb187-11"><a href="#cb187-11"></a>    <span class="st">'cart_additions'</span>: <span class="st">'mean'</span>,</span>
<span id="cb187-12"><a href="#cb187-12"></a>    <span class="st">'made_purchase'</span>: <span class="st">'mean'</span>,</span>
<span id="cb187-13"><a href="#cb187-13"></a>    <span class="st">'purchase_amount'</span>: <span class="st">'mean'</span>,</span>
<span id="cb187-14"><a href="#cb187-14"></a>    <span class="st">'user_id'</span>: <span class="st">'count'</span></span>
<span id="cb187-15"><a href="#cb187-15"></a>}).rename(columns<span class="op">=</span>{<span class="st">'user_id'</span>: <span class="st">'count'</span>})</span>
<span id="cb187-16"><a href="#cb187-16"></a></span>
<span id="cb187-17"><a href="#cb187-17"></a><span class="bu">print</span>(<span class="st">"聚类分析结果:"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>聚类分析结果:</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb189"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb189-1"><a href="#cb189-1"></a><span class="bu">print</span>(cluster_analysis.<span class="bu">round</span>(<span class="dv">2</span>))</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>           age    income  page_views  ...  made_purchase  purchase_amount  count
cluster                               ...                                       
0        27.81  53227.80       26.55  ...           0.12            93.78    266
1        41.83  37788.28       21.12  ...           0.06            84.25    242
2        55.03  55961.32       25.49  ...           0.11            95.40    266
3        44.12  54015.27       27.58  ...           0.11            96.53    226

[4 rows x 8 columns]</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb191"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb191-1"><a href="#cb191-1"></a><span class="co"># 聚类可视化</span></span>
<span id="cb191-2"><a href="#cb191-2"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">10</span>))</span>
<span id="cb191-3"><a href="#cb191-3"></a>features_to_plot <span class="op">=</span> [<span class="st">'age'</span>, <span class="st">'income'</span>, <span class="st">'page_views'</span>, <span class="st">'time_on_site'</span>, <span class="st">'cart_additions'</span>, <span class="st">'purchase_amount'</span>]</span>
<span id="cb191-4"><a href="#cb191-4"></a></span>
<span id="cb191-5"><a href="#cb191-5"></a><span class="cf">for</span> i, feature <span class="kw">in</span> <span class="bu">enumerate</span>(features_to_plot):</span>
<span id="cb191-6"><a href="#cb191-6"></a>    row, col <span class="op">=</span> i <span class="op">//</span> <span class="dv">3</span>, i <span class="op">%</span> <span class="dv">3</span></span>
<span id="cb191-7"><a href="#cb191-7"></a>    python_user_data.boxplot(column<span class="op">=</span>feature, by<span class="op">=</span><span class="st">'cluster'</span>, ax<span class="op">=</span>axes[row, col])</span>
<span id="cb191-8"><a href="#cb191-8"></a>    axes[row, col].set_title(<span class="ss">f'</span><span class="sc">{</span>feature<span class="sc">}</span><span class="ss"> by Cluster'</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>&lt;Axes: title={'center': 'age'}, xlabel='cluster'&gt;
Text(0.5, 1.0, 'age by Cluster')
&lt;Axes: title={'center': 'income'}, xlabel='cluster'&gt;
Text(0.5, 1.0, 'income by Cluster')
&lt;Axes: title={'center': 'page_views'}, xlabel='cluster'&gt;
Text(0.5, 1.0, 'page_views by Cluster')
&lt;Axes: title={'center': 'time_on_site'}, xlabel='cluster'&gt;
Text(0.5, 1.0, 'time_on_site by Cluster')
&lt;Axes: title={'center': 'cart_additions'}, xlabel='cluster'&gt;
Text(0.5, 1.0, 'cart_additions by Cluster')
&lt;Axes: title={'center': 'purchase_amount'}, xlabel='cluster'&gt;
Text(0.5, 1.0, 'purchase_amount by Cluster')</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb193"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb193-1"><a href="#cb193-1"></a>plt.suptitle(<span class="st">'各聚类群体特征分布'</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Text(0.5, 0.98, '各聚类群体特征分布')</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb195"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb195-1"><a href="#cb195-1"></a>plt.tight_layout()</span>
<span id="cb195-2"><a href="#cb195-2"></a>plt.show()</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="14-案例综合分析_files/figure-html/python-clustering-6.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
</section><section id="python关联分析" class="level2" data-number="15.5"><h2 data-number="15.5" class="anchored" data-anchor-id="python关联分析">
<span class="header-section-number">15.5</span> 5. Python关联分析</h2>
<div class="cell">
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb196"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb196-1"><a href="#cb196-1"></a><span class="im">from</span> mlxtend.frequent_patterns <span class="im">import</span> apriori, association_rules</span>
<span id="cb196-2"><a href="#cb196-2"></a></span>
<span id="cb196-3"><a href="#cb196-3"></a><span class="co"># 准备关联分析数据</span></span>
<span id="cb196-4"><a href="#cb196-4"></a>association_data <span class="op">=</span> python_user_data[[<span class="ss">f'bought_</span><span class="sc">{</span>product<span class="sc">}</span><span class="ss">'</span> <span class="cf">for</span> product <span class="kw">in</span> products]]</span>
<span id="cb196-5"><a href="#cb196-5"></a></span>
<span id="cb196-6"><a href="#cb196-6"></a><span class="co"># 查看数据概览</span></span>
<span id="cb196-7"><a href="#cb196-7"></a><span class="bu">print</span>(<span class="st">"关联分析数据概览:"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>关联分析数据概览:</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb198"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb198-1"><a href="#cb198-1"></a><span class="bu">print</span>(association_data.head())</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>   bought_electronics  bought_clothing  ...  bought_home  bought_sports
0                   1                1  ...            0              1
1                   1                1  ...            1              1
2                   0                1  ...            1              1
3                   1                0  ...            1              0
4                   1                1  ...            1              1

[5 rows x 5 columns]</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb200"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb200-1"><a href="#cb200-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">各产品购买率:"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>
各产品购买率:</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb202"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb202-1"><a href="#cb202-1"></a><span class="bu">print</span>(association_data.mean())</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>bought_electronics    0.411
bought_clothing       0.522
bought_books          0.553
bought_home           0.554
bought_sports         0.565
dtype: float64</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb204"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb204-1"><a href="#cb204-1"></a><span class="co"># 挖掘频繁项集 - 使用更宽松的参数</span></span>
<span id="cb204-2"><a href="#cb204-2"></a>frequent_itemsets <span class="op">=</span> apriori(association_data, </span>
<span id="cb204-3"><a href="#cb204-3"></a>                           min_support<span class="op">=</span><span class="fl">0.05</span>,  <span class="co"># 降低支持度</span></span>
<span id="cb204-4"><a href="#cb204-4"></a>                           use_colnames<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb204-5"><a href="#cb204-5"></a>                           max_len<span class="op">=</span><span class="dv">4</span>)         <span class="co"># 限制最大项集大小</span></span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>C:\Data\Anaconda\Lib\site-packages\mlxtend\frequent_patterns\fpcommon.py:161: DeprecationWarning: DataFrames with non-bool types result in worse computationalperformance and their support might be discontinued in the future.Please use a DataFrame with bool type
  warnings.warn(</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb206"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb206-1"><a href="#cb206-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">找到的频繁项集数量: </span><span class="sc">{</span><span class="bu">len</span>(frequent_itemsets)<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>
找到的频繁项集数量: 30</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb208"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb208-1"><a href="#cb208-1"></a><span class="cf">if</span> <span class="bu">len</span>(frequent_itemsets) <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb208-2"><a href="#cb208-2"></a>    <span class="co"># 生成关联规则</span></span>
<span id="cb208-3"><a href="#cb208-3"></a>    rules_python <span class="op">=</span> association_rules(frequent_itemsets, </span>
<span id="cb208-4"><a href="#cb208-4"></a>                                   metric<span class="op">=</span><span class="st">"confidence"</span>, </span>
<span id="cb208-5"><a href="#cb208-5"></a>                                   min_threshold<span class="op">=</span><span class="fl">0.3</span>)  <span class="co"># 降低置信度</span></span>
<span id="cb208-6"><a href="#cb208-6"></a>    </span>
<span id="cb208-7"><a href="#cb208-7"></a>    <span class="bu">print</span>(<span class="ss">f"生成的关联规则数量: </span><span class="sc">{</span><span class="bu">len</span>(rules_python)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb208-8"><a href="#cb208-8"></a>    </span>
<span id="cb208-9"><a href="#cb208-9"></a>    <span class="cf">if</span> <span class="bu">len</span>(rules_python) <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb208-10"><a href="#cb208-10"></a>        <span class="co"># 显示前10条规则</span></span>
<span id="cb208-11"><a href="#cb208-11"></a>        rules_display <span class="op">=</span> rules_python.sort_values(<span class="st">'lift'</span>, ascending<span class="op">=</span><span class="va">False</span>).head(<span class="dv">10</span>)</span>
<span id="cb208-12"><a href="#cb208-12"></a>        <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">前10条关联规则 (按提升度排序):"</span>)</span>
<span id="cb208-13"><a href="#cb208-13"></a>        <span class="cf">for</span> idx, rule <span class="kw">in</span> rules_display.iterrows():</span>
<span id="cb208-14"><a href="#cb208-14"></a>            antecedents <span class="op">=</span> <span class="bu">list</span>(rule[<span class="st">'antecedents'</span>])</span>
<span id="cb208-15"><a href="#cb208-15"></a>            consequents <span class="op">=</span> <span class="bu">list</span>(rule[<span class="st">'consequents'</span>])</span>
<span id="cb208-16"><a href="#cb208-16"></a>            <span class="bu">print</span>(<span class="ss">f"规则: </span><span class="sc">{</span>antecedents<span class="sc">}</span><span class="ss"> -&gt; </span><span class="sc">{</span>consequents<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb208-17"><a href="#cb208-17"></a>            <span class="bu">print</span>(<span class="ss">f"  支持度: </span><span class="sc">{</span>rule[<span class="st">'support'</span>]<span class="sc">:.3f}</span><span class="ss">, 置信度: </span><span class="sc">{</span>rule[<span class="st">'confidence'</span>]<span class="sc">:.3f}</span><span class="ss">, 提升度: </span><span class="sc">{</span>rule[<span class="st">'lift'</span>]<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb208-18"><a href="#cb208-18"></a>            <span class="bu">print</span>()</span>
<span id="cb208-19"><a href="#cb208-19"></a>    <span class="cf">else</span>:</span>
<span id="cb208-20"><a href="#cb208-20"></a>        <span class="bu">print</span>(<span class="st">"没有生成关联规则，请进一步降低阈值"</span>)</span>
<span id="cb208-21"><a href="#cb208-21"></a><span class="cf">else</span>:</span>
<span id="cb208-22"><a href="#cb208-22"></a>    <span class="bu">print</span>(<span class="st">"没有找到频繁项集，请降低支持度阈值"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>生成的关联规则数量: 137

前10条关联规则 (按提升度排序):
规则: ['bought_clothing', 'bought_home'] -&gt; ['bought_books', 'bought_electronics']
  支持度: 0.146, 置信度: 0.465, 提升度: 1.802

规则: ['bought_books', 'bought_electronics'] -&gt; ['bought_clothing', 'bought_home']
  支持度: 0.146, 置信度: 0.566, 提升度: 1.802

规则: ['bought_clothing', 'bought_sports'] -&gt; ['bought_electronics', 'bought_home']
  支持度: 0.128, 置信度: 0.416, 提升度: 1.768

规则: ['bought_electronics', 'bought_home'] -&gt; ['bought_clothing', 'bought_sports']
  支持度: 0.128, 置信度: 0.545, 提升度: 1.768

规则: ['bought_books', 'bought_electronics'] -&gt; ['bought_clothing', 'bought_sports']
  支持度: 0.138, 置信度: 0.535, 提升度: 1.737

规则: ['bought_clothing', 'bought_sports'] -&gt; ['bought_books', 'bought_electronics']
  支持度: 0.138, 置信度: 0.448, 提升度: 1.737

规则: ['bought_electronics', 'bought_home'] -&gt; ['bought_books', 'bought_clothing']
  支持度: 0.146, 置信度: 0.621, 提升度: 1.721

规则: ['bought_books', 'bought_clothing'] -&gt; ['bought_electronics', 'bought_home']
  支持度: 0.146, 置信度: 0.404, 提升度: 1.721

规则: ['bought_electronics', 'bought_home'] -&gt; ['bought_books', 'bought_sports']
  支持度: 0.138, 置信度: 0.587, 提升度: 1.692

规则: ['bought_books', 'bought_sports'] -&gt; ['bought_electronics', 'bought_home']
  支持度: 0.138, 置信度: 0.398, 提升度: 1.692</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb210"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb210-1"><a href="#cb210-1"></a>    </span>
<span id="cb210-2"><a href="#cb210-2"></a><span class="co"># 产品共现热图</span></span>
<span id="cb210-3"><a href="#cb210-3"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>&lt;Figure size 800x600 with 0 Axes&gt;</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb212"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb212-1"><a href="#cb212-1"></a>corr_matrix <span class="op">=</span> association_data.corr()</span>
<span id="cb212-2"><a href="#cb212-2"></a>sns.heatmap(corr_matrix, annot<span class="op">=</span><span class="va">True</span>, cmap<span class="op">=</span><span class="st">'coolwarm'</span>, center<span class="op">=</span><span class="dv">0</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>&lt;Axes: &gt;</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb214"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb214-1"><a href="#cb214-1"></a>plt.title(<span class="st">'产品购买相关性热图'</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>Text(0.5, 1.0, '产品购买相关性热图')</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb216"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb216-1"><a href="#cb216-1"></a>plt.tight_layout()</span>
<span id="cb216-2"><a href="#cb216-2"></a>plt.show()</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output-display">
<div>
<figure class="figure"><p><img src="14-案例综合分析_files/figure-html/python-association-9.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
</section></section><section id="综合分析结果" class="level1" data-number="16"><h1 data-number="16">
<span class="header-section-number">16</span> 综合分析结果</h1>
<section id="方法比较" class="level2" data-number="16.1"><h2 data-number="16.1" class="anchored" data-anchor-id="方法比较">
<span class="header-section-number">16.1</span> 方法比较</h2>
<div class="cell">
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb217"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb217-1"><a href="#cb217-1"></a><span class="co"># R和Python结果比较</span></span>
<span id="cb217-2"><a href="#cb217-2"></a><span class="fu">cat</span>(<span class="st">"## 分析方法总结</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>## 分析方法总结</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb219"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb219-1"><a href="#cb219-1"></a><span class="fu">cat</span>(<span class="st">"### 回归分析</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>### 回归分析</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb221"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb221-1"><a href="#cb221-1"></a><span class="fu">cat</span>(<span class="st">"- 线性回归和随机森林都能较好地预测用户消费金额</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>- 线性回归和随机森林都能较好地预测用户消费金额</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb223"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb223-1"><a href="#cb223-1"></a><span class="fu">cat</span>(<span class="st">"- 随机森林在非线性关系处理上表现更好</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>- 随机森林在非线性关系处理上表现更好</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb225"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb225-1"><a href="#cb225-1"></a><span class="fu">cat</span>(<span class="st">"### 分类分析</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>### 分类分析</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb227"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb227-1"><a href="#cb227-1"></a><span class="fu">cat</span>(<span class="st">"- 逻辑回归和随机森林都能有效预测用户购买意向</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>- 逻辑回归和随机森林都能有效预测用户购买意向</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb229"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb229-1"><a href="#cb229-1"></a><span class="fu">cat</span>(<span class="st">"- 页面浏览量和购物车添加次数是最重要的预测特征</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>- 页面浏览量和购物车添加次数是最重要的预测特征</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb231"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb231-1"><a href="#cb231-1"></a><span class="fu">cat</span>(<span class="st">"- 随机森林在AUC指标上表现略优于逻辑回归</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>- 随机森林在AUC指标上表现略优于逻辑回归</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb233"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb233-1"><a href="#cb233-1"></a><span class="fu">cat</span>(<span class="st">"### 聚类分析</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>### 聚类分析</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb235"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb235-1"><a href="#cb235-1"></a><span class="fu">cat</span>(<span class="st">"- 成功将用户分为4个有意义的群体</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>- 成功将用户分为4个有意义的群体</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb237"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb237-1"><a href="#cb237-1"></a><span class="fu">cat</span>(<span class="st">"- 不同群体在消费行为和用户特征上有明显差异</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>- 不同群体在消费行为和用户特征上有明显差异</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb239"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb239-1"><a href="#cb239-1"></a><span class="fu">cat</span>(<span class="st">"### 关联分析</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>### 关联分析</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb241"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb241-1"><a href="#cb241-1"></a><span class="fu">cat</span>(<span class="st">"- 通过调整参数成功挖掘出关联规则</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>- 通过调整参数成功挖掘出关联规则</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb243"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb243-1"><a href="#cb243-1"></a><span class="fu">cat</span>(<span class="st">"- 发现了产品间的购买模式和相关关系</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>- 发现了产品间的购买模式和相关关系</code></pre>
</div>
</div>
</section><section id="业务建议" class="level2" data-number="16.2"><h2 data-number="16.2" class="anchored" data-anchor-id="业务建议">
<span class="header-section-number">16.2</span> 业务建议</h2>
<div class="cell">
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb245"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb245-1"><a href="#cb245-1"></a><span class="fu">cat</span>(<span class="st">"## 业务洞察与建议</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>## 业务洞察与建议</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb247"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb247-1"><a href="#cb247-1"></a><span class="fu">cat</span>(<span class="st">"1. **用户分群营销**: 针对不同聚类群体制定个性化营销策略</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>1. **用户分群营销**: 针对不同聚类群体制定个性化营销策略</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb249"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb249-1"><a href="#cb249-1"></a><span class="fu">cat</span>(<span class="st">"2. **交叉销售**: 利用关联规则结果优化商品推荐系统</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>2. **交叉销售**: 利用关联规则结果优化商品推荐系统</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb251"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb251-1"><a href="#cb251-1"></a><span class="fu">cat</span>(<span class="st">"3. **用户行为预测**: 使用分类模型识别高价值潜在客户</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>3. **用户行为预测**: 使用分类模型识别高价值潜在客户</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb253"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb253-1"><a href="#cb253-1"></a><span class="fu">cat</span>(<span class="st">"4. **收入预测**: 回归模型可用于预测用户生命周期价值</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>4. **收入预测**: 回归模型可用于预测用户生命周期价值</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb255"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb255-1"><a href="#cb255-1"></a><span class="fu">cat</span>(<span class="st">"5. **产品组合优化**: 基于关联分析结果调整产品陈列和捆绑销售策略</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>5. **产品组合优化**: 基于关联分析结果调整产品陈列和捆绑销售策略</code></pre>
</div>
</div>
</section><section id="技术总结" class="level2" data-number="16.3"><h2 data-number="16.3" class="anchored" data-anchor-id="技术总结">
<span class="header-section-number">16.3</span> 技术总结</h2>
<div class="cell">
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb257"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb257-1"><a href="#cb257-1"></a><span class="fu">cat</span>(<span class="st">"## 技术实现总结</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>## 技术实现总结</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb259"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb259-1"><a href="#cb259-1"></a><span class="fu">cat</span>(<span class="st">"### 数据框操作修复要点</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>### 数据框操作修复要点</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb261"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb261-1"><a href="#cb261-1"></a><span class="fu">cat</span>(<span class="st">"- 避免对字符型变量进行数学运算</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>- 避免对字符型变量进行数学运算</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb263"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb263-1"><a href="#cb263-1"></a><span class="fu">cat</span>(<span class="st">"- 使用明确的列选择，只对数值列进行操作</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>- 使用明确的列选择，只对数值列进行操作</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb265"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb265-1"><a href="#cb265-1"></a><span class="fu">cat</span>(<span class="st">"- 使用`across(where(is.numeric), ~ round(., 4))`时确保只选择数值列</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>- 使用`across(where(is.numeric), ~ round(., 4))`时确保只选择数值列</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb267"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb267-1"><a href="#cb267-1"></a><span class="fu">cat</span>(<span class="st">"### R语言优势</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>### R语言优势</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb269"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb269-1"><a href="#cb269-1"></a><span class="fu">cat</span>(<span class="st">"- 统计建模功能强大，模型输出详细</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>- 统计建模功能强大，模型输出详细</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb271"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb271-1"><a href="#cb271-1"></a><span class="fu">cat</span>(<span class="st">"- 可视化库丰富，图形质量高</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>- 可视化库丰富，图形质量高</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb273"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb273-1"><a href="#cb273-1"></a><span class="fu">cat</span>(<span class="st">"- 数据处理管道清晰易读</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>- 数据处理管道清晰易读</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb275"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb275-1"><a href="#cb275-1"></a><span class="fu">cat</span>(<span class="st">"### Python优势</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>### Python优势</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb277"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb277-1"><a href="#cb277-1"></a><span class="fu">cat</span>(<span class="st">"- 机器学习库生态系统完善</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>- 机器学习库生态系统完善</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb279"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb279-1"><a href="#cb279-1"></a><span class="fu">cat</span>(<span class="st">"- 代码简洁，部署方便</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>- 代码简洁，部署方便</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb281"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb281-1"><a href="#cb281-1"></a><span class="fu">cat</span>(<span class="st">"- 深度学习和大数据处理能力强</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>- 深度学习和大数据处理能力强</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb283"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb283-1"><a href="#cb283-1"></a><span class="fu">cat</span>(<span class="st">"### 推荐使用场景</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>### 推荐使用场景</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb285"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb285-1"><a href="#cb285-1"></a><span class="fu">cat</span>(<span class="st">"- **学术研究、统计分析**: 推荐使用R</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>- **学术研究、统计分析**: 推荐使用R</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb287"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb287-1"><a href="#cb287-1"></a><span class="fu">cat</span>(<span class="st">"- **生产环境、大型项目**: 推荐使用Python</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>- **生产环境、大型项目**: 推荐使用Python</code></pre>
</div>
<details class="code-fold"><summary>代码</summary><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb289"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb289-1"><a href="#cb289-1"></a><span class="fu">cat</span>(<span class="st">"- **混合使用**: 根据具体任务选择最适合的工具</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</details><div class="cell-output cell-output-stdout">
<pre><code>- **混合使用**: 根据具体任务选择最适合的工具</code></pre>
</div>
</div>
</section></section><section id="附录" class="level1" data-number="17"><h1 data-number="17">
<span class="header-section-number">17</span> 附录</h1>
<section id="数据字典" class="level2" data-number="17.1"><h2 data-number="17.1" class="anchored" data-anchor-id="数据字典">
<span class="header-section-number">17.1</span> 数据字典</h2>
<table class="caption-top table">
<thead><tr class="header">
<th>变量名</th>
<th>描述</th>
<th>类型</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>user_id</td>
<td>用户ID</td>
<td>数值</td>
</tr>
<tr class="even">
<td>age</td>
<td>年龄</td>
<td>数值</td>
</tr>
<tr class="odd">
<td>gender</td>
<td>性别</td>
<td>分类</td>
</tr>
<tr class="even">
<td>income</td>
<td>收入</td>
<td>数值</td>
</tr>
<tr class="odd">
<td>region</td>
<td>地区</td>
<td>分类</td>
</tr>
<tr class="even">
<td>page_views</td>
<td>页面浏览量</td>
<td>数值</td>
</tr>
<tr class="odd">
<td>time_on_site</td>
<td>网站停留时间(秒)</td>
<td>数值</td>
</tr>
<tr class="even">
<td>cart_additions</td>
<td>购物车添加次数</td>
<td>数值</td>
</tr>
<tr class="odd">
<td>purchase_amount</td>
<td>购买金额</td>
<td>数值</td>
</tr>
<tr class="even">
<td>made_purchase</td>
<td>是否购买</td>
<td>二分类</td>
</tr>
</tbody>
</table></section><section id="依赖包列表" class="level2" data-number="17.2"><h2 data-number="17.2" class="anchored" data-anchor-id="依赖包列表">
<span class="header-section-number">17.2</span> 依赖包列表</h2>
<p><strong>R包</strong>: - <code>dplyr</code>, <code>ggplot2</code>, <code>caret</code>, <code>randomForest</code>, <code>factoextra</code>, <code>arules</code>, <code>arulesViz</code>, <code>corrplot</code>, <code>pROC</code>, <code>patchwork</code>, <code>tidyr</code></p>
<p><strong>Python包</strong>: - <code>pandas</code>, <code>numpy</code>, <code>matplotlib</code>, <code>seaborn</code>, <code>scikit-learn</code>, <code>mlxtend</code></p>


<!-- -->

</section></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "已复制");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "已复制");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="../chapters/13 分类任务.html" class="pagination-link" aria-label="分类任务">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">分类任务</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">源代码</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb291" data-shortcodes="false"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb291-1"><a href="#cb291-1"></a><span class="co">---</span></span>
<span id="cb291-2"><a href="#cb291-2"></a><span class="an">title:</span><span class="co"> "综合数据分析"</span></span>
<span id="cb291-3"><a href="#cb291-3"></a><span class="an">author:</span><span class="co"> "李世纪"</span></span>
<span id="cb291-4"><a href="#cb291-4"></a><span class="an">date:</span><span class="co"> "`r Sys.Date()`"</span></span>
<span id="cb291-5"><a href="#cb291-5"></a><span class="an">format:</span><span class="co"> </span></span>
<span id="cb291-6"><a href="#cb291-6"></a><span class="co">  html:</span></span>
<span id="cb291-7"><a href="#cb291-7"></a><span class="co">    toc: true</span></span>
<span id="cb291-8"><a href="#cb291-8"></a><span class="co">    toc-depth: 3</span></span>
<span id="cb291-9"><a href="#cb291-9"></a><span class="co">    code-fold: true</span></span>
<span id="cb291-10"><a href="#cb291-10"></a><span class="co">    code-overflow: wrap</span></span>
<span id="cb291-11"><a href="#cb291-11"></a><span class="co">    code-tools: true</span></span>
<span id="cb291-12"><a href="#cb291-12"></a><span class="co">---</span></span>
<span id="cb291-13"><a href="#cb291-13"></a></span>
<span id="cb291-14"><a href="#cb291-14"></a><span class="fu">## 案例导读</span></span>
<span id="cb291-15"><a href="#cb291-15"></a>本项目基于模拟的电商用户数据，进行全面的数据分析，包括：</span>
<span id="cb291-16"><a href="#cb291-16"></a><span class="ss">- </span>**回归分析**：预测用户消费金额</span>
<span id="cb291-17"><a href="#cb291-17"></a><span class="ss">- </span>**分类分析**：预测用户购买意向</span>
<span id="cb291-18"><a href="#cb291-18"></a><span class="ss">- </span>**聚类分析**：用户分群</span>
<span id="cb291-19"><a href="#cb291-19"></a><span class="ss">- </span>**关联分析**：商品购买关联规则</span>
<span id="cb291-20"><a href="#cb291-20"></a></span>
<span id="cb291-21"><a href="#cb291-21"></a>数据说明</span>
<span id="cb291-24"><a href="#cb291-24"></a><span class="in">```{r}</span></span>
<span id="cb291-25"><a href="#cb291-25"></a><span class="co"># 生成模拟数据</span></span>
<span id="cb291-26"><a href="#cb291-26"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb291-27"><a href="#cb291-27"></a>n <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb291-28"><a href="#cb291-28"></a></span>
<span id="cb291-29"><a href="#cb291-29"></a><span class="co"># 用户基本信息</span></span>
<span id="cb291-30"><a href="#cb291-30"></a>user_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb291-31"><a href="#cb291-31"></a>  <span class="at">user_id =</span> <span class="dv">1</span><span class="sc">:</span>n,</span>
<span id="cb291-32"><a href="#cb291-32"></a>  <span class="at">age =</span> <span class="fu">sample</span>(<span class="dv">18</span><span class="sc">:</span><span class="dv">65</span>, n, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb291-33"><a href="#cb291-33"></a>  <span class="at">gender =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"Male"</span>, <span class="st">"Female"</span>), n, <span class="at">replace =</span> <span class="cn">TRUE</span>, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.48</span>, <span class="fl">0.52</span>)),</span>
<span id="cb291-34"><a href="#cb291-34"></a>  <span class="at">income =</span> <span class="fu">round</span>(<span class="fu">rnorm</span>(n, <span class="dv">50000</span>, <span class="dv">15000</span>)),</span>
<span id="cb291-35"><a href="#cb291-35"></a>  <span class="at">region =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"North"</span>, <span class="st">"South"</span>, <span class="st">"East"</span>, <span class="st">"West"</span>), n, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb291-36"><a href="#cb291-36"></a>  <span class="at">days_since_signup =</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">365</span>, n, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb291-37"><a href="#cb291-37"></a>  <span class="at">page_views =</span> <span class="fu">rpois</span>(n, <span class="dv">25</span>),</span>
<span id="cb291-38"><a href="#cb291-38"></a>  <span class="at">time_on_site =</span> <span class="fu">round</span>(<span class="fu">rnorm</span>(n, <span class="dv">300</span>, <span class="dv">120</span>)),</span>
<span id="cb291-39"><a href="#cb291-39"></a>  <span class="at">cart_additions =</span> <span class="fu">rpois</span>(n, <span class="dv">5</span>)</span>
<span id="cb291-40"><a href="#cb291-40"></a>)</span>
<span id="cb291-41"><a href="#cb291-41"></a></span>
<span id="cb291-42"><a href="#cb291-42"></a><span class="co"># 生成购买行为数据</span></span>
<span id="cb291-43"><a href="#cb291-43"></a>user_data<span class="sc">$</span>purchase_amount <span class="ot">&lt;-</span> <span class="fu">with</span>(user_data, </span>
<span id="cb291-44"><a href="#cb291-44"></a>  <span class="dv">50</span> <span class="sc">+</span> <span class="fl">0.3</span> <span class="sc">*</span> income<span class="sc">/</span><span class="dv">1000</span> <span class="sc">+</span> <span class="fl">0.5</span> <span class="sc">*</span> page_views <span class="sc">+</span> <span class="fl">0.8</span> <span class="sc">*</span> time_on_site<span class="sc">/</span><span class="dv">60</span> <span class="sc">+</span> </span>
<span id="cb291-45"><a href="#cb291-45"></a>  <span class="dv">2</span> <span class="sc">*</span> cart_additions <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="dv">20</span>)</span>
<span id="cb291-46"><a href="#cb291-46"></a>)</span>
<span id="cb291-47"><a href="#cb291-47"></a></span>
<span id="cb291-48"><a href="#cb291-48"></a>user_data<span class="sc">$</span>made_purchase <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(user_data<span class="sc">$</span>purchase_amount <span class="sc">&gt;</span> <span class="dv">120</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb291-49"><a href="#cb291-49"></a></span>
<span id="cb291-50"><a href="#cb291-50"></a><span class="co"># 添加产品类别购买信息 - 增加相关性以产生关联规则</span></span>
<span id="cb291-51"><a href="#cb291-51"></a>products <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Electronics"</span>, <span class="st">"Clothing"</span>, <span class="st">"Books"</span>, <span class="st">"Home"</span>, <span class="st">"Sports"</span>)</span>
<span id="cb291-52"><a href="#cb291-52"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb291-53"><a href="#cb291-53"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(products)) {</span>
<span id="cb291-54"><a href="#cb291-54"></a>  product <span class="ot">&lt;-</span> products[i]</span>
<span id="cb291-55"><a href="#cb291-55"></a>  base_prob <span class="ot">&lt;-</span> <span class="fl">0.4</span></span>
<span id="cb291-56"><a href="#cb291-56"></a>  <span class="co"># 创建产品间的相关性</span></span>
<span id="cb291-57"><a href="#cb291-57"></a>  <span class="cf">if</span>(i <span class="sc">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb291-58"><a href="#cb291-58"></a>    <span class="co"># 让某些产品更可能一起购买</span></span>
<span id="cb291-59"><a href="#cb291-59"></a>    correlated_prob <span class="ot">&lt;-</span> user_data[[<span class="fu">paste0</span>(<span class="st">"bought_"</span>, <span class="fu">tolower</span>(products[i<span class="dv">-1</span>]))]] <span class="sc">*</span> <span class="fl">0.3</span> <span class="sc">+</span> base_prob</span>
<span id="cb291-60"><a href="#cb291-60"></a>    user_data[[<span class="fu">paste0</span>(<span class="st">"bought_"</span>, <span class="fu">tolower</span>(product))]] <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n, <span class="dv">1</span>, <span class="fu">pmin</span>(correlated_prob, <span class="fl">0.8</span>))</span>
<span id="cb291-61"><a href="#cb291-61"></a>  } <span class="cf">else</span> {</span>
<span id="cb291-62"><a href="#cb291-62"></a>    user_data[[<span class="fu">paste0</span>(<span class="st">"bought_"</span>, <span class="fu">tolower</span>(product))]] <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n, <span class="dv">1</span>, base_prob)</span>
<span id="cb291-63"><a href="#cb291-63"></a>  }</span>
<span id="cb291-64"><a href="#cb291-64"></a>}</span>
<span id="cb291-65"><a href="#cb291-65"></a></span>
<span id="cb291-66"><a href="#cb291-66"></a><span class="fu">head</span>(user_data)</span>
<span id="cb291-67"><a href="#cb291-67"></a><span class="in">```</span></span>
<span id="cb291-68"><a href="#cb291-68"></a></span>
<span id="cb291-69"><a href="#cb291-69"></a><span class="fu">## R语言实现</span></span>
<span id="cb291-70"><a href="#cb291-70"></a></span>
<span id="cb291-71"><a href="#cb291-71"></a><span class="fu">## 1. 数据探索与预处理</span></span>
<span id="cb291-72"><a href="#cb291-72"></a></span>
<span id="cb291-73"><a href="#cb291-73"></a><span class="fu">### 1.1 数据概览</span></span>
<span id="cb291-76"><a href="#cb291-76"></a><span class="in">```{r}</span></span>
<span id="cb291-77"><a href="#cb291-77"></a><span class="co">#| label: r-data-overview</span></span>
<span id="cb291-78"><a href="#cb291-78"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb291-79"><a href="#cb291-79"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb291-80"><a href="#cb291-80"></a><span class="fu">library</span>(corrplot)</span>
<span id="cb291-81"><a href="#cb291-81"></a></span>
<span id="cb291-82"><a href="#cb291-82"></a><span class="co"># 基本统计信息</span></span>
<span id="cb291-83"><a href="#cb291-83"></a><span class="fu">summary</span>(user_data[, <span class="fu">c</span>(<span class="st">"age"</span>, <span class="st">"income"</span>, <span class="st">"page_views"</span>, <span class="st">"time_on_site"</span>, <span class="st">"purchase_amount"</span>)])</span>
<span id="cb291-84"><a href="#cb291-84"></a></span>
<span id="cb291-85"><a href="#cb291-85"></a><span class="co"># 缺失值检查</span></span>
<span id="cb291-86"><a href="#cb291-86"></a><span class="fu">sapply</span>(user_data, <span class="cf">function</span>(x) <span class="fu">sum</span>(<span class="fu">is.na</span>(x)))</span>
<span id="cb291-87"><a href="#cb291-87"></a><span class="in">```</span></span>
<span id="cb291-88"><a href="#cb291-88"></a></span>
<span id="cb291-89"><a href="#cb291-89"></a><span class="fu">### 1.2 数据可视化</span></span>
<span id="cb291-92"><a href="#cb291-92"></a><span class="in">```{r}</span></span>
<span id="cb291-93"><a href="#cb291-93"></a><span class="co">#| label: r-data-visualization</span></span>
<span id="cb291-94"><a href="#cb291-94"></a><span class="co"># 数值变量分布</span></span>
<span id="cb291-95"><a href="#cb291-95"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(user_data, <span class="fu">aes</span>(<span class="at">x =</span> purchase_amount)) <span class="sc">+</span></span>
<span id="cb291-96"><a href="#cb291-96"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">30</span>, <span class="at">fill =</span> <span class="st">"steelblue"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb291-97"><a href="#cb291-97"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"购买金额分布"</span>)</span>
<span id="cb291-98"><a href="#cb291-98"></a></span>
<span id="cb291-99"><a href="#cb291-99"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(user_data, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(made_purchase), <span class="at">fill =</span> <span class="fu">factor</span>(made_purchase))) <span class="sc">+</span></span>
<span id="cb291-100"><a href="#cb291-100"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span></span>
<span id="cb291-101"><a href="#cb291-101"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"购买行为分布"</span>, <span class="at">x =</span> <span class="st">"是否购买"</span>)</span>
<span id="cb291-102"><a href="#cb291-102"></a></span>
<span id="cb291-103"><a href="#cb291-103"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(user_data, <span class="fu">aes</span>(<span class="at">x =</span> age, <span class="at">y =</span> purchase_amount, <span class="at">color =</span> gender)) <span class="sc">+</span></span>
<span id="cb291-104"><a href="#cb291-104"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb291-105"><a href="#cb291-105"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"年龄与购买金额关系"</span>)</span>
<span id="cb291-106"><a href="#cb291-106"></a></span>
<span id="cb291-107"><a href="#cb291-107"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb291-108"><a href="#cb291-108"></a>p1 <span class="sc">/</span> p2 <span class="sc">/</span> p3</span>
<span id="cb291-109"><a href="#cb291-109"></a><span class="in">```</span></span>
<span id="cb291-110"><a href="#cb291-110"></a></span>
<span id="cb291-111"><a href="#cb291-111"></a><span class="fu">## 2. 回归分析：预测购买金额</span></span>
<span id="cb291-112"><a href="#cb291-112"></a></span>
<span id="cb291-113"><a href="#cb291-113"></a><span class="fu">### 2.1 线性回归模型</span></span>
<span id="cb291-116"><a href="#cb291-116"></a><span class="in">```{r}</span></span>
<span id="cb291-117"><a href="#cb291-117"></a><span class="co">#| label: r-regression</span></span>
<span id="cb291-118"><a href="#cb291-118"></a><span class="fu">library</span>(caret)</span>
<span id="cb291-119"><a href="#cb291-119"></a></span>
<span id="cb291-120"><a href="#cb291-120"></a><span class="co"># 准备数据</span></span>
<span id="cb291-121"><a href="#cb291-121"></a>reg_data <span class="ot">&lt;-</span> user_data <span class="sc">%&gt;%</span> </span>
<span id="cb291-122"><a href="#cb291-122"></a>  <span class="fu">select</span>(age, income, page_views, time_on_site, cart_additions, purchase_amount) <span class="sc">%&gt;%</span></span>
<span id="cb291-123"><a href="#cb291-123"></a>  <span class="fu">na.omit</span>()</span>
<span id="cb291-124"><a href="#cb291-124"></a></span>
<span id="cb291-125"><a href="#cb291-125"></a><span class="co"># 数据分割</span></span>
<span id="cb291-126"><a href="#cb291-126"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb291-127"><a href="#cb291-127"></a>train_index <span class="ot">&lt;-</span> <span class="fu">createDataPartition</span>(reg_data<span class="sc">$</span>purchase_amount, <span class="at">p =</span> <span class="fl">0.7</span>, <span class="at">list =</span> <span class="cn">FALSE</span>)</span>
<span id="cb291-128"><a href="#cb291-128"></a>train_reg <span class="ot">&lt;-</span> reg_data[train_index, ]</span>
<span id="cb291-129"><a href="#cb291-129"></a>test_reg <span class="ot">&lt;-</span> reg_data[<span class="sc">-</span>train_index, ]</span>
<span id="cb291-130"><a href="#cb291-130"></a></span>
<span id="cb291-131"><a href="#cb291-131"></a><span class="co"># 训练线性回归模型</span></span>
<span id="cb291-132"><a href="#cb291-132"></a>lm_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(purchase_amount <span class="sc">~</span> ., <span class="at">data =</span> train_reg)</span>
<span id="cb291-133"><a href="#cb291-133"></a><span class="fu">summary</span>(lm_model)</span>
<span id="cb291-134"><a href="#cb291-134"></a></span>
<span id="cb291-135"><a href="#cb291-135"></a><span class="co"># 预测</span></span>
<span id="cb291-136"><a href="#cb291-136"></a>predictions_lm <span class="ot">&lt;-</span> <span class="fu">predict</span>(lm_model, <span class="at">newdata =</span> test_reg)</span>
<span id="cb291-137"><a href="#cb291-137"></a></span>
<span id="cb291-138"><a href="#cb291-138"></a><span class="co"># 模型评估</span></span>
<span id="cb291-139"><a href="#cb291-139"></a>reg_metrics <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb291-140"><a href="#cb291-140"></a>  <span class="at">RMSE =</span> <span class="fu">RMSE</span>(predictions_lm, test_reg<span class="sc">$</span>purchase_amount),</span>
<span id="cb291-141"><a href="#cb291-141"></a>  <span class="at">MAE =</span> <span class="fu">MAE</span>(predictions_lm, test_reg<span class="sc">$</span>purchase_amount),</span>
<span id="cb291-142"><a href="#cb291-142"></a>  <span class="at">R2 =</span> <span class="fu">R2</span>(predictions_lm, test_reg<span class="sc">$</span>purchase_amount)</span>
<span id="cb291-143"><a href="#cb291-143"></a>)</span>
<span id="cb291-144"><a href="#cb291-144"></a><span class="fu">print</span>(reg_metrics)</span>
<span id="cb291-145"><a href="#cb291-145"></a><span class="in">```</span></span>
<span id="cb291-146"><a href="#cb291-146"></a></span>
<span id="cb291-147"><a href="#cb291-147"></a><span class="fu">### 2.2 回归结果可视化</span></span>
<span id="cb291-150"><a href="#cb291-150"></a><span class="in">```{r}</span></span>
<span id="cb291-151"><a href="#cb291-151"></a><span class="co">#| label: r-regression-viz</span></span>
<span id="cb291-152"><a href="#cb291-152"></a><span class="co"># 预测 vs 实际值</span></span>
<span id="cb291-153"><a href="#cb291-153"></a>results_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb291-154"><a href="#cb291-154"></a>  <span class="at">Actual =</span> test_reg<span class="sc">$</span>purchase_amount,</span>
<span id="cb291-155"><a href="#cb291-155"></a>  <span class="at">Predicted =</span> predictions_lm</span>
<span id="cb291-156"><a href="#cb291-156"></a>)</span>
<span id="cb291-157"><a href="#cb291-157"></a></span>
<span id="cb291-158"><a href="#cb291-158"></a><span class="fu">ggplot</span>(results_df, <span class="fu">aes</span>(<span class="at">x =</span> Actual, <span class="at">y =</span> Predicted)) <span class="sc">+</span></span>
<span id="cb291-159"><a href="#cb291-159"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">color =</span> <span class="st">"steelblue"</span>) <span class="sc">+</span></span>
<span id="cb291-160"><a href="#cb291-160"></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>, <span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb291-161"><a href="#cb291-161"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"线性回归：预测值 vs 实际值"</span>,</span>
<span id="cb291-162"><a href="#cb291-162"></a>       <span class="at">subtitle =</span> <span class="fu">paste</span>(<span class="st">"R² ="</span>, <span class="fu">round</span>(reg_metrics<span class="sc">$</span>R2, <span class="dv">3</span>))) <span class="sc">+</span></span>
<span id="cb291-163"><a href="#cb291-163"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb291-164"><a href="#cb291-164"></a><span class="in">```</span></span>
<span id="cb291-165"><a href="#cb291-165"></a></span>
<span id="cb291-166"><a href="#cb291-166"></a><span class="fu">## 3. 分类分析：预测购买意向</span></span>
<span id="cb291-167"><a href="#cb291-167"></a></span>
<span id="cb291-168"><a href="#cb291-168"></a><span class="fu">### 3.1 逻辑回归分类</span></span>
<span id="cb291-171"><a href="#cb291-171"></a><span class="in">```{r}</span></span>
<span id="cb291-172"><a href="#cb291-172"></a><span class="co">#| label: r-classification</span></span>
<span id="cb291-173"><a href="#cb291-173"></a><span class="co"># 准备分类数据 - 确保因子水平一致</span></span>
<span id="cb291-174"><a href="#cb291-174"></a>class_data <span class="ot">&lt;-</span> user_data <span class="sc">%&gt;%</span> </span>
<span id="cb291-175"><a href="#cb291-175"></a>  <span class="fu">select</span>(age, income, page_views, time_on_site, cart_additions, made_purchase) <span class="sc">%&gt;%</span></span>
<span id="cb291-176"><a href="#cb291-176"></a>  <span class="fu">mutate</span>(<span class="at">made_purchase =</span> <span class="fu">factor</span>(made_purchase, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"No"</span>, <span class="st">"Yes"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb291-177"><a href="#cb291-177"></a>  <span class="fu">na.omit</span>()</span>
<span id="cb291-178"><a href="#cb291-178"></a></span>
<span id="cb291-179"><a href="#cb291-179"></a><span class="co"># 数据分割</span></span>
<span id="cb291-180"><a href="#cb291-180"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb291-181"><a href="#cb291-181"></a>train_index_class <span class="ot">&lt;-</span> <span class="fu">createDataPartition</span>(class_data<span class="sc">$</span>made_purchase, <span class="at">p =</span> <span class="fl">0.7</span>, <span class="at">list =</span> <span class="cn">FALSE</span>)</span>
<span id="cb291-182"><a href="#cb291-182"></a>train_class <span class="ot">&lt;-</span> class_data[train_index_class, ]</span>
<span id="cb291-183"><a href="#cb291-183"></a>test_class <span class="ot">&lt;-</span> class_data[<span class="sc">-</span>train_index_class, ]</span>
<span id="cb291-184"><a href="#cb291-184"></a></span>
<span id="cb291-185"><a href="#cb291-185"></a><span class="co"># 训练逻辑回归模型</span></span>
<span id="cb291-186"><a href="#cb291-186"></a>logit_model <span class="ot">&lt;-</span> <span class="fu">glm</span>(made_purchase <span class="sc">~</span> ., <span class="at">data =</span> train_class, <span class="at">family =</span> binomial)</span>
<span id="cb291-187"><a href="#cb291-187"></a><span class="fu">summary</span>(logit_model)</span>
<span id="cb291-188"><a href="#cb291-188"></a></span>
<span id="cb291-189"><a href="#cb291-189"></a><span class="co"># 预测概率</span></span>
<span id="cb291-190"><a href="#cb291-190"></a>prob_predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(logit_model, <span class="at">newdata =</span> test_class, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb291-191"><a href="#cb291-191"></a>class_predictions <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(prob_predictions <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="st">"Yes"</span>, <span class="st">"No"</span>)</span>
<span id="cb291-192"><a href="#cb291-192"></a>class_predictions <span class="ot">&lt;-</span> <span class="fu">factor</span>(class_predictions, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"No"</span>, <span class="st">"Yes"</span>))</span>
<span id="cb291-193"><a href="#cb291-193"></a></span>
<span id="cb291-194"><a href="#cb291-194"></a><span class="co"># 模型评估 - 修复因子水平问题</span></span>
<span id="cb291-195"><a href="#cb291-195"></a>conf_matrix <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(class_predictions, test_class<span class="sc">$</span>made_purchase, <span class="at">positive =</span> <span class="st">"Yes"</span>)</span>
<span id="cb291-196"><a href="#cb291-196"></a><span class="fu">print</span>(conf_matrix)</span>
<span id="cb291-197"><a href="#cb291-197"></a></span>
<span id="cb291-198"><a href="#cb291-198"></a><span class="co"># 绘制ROC曲线</span></span>
<span id="cb291-199"><a href="#cb291-199"></a><span class="fu">library</span>(pROC)</span>
<span id="cb291-200"><a href="#cb291-200"></a>roc_curve <span class="ot">&lt;-</span> <span class="fu">roc</span>(<span class="fu">as.numeric</span>(test_class<span class="sc">$</span>made_purchase) <span class="sc">-</span> <span class="dv">1</span>, prob_predictions)</span>
<span id="cb291-201"><a href="#cb291-201"></a><span class="fu">plot</span>(roc_curve, <span class="at">main =</span> <span class="st">"逻辑回归ROC曲线"</span>)</span>
<span id="cb291-202"><a href="#cb291-202"></a>auc_value <span class="ot">&lt;-</span> <span class="fu">auc</span>(roc_curve)</span>
<span id="cb291-203"><a href="#cb291-203"></a><span class="fu">legend</span>(<span class="st">"bottomright"</span>, <span class="at">legend =</span> <span class="fu">paste</span>(<span class="st">"AUC ="</span>, <span class="fu">round</span>(auc_value, <span class="dv">3</span>)))</span>
<span id="cb291-204"><a href="#cb291-204"></a><span class="in">```</span></span>
<span id="cb291-205"><a href="#cb291-205"></a></span>
<span id="cb291-206"><a href="#cb291-206"></a><span class="fu">### 3.2 随机森林分类</span></span>
<span id="cb291-209"><a href="#cb291-209"></a><span class="in">```{r}</span></span>
<span id="cb291-210"><a href="#cb291-210"></a><span class="co">#| label: r-random-forest</span></span>
<span id="cb291-211"><a href="#cb291-211"></a><span class="fu">library</span>(randomForest)</span>
<span id="cb291-212"><a href="#cb291-212"></a></span>
<span id="cb291-213"><a href="#cb291-213"></a><span class="co"># 确保训练数据和测试数据的因子水平一致</span></span>
<span id="cb291-214"><a href="#cb291-214"></a>train_class<span class="sc">$</span>made_purchase <span class="ot">&lt;-</span> <span class="fu">factor</span>(train_class<span class="sc">$</span>made_purchase, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"No"</span>, <span class="st">"Yes"</span>))</span>
<span id="cb291-215"><a href="#cb291-215"></a>test_class<span class="sc">$</span>made_purchase <span class="ot">&lt;-</span> <span class="fu">factor</span>(test_class<span class="sc">$</span>made_purchase, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"No"</span>, <span class="st">"Yes"</span>))</span>
<span id="cb291-216"><a href="#cb291-216"></a></span>
<span id="cb291-217"><a href="#cb291-217"></a><span class="co"># 训练随机森林</span></span>
<span id="cb291-218"><a href="#cb291-218"></a>rf_model <span class="ot">&lt;-</span> <span class="fu">randomForest</span>(made_purchase <span class="sc">~</span> ., <span class="at">data =</span> train_class, <span class="at">ntree =</span> <span class="dv">100</span>)</span>
<span id="cb291-219"><a href="#cb291-219"></a></span>
<span id="cb291-220"><a href="#cb291-220"></a><span class="co"># 预测</span></span>
<span id="cb291-221"><a href="#cb291-221"></a>rf_predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(rf_model, <span class="at">newdata =</span> test_class)</span>
<span id="cb291-222"><a href="#cb291-222"></a></span>
<span id="cb291-223"><a href="#cb291-223"></a><span class="co"># 评估 - 确保因子水平一致</span></span>
<span id="cb291-224"><a href="#cb291-224"></a>rf_conf_matrix <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(rf_predictions, test_class<span class="sc">$</span>made_purchase, <span class="at">positive =</span> <span class="st">"Yes"</span>)</span>
<span id="cb291-225"><a href="#cb291-225"></a><span class="fu">print</span>(rf_conf_matrix)</span>
<span id="cb291-226"><a href="#cb291-226"></a></span>
<span id="cb291-227"><a href="#cb291-227"></a><span class="co"># 变量重要性</span></span>
<span id="cb291-228"><a href="#cb291-228"></a><span class="fu">varImpPlot</span>(rf_model, <span class="at">main =</span> <span class="st">"随机森林变量重要性"</span>)</span>
<span id="cb291-229"><a href="#cb291-229"></a></span>
<span id="cb291-230"><a href="#cb291-230"></a><span class="co"># 随机森林ROC曲线</span></span>
<span id="cb291-231"><a href="#cb291-231"></a>rf_prob <span class="ot">&lt;-</span> <span class="fu">predict</span>(rf_model, <span class="at">newdata =</span> test_class, <span class="at">type =</span> <span class="st">"prob"</span>)[, <span class="st">"Yes"</span>]</span>
<span id="cb291-232"><a href="#cb291-232"></a>rf_roc <span class="ot">&lt;-</span> <span class="fu">roc</span>(<span class="fu">as.numeric</span>(test_class<span class="sc">$</span>made_purchase) <span class="sc">-</span> <span class="dv">1</span>, rf_prob)</span>
<span id="cb291-233"><a href="#cb291-233"></a><span class="fu">plot</span>(rf_roc, <span class="at">main =</span> <span class="st">"随机森林ROC曲线"</span>)</span>
<span id="cb291-234"><a href="#cb291-234"></a>rf_auc <span class="ot">&lt;-</span> <span class="fu">auc</span>(rf_roc)</span>
<span id="cb291-235"><a href="#cb291-235"></a><span class="fu">legend</span>(<span class="st">"bottomright"</span>, <span class="at">legend =</span> <span class="fu">paste</span>(<span class="st">"AUC ="</span>, <span class="fu">round</span>(rf_auc, <span class="dv">3</span>)))</span>
<span id="cb291-236"><a href="#cb291-236"></a><span class="in">```</span></span>
<span id="cb291-237"><a href="#cb291-237"></a></span>
<span id="cb291-238"><a href="#cb291-238"></a><span class="fu">### 3.3 分类模型比较 - 修复版本</span></span>
<span id="cb291-241"><a href="#cb291-241"></a><span class="in">```{r}</span></span>
<span id="cb291-242"><a href="#cb291-242"></a><span class="co">#| label: r-classification-comparison</span></span>
<span id="cb291-243"><a href="#cb291-243"></a><span class="co"># 加载必要的包</span></span>
<span id="cb291-244"><a href="#cb291-244"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb291-245"><a href="#cb291-245"></a></span>
<span id="cb291-246"><a href="#cb291-246"></a><span class="in">```</span></span>
<span id="cb291-247"><a href="#cb291-247"></a></span>
<span id="cb291-248"><a href="#cb291-248"></a><span class="fu">## 4. 聚类分析：用户分群</span></span>
<span id="cb291-249"><a href="#cb291-249"></a></span>
<span id="cb291-250"><a href="#cb291-250"></a><span class="fu">### 4.1 K-means聚类</span></span>
<span id="cb291-253"><a href="#cb291-253"></a><span class="in">```{r}</span></span>
<span id="cb291-254"><a href="#cb291-254"></a><span class="co">#| label: r-clustering</span></span>
<span id="cb291-255"><a href="#cb291-255"></a><span class="co"># 准备聚类数据</span></span>
<span id="cb291-256"><a href="#cb291-256"></a>cluster_data <span class="ot">&lt;-</span> user_data <span class="sc">%&gt;%</span></span>
<span id="cb291-257"><a href="#cb291-257"></a>  <span class="fu">select</span>(age, income, page_views, time_on_site, cart_additions) <span class="sc">%&gt;%</span></span>
<span id="cb291-258"><a href="#cb291-258"></a>  <span class="fu">scale</span>()  <span class="co"># 标准化</span></span>
<span id="cb291-259"><a href="#cb291-259"></a></span>
<span id="cb291-260"><a href="#cb291-260"></a><span class="co"># 确定最佳聚类数</span></span>
<span id="cb291-261"><a href="#cb291-261"></a>wss <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="cf">function</span>(k){<span class="fu">kmeans</span>(cluster_data, k, <span class="at">nstart =</span> <span class="dv">25</span>)<span class="sc">$</span>tot.withinss})</span>
<span id="cb291-262"><a href="#cb291-262"></a></span>
<span id="cb291-263"><a href="#cb291-263"></a><span class="fu">ggplot</span>(<span class="fu">data.frame</span>(<span class="at">k =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">wss =</span> wss), <span class="fu">aes</span>(<span class="at">x =</span> k, <span class="at">y =</span> wss)) <span class="sc">+</span></span>
<span id="cb291-264"><a href="#cb291-264"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb291-265"><a href="#cb291-265"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"肘部法则确定最佳聚类数"</span>, <span class="at">x =</span> <span class="st">"聚类数"</span>, <span class="at">y =</span> <span class="st">"组内平方和"</span>)</span>
<span id="cb291-266"><a href="#cb291-266"></a></span>
<span id="cb291-267"><a href="#cb291-267"></a><span class="co"># 执行K-means聚类</span></span>
<span id="cb291-268"><a href="#cb291-268"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb291-269"><a href="#cb291-269"></a>kmeans_result <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(cluster_data, <span class="at">centers =</span> <span class="dv">4</span>, <span class="at">nstart =</span> <span class="dv">25</span>)</span>
<span id="cb291-270"><a href="#cb291-270"></a></span>
<span id="cb291-271"><a href="#cb291-271"></a><span class="co"># 添加聚类标签</span></span>
<span id="cb291-272"><a href="#cb291-272"></a>user_data<span class="sc">$</span>cluster <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(kmeans_result<span class="sc">$</span>cluster)</span>
<span id="cb291-273"><a href="#cb291-273"></a></span>
<span id="cb291-274"><a href="#cb291-274"></a><span class="co"># 聚类结果可视化</span></span>
<span id="cb291-275"><a href="#cb291-275"></a><span class="fu">library</span>(factoextra)</span>
<span id="cb291-276"><a href="#cb291-276"></a><span class="fu">fviz_cluster</span>(kmeans_result, <span class="at">data =</span> cluster_data, </span>
<span id="cb291-277"><a href="#cb291-277"></a>             <span class="at">palette =</span> <span class="fu">c</span>(<span class="st">"#2E9FDF"</span>, <span class="st">"#00AFBB"</span>, <span class="st">"#E7B800"</span>, <span class="st">"#FC4E07"</span>),</span>
<span id="cb291-278"><a href="#cb291-278"></a>             <span class="at">geom =</span> <span class="st">"point"</span>,</span>
<span id="cb291-279"><a href="#cb291-279"></a>             <span class="at">ellipse.type =</span> <span class="st">"convex"</span>,</span>
<span id="cb291-280"><a href="#cb291-280"></a>             <span class="at">ggtheme =</span> <span class="fu">theme_bw</span>())</span>
<span id="cb291-281"><a href="#cb291-281"></a><span class="in">```</span></span>
<span id="cb291-282"><a href="#cb291-282"></a></span>
<span id="cb291-283"><a href="#cb291-283"></a><span class="fu">### 4.2 聚类分析 - 修复版本</span></span>
<span id="cb291-286"><a href="#cb291-286"></a><span class="in">```{r}</span></span>
<span id="cb291-287"><a href="#cb291-287"></a><span class="co">#| label: r-cluster-analysis</span></span>
<span id="cb291-288"><a href="#cb291-288"></a><span class="co"># 聚类特征分析</span></span>
<span id="cb291-289"><a href="#cb291-289"></a>cluster_summary <span class="ot">&lt;-</span> user_data <span class="sc">%&gt;%</span></span>
<span id="cb291-290"><a href="#cb291-290"></a>  <span class="fu">group_by</span>(cluster) <span class="sc">%&gt;%</span></span>
<span id="cb291-291"><a href="#cb291-291"></a>  <span class="fu">summarise</span>(</span>
<span id="cb291-292"><a href="#cb291-292"></a>    <span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb291-293"><a href="#cb291-293"></a>    <span class="at">avg_age =</span> <span class="fu">mean</span>(age),</span>
<span id="cb291-294"><a href="#cb291-294"></a>    <span class="at">avg_income =</span> <span class="fu">mean</span>(income),</span>
<span id="cb291-295"><a href="#cb291-295"></a>    <span class="at">avg_page_views =</span> <span class="fu">mean</span>(page_views),</span>
<span id="cb291-296"><a href="#cb291-296"></a>    <span class="at">avg_time =</span> <span class="fu">mean</span>(time_on_site),</span>
<span id="cb291-297"><a href="#cb291-297"></a>    <span class="at">purchase_rate =</span> <span class="fu">mean</span>(made_purchase),</span>
<span id="cb291-298"><a href="#cb291-298"></a>    <span class="at">avg_purchase =</span> <span class="fu">mean</span>(purchase_amount)</span>
<span id="cb291-299"><a href="#cb291-299"></a>  )</span>
<span id="cb291-300"><a href="#cb291-300"></a></span>
<span id="cb291-301"><a href="#cb291-301"></a><span class="fu">print</span>(cluster_summary)</span>
<span id="cb291-302"><a href="#cb291-302"></a></span>
<span id="cb291-303"><a href="#cb291-303"></a><span class="co"># 聚类特征可视化 - 修复版本</span></span>
<span id="cb291-304"><a href="#cb291-304"></a>cluster_features <span class="ot">&lt;-</span> user_data <span class="sc">%&gt;%</span></span>
<span id="cb291-305"><a href="#cb291-305"></a>  <span class="fu">select</span>(cluster, age, income, page_views, time_on_site, purchase_amount)</span>
<span id="cb291-306"><a href="#cb291-306"></a></span>
<span id="cb291-307"><a href="#cb291-307"></a><span class="co"># 使用tidyr::pivot_longer</span></span>
<span id="cb291-308"><a href="#cb291-308"></a>cluster_features_long <span class="ot">&lt;-</span> tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(</span>
<span id="cb291-309"><a href="#cb291-309"></a>  cluster_features,</span>
<span id="cb291-310"><a href="#cb291-310"></a>  <span class="at">cols =</span> <span class="sc">-</span>cluster,</span>
<span id="cb291-311"><a href="#cb291-311"></a>  <span class="at">names_to =</span> <span class="st">"Feature"</span>,</span>
<span id="cb291-312"><a href="#cb291-312"></a>  <span class="at">values_to =</span> <span class="st">"Value"</span></span>
<span id="cb291-313"><a href="#cb291-313"></a>)</span>
<span id="cb291-314"><a href="#cb291-314"></a></span>
<span id="cb291-315"><a href="#cb291-315"></a><span class="fu">ggplot</span>(cluster_features_long, <span class="fu">aes</span>(<span class="at">x =</span> cluster, <span class="at">y =</span> Value, <span class="at">fill =</span> cluster)) <span class="sc">+</span></span>
<span id="cb291-316"><a href="#cb291-316"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb291-317"><a href="#cb291-317"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> Feature, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb291-318"><a href="#cb291-318"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"各聚类群体特征分布"</span>) <span class="sc">+</span></span>
<span id="cb291-319"><a href="#cb291-319"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb291-320"><a href="#cb291-320"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb291-321"><a href="#cb291-321"></a><span class="in">```</span></span>
<span id="cb291-322"><a href="#cb291-322"></a></span>
<span id="cb291-323"><a href="#cb291-323"></a><span class="fu">## 5. 关联分析：商品购买关联规则</span></span>
<span id="cb291-324"><a href="#cb291-324"></a></span>
<span id="cb291-325"><a href="#cb291-325"></a><span class="fu">### 5.1 Apriori算法</span></span>
<span id="cb291-328"><a href="#cb291-328"></a><span class="in">```{r}</span></span>
<span id="cb291-329"><a href="#cb291-329"></a><span class="co">#| label: r-association</span></span>
<span id="cb291-330"><a href="#cb291-330"></a><span class="fu">library</span>(arules)</span>
<span id="cb291-331"><a href="#cb291-331"></a></span>
<span id="cb291-332"><a href="#cb291-332"></a><span class="co"># 准备关联分析数据 - 只包含产品购买列</span></span>
<span id="cb291-333"><a href="#cb291-333"></a>transaction_data <span class="ot">&lt;-</span> user_data <span class="sc">%&gt;%</span></span>
<span id="cb291-334"><a href="#cb291-334"></a>  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"bought_"</span>))</span>
<span id="cb291-335"><a href="#cb291-335"></a></span>
<span id="cb291-336"><a href="#cb291-336"></a><span class="co"># 转换为事务数据</span></span>
<span id="cb291-337"><a href="#cb291-337"></a>transactions <span class="ot">&lt;-</span> <span class="fu">as</span>(transaction_data, <span class="st">"transactions"</span>)</span>
<span id="cb291-338"><a href="#cb291-338"></a></span>
<span id="cb291-339"><a href="#cb291-339"></a><span class="co"># 查看事务数据概览</span></span>
<span id="cb291-340"><a href="#cb291-340"></a><span class="fu">summary</span>(transactions)</span>
<span id="cb291-341"><a href="#cb291-341"></a></span>
<span id="cb291-342"><a href="#cb291-342"></a><span class="co"># 查看产品频率</span></span>
<span id="cb291-343"><a href="#cb291-343"></a>itemFrequency <span class="ot">&lt;-</span> <span class="fu">itemFrequency</span>(transactions)</span>
<span id="cb291-344"><a href="#cb291-344"></a><span class="fu">print</span>(<span class="st">"产品购买频率:"</span>)</span>
<span id="cb291-345"><a href="#cb291-345"></a><span class="fu">print</span>(<span class="fu">sort</span>(itemFrequency, <span class="at">decreasing =</span> <span class="cn">TRUE</span>))</span>
<span id="cb291-346"><a href="#cb291-346"></a></span>
<span id="cb291-347"><a href="#cb291-347"></a><span class="co"># 使用更宽松的参数挖掘关联规则</span></span>
<span id="cb291-348"><a href="#cb291-348"></a>rules <span class="ot">&lt;-</span> <span class="fu">apriori</span>(transactions, </span>
<span id="cb291-349"><a href="#cb291-349"></a>                 <span class="at">parameter =</span> <span class="fu">list</span>(<span class="at">support =</span> <span class="fl">0.05</span>,  <span class="co"># 降低支持度阈值</span></span>
<span id="cb291-350"><a href="#cb291-350"></a>                                 <span class="at">confidence =</span> <span class="fl">0.3</span>,  <span class="co"># 降低置信度阈值</span></span>
<span id="cb291-351"><a href="#cb291-351"></a>                                 <span class="at">minlen =</span> <span class="dv">2</span>,        <span class="co"># 最小规则长度</span></span>
<span id="cb291-352"><a href="#cb291-352"></a>                                 <span class="at">maxlen =</span> <span class="dv">4</span>))       <span class="co"># 最大规则长度</span></span>
<span id="cb291-353"><a href="#cb291-353"></a></span>
<span id="cb291-354"><a href="#cb291-354"></a><span class="co"># 规则摘要</span></span>
<span id="cb291-355"><a href="#cb291-355"></a><span class="fu">cat</span>(<span class="st">"找到的规则数量:"</span>, <span class="fu">length</span>(rules), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb291-356"><a href="#cb291-356"></a><span class="fu">summary</span>(rules)</span>
<span id="cb291-357"><a href="#cb291-357"></a></span>
<span id="cb291-358"><a href="#cb291-358"></a><span class="co"># 查看规则</span></span>
<span id="cb291-359"><a href="#cb291-359"></a><span class="cf">if</span>(<span class="fu">length</span>(rules) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb291-360"><a href="#cb291-360"></a>  <span class="co"># 按提升度排序</span></span>
<span id="cb291-361"><a href="#cb291-361"></a>  rules_sorted <span class="ot">&lt;-</span> <span class="fu">sort</span>(rules, <span class="at">by =</span> <span class="st">"lift"</span>, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb291-362"><a href="#cb291-362"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">前10条关联规则 (按提升度排序):</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb291-363"><a href="#cb291-363"></a>  <span class="fu">inspect</span>(<span class="fu">head</span>(rules_sorted, <span class="dv">10</span>))</span>
<span id="cb291-364"><a href="#cb291-364"></a>} <span class="cf">else</span> {</span>
<span id="cb291-365"><a href="#cb291-365"></a>  <span class="fu">cat</span>(<span class="st">"没有找到关联规则，请进一步降低阈值参数</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb291-366"><a href="#cb291-366"></a>}</span>
<span id="cb291-367"><a href="#cb291-367"></a><span class="in">```</span></span>
<span id="cb291-368"><a href="#cb291-368"></a></span>
<span id="cb291-369"><a href="#cb291-369"></a><span class="fu">### 5.2 关联规则可视化</span></span>
<span id="cb291-372"><a href="#cb291-372"></a><span class="in">```{r}</span></span>
<span id="cb291-373"><a href="#cb291-373"></a><span class="co">#| label: r-association-viz</span></span>
<span id="cb291-374"><a href="#cb291-374"></a><span class="fu">library</span>(arulesViz)</span>
<span id="cb291-375"><a href="#cb291-375"></a></span>
<span id="cb291-376"><a href="#cb291-376"></a><span class="cf">if</span>(<span class="fu">length</span>(rules) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb291-377"><a href="#cb291-377"></a>  <span class="co"># 选择前20条规则进行可视化</span></span>
<span id="cb291-378"><a href="#cb291-378"></a>  rules_for_plot <span class="ot">&lt;-</span> <span class="fu">head</span>(<span class="fu">sort</span>(rules, <span class="at">by =</span> <span class="st">"lift"</span>), <span class="fu">min</span>(<span class="dv">20</span>, <span class="fu">length</span>(rules)))</span>
<span id="cb291-379"><a href="#cb291-379"></a>  </span>
<span id="cb291-380"><a href="#cb291-380"></a>  <span class="co"># 散点图</span></span>
<span id="cb291-381"><a href="#cb291-381"></a>  plot1 <span class="ot">&lt;-</span> <span class="fu">plot</span>(rules_for_plot, <span class="at">method =</span> <span class="st">"scatter"</span>, </span>
<span id="cb291-382"><a href="#cb291-382"></a>               <span class="at">main =</span> <span class="st">"关联规则散点图 (支持度 vs 置信度)"</span>)</span>
<span id="cb291-383"><a href="#cb291-383"></a>  </span>
<span id="cb291-384"><a href="#cb291-384"></a>  <span class="co"># 矩阵图</span></span>
<span id="cb291-385"><a href="#cb291-385"></a>  plot2 <span class="ot">&lt;-</span> <span class="fu">plot</span>(rules_for_plot, <span class="at">method =</span> <span class="st">"matrix"</span>, </span>
<span id="cb291-386"><a href="#cb291-386"></a>               <span class="at">main =</span> <span class="st">"关联规则矩阵图"</span>)</span>
<span id="cb291-387"><a href="#cb291-387"></a>  </span>
<span id="cb291-388"><a href="#cb291-388"></a>  <span class="co"># 分组图</span></span>
<span id="cb291-389"><a href="#cb291-389"></a>  plot3 <span class="ot">&lt;-</span> <span class="fu">plot</span>(rules_for_plot, <span class="at">method =</span> <span class="st">"grouped"</span>,</span>
<span id="cb291-390"><a href="#cb291-390"></a>               <span class="at">main =</span> <span class="st">"关联规则分组图"</span>)</span>
<span id="cb291-391"><a href="#cb291-391"></a>  </span>
<span id="cb291-392"><a href="#cb291-392"></a>  <span class="co"># 显示图形</span></span>
<span id="cb291-393"><a href="#cb291-393"></a>  plot1</span>
<span id="cb291-394"><a href="#cb291-394"></a>  plot2</span>
<span id="cb291-395"><a href="#cb291-395"></a>  plot3</span>
<span id="cb291-396"><a href="#cb291-396"></a>  </span>
<span id="cb291-397"><a href="#cb291-397"></a>} <span class="cf">else</span> {</span>
<span id="cb291-398"><a href="#cb291-398"></a>  <span class="fu">cat</span>(<span class="st">"没有足够的规则进行可视化</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb291-399"><a href="#cb291-399"></a>  </span>
<span id="cb291-400"><a href="#cb291-400"></a>  <span class="co"># 显示产品共现矩阵作为替代</span></span>
<span id="cb291-401"><a href="#cb291-401"></a>  item_matrix <span class="ot">&lt;-</span> <span class="fu">crossTable</span>(transactions)</span>
<span id="cb291-402"><a href="#cb291-402"></a>  <span class="fu">corrplot</span>(item_matrix, <span class="at">method =</span> <span class="st">"color"</span>, </span>
<span id="cb291-403"><a href="#cb291-403"></a>           <span class="at">title =</span> <span class="st">"产品共现热图"</span>,</span>
<span id="cb291-404"><a href="#cb291-404"></a>           <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">0</span>))</span>
<span id="cb291-405"><a href="#cb291-405"></a>}</span>
<span id="cb291-406"><a href="#cb291-406"></a><span class="in">```</span></span>
<span id="cb291-407"><a href="#cb291-407"></a></span>
<span id="cb291-408"><a href="#cb291-408"></a><span class="fu"># Python实现</span></span>
<span id="cb291-409"><a href="#cb291-409"></a></span>
<span id="cb291-410"><a href="#cb291-410"></a><span class="fu">## 1. 数据准备</span></span>
<span id="cb291-411"><a href="#cb291-411"></a></span>
<span id="cb291-414"><a href="#cb291-414"></a><span class="in">```{python}</span></span>
<span id="cb291-415"><a href="#cb291-415"></a><span class="co">#| label: python-setup</span></span>
<span id="cb291-416"><a href="#cb291-416"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb291-417"><a href="#cb291-417"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb291-418"><a href="#cb291-418"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb291-419"><a href="#cb291-419"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb291-420"><a href="#cb291-420"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb291-421"><a href="#cb291-421"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb291-422"><a href="#cb291-422"></a><span class="im">import</span> warnings</span>
<span id="cb291-423"><a href="#cb291-423"></a>warnings.filterwarnings(<span class="st">'ignore'</span>)</span>
<span id="cb291-424"><a href="#cb291-424"></a></span>
<span id="cb291-425"><a href="#cb291-425"></a><span class="co"># 设置中文字体</span></span>
<span id="cb291-426"><a href="#cb291-426"></a>plt.rcParams[<span class="st">'font.sans-serif'</span>] <span class="op">=</span> [<span class="st">'SimHei'</span>]</span>
<span id="cb291-427"><a href="#cb291-427"></a>plt.rcParams[<span class="st">'axes.unicode_minus'</span>] <span class="op">=</span> <span class="va">False</span></span>
<span id="cb291-428"><a href="#cb291-428"></a></span>
<span id="cb291-429"><a href="#cb291-429"></a><span class="co"># 生成相同的模拟数据</span></span>
<span id="cb291-430"><a href="#cb291-430"></a>np.random.seed(<span class="dv">123</span>)</span>
<span id="cb291-431"><a href="#cb291-431"></a>n <span class="op">=</span> <span class="dv">1000</span></span>
<span id="cb291-432"><a href="#cb291-432"></a></span>
<span id="cb291-433"><a href="#cb291-433"></a>python_user_data <span class="op">=</span> pd.DataFrame({</span>
<span id="cb291-434"><a href="#cb291-434"></a>    <span class="st">'user_id'</span>: <span class="bu">range</span>(<span class="dv">1</span>, n<span class="op">+</span><span class="dv">1</span>),</span>
<span id="cb291-435"><a href="#cb291-435"></a>    <span class="st">'age'</span>: np.random.randint(<span class="dv">18</span>, <span class="dv">66</span>, n),</span>
<span id="cb291-436"><a href="#cb291-436"></a>    <span class="st">'gender'</span>: np.random.choice([<span class="st">'Male'</span>, <span class="st">'Female'</span>], n, p<span class="op">=</span>[<span class="fl">0.48</span>, <span class="fl">0.52</span>]),</span>
<span id="cb291-437"><a href="#cb291-437"></a>    <span class="st">'income'</span>: np.random.normal(<span class="dv">50000</span>, <span class="dv">15000</span>, n).<span class="bu">round</span>(),</span>
<span id="cb291-438"><a href="#cb291-438"></a>    <span class="st">'region'</span>: np.random.choice([<span class="st">'North'</span>, <span class="st">'South'</span>, <span class="st">'East'</span>, <span class="st">'West'</span>], n),</span>
<span id="cb291-439"><a href="#cb291-439"></a>    <span class="st">'days_since_signup'</span>: np.random.randint(<span class="dv">1</span>, <span class="dv">366</span>, n),</span>
<span id="cb291-440"><a href="#cb291-440"></a>    <span class="st">'page_views'</span>: np.random.poisson(<span class="dv">25</span>, n),</span>
<span id="cb291-441"><a href="#cb291-441"></a>    <span class="st">'time_on_site'</span>: np.random.normal(<span class="dv">300</span>, <span class="dv">120</span>, n).<span class="bu">round</span>(),</span>
<span id="cb291-442"><a href="#cb291-442"></a>    <span class="st">'cart_additions'</span>: np.random.poisson(<span class="dv">5</span>, n)</span>
<span id="cb291-443"><a href="#cb291-443"></a>})</span>
<span id="cb291-444"><a href="#cb291-444"></a></span>
<span id="cb291-445"><a href="#cb291-445"></a><span class="co"># 生成购买行为</span></span>
<span id="cb291-446"><a href="#cb291-446"></a>python_user_data[<span class="st">'purchase_amount'</span>] <span class="op">=</span> (</span>
<span id="cb291-447"><a href="#cb291-447"></a>    <span class="dv">50</span> <span class="op">+</span> <span class="fl">0.3</span> <span class="op">*</span> python_user_data[<span class="st">'income'</span>]<span class="op">/</span><span class="dv">1000</span> <span class="op">+</span> </span>
<span id="cb291-448"><a href="#cb291-448"></a>    <span class="fl">0.5</span> <span class="op">*</span> python_user_data[<span class="st">'page_views'</span>] <span class="op">+</span> </span>
<span id="cb291-449"><a href="#cb291-449"></a>    <span class="fl">0.8</span> <span class="op">*</span> python_user_data[<span class="st">'time_on_site'</span>]<span class="op">/</span><span class="dv">60</span> <span class="op">+</span> </span>
<span id="cb291-450"><a href="#cb291-450"></a>    <span class="dv">2</span> <span class="op">*</span> python_user_data[<span class="st">'cart_additions'</span>] <span class="op">+</span> </span>
<span id="cb291-451"><a href="#cb291-451"></a>    np.random.normal(<span class="dv">0</span>, <span class="dv">20</span>, n)</span>
<span id="cb291-452"><a href="#cb291-452"></a>)</span>
<span id="cb291-453"><a href="#cb291-453"></a></span>
<span id="cb291-454"><a href="#cb291-454"></a>python_user_data[<span class="st">'made_purchase'</span>] <span class="op">=</span> (python_user_data[<span class="st">'purchase_amount'</span>] <span class="op">&gt;</span> <span class="dv">120</span>).astype(<span class="bu">int</span>)</span>
<span id="cb291-455"><a href="#cb291-455"></a></span>
<span id="cb291-456"><a href="#cb291-456"></a><span class="co"># 添加产品类别 - 创建相关性</span></span>
<span id="cb291-457"><a href="#cb291-457"></a>products <span class="op">=</span> [<span class="st">'electronics'</span>, <span class="st">'clothing'</span>, <span class="st">'books'</span>, <span class="st">'home'</span>, <span class="st">'sports'</span>]</span>
<span id="cb291-458"><a href="#cb291-458"></a>base_prob <span class="op">=</span> <span class="fl">0.4</span></span>
<span id="cb291-459"><a href="#cb291-459"></a></span>
<span id="cb291-460"><a href="#cb291-460"></a>python_user_data[<span class="st">'bought_electronics'</span>] <span class="op">=</span> np.random.binomial(<span class="dv">1</span>, base_prob, n)</span>
<span id="cb291-461"><a href="#cb291-461"></a></span>
<span id="cb291-462"><a href="#cb291-462"></a><span class="co"># 创建相关产品</span></span>
<span id="cb291-463"><a href="#cb291-463"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="bu">len</span>(products)):</span>
<span id="cb291-464"><a href="#cb291-464"></a>    prev_product <span class="op">=</span> <span class="ss">f'bought_</span><span class="sc">{</span>products[i<span class="op">-</span><span class="dv">1</span>]<span class="sc">}</span><span class="ss">'</span></span>
<span id="cb291-465"><a href="#cb291-465"></a>    current_product <span class="op">=</span> <span class="ss">f'bought_</span><span class="sc">{</span>products[i]<span class="sc">}</span><span class="ss">'</span></span>
<span id="cb291-466"><a href="#cb291-466"></a>    correlated_prob <span class="op">=</span> python_user_data[prev_product] <span class="op">*</span> <span class="fl">0.3</span> <span class="op">+</span> base_prob</span>
<span id="cb291-467"><a href="#cb291-467"></a>    python_user_data[current_product] <span class="op">=</span> np.random.binomial(<span class="dv">1</span>, np.minimum(correlated_prob, <span class="fl">0.8</span>), n)</span>
<span id="cb291-468"><a href="#cb291-468"></a></span>
<span id="cb291-469"><a href="#cb291-469"></a><span class="bu">print</span>(<span class="st">"Python数据概览:"</span>)</span>
<span id="cb291-470"><a href="#cb291-470"></a><span class="bu">print</span>(python_user_data.head())</span>
<span id="cb291-471"><a href="#cb291-471"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">数据形状: </span><span class="sc">{</span>python_user_data<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb291-472"><a href="#cb291-472"></a></span>
<span id="cb291-473"><a href="#cb291-473"></a><span class="co"># 产品购买频率</span></span>
<span id="cb291-474"><a href="#cb291-474"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">产品购买频率:"</span>)</span>
<span id="cb291-475"><a href="#cb291-475"></a><span class="cf">for</span> product <span class="kw">in</span> products:</span>
<span id="cb291-476"><a href="#cb291-476"></a>    col_name <span class="op">=</span> <span class="ss">f'bought_</span><span class="sc">{</span>product<span class="sc">}</span><span class="ss">'</span></span>
<span id="cb291-477"><a href="#cb291-477"></a>    freq <span class="op">=</span> python_user_data[col_name].mean()</span>
<span id="cb291-478"><a href="#cb291-478"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>product<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>freq<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb291-479"><a href="#cb291-479"></a><span class="in">```</span></span>
<span id="cb291-480"><a href="#cb291-480"></a></span>
<span id="cb291-481"><a href="#cb291-481"></a><span class="fu">## 2. Python回归分析</span></span>
<span id="cb291-482"><a href="#cb291-482"></a></span>
<span id="cb291-485"><a href="#cb291-485"></a><span class="in">```{python}</span></span>
<span id="cb291-486"><a href="#cb291-486"></a><span class="co">#| label: python-regression</span></span>
<span id="cb291-487"><a href="#cb291-487"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LinearRegression</span>
<span id="cb291-488"><a href="#cb291-488"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestRegressor</span>
<span id="cb291-489"><a href="#cb291-489"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_squared_error, r2_score, mean_absolute_error</span>
<span id="cb291-490"><a href="#cb291-490"></a></span>
<span id="cb291-491"><a href="#cb291-491"></a><span class="co"># 准备回归数据</span></span>
<span id="cb291-492"><a href="#cb291-492"></a>reg_features <span class="op">=</span> [<span class="st">'age'</span>, <span class="st">'income'</span>, <span class="st">'page_views'</span>, <span class="st">'time_on_site'</span>, <span class="st">'cart_additions'</span>]</span>
<span id="cb291-493"><a href="#cb291-493"></a>X_reg <span class="op">=</span> python_user_data[reg_features]</span>
<span id="cb291-494"><a href="#cb291-494"></a>y_reg <span class="op">=</span> python_user_data[<span class="st">'purchase_amount'</span>]</span>
<span id="cb291-495"><a href="#cb291-495"></a></span>
<span id="cb291-496"><a href="#cb291-496"></a><span class="co"># 数据分割</span></span>
<span id="cb291-497"><a href="#cb291-497"></a>X_train_reg, X_test_reg, y_train_reg, y_test_reg <span class="op">=</span> train_test_split(</span>
<span id="cb291-498"><a href="#cb291-498"></a>    X_reg, y_reg, test_size<span class="op">=</span><span class="fl">0.3</span>, random_state<span class="op">=</span><span class="dv">123</span>)</span>
<span id="cb291-499"><a href="#cb291-499"></a></span>
<span id="cb291-500"><a href="#cb291-500"></a><span class="co"># 线性回归</span></span>
<span id="cb291-501"><a href="#cb291-501"></a>lr_model <span class="op">=</span> LinearRegression()</span>
<span id="cb291-502"><a href="#cb291-502"></a>lr_model.fit(X_train_reg, y_train_reg)</span>
<span id="cb291-503"><a href="#cb291-503"></a>y_pred_lr <span class="op">=</span> lr_model.predict(X_test_reg)</span>
<span id="cb291-504"><a href="#cb291-504"></a></span>
<span id="cb291-505"><a href="#cb291-505"></a><span class="co"># 随机森林回归</span></span>
<span id="cb291-506"><a href="#cb291-506"></a>rf_reg_model <span class="op">=</span> RandomForestRegressor(n_estimators<span class="op">=</span><span class="dv">100</span>, random_state<span class="op">=</span><span class="dv">123</span>)</span>
<span id="cb291-507"><a href="#cb291-507"></a>rf_reg_model.fit(X_train_reg, y_train_reg)</span>
<span id="cb291-508"><a href="#cb291-508"></a>y_pred_rf <span class="op">=</span> rf_reg_model.predict(X_test_reg)</span>
<span id="cb291-509"><a href="#cb291-509"></a></span>
<span id="cb291-510"><a href="#cb291-510"></a><span class="co"># 模型评估</span></span>
<span id="cb291-511"><a href="#cb291-511"></a><span class="kw">def</span> evaluate_regression(y_true, y_pred, model_name):</span>
<span id="cb291-512"><a href="#cb291-512"></a>    mse <span class="op">=</span> mean_squared_error(y_true, y_pred)</span>
<span id="cb291-513"><a href="#cb291-513"></a>    mae <span class="op">=</span> mean_absolute_error(y_true, y_pred)</span>
<span id="cb291-514"><a href="#cb291-514"></a>    r2 <span class="op">=</span> r2_score(y_true, y_pred)</span>
<span id="cb291-515"><a href="#cb291-515"></a>    </span>
<span id="cb291-516"><a href="#cb291-516"></a>    results <span class="op">=</span> {</span>
<span id="cb291-517"><a href="#cb291-517"></a>        <span class="st">'Model'</span>: model_name,</span>
<span id="cb291-518"><a href="#cb291-518"></a>        <span class="st">'RMSE'</span>: np.sqrt(mse),</span>
<span id="cb291-519"><a href="#cb291-519"></a>        <span class="st">'MAE'</span>: mae,</span>
<span id="cb291-520"><a href="#cb291-520"></a>        <span class="st">'R2'</span>: r2</span>
<span id="cb291-521"><a href="#cb291-521"></a>    }</span>
<span id="cb291-522"><a href="#cb291-522"></a>    <span class="cf">return</span> results</span>
<span id="cb291-523"><a href="#cb291-523"></a></span>
<span id="cb291-524"><a href="#cb291-524"></a>lr_metrics <span class="op">=</span> evaluate_regression(y_test_reg, y_pred_lr, <span class="st">'Linear Regression'</span>)</span>
<span id="cb291-525"><a href="#cb291-525"></a>rf_metrics <span class="op">=</span> evaluate_regression(y_test_reg, y_pred_rf, <span class="st">'Random Forest'</span>)</span>
<span id="cb291-526"><a href="#cb291-526"></a></span>
<span id="cb291-527"><a href="#cb291-527"></a>regression_results <span class="op">=</span> pd.DataFrame([lr_metrics, rf_metrics])</span>
<span id="cb291-528"><a href="#cb291-528"></a><span class="bu">print</span>(<span class="st">"回归模型性能比较:"</span>)</span>
<span id="cb291-529"><a href="#cb291-529"></a><span class="bu">print</span>(regression_results)</span>
<span id="cb291-530"><a href="#cb291-530"></a></span>
<span id="cb291-531"><a href="#cb291-531"></a><span class="co"># 可视化回归结果</span></span>
<span id="cb291-532"><a href="#cb291-532"></a>fig, (ax1, ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">5</span>))</span>
<span id="cb291-533"><a href="#cb291-533"></a></span>
<span id="cb291-534"><a href="#cb291-534"></a><span class="co"># 线性回归结果</span></span>
<span id="cb291-535"><a href="#cb291-535"></a>ax1.scatter(y_test_reg, y_pred_lr, alpha<span class="op">=</span><span class="fl">0.6</span>)</span>
<span id="cb291-536"><a href="#cb291-536"></a>ax1.plot([y_test_reg.<span class="bu">min</span>(), y_test_reg.<span class="bu">max</span>()], [y_test_reg.<span class="bu">min</span>(), y_test_reg.<span class="bu">max</span>()], <span class="st">'r--'</span>, lw<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb291-537"><a href="#cb291-537"></a>ax1.set_xlabel(<span class="st">'实际值'</span>)</span>
<span id="cb291-538"><a href="#cb291-538"></a>ax1.set_ylabel(<span class="st">'预测值'</span>)</span>
<span id="cb291-539"><a href="#cb291-539"></a>ax1.set_title(<span class="ss">f'线性回归 (R² = </span><span class="sc">{</span>lr_metrics[<span class="st">"R2"</span>]<span class="sc">:.3f}</span><span class="ss">)'</span>)</span>
<span id="cb291-540"><a href="#cb291-540"></a></span>
<span id="cb291-541"><a href="#cb291-541"></a><span class="co"># 随机森林结果</span></span>
<span id="cb291-542"><a href="#cb291-542"></a>ax2.scatter(y_test_reg, y_pred_rf, alpha<span class="op">=</span><span class="fl">0.6</span>)</span>
<span id="cb291-543"><a href="#cb291-543"></a>ax2.plot([y_test_reg.<span class="bu">min</span>(), y_test_reg.<span class="bu">max</span>()], [y_test_reg.<span class="bu">min</span>(), y_test_reg.<span class="bu">max</span>()], <span class="st">'r--'</span>, lw<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb291-544"><a href="#cb291-544"></a>ax2.set_xlabel(<span class="st">'实际值'</span>)</span>
<span id="cb291-545"><a href="#cb291-545"></a>ax2.set_ylabel(<span class="st">'预测值'</span>)</span>
<span id="cb291-546"><a href="#cb291-546"></a>ax2.set_title(<span class="ss">f'随机森林回归 (R² = </span><span class="sc">{</span>rf_metrics[<span class="st">"R2"</span>]<span class="sc">:.3f}</span><span class="ss">)'</span>)</span>
<span id="cb291-547"><a href="#cb291-547"></a></span>
<span id="cb291-548"><a href="#cb291-548"></a>plt.tight_layout()</span>
<span id="cb291-549"><a href="#cb291-549"></a>plt.show()</span>
<span id="cb291-550"><a href="#cb291-550"></a><span class="in">```</span></span>
<span id="cb291-551"><a href="#cb291-551"></a></span>
<span id="cb291-552"><a href="#cb291-552"></a><span class="fu">## 3. Python分类分析</span></span>
<span id="cb291-553"><a href="#cb291-553"></a></span>
<span id="cb291-556"><a href="#cb291-556"></a><span class="in">```{python}</span></span>
<span id="cb291-557"><a href="#cb291-557"></a><span class="co">#| label: python-classification</span></span>
<span id="cb291-558"><a href="#cb291-558"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LogisticRegression</span>
<span id="cb291-559"><a href="#cb291-559"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestClassifier</span>
<span id="cb291-560"><a href="#cb291-560"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> classification_report, confusion_matrix, accuracy_score, roc_auc_score, roc_curve</span>
<span id="cb291-561"><a href="#cb291-561"></a></span>
<span id="cb291-562"><a href="#cb291-562"></a><span class="co"># 准备分类数据</span></span>
<span id="cb291-563"><a href="#cb291-563"></a>class_features <span class="op">=</span> [<span class="st">'age'</span>, <span class="st">'income'</span>, <span class="st">'page_views'</span>, <span class="st">'time_on_site'</span>, <span class="st">'cart_additions'</span>]</span>
<span id="cb291-564"><a href="#cb291-564"></a>X_class <span class="op">=</span> python_user_data[class_features]</span>
<span id="cb291-565"><a href="#cb291-565"></a>y_class <span class="op">=</span> python_user_data[<span class="st">'made_purchase'</span>]</span>
<span id="cb291-566"><a href="#cb291-566"></a></span>
<span id="cb291-567"><a href="#cb291-567"></a><span class="co"># 数据分割</span></span>
<span id="cb291-568"><a href="#cb291-568"></a>X_train_class, X_test_class, y_train_class, y_test_class <span class="op">=</span> train_test_split(</span>
<span id="cb291-569"><a href="#cb291-569"></a>    X_class, y_class, test_size<span class="op">=</span><span class="fl">0.3</span>, random_state<span class="op">=</span><span class="dv">123</span>, stratify<span class="op">=</span>y_class)</span>
<span id="cb291-570"><a href="#cb291-570"></a></span>
<span id="cb291-571"><a href="#cb291-571"></a><span class="co"># 逻辑回归</span></span>
<span id="cb291-572"><a href="#cb291-572"></a>logit_model <span class="op">=</span> LogisticRegression(random_state<span class="op">=</span><span class="dv">123</span>)</span>
<span id="cb291-573"><a href="#cb291-573"></a>logit_model.fit(X_train_class, y_train_class)</span>
<span id="cb291-574"><a href="#cb291-574"></a>y_pred_logit <span class="op">=</span> logit_model.predict(X_test_class)</span>
<span id="cb291-575"><a href="#cb291-575"></a>y_pred_logit_proba <span class="op">=</span> logit_model.predict_proba(X_test_class)[:, <span class="dv">1</span>]</span>
<span id="cb291-576"><a href="#cb291-576"></a></span>
<span id="cb291-577"><a href="#cb291-577"></a><span class="co"># 随机森林分类</span></span>
<span id="cb291-578"><a href="#cb291-578"></a>rf_class_model <span class="op">=</span> RandomForestClassifier(n_estimators<span class="op">=</span><span class="dv">100</span>, random_state<span class="op">=</span><span class="dv">123</span>)</span>
<span id="cb291-579"><a href="#cb291-579"></a>rf_class_model.fit(X_train_class, y_train_class)</span>
<span id="cb291-580"><a href="#cb291-580"></a>y_pred_rf_class <span class="op">=</span> rf_class_model.predict(X_test_class)</span>
<span id="cb291-581"><a href="#cb291-581"></a>y_pred_rf_proba <span class="op">=</span> rf_class_model.predict_proba(X_test_class)[:, <span class="dv">1</span>]</span>
<span id="cb291-582"><a href="#cb291-582"></a></span>
<span id="cb291-583"><a href="#cb291-583"></a><span class="co"># 模型评估</span></span>
<span id="cb291-584"><a href="#cb291-584"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">50</span>)</span>
<span id="cb291-585"><a href="#cb291-585"></a><span class="bu">print</span>(<span class="st">"逻辑回归性能:"</span>)</span>
<span id="cb291-586"><a href="#cb291-586"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">50</span>)</span>
<span id="cb291-587"><a href="#cb291-587"></a><span class="bu">print</span>(classification_report(y_test_class, y_pred_logit))</span>
<span id="cb291-588"><a href="#cb291-588"></a>logit_accuracy <span class="op">=</span> accuracy_score(y_test_class, y_pred_logit)</span>
<span id="cb291-589"><a href="#cb291-589"></a>logit_auc <span class="op">=</span> roc_auc_score(y_test_class, y_pred_logit_proba)</span>
<span id="cb291-590"><a href="#cb291-590"></a><span class="bu">print</span>(<span class="ss">f"准确率: </span><span class="sc">{</span>logit_accuracy<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb291-591"><a href="#cb291-591"></a><span class="bu">print</span>(<span class="ss">f"AUC: </span><span class="sc">{</span>logit_auc<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb291-592"><a href="#cb291-592"></a></span>
<span id="cb291-593"><a href="#cb291-593"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"="</span> <span class="op">*</span> <span class="dv">50</span>)</span>
<span id="cb291-594"><a href="#cb291-594"></a><span class="bu">print</span>(<span class="st">"随机森林性能:"</span>)</span>
<span id="cb291-595"><a href="#cb291-595"></a><span class="bu">print</span>(<span class="st">"="</span> <span class="op">*</span> <span class="dv">50</span>)</span>
<span id="cb291-596"><a href="#cb291-596"></a><span class="bu">print</span>(classification_report(y_test_class, y_pred_rf_class))</span>
<span id="cb291-597"><a href="#cb291-597"></a>rf_accuracy <span class="op">=</span> accuracy_score(y_test_class, y_pred_rf_class)</span>
<span id="cb291-598"><a href="#cb291-598"></a>rf_auc <span class="op">=</span> roc_auc_score(y_test_class, y_pred_rf_proba)</span>
<span id="cb291-599"><a href="#cb291-599"></a><span class="bu">print</span>(<span class="ss">f"准确率: </span><span class="sc">{</span>rf_accuracy<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb291-600"><a href="#cb291-600"></a><span class="bu">print</span>(<span class="ss">f"AUC: </span><span class="sc">{</span>rf_auc<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb291-601"><a href="#cb291-601"></a></span>
<span id="cb291-602"><a href="#cb291-602"></a><span class="co"># 特征重要性</span></span>
<span id="cb291-603"><a href="#cb291-603"></a>feature_importance <span class="op">=</span> pd.DataFrame({</span>
<span id="cb291-604"><a href="#cb291-604"></a>    <span class="st">'feature'</span>: class_features,</span>
<span id="cb291-605"><a href="#cb291-605"></a>    <span class="st">'importance'</span>: rf_class_model.feature_importances_</span>
<span id="cb291-606"><a href="#cb291-606"></a>}).sort_values(<span class="st">'importance'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb291-607"><a href="#cb291-607"></a></span>
<span id="cb291-608"><a href="#cb291-608"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">随机森林特征重要性:"</span>)</span>
<span id="cb291-609"><a href="#cb291-609"></a><span class="bu">print</span>(feature_importance)</span>
<span id="cb291-610"><a href="#cb291-610"></a></span>
<span id="cb291-611"><a href="#cb291-611"></a><span class="co"># ROC曲线比较</span></span>
<span id="cb291-612"><a href="#cb291-612"></a>fig, (ax1, ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">5</span>))</span>
<span id="cb291-613"><a href="#cb291-613"></a></span>
<span id="cb291-614"><a href="#cb291-614"></a><span class="co"># 逻辑回归ROC</span></span>
<span id="cb291-615"><a href="#cb291-615"></a>fpr_lr, tpr_lr, _ <span class="op">=</span> roc_curve(y_test_class, y_pred_logit_proba)</span>
<span id="cb291-616"><a href="#cb291-616"></a>ax1.plot(fpr_lr, tpr_lr, label<span class="op">=</span><span class="ss">f'Logistic Regression (AUC = </span><span class="sc">{</span>logit_auc<span class="sc">:.3f}</span><span class="ss">)'</span>)</span>
<span id="cb291-617"><a href="#cb291-617"></a>ax1.plot([<span class="dv">0</span>, <span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>], <span class="st">'k--'</span>)</span>
<span id="cb291-618"><a href="#cb291-618"></a>ax1.set_xlabel(<span class="st">'False Positive Rate'</span>)</span>
<span id="cb291-619"><a href="#cb291-619"></a>ax1.set_ylabel(<span class="st">'True Positive Rate'</span>)</span>
<span id="cb291-620"><a href="#cb291-620"></a>ax1.set_title(<span class="st">'逻辑回归ROC曲线'</span>)</span>
<span id="cb291-621"><a href="#cb291-621"></a>ax1.legend()</span>
<span id="cb291-622"><a href="#cb291-622"></a>ax1.grid(<span class="va">True</span>)</span>
<span id="cb291-623"><a href="#cb291-623"></a></span>
<span id="cb291-624"><a href="#cb291-624"></a><span class="co"># 随机森林ROC</span></span>
<span id="cb291-625"><a href="#cb291-625"></a>fpr_rf, tpr_rf, _ <span class="op">=</span> roc_curve(y_test_class, y_pred_rf_proba)</span>
<span id="cb291-626"><a href="#cb291-626"></a>ax2.plot(fpr_rf, tpr_rf, label<span class="op">=</span><span class="ss">f'Random Forest (AUC = </span><span class="sc">{</span>rf_auc<span class="sc">:.3f}</span><span class="ss">)'</span>)</span>
<span id="cb291-627"><a href="#cb291-627"></a>ax2.plot([<span class="dv">0</span>, <span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>], <span class="st">'k--'</span>)</span>
<span id="cb291-628"><a href="#cb291-628"></a>ax2.set_xlabel(<span class="st">'False Positive Rate'</span>)</span>
<span id="cb291-629"><a href="#cb291-629"></a>ax2.set_ylabel(<span class="st">'True Positive Rate'</span>)</span>
<span id="cb291-630"><a href="#cb291-630"></a>ax2.set_title(<span class="st">'随机森林ROC曲线'</span>)</span>
<span id="cb291-631"><a href="#cb291-631"></a>ax2.legend()</span>
<span id="cb291-632"><a href="#cb291-632"></a>ax2.grid(<span class="va">True</span>)</span>
<span id="cb291-633"><a href="#cb291-633"></a></span>
<span id="cb291-634"><a href="#cb291-634"></a>plt.tight_layout()</span>
<span id="cb291-635"><a href="#cb291-635"></a>plt.show()</span>
<span id="cb291-636"><a href="#cb291-636"></a></span>
<span id="cb291-637"><a href="#cb291-637"></a><span class="co"># 模型比较</span></span>
<span id="cb291-638"><a href="#cb291-638"></a>comparison_df <span class="op">=</span> pd.DataFrame({</span>
<span id="cb291-639"><a href="#cb291-639"></a>    <span class="st">'Model'</span>: [<span class="st">'Logistic Regression'</span>, <span class="st">'Random Forest'</span>],</span>
<span id="cb291-640"><a href="#cb291-640"></a>    <span class="st">'Accuracy'</span>: [logit_accuracy, rf_accuracy],</span>
<span id="cb291-641"><a href="#cb291-641"></a>    <span class="st">'AUC'</span>: [logit_auc, rf_auc]</span>
<span id="cb291-642"><a href="#cb291-642"></a>})</span>
<span id="cb291-643"><a href="#cb291-643"></a></span>
<span id="cb291-644"><a href="#cb291-644"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">模型性能比较:"</span>)</span>
<span id="cb291-645"><a href="#cb291-645"></a><span class="bu">print</span>(comparison_df)</span>
<span id="cb291-646"><a href="#cb291-646"></a><span class="in">```</span></span>
<span id="cb291-647"><a href="#cb291-647"></a></span>
<span id="cb291-648"><a href="#cb291-648"></a><span class="fu">## 4. Python聚类分析</span></span>
<span id="cb291-649"><a href="#cb291-649"></a></span>
<span id="cb291-652"><a href="#cb291-652"></a><span class="in">```{python}</span></span>
<span id="cb291-653"><a href="#cb291-653"></a><span class="co">#| label: python-clustering</span></span>
<span id="cb291-654"><a href="#cb291-654"></a><span class="im">from</span> sklearn.cluster <span class="im">import</span> KMeans</span>
<span id="cb291-655"><a href="#cb291-655"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb291-656"><a href="#cb291-656"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> silhouette_score</span>
<span id="cb291-657"><a href="#cb291-657"></a></span>
<span id="cb291-658"><a href="#cb291-658"></a><span class="co"># 准备聚类数据</span></span>
<span id="cb291-659"><a href="#cb291-659"></a>cluster_features <span class="op">=</span> [<span class="st">'age'</span>, <span class="st">'income'</span>, <span class="st">'page_views'</span>, <span class="st">'time_on_site'</span>, <span class="st">'cart_additions'</span>]</span>
<span id="cb291-660"><a href="#cb291-660"></a>X_cluster <span class="op">=</span> python_user_data[cluster_features]</span>
<span id="cb291-661"><a href="#cb291-661"></a></span>
<span id="cb291-662"><a href="#cb291-662"></a><span class="co"># 数据标准化</span></span>
<span id="cb291-663"><a href="#cb291-663"></a>scaler <span class="op">=</span> StandardScaler()</span>
<span id="cb291-664"><a href="#cb291-664"></a>X_cluster_scaled <span class="op">=</span> scaler.fit_transform(X_cluster)</span>
<span id="cb291-665"><a href="#cb291-665"></a></span>
<span id="cb291-666"><a href="#cb291-666"></a><span class="co"># 寻找最佳聚类数</span></span>
<span id="cb291-667"><a href="#cb291-667"></a>wcss <span class="op">=</span> []</span>
<span id="cb291-668"><a href="#cb291-668"></a>silhouette_scores <span class="op">=</span> []</span>
<span id="cb291-669"><a href="#cb291-669"></a>k_range <span class="op">=</span> <span class="bu">range</span>(<span class="dv">2</span>, <span class="dv">11</span>)</span>
<span id="cb291-670"><a href="#cb291-670"></a></span>
<span id="cb291-671"><a href="#cb291-671"></a><span class="cf">for</span> k <span class="kw">in</span> k_range:</span>
<span id="cb291-672"><a href="#cb291-672"></a>    kmeans <span class="op">=</span> KMeans(n_clusters<span class="op">=</span>k, random_state<span class="op">=</span><span class="dv">123</span>, n_init<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb291-673"><a href="#cb291-673"></a>    kmeans.fit(X_cluster_scaled)</span>
<span id="cb291-674"><a href="#cb291-674"></a>    wcss.append(kmeans.inertia_)</span>
<span id="cb291-675"><a href="#cb291-675"></a>    silhouette_scores.append(silhouette_score(X_cluster_scaled, kmeans.labels_))</span>
<span id="cb291-676"><a href="#cb291-676"></a></span>
<span id="cb291-677"><a href="#cb291-677"></a><span class="co"># 肘部法则图</span></span>
<span id="cb291-678"><a href="#cb291-678"></a>fig, (ax1, ax2) <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">4</span>))</span>
<span id="cb291-679"><a href="#cb291-679"></a></span>
<span id="cb291-680"><a href="#cb291-680"></a>ax1.plot(k_range, wcss, <span class="st">'bo-'</span>)</span>
<span id="cb291-681"><a href="#cb291-681"></a>ax1.set_xlabel(<span class="st">'聚类数'</span>)</span>
<span id="cb291-682"><a href="#cb291-682"></a>ax1.set_ylabel(<span class="st">'WCSS'</span>)</span>
<span id="cb291-683"><a href="#cb291-683"></a>ax1.set_title(<span class="st">'肘部法则'</span>)</span>
<span id="cb291-684"><a href="#cb291-684"></a></span>
<span id="cb291-685"><a href="#cb291-685"></a>ax2.plot(k_range, silhouette_scores, <span class="st">'ro-'</span>)</span>
<span id="cb291-686"><a href="#cb291-686"></a>ax2.set_xlabel(<span class="st">'聚类数'</span>)</span>
<span id="cb291-687"><a href="#cb291-687"></a>ax2.set_ylabel(<span class="st">'轮廓系数'</span>)</span>
<span id="cb291-688"><a href="#cb291-688"></a>ax2.set_title(<span class="st">'轮廓系数'</span>)</span>
<span id="cb291-689"><a href="#cb291-689"></a></span>
<span id="cb291-690"><a href="#cb291-690"></a>plt.tight_layout()</span>
<span id="cb291-691"><a href="#cb291-691"></a>plt.show()</span>
<span id="cb291-692"><a href="#cb291-692"></a></span>
<span id="cb291-693"><a href="#cb291-693"></a><span class="co"># 执行K-means聚类</span></span>
<span id="cb291-694"><a href="#cb291-694"></a>kmeans_final <span class="op">=</span> KMeans(n_clusters<span class="op">=</span><span class="dv">4</span>, random_state<span class="op">=</span><span class="dv">123</span>, n_init<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb291-695"><a href="#cb291-695"></a>python_user_data[<span class="st">'cluster'</span>] <span class="op">=</span> kmeans_final.fit_predict(X_cluster_scaled)</span>
<span id="cb291-696"><a href="#cb291-696"></a></span>
<span id="cb291-697"><a href="#cb291-697"></a><span class="co"># 聚类分析</span></span>
<span id="cb291-698"><a href="#cb291-698"></a>cluster_analysis <span class="op">=</span> python_user_data.groupby(<span class="st">'cluster'</span>).agg({</span>
<span id="cb291-699"><a href="#cb291-699"></a>    <span class="st">'age'</span>: <span class="st">'mean'</span>,</span>
<span id="cb291-700"><a href="#cb291-700"></a>    <span class="st">'income'</span>: <span class="st">'mean'</span>,</span>
<span id="cb291-701"><a href="#cb291-701"></a>    <span class="st">'page_views'</span>: <span class="st">'mean'</span>,</span>
<span id="cb291-702"><a href="#cb291-702"></a>    <span class="st">'time_on_site'</span>: <span class="st">'mean'</span>,</span>
<span id="cb291-703"><a href="#cb291-703"></a>    <span class="st">'cart_additions'</span>: <span class="st">'mean'</span>,</span>
<span id="cb291-704"><a href="#cb291-704"></a>    <span class="st">'made_purchase'</span>: <span class="st">'mean'</span>,</span>
<span id="cb291-705"><a href="#cb291-705"></a>    <span class="st">'purchase_amount'</span>: <span class="st">'mean'</span>,</span>
<span id="cb291-706"><a href="#cb291-706"></a>    <span class="st">'user_id'</span>: <span class="st">'count'</span></span>
<span id="cb291-707"><a href="#cb291-707"></a>}).rename(columns<span class="op">=</span>{<span class="st">'user_id'</span>: <span class="st">'count'</span>})</span>
<span id="cb291-708"><a href="#cb291-708"></a></span>
<span id="cb291-709"><a href="#cb291-709"></a><span class="bu">print</span>(<span class="st">"聚类分析结果:"</span>)</span>
<span id="cb291-710"><a href="#cb291-710"></a><span class="bu">print</span>(cluster_analysis.<span class="bu">round</span>(<span class="dv">2</span>))</span>
<span id="cb291-711"><a href="#cb291-711"></a></span>
<span id="cb291-712"><a href="#cb291-712"></a><span class="co"># 聚类可视化</span></span>
<span id="cb291-713"><a href="#cb291-713"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">10</span>))</span>
<span id="cb291-714"><a href="#cb291-714"></a>features_to_plot <span class="op">=</span> [<span class="st">'age'</span>, <span class="st">'income'</span>, <span class="st">'page_views'</span>, <span class="st">'time_on_site'</span>, <span class="st">'cart_additions'</span>, <span class="st">'purchase_amount'</span>]</span>
<span id="cb291-715"><a href="#cb291-715"></a></span>
<span id="cb291-716"><a href="#cb291-716"></a><span class="cf">for</span> i, feature <span class="kw">in</span> <span class="bu">enumerate</span>(features_to_plot):</span>
<span id="cb291-717"><a href="#cb291-717"></a>    row, col <span class="op">=</span> i <span class="op">//</span> <span class="dv">3</span>, i <span class="op">%</span> <span class="dv">3</span></span>
<span id="cb291-718"><a href="#cb291-718"></a>    python_user_data.boxplot(column<span class="op">=</span>feature, by<span class="op">=</span><span class="st">'cluster'</span>, ax<span class="op">=</span>axes[row, col])</span>
<span id="cb291-719"><a href="#cb291-719"></a>    axes[row, col].set_title(<span class="ss">f'</span><span class="sc">{</span>feature<span class="sc">}</span><span class="ss"> by Cluster'</span>)</span>
<span id="cb291-720"><a href="#cb291-720"></a></span>
<span id="cb291-721"><a href="#cb291-721"></a>plt.suptitle(<span class="st">'各聚类群体特征分布'</span>)</span>
<span id="cb291-722"><a href="#cb291-722"></a>plt.tight_layout()</span>
<span id="cb291-723"><a href="#cb291-723"></a>plt.show()</span>
<span id="cb291-724"><a href="#cb291-724"></a><span class="in">```</span></span>
<span id="cb291-725"><a href="#cb291-725"></a></span>
<span id="cb291-726"><a href="#cb291-726"></a><span class="fu">## 5. Python关联分析</span></span>
<span id="cb291-727"><a href="#cb291-727"></a></span>
<span id="cb291-730"><a href="#cb291-730"></a><span class="in">```{python}</span></span>
<span id="cb291-731"><a href="#cb291-731"></a><span class="co">#| label: python-association</span></span>
<span id="cb291-732"><a href="#cb291-732"></a><span class="im">from</span> mlxtend.frequent_patterns <span class="im">import</span> apriori, association_rules</span>
<span id="cb291-733"><a href="#cb291-733"></a></span>
<span id="cb291-734"><a href="#cb291-734"></a><span class="co"># 准备关联分析数据</span></span>
<span id="cb291-735"><a href="#cb291-735"></a>association_data <span class="op">=</span> python_user_data[[<span class="ss">f'bought_</span><span class="sc">{</span>product<span class="sc">}</span><span class="ss">'</span> <span class="cf">for</span> product <span class="kw">in</span> products]]</span>
<span id="cb291-736"><a href="#cb291-736"></a></span>
<span id="cb291-737"><a href="#cb291-737"></a><span class="co"># 查看数据概览</span></span>
<span id="cb291-738"><a href="#cb291-738"></a><span class="bu">print</span>(<span class="st">"关联分析数据概览:"</span>)</span>
<span id="cb291-739"><a href="#cb291-739"></a><span class="bu">print</span>(association_data.head())</span>
<span id="cb291-740"><a href="#cb291-740"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">各产品购买率:"</span>)</span>
<span id="cb291-741"><a href="#cb291-741"></a><span class="bu">print</span>(association_data.mean())</span>
<span id="cb291-742"><a href="#cb291-742"></a></span>
<span id="cb291-743"><a href="#cb291-743"></a><span class="co"># 挖掘频繁项集 - 使用更宽松的参数</span></span>
<span id="cb291-744"><a href="#cb291-744"></a>frequent_itemsets <span class="op">=</span> apriori(association_data, </span>
<span id="cb291-745"><a href="#cb291-745"></a>                           min_support<span class="op">=</span><span class="fl">0.05</span>,  <span class="co"># 降低支持度</span></span>
<span id="cb291-746"><a href="#cb291-746"></a>                           use_colnames<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb291-747"><a href="#cb291-747"></a>                           max_len<span class="op">=</span><span class="dv">4</span>)         <span class="co"># 限制最大项集大小</span></span>
<span id="cb291-748"><a href="#cb291-748"></a></span>
<span id="cb291-749"><a href="#cb291-749"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">找到的频繁项集数量: </span><span class="sc">{</span><span class="bu">len</span>(frequent_itemsets)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb291-750"><a href="#cb291-750"></a></span>
<span id="cb291-751"><a href="#cb291-751"></a><span class="cf">if</span> <span class="bu">len</span>(frequent_itemsets) <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb291-752"><a href="#cb291-752"></a>    <span class="co"># 生成关联规则</span></span>
<span id="cb291-753"><a href="#cb291-753"></a>    rules_python <span class="op">=</span> association_rules(frequent_itemsets, </span>
<span id="cb291-754"><a href="#cb291-754"></a>                                   metric<span class="op">=</span><span class="st">"confidence"</span>, </span>
<span id="cb291-755"><a href="#cb291-755"></a>                                   min_threshold<span class="op">=</span><span class="fl">0.3</span>)  <span class="co"># 降低置信度</span></span>
<span id="cb291-756"><a href="#cb291-756"></a>    </span>
<span id="cb291-757"><a href="#cb291-757"></a>    <span class="bu">print</span>(<span class="ss">f"生成的关联规则数量: </span><span class="sc">{</span><span class="bu">len</span>(rules_python)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb291-758"><a href="#cb291-758"></a>    </span>
<span id="cb291-759"><a href="#cb291-759"></a>    <span class="cf">if</span> <span class="bu">len</span>(rules_python) <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb291-760"><a href="#cb291-760"></a>        <span class="co"># 显示前10条规则</span></span>
<span id="cb291-761"><a href="#cb291-761"></a>        rules_display <span class="op">=</span> rules_python.sort_values(<span class="st">'lift'</span>, ascending<span class="op">=</span><span class="va">False</span>).head(<span class="dv">10</span>)</span>
<span id="cb291-762"><a href="#cb291-762"></a>        <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">前10条关联规则 (按提升度排序):"</span>)</span>
<span id="cb291-763"><a href="#cb291-763"></a>        <span class="cf">for</span> idx, rule <span class="kw">in</span> rules_display.iterrows():</span>
<span id="cb291-764"><a href="#cb291-764"></a>            antecedents <span class="op">=</span> <span class="bu">list</span>(rule[<span class="st">'antecedents'</span>])</span>
<span id="cb291-765"><a href="#cb291-765"></a>            consequents <span class="op">=</span> <span class="bu">list</span>(rule[<span class="st">'consequents'</span>])</span>
<span id="cb291-766"><a href="#cb291-766"></a>            <span class="bu">print</span>(<span class="ss">f"规则: </span><span class="sc">{</span>antecedents<span class="sc">}</span><span class="ss"> -&gt; </span><span class="sc">{</span>consequents<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb291-767"><a href="#cb291-767"></a>            <span class="bu">print</span>(<span class="ss">f"  支持度: </span><span class="sc">{</span>rule[<span class="st">'support'</span>]<span class="sc">:.3f}</span><span class="ss">, 置信度: </span><span class="sc">{</span>rule[<span class="st">'confidence'</span>]<span class="sc">:.3f}</span><span class="ss">, 提升度: </span><span class="sc">{</span>rule[<span class="st">'lift'</span>]<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb291-768"><a href="#cb291-768"></a>            <span class="bu">print</span>()</span>
<span id="cb291-769"><a href="#cb291-769"></a>    <span class="cf">else</span>:</span>
<span id="cb291-770"><a href="#cb291-770"></a>        <span class="bu">print</span>(<span class="st">"没有生成关联规则，请进一步降低阈值"</span>)</span>
<span id="cb291-771"><a href="#cb291-771"></a><span class="cf">else</span>:</span>
<span id="cb291-772"><a href="#cb291-772"></a>    <span class="bu">print</span>(<span class="st">"没有找到频繁项集，请降低支持度阈值"</span>)</span>
<span id="cb291-773"><a href="#cb291-773"></a>    </span>
<span id="cb291-774"><a href="#cb291-774"></a><span class="co"># 产品共现热图</span></span>
<span id="cb291-775"><a href="#cb291-775"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb291-776"><a href="#cb291-776"></a>corr_matrix <span class="op">=</span> association_data.corr()</span>
<span id="cb291-777"><a href="#cb291-777"></a>sns.heatmap(corr_matrix, annot<span class="op">=</span><span class="va">True</span>, cmap<span class="op">=</span><span class="st">'coolwarm'</span>, center<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb291-778"><a href="#cb291-778"></a>plt.title(<span class="st">'产品购买相关性热图'</span>)</span>
<span id="cb291-779"><a href="#cb291-779"></a>plt.tight_layout()</span>
<span id="cb291-780"><a href="#cb291-780"></a>plt.show()</span>
<span id="cb291-781"><a href="#cb291-781"></a><span class="in">```</span></span>
<span id="cb291-782"><a href="#cb291-782"></a></span>
<span id="cb291-783"><a href="#cb291-783"></a><span class="fu"># 综合分析结果</span></span>
<span id="cb291-784"><a href="#cb291-784"></a></span>
<span id="cb291-785"><a href="#cb291-785"></a><span class="fu">## 方法比较</span></span>
<span id="cb291-786"><a href="#cb291-786"></a></span>
<span id="cb291-789"><a href="#cb291-789"></a><span class="in">```{r}</span></span>
<span id="cb291-790"><a href="#cb291-790"></a><span class="co">#| label: comparison</span></span>
<span id="cb291-791"><a href="#cb291-791"></a><span class="co"># R和Python结果比较</span></span>
<span id="cb291-792"><a href="#cb291-792"></a><span class="fu">cat</span>(<span class="st">"## 分析方法总结</span><span class="sc">\n\n</span><span class="st">"</span>)</span>
<span id="cb291-793"><a href="#cb291-793"></a><span class="fu">cat</span>(<span class="st">"### 回归分析</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb291-794"><a href="#cb291-794"></a><span class="fu">cat</span>(<span class="st">"- 线性回归和随机森林都能较好地预测用户消费金额</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb291-795"><a href="#cb291-795"></a><span class="fu">cat</span>(<span class="st">"- 随机森林在非线性关系处理上表现更好</span><span class="sc">\n\n</span><span class="st">"</span>)</span>
<span id="cb291-796"><a href="#cb291-796"></a></span>
<span id="cb291-797"><a href="#cb291-797"></a><span class="fu">cat</span>(<span class="st">"### 分类分析</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb291-798"><a href="#cb291-798"></a><span class="fu">cat</span>(<span class="st">"- 逻辑回归和随机森林都能有效预测用户购买意向</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb291-799"><a href="#cb291-799"></a><span class="fu">cat</span>(<span class="st">"- 页面浏览量和购物车添加次数是最重要的预测特征</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb291-800"><a href="#cb291-800"></a><span class="fu">cat</span>(<span class="st">"- 随机森林在AUC指标上表现略优于逻辑回归</span><span class="sc">\n\n</span><span class="st">"</span>)</span>
<span id="cb291-801"><a href="#cb291-801"></a></span>
<span id="cb291-802"><a href="#cb291-802"></a><span class="fu">cat</span>(<span class="st">"### 聚类分析</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb291-803"><a href="#cb291-803"></a><span class="fu">cat</span>(<span class="st">"- 成功将用户分为4个有意义的群体</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb291-804"><a href="#cb291-804"></a><span class="fu">cat</span>(<span class="st">"- 不同群体在消费行为和用户特征上有明显差异</span><span class="sc">\n\n</span><span class="st">"</span>)</span>
<span id="cb291-805"><a href="#cb291-805"></a></span>
<span id="cb291-806"><a href="#cb291-806"></a><span class="fu">cat</span>(<span class="st">"### 关联分析</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb291-807"><a href="#cb291-807"></a><span class="fu">cat</span>(<span class="st">"- 通过调整参数成功挖掘出关联规则</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb291-808"><a href="#cb291-808"></a><span class="fu">cat</span>(<span class="st">"- 发现了产品间的购买模式和相关关系</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb291-809"><a href="#cb291-809"></a><span class="in">```</span></span>
<span id="cb291-810"><a href="#cb291-810"></a></span>
<span id="cb291-811"><a href="#cb291-811"></a><span class="fu">## 业务建议</span></span>
<span id="cb291-812"><a href="#cb291-812"></a></span>
<span id="cb291-815"><a href="#cb291-815"></a><span class="in">```{r}</span></span>
<span id="cb291-816"><a href="#cb291-816"></a><span class="co">#| label: business-insights</span></span>
<span id="cb291-817"><a href="#cb291-817"></a><span class="fu">cat</span>(<span class="st">"## 业务洞察与建议</span><span class="sc">\n\n</span><span class="st">"</span>)</span>
<span id="cb291-818"><a href="#cb291-818"></a><span class="fu">cat</span>(<span class="st">"1. **用户分群营销**: 针对不同聚类群体制定个性化营销策略</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb291-819"><a href="#cb291-819"></a><span class="fu">cat</span>(<span class="st">"2. **交叉销售**: 利用关联规则结果优化商品推荐系统</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb291-820"><a href="#cb291-820"></a><span class="fu">cat</span>(<span class="st">"3. **用户行为预测**: 使用分类模型识别高价值潜在客户</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb291-821"><a href="#cb291-821"></a><span class="fu">cat</span>(<span class="st">"4. **收入预测**: 回归模型可用于预测用户生命周期价值</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb291-822"><a href="#cb291-822"></a><span class="fu">cat</span>(<span class="st">"5. **产品组合优化**: 基于关联分析结果调整产品陈列和捆绑销售策略</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb291-823"><a href="#cb291-823"></a><span class="in">```</span></span>
<span id="cb291-824"><a href="#cb291-824"></a></span>
<span id="cb291-825"><a href="#cb291-825"></a><span class="fu">## 技术总结</span></span>
<span id="cb291-826"><a href="#cb291-826"></a></span>
<span id="cb291-829"><a href="#cb291-829"></a><span class="in">```{r}</span></span>
<span id="cb291-830"><a href="#cb291-830"></a><span class="co">#| label: technical-summary</span></span>
<span id="cb291-831"><a href="#cb291-831"></a><span class="fu">cat</span>(<span class="st">"## 技术实现总结</span><span class="sc">\n\n</span><span class="st">"</span>)</span>
<span id="cb291-832"><a href="#cb291-832"></a><span class="fu">cat</span>(<span class="st">"### 数据框操作修复要点</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb291-833"><a href="#cb291-833"></a><span class="fu">cat</span>(<span class="st">"- 避免对字符型变量进行数学运算</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb291-834"><a href="#cb291-834"></a><span class="fu">cat</span>(<span class="st">"- 使用明确的列选择，只对数值列进行操作</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb291-835"><a href="#cb291-835"></a><span class="fu">cat</span>(<span class="st">"- 使用`across(where(is.numeric), ~ round(., 4))`时确保只选择数值列</span><span class="sc">\n\n</span><span class="st">"</span>)</span>
<span id="cb291-836"><a href="#cb291-836"></a></span>
<span id="cb291-837"><a href="#cb291-837"></a><span class="fu">cat</span>(<span class="st">"### R语言优势</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb291-838"><a href="#cb291-838"></a><span class="fu">cat</span>(<span class="st">"- 统计建模功能强大，模型输出详细</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb291-839"><a href="#cb291-839"></a><span class="fu">cat</span>(<span class="st">"- 可视化库丰富，图形质量高</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb291-840"><a href="#cb291-840"></a><span class="fu">cat</span>(<span class="st">"- 数据处理管道清晰易读</span><span class="sc">\n\n</span><span class="st">"</span>)</span>
<span id="cb291-841"><a href="#cb291-841"></a></span>
<span id="cb291-842"><a href="#cb291-842"></a><span class="fu">cat</span>(<span class="st">"### Python优势</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb291-843"><a href="#cb291-843"></a><span class="fu">cat</span>(<span class="st">"- 机器学习库生态系统完善</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb291-844"><a href="#cb291-844"></a><span class="fu">cat</span>(<span class="st">"- 代码简洁，部署方便</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb291-845"><a href="#cb291-845"></a><span class="fu">cat</span>(<span class="st">"- 深度学习和大数据处理能力强</span><span class="sc">\n\n</span><span class="st">"</span>)</span>
<span id="cb291-846"><a href="#cb291-846"></a></span>
<span id="cb291-847"><a href="#cb291-847"></a><span class="fu">cat</span>(<span class="st">"### 推荐使用场景</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb291-848"><a href="#cb291-848"></a><span class="fu">cat</span>(<span class="st">"- **学术研究、统计分析**: 推荐使用R</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb291-849"><a href="#cb291-849"></a><span class="fu">cat</span>(<span class="st">"- **生产环境、大型项目**: 推荐使用Python</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb291-850"><a href="#cb291-850"></a><span class="fu">cat</span>(<span class="st">"- **混合使用**: 根据具体任务选择最适合的工具</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb291-851"><a href="#cb291-851"></a><span class="in">```</span></span>
<span id="cb291-852"><a href="#cb291-852"></a></span>
<span id="cb291-853"><a href="#cb291-853"></a><span class="fu"># 附录</span></span>
<span id="cb291-854"><a href="#cb291-854"></a></span>
<span id="cb291-855"><a href="#cb291-855"></a><span class="fu">## 数据字典</span></span>
<span id="cb291-856"><a href="#cb291-856"></a></span>
<span id="cb291-857"><a href="#cb291-857"></a><span class="pp">|</span> 变量名 <span class="pp">|</span> 描述 <span class="pp">|</span> 类型 <span class="pp">|</span></span>
<span id="cb291-858"><a href="#cb291-858"></a><span class="pp">|--------|------|------|</span></span>
<span id="cb291-859"><a href="#cb291-859"></a><span class="pp">|</span> user_id <span class="pp">|</span> 用户ID <span class="pp">|</span> 数值 <span class="pp">|</span></span>
<span id="cb291-860"><a href="#cb291-860"></a><span class="pp">|</span> age <span class="pp">|</span> 年龄 <span class="pp">|</span> 数值 <span class="pp">|</span></span>
<span id="cb291-861"><a href="#cb291-861"></a><span class="pp">|</span> gender <span class="pp">|</span> 性别 <span class="pp">|</span> 分类 <span class="pp">|</span></span>
<span id="cb291-862"><a href="#cb291-862"></a><span class="pp">|</span> income <span class="pp">|</span> 收入 <span class="pp">|</span> 数值 <span class="pp">|</span></span>
<span id="cb291-863"><a href="#cb291-863"></a><span class="pp">|</span> region <span class="pp">|</span> 地区 <span class="pp">|</span> 分类 <span class="pp">|</span></span>
<span id="cb291-864"><a href="#cb291-864"></a><span class="pp">|</span> page_views <span class="pp">|</span> 页面浏览量 <span class="pp">|</span> 数值 <span class="pp">|</span></span>
<span id="cb291-865"><a href="#cb291-865"></a><span class="pp">|</span> time_on_site <span class="pp">|</span> 网站停留时间(秒) <span class="pp">|</span> 数值 <span class="pp">|</span></span>
<span id="cb291-866"><a href="#cb291-866"></a><span class="pp">|</span> cart_additions <span class="pp">|</span> 购物车添加次数 <span class="pp">|</span> 数值 <span class="pp">|</span></span>
<span id="cb291-867"><a href="#cb291-867"></a><span class="pp">|</span> purchase_amount <span class="pp">|</span> 购买金额 <span class="pp">|</span> 数值 <span class="pp">|</span></span>
<span id="cb291-868"><a href="#cb291-868"></a><span class="pp">|</span> made_purchase <span class="pp">|</span> 是否购买 <span class="pp">|</span> 二分类 <span class="pp">|</span></span>
<span id="cb291-869"><a href="#cb291-869"></a></span>
<span id="cb291-870"><a href="#cb291-870"></a><span class="fu">## 依赖包列表</span></span>
<span id="cb291-871"><a href="#cb291-871"></a></span>
<span id="cb291-872"><a href="#cb291-872"></a>**R包**: </span>
<span id="cb291-873"><a href="#cb291-873"></a><span class="ss">- </span><span class="in">`dplyr`</span>, <span class="in">`ggplot2`</span>, <span class="in">`caret`</span>, <span class="in">`randomForest`</span>, <span class="in">`factoextra`</span>, <span class="in">`arules`</span>, <span class="in">`arulesViz`</span>, <span class="in">`corrplot`</span>, <span class="in">`pROC`</span>, <span class="in">`patchwork`</span>, <span class="in">`tidyr`</span></span>
<span id="cb291-874"><a href="#cb291-874"></a></span>
<span id="cb291-875"><a href="#cb291-875"></a>**Python包**: </span>
<span id="cb291-876"><a href="#cb291-876"></a><span class="ss">- </span><span class="in">`pandas`</span>, <span class="in">`numpy`</span>, <span class="in">`matplotlib`</span>, <span class="in">`seaborn`</span>, <span class="in">`scikit-learn`</span>, <span class="in">`mlxtend`</span></span>
</code></pre></div><button title="复制到剪贴板" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>