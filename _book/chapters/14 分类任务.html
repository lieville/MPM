<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh-Hans" xml:lang="zh-Hans"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>14 分类任务 – 现代预测建模：从回归到机器学习</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../chapters/15 案例综合分析.html" rel="next">
<link href="../chapters/13 回归任务与基准测试.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-70a47bd5681a7291082a5b9f83d58762.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "没有结果",
    "search-matching-documents-text": "匹配的文档",
    "search-copy-link-title": "复制搜索链接",
    "search-hide-matches-text": "隐藏其它匹配结果",
    "search-more-match-text": "更多匹配结果",
    "search-more-matches-text": "更多匹配结果",
    "search-clear-button-title": "清除",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "取消",
    "search-submit-button-title": "提交",
    "search-label": "搜索"
  }
}</script><link rel="stylesheet" href="science-textbook.css">
</head>
<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="展开或折叠侧边栏导航" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapters/part-4-introduction.html">IV 实践——综合案例分析</a></li><li class="breadcrumb-item"><a href="../chapters/14 分类任务.html"><span class="chapter-title">14 分类任务</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="展开或折叠侧边栏导航" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="搜索" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">现代预测建模：从回归到机器学习</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="搜索"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">前言</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">index.html</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">I 基础-线性回归模型</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="展开或折叠此栏">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/part-1-introduction.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">part-1-introduction.html</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/1 预测模型与评估.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">1 预测模型与评估</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/2 线性回归.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">2 线性回归</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/3 模型诊断.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">3 模型诊断</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/4 时间序列分析初步.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">4 时间序列分析初步</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">II 扩展——线性分析方法</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="展开或折叠此栏">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/part-2-introduction.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">part-2-introduction.html</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/5 降维.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">5 降维</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/6 正则化.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">6 正则化</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/7 广义线性模型.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">7 广义线性模型</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/8 线性分类模型.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">8 线性分类模型</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/9 非线性回归与样条回归.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">9 非线性回归与样条回归</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">III 进阶——超越线性的机器学习</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="展开或折叠此栏">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/part-3-introduction.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">part-3-introduction.html</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/10 决策树与集成学习.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">10 决策树与集成学习</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/11 支持向量机.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">11 支持向量机</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/12 神经网络与深度学习基础.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">12 神经网络与深度学习基础</span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">IV 实践——综合案例分析</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="展开或折叠此栏">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/part-4-introduction.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">part-4-introduction.html</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/13 回归任务与基准测试.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">13 回归任务与基准测试</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/14 分类任务.html" class="sidebar-item-text sidebar-link active"><span class="chapter-title">14 分类任务</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chapters/15 案例综合分析.html" class="sidebar-item-text sidebar-link"><span class="chapter-title">15 案例综合分析</span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">目录</h2>
   
  <ul>
<li><a href="#%E5%88%86%E7%B1%BB%E9%97%AE%E9%A2%98%E5%AF%BC%E8%AF%BB" id="toc-分类问题导读" class="nav-link active" data-scroll-target="#%E5%88%86%E7%B1%BB%E9%97%AE%E9%A2%98%E5%AF%BC%E8%AF%BB">分类问题导读</a></li>
  <li><a href="#benchmark" id="toc-benchmark" class="nav-link" data-scroll-target="#benchmark">14.1 Benchmark</a></li>
  <li><a href="#benchmark%E5%88%86%E6%9E%90%E6%80%BB%E7%BB%93" id="toc-benchmark分析总结" class="nav-link" data-scroll-target="#benchmark%E5%88%86%E6%9E%90%E6%80%BB%E7%BB%93">14.2 Benchmark分析总结</a></li>
  <li><a href="#r%E8%AF%AD%E8%A8%80%E5%A4%9A%E5%88%86%E7%B1%BB" id="toc-r语言多分类" class="nav-link" data-scroll-target="#r%E8%AF%AD%E8%A8%80%E5%A4%9A%E5%88%86%E7%B1%BB">14.4 R语言–多分类</a></li>
  <li><a href="#python%E5%A4%9A%E5%88%86%E7%B1%BB" id="toc-python多分类" class="nav-link" data-scroll-target="#python%E5%A4%9A%E5%88%86%E7%B1%BB">14.5 Python–多分类</a></li>
  <li><a href="#%E5%A4%9A%E5%88%86%E7%B1%BB%E6%A1%88%E4%BE%8B%E6%80%BB%E7%BB%93" id="toc-多分类案例总结" class="nav-link" data-scroll-target="#%E5%A4%9A%E5%88%86%E7%B1%BB%E6%A1%88%E4%BE%8B%E6%80%BB%E7%BB%93">14.6 多分类案例总结</a></li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../chapters/part-4-introduction.html">IV 实践——综合案例分析</a></li><li class="breadcrumb-item"><a href="../chapters/14 分类任务.html"><span class="chapter-title">14 分类任务</span></a></li></ol></nav><div class="quarto-title">
<h1 class="title"><span class="chapter-title">14 分类任务</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><section id="分类问题导读" class="level2"><h2 class="anchored" data-anchor-id="分类问题导读">分类问题导读</h2>
<p>分类问题是机器学习中最常见的任务之一，广泛应用于物种分类、医疗诊断、客户分类等领域。本章将通过鸢尾花分类案例，完整展示多分类问题的解决方案，涵盖数据探索、特征工程、多种分类算法比较、模型评估等关键环节。</p>
</section><section id="benchmark" class="level2"><h2 class="anchored" data-anchor-id="benchmark">14.1 Benchmark</h2>
<p>mlr3提供了强大的Benchmark功能，可以系统性地比较多个学习器在多个任务上的性能。</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">library</span>(mlr3)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="fu">library</span>(mlr3verse)</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="fu">library</span>(mlr3pipelines)</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="fu">library</span>(mlr3tuning)</span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="fu">library</span>(data.table)</span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="fu">library</span>(corrplot)</span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="fu">library</span>(paradox)</span>
<span id="cb1-11"><a href="#cb1-11"></a><span class="co"># 查看mlr包支持的学习算法</span></span>
<span id="cb1-12"><a href="#cb1-12"></a>mlr_learners</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;DictionaryLearner&gt; with 51 stored values
Keys: classif.cv_glmnet, classif.debug, classif.featureless,
  classif.glmnet, classif.kknn, classif.lda, classif.log_reg,
  classif.multinom, classif.naive_bayes, classif.nnet, classif.qda,
  classif.ranger, classif.rpart, classif.svm, classif.xgboost,
  clust.agnes, clust.ap, clust.bico, clust.birch, clust.cmeans,
  clust.cobweb, clust.dbscan, clust.dbscan_fpc, clust.diana, clust.em,
  clust.fanny, clust.featureless, clust.ff, clust.hclust,
  clust.hdbscan, clust.kkmeans, clust.kmeans, clust.MBatchKMeans,
  clust.mclust, clust.meanshift, clust.optics, clust.pam,
  clust.SimpleKMeans, clust.xmeans, regr.cv_glmnet, regr.debug,
  regr.featureless, regr.glmnet, regr.kknn, regr.km, regr.lm,
  regr.nnet, regr.ranger, regr.rpart, regr.svm, regr.xgboost</code></pre>
</div>
</div>
<p>加载数据，建立任务</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="co"># 创建多个任务（不同特征子集）</span></span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="fu">data</span>(<span class="st">"Ionosphere"</span>, <span class="at">package =</span> <span class="st">"mlbench"</span>)</span>
<span id="cb3-3"><a href="#cb3-3"></a>Ionosphere_data <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(Ionosphere)</span>
<span id="cb3-4"><a href="#cb3-4"></a>Ionosphere_data<span class="ot">=</span>Ionosphere_data[, <span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>)]</span>
<span id="cb3-5"><a href="#cb3-5"></a><span class="fu">str</span>(Ionosphere_data )</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Classes 'data.table' and 'data.frame':  351 obs. of  33 variables:
 $ V3   : num  0.995 1 1 1 1 ...
 $ V4   : num  -0.0589 -0.1883 -0.0336 -0.4516 -0.024 ...
 $ V5   : num  0.852 0.93 1 1 0.941 ...
 $ V6   : num  0.02306 -0.36156 0.00485 1 0.06531 ...
 $ V7   : num  0.834 -0.109 1 0.712 0.921 ...
 $ V8   : num  -0.377 -0.936 -0.121 -1 -0.233 ...
 $ V9   : num  1 1 0.89 0 0.772 ...
 $ V10  : num  0.0376 -0.0455 0.012 0 -0.164 ...
 $ V11  : num  0.852 0.509 0.731 0 0.528 ...
 $ V12  : num  -0.1776 -0.6774 0.0535 0 -0.2028 ...
 $ V13  : num  0.598 0.344 0.854 0 0.564 ...
 $ V14  : num  -0.44945 -0.69707 0.00827 0 -0.00712 ...
 $ V15  : num  0.605 -0.517 0.546 -1 0.344 ...
 $ V16  : num  -0.38223 -0.97515 0.00299 0.14516 -0.27457 ...
 $ V17  : num  0.844 0.055 0.838 0.541 0.529 ...
 $ V18  : num  -0.385 -0.622 -0.136 -0.393 -0.218 ...
 $ V19  : num  0.582 0.331 0.755 -1 0.451 ...
 $ V20  : num  -0.3219 -1 -0.0854 -0.5447 -0.1781 ...
 $ V21  : num  0.5697 -0.1315 0.7089 -0.6997 0.0598 ...
 $ V22  : num  -0.297 -0.453 -0.275 1 -0.356 ...
 $ V23  : num  0.3695 -0.1806 0.4339 0 0.0231 ...
 $ V24  : num  -0.474 -0.357 -0.121 0 -0.529 ...
 $ V25  : num  0.5681 -0.2033 0.5753 1 0.0329 ...
 $ V26  : num  -0.512 -0.266 -0.402 0.907 -0.652 ...
 $ V27  : num  0.411 -0.205 0.59 0.516 0.133 ...
 $ V28  : num  -0.462 -0.184 -0.221 1 -0.532 ...
 $ V29  : num  0.2127 -0.1904 0.431 1 0.0243 ...
 $ V30  : num  -0.341 -0.116 -0.174 -0.201 -0.622 ...
 $ V31  : num  0.4227 -0.1663 0.6044 0.2568 -0.0571 ...
 $ V32  : num  -0.5449 -0.0629 -0.2418 1 -0.5957 ...
 $ V33  : num  0.1864 -0.1374 0.5605 -0.3238 -0.0461 ...
 $ V34  : num  -0.453 -0.0245 -0.3824 1 -0.657 ...
 $ Class: Factor w/ 2 levels "bad","good": 2 1 2 1 2 1 2 1 2 1 ...
 - attr(*, ".internal.selfref")=&lt;externalptr&gt; </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">缺失值检查:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
缺失值检查:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>missing_counts <span class="ot">&lt;-</span> <span class="fu">colSums</span>(<span class="fu">is.na</span>(Ionosphere_data))</span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="fu">print</span>(missing_counts)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   V3    V4    V5    V6    V7    V8    V9   V10   V11   V12   V13   V14   V15 
    0     0     0     0     0     0     0     0     0     0     0     0     0 
  V16   V17   V18   V19   V20   V21   V22   V23   V24   V25   V26   V27   V28 
    0     0     0     0     0     0     0     0     0     0     0     0     0 
  V29   V30   V31   V32   V33   V34 Class 
    0     0     0     0     0     0     0 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="fu">data</span>(<span class="st">"Sonar"</span>, <span class="at">package =</span> <span class="st">"mlbench"</span>)</span>
<span id="cb9-2"><a href="#cb9-2"></a>sonar_data <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(Sonar)</span>
<span id="cb9-3"><a href="#cb9-3"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">缺失值检查:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
缺失值检查:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>missing_sonar <span class="ot">&lt;-</span> <span class="fu">colSums</span>(<span class="fu">is.na</span>(sonar_data)) </span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="fu">print</span>(missing_sonar)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   V1    V2    V3    V4    V5    V6    V7    V8    V9   V10   V11   V12   V13 
    0     0     0     0     0     0     0     0     0     0     0     0     0 
  V14   V15   V16   V17   V18   V19   V20   V21   V22   V23   V24   V25   V26 
    0     0     0     0     0     0     0     0     0     0     0     0     0 
  V27   V28   V29   V30   V31   V32   V33   V34   V35   V36   V37   V38   V39 
    0     0     0     0     0     0     0     0     0     0     0     0     0 
  V40   V41   V42   V43   V44   V45   V46   V47   V48   V49   V50   V51   V52 
    0     0     0     0     0     0     0     0     0     0     0     0     0 
  V53   V54   V55   V56   V57   V58   V59   V60 Class 
    0     0     0     0     0     0     0     0     0 </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a><span class="fu">str</span>(sonar_data)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Classes 'data.table' and 'data.frame':  208 obs. of  61 variables:
 $ V1   : num  0.02 0.0453 0.0262 0.01 0.0762 0.0286 0.0317 0.0519 0.0223 0.0164 ...
 $ V2   : num  0.0371 0.0523 0.0582 0.0171 0.0666 0.0453 0.0956 0.0548 0.0375 0.0173 ...
 $ V3   : num  0.0428 0.0843 0.1099 0.0623 0.0481 ...
 $ V4   : num  0.0207 0.0689 0.1083 0.0205 0.0394 ...
 $ V5   : num  0.0954 0.1183 0.0974 0.0205 0.059 ...
 $ V6   : num  0.0986 0.2583 0.228 0.0368 0.0649 ...
 $ V7   : num  0.154 0.216 0.243 0.11 0.121 ...
 $ V8   : num  0.16 0.348 0.377 0.128 0.247 ...
 $ V9   : num  0.3109 0.3337 0.5598 0.0598 0.3564 ...
 $ V10  : num  0.211 0.287 0.619 0.126 0.446 ...
 $ V11  : num  0.1609 0.4918 0.6333 0.0881 0.4152 ...
 $ V12  : num  0.158 0.655 0.706 0.199 0.395 ...
 $ V13  : num  0.2238 0.6919 0.5544 0.0184 0.4256 ...
 $ V14  : num  0.0645 0.7797 0.532 0.2261 0.4135 ...
 $ V15  : num  0.066 0.746 0.648 0.173 0.453 ...
 $ V16  : num  0.227 0.944 0.693 0.213 0.533 ...
 $ V17  : num  0.31 1 0.6759 0.0693 0.7306 ...
 $ V18  : num  0.3 0.887 0.755 0.228 0.619 ...
 $ V19  : num  0.508 0.802 0.893 0.406 0.203 ...
 $ V20  : num  0.48 0.782 0.862 0.397 0.464 ...
 $ V21  : num  0.578 0.521 0.797 0.274 0.415 ...
 $ V22  : num  0.507 0.405 0.674 0.369 0.429 ...
 $ V23  : num  0.433 0.396 0.429 0.556 0.573 ...
 $ V24  : num  0.555 0.391 0.365 0.485 0.54 ...
 $ V25  : num  0.671 0.325 0.533 0.314 0.316 ...
 $ V26  : num  0.641 0.32 0.241 0.533 0.229 ...
 $ V27  : num  0.71 0.327 0.507 0.526 0.7 ...
 $ V28  : num  0.808 0.277 0.853 0.252 1 ...
 $ V29  : num  0.679 0.442 0.604 0.209 0.726 ...
 $ V30  : num  0.386 0.203 0.851 0.356 0.472 ...
 $ V31  : num  0.131 0.379 0.851 0.626 0.51 ...
 $ V32  : num  0.26 0.295 0.504 0.734 0.546 ...
 $ V33  : num  0.512 0.198 0.186 0.612 0.288 ...
 $ V34  : num  0.7547 0.2341 0.2709 0.3497 0.0981 ...
 $ V35  : num  0.854 0.131 0.423 0.395 0.195 ...
 $ V36  : num  0.851 0.418 0.304 0.301 0.418 ...
 $ V37  : num  0.669 0.384 0.612 0.541 0.46 ...
 $ V38  : num  0.61 0.106 0.676 0.881 0.322 ...
 $ V39  : num  0.494 0.184 0.537 0.986 0.283 ...
 $ V40  : num  0.274 0.197 0.472 0.917 0.243 ...
 $ V41  : num  0.051 0.167 0.465 0.612 0.198 ...
 $ V42  : num  0.2834 0.0583 0.2587 0.5006 0.2444 ...
 $ V43  : num  0.282 0.14 0.213 0.321 0.185 ...
 $ V44  : num  0.4256 0.1628 0.2222 0.3202 0.0841 ...
 $ V45  : num  0.2641 0.0621 0.2111 0.4295 0.0692 ...
 $ V46  : num  0.1386 0.0203 0.0176 0.3654 0.0528 ...
 $ V47  : num  0.1051 0.053 0.1348 0.2655 0.0357 ...
 $ V48  : num  0.1343 0.0742 0.0744 0.1576 0.0085 ...
 $ V49  : num  0.0383 0.0409 0.013 0.0681 0.023 0.0264 0.0507 0.0285 0.0777 0.0092 ...
 $ V50  : num  0.0324 0.0061 0.0106 0.0294 0.0046 0.0081 0.0159 0.0178 0.0439 0.0198 ...
 $ V51  : num  0.0232 0.0125 0.0033 0.0241 0.0156 0.0104 0.0195 0.0052 0.0061 0.0118 ...
 $ V52  : num  0.0027 0.0084 0.0232 0.0121 0.0031 0.0045 0.0201 0.0081 0.0145 0.009 ...
 $ V53  : num  0.0065 0.0089 0.0166 0.0036 0.0054 0.0014 0.0248 0.012 0.0128 0.0223 ...
 $ V54  : num  0.0159 0.0048 0.0095 0.015 0.0105 0.0038 0.0131 0.0045 0.0145 0.0179 ...
 $ V55  : num  0.0072 0.0094 0.018 0.0085 0.011 0.0013 0.007 0.0121 0.0058 0.0084 ...
 $ V56  : num  0.0167 0.0191 0.0244 0.0073 0.0015 0.0089 0.0138 0.0097 0.0049 0.0068 ...
 $ V57  : num  0.018 0.014 0.0316 0.005 0.0072 0.0057 0.0092 0.0085 0.0065 0.0032 ...
 $ V58  : num  0.0084 0.0049 0.0164 0.0044 0.0048 0.0027 0.0143 0.0047 0.0093 0.0035 ...
 $ V59  : num  0.009 0.0052 0.0095 0.004 0.0107 0.0051 0.0036 0.0048 0.0059 0.0056 ...
 $ V60  : num  0.0032 0.0044 0.0078 0.0117 0.0094 0.0062 0.0103 0.0053 0.0022 0.004 ...
 $ Class: Factor w/ 2 levels "M","R": 2 2 2 2 2 2 2 2 2 2 ...
 - attr(*, ".internal.selfref")=&lt;externalptr&gt; </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a>task_Ionosphere <span class="ot">&lt;-</span> <span class="fu">as_task_classif</span>(Ionosphere_data, <span class="at">target =</span> <span class="st">"Class"</span>, <span class="at">id =</span> <span class="st">"Ionosphere"</span>)</span>
<span id="cb15-2"><a href="#cb15-2"></a></span>
<span id="cb15-3"><a href="#cb15-3"></a>task_sonar <span class="ot">&lt;-</span> <span class="fu">as_task_classif</span>(sonar_data, <span class="at">target =</span> <span class="st">"Class"</span>, <span class="at">id =</span> <span class="st">"sonar"</span>)</span>
<span id="cb15-4"><a href="#cb15-4"></a></span>
<span id="cb15-5"><a href="#cb15-5"></a>tasks <span class="ot">=</span> <span class="fu">list</span>(task_Ionosphere, task_sonar)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="co"># 定义学习器</span></span>
<span id="cb16-2"><a href="#cb16-2"></a>learners_extended <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb16-3"><a href="#cb16-3"></a>  <span class="fu">lrn</span>(<span class="st">"classif.ranger"</span>, <span class="at">id =</span> <span class="st">"random_forest"</span>, <span class="at">predict_type =</span> <span class="st">"prob"</span>),</span>
<span id="cb16-4"><a href="#cb16-4"></a>  <span class="fu">lrn</span>(<span class="st">"classif.xgboost"</span>, <span class="at">id =</span> <span class="st">"xgboost"</span>, <span class="at">predict_type =</span> <span class="st">"prob"</span>),</span>
<span id="cb16-5"><a href="#cb16-5"></a>  <span class="fu">lrn</span>(<span class="st">"classif.svm"</span>, <span class="at">id =</span> <span class="st">"svm"</span>, <span class="at">predict_type =</span> <span class="st">"prob"</span>),</span>
<span id="cb16-6"><a href="#cb16-6"></a>  <span class="fu">lrn</span>(<span class="st">"classif.kknn"</span>, <span class="at">id =</span> <span class="st">"knn"</span>, <span class="at">predict_type =</span> <span class="st">"prob"</span>),</span>
<span id="cb16-7"><a href="#cb16-7"></a>  <span class="fu">lrn</span>(<span class="st">"classif.naive_bayes"</span>, <span class="at">id =</span> <span class="st">"naive_bayes"</span>, <span class="at">predict_type =</span> <span class="st">"prob"</span>),</span>
<span id="cb16-8"><a href="#cb16-8"></a>  <span class="fu">lrn</span>(<span class="st">"classif.rpart"</span>, <span class="at">id =</span> <span class="st">"decision_tree"</span>, <span class="at">predict_type =</span> <span class="st">"prob"</span>)</span>
<span id="cb16-9"><a href="#cb16-9"></a>)</span>
<span id="cb16-10"><a href="#cb16-10"></a></span>
<span id="cb16-11"><a href="#cb16-11"></a><span class="co"># 设置不同的重采样策略</span></span>
<span id="cb16-12"><a href="#cb16-12"></a>resamplings <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb16-13"><a href="#cb16-13"></a>  <span class="at">cv5 =</span> <span class="fu">rsmp</span>(<span class="st">"cv"</span>, <span class="at">folds =</span> <span class="dv">5</span>),</span>
<span id="cb16-14"><a href="#cb16-14"></a>  <span class="at">cv10 =</span> <span class="fu">rsmp</span>(<span class="st">"cv"</span>, <span class="at">folds =</span> <span class="dv">10</span>),</span>
<span id="cb16-15"><a href="#cb16-15"></a>  <span class="at">holdout =</span> <span class="fu">rsmp</span>(<span class="st">"holdout"</span>, <span class="at">ratio =</span> <span class="fl">0.7</span>),</span>
<span id="cb16-16"><a href="#cb16-16"></a>  <span class="at">bootstrap =</span> <span class="fu">rsmp</span>(<span class="st">"bootstrap"</span>, <span class="at">repeats =</span> <span class="dv">5</span>)</span>
<span id="cb16-17"><a href="#cb16-17"></a>)</span>
<span id="cb16-18"><a href="#cb16-18"></a></span>
<span id="cb16-19"><a href="#cb16-19"></a><span class="co"># 创建Benchmark设计</span></span>
<span id="cb16-20"><a href="#cb16-20"></a>design_extended <span class="ot">&lt;-</span> <span class="fu">benchmark_grid</span>(</span>
<span id="cb16-21"><a href="#cb16-21"></a>  <span class="at">tasks =</span> tasks,</span>
<span id="cb16-22"><a href="#cb16-22"></a>  <span class="at">learners =</span> learners_extended,</span>
<span id="cb16-23"><a href="#cb16-23"></a>  <span class="at">resamplings =</span> resamplings[<span class="dv">1</span>]  <span class="co"># 使用5折交叉验证以节省时间</span></span>
<span id="cb16-24"><a href="#cb16-24"></a>)</span>
<span id="cb16-25"><a href="#cb16-25"></a></span>
<span id="cb16-26"><a href="#cb16-26"></a><span class="co"># 执行Benchmark</span></span>
<span id="cb16-27"><a href="#cb16-27"></a><span class="fu">cat</span>(<span class="st">"开始扩展Benchmark分析...</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>开始扩展Benchmark分析...</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a>bmr_extended <span class="ot">&lt;-</span> <span class="fu">benchmark</span>(design_extended, <span class="at">store_models =</span> <span class="cn">TRUE</span>)</span>
<span id="cb18-2"><a href="#cb18-2"></a></span>
<span id="cb18-3"><a href="#cb18-3"></a><span class="co"># 性能汇总</span></span>
<span id="cb18-4"><a href="#cb18-4"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">=== Benchmark性能汇总 ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
=== Benchmark性能汇总 ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a>measures_all <span class="ot">&lt;-</span> <span class="fu">msrs</span>(<span class="fu">c</span>(<span class="st">"classif.acc"</span>, <span class="st">"classif.auc"</span>, <span class="st">"classif.bacc"</span>, <span class="st">"classif.ce"</span>))</span>
<span id="cb20-2"><a href="#cb20-2"></a>bmr_results <span class="ot">&lt;-</span> bmr_extended<span class="sc">$</span><span class="fu">aggregate</span>(measures_all)</span>
<span id="cb20-3"><a href="#cb20-3"></a></span>
<span id="cb20-4"><a href="#cb20-4"></a><span class="co"># 格式化结果</span></span>
<span id="cb20-5"><a href="#cb20-5"></a>results_detailed <span class="ot">&lt;-</span> bmr_results[, .(</span>
<span id="cb20-6"><a href="#cb20-6"></a>  <span class="at">Task =</span> task_id,</span>
<span id="cb20-7"><a href="#cb20-7"></a>  <span class="at">Model =</span> learner_id,</span>
<span id="cb20-8"><a href="#cb20-8"></a>  <span class="at">Resampling =</span> resampling_id,</span>
<span id="cb20-9"><a href="#cb20-9"></a>  <span class="at">Accuracy =</span> classif.acc,</span>
<span id="cb20-10"><a href="#cb20-10"></a>  <span class="at">AUC =</span> classif.auc,</span>
<span id="cb20-11"><a href="#cb20-11"></a>  <span class="at">Balanced_Accuracy =</span> classif.bacc,</span>
<span id="cb20-12"><a href="#cb20-12"></a>  <span class="at">LogLoss =</span> classif.ce</span>
<span id="cb20-13"><a href="#cb20-13"></a>)]</span>
<span id="cb20-14"><a href="#cb20-14"></a></span>
<span id="cb20-15"><a href="#cb20-15"></a><span class="fu">print</span>(results_detailed[<span class="fu">order</span>(Task, <span class="sc">-</span>Accuracy)])</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>          Task         Model Resampling  Accuracy       AUC Balanced_Accuracy
        &lt;char&gt;        &lt;char&gt;     &lt;char&gt;     &lt;num&gt;     &lt;num&gt;             &lt;num&gt;
 1: Ionosphere           svm         cv 0.9487324 0.9820820         0.9416321
 2: Ionosphere       xgboost         cv 0.9344064 0.9789980         0.9212549
 3: Ionosphere random_forest         cv 0.9287726 0.9809080         0.9201580
 4: Ionosphere decision_tree         cv 0.8661972 0.9103794         0.8434849
 5: Ionosphere           knn         cv 0.8575453 0.9175268         0.8081414
 6: Ionosphere   naive_bayes         cv 0.8317907 0.9387509         0.8439733
 7:      sonar           knn         cv 0.8465738 0.9374191         0.8419655
 8:      sonar       xgboost         cv 0.8270616 0.8975745         0.8279575
 9:      sonar           svm         cv 0.8222997 0.9348429         0.8153992
10:      sonar random_forest         cv 0.8173055 0.9216941         0.8148226
11:      sonar decision_tree         cv 0.7312427 0.7541301         0.7269468
12:      sonar   naive_bayes         cv 0.6880372 0.7953927         0.6973016
       LogLoss
         &lt;num&gt;
 1: 0.05126761
 2: 0.06559356
 3: 0.07122736
 4: 0.13380282
 5: 0.14245473
 6: 0.16820926
 7: 0.15342625
 8: 0.17293844
 9: 0.17770035
10: 0.18269454
11: 0.26875726
12: 0.31196283</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a><span class="co"># 按任务分组统计</span></span>
<span id="cb22-2"><a href="#cb22-2"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">=== 按任务分组的性能统计 ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
=== 按任务分组的性能统计 ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a>task_stats <span class="ot">&lt;-</span> results_detailed[, .(</span>
<span id="cb24-2"><a href="#cb24-2"></a>  <span class="at">Mean_Accuracy =</span> <span class="fu">mean</span>(Accuracy),</span>
<span id="cb24-3"><a href="#cb24-3"></a>  <span class="at">Std_Accuracy =</span> <span class="fu">sd</span>(Accuracy),</span>
<span id="cb24-4"><a href="#cb24-4"></a>  <span class="at">Best_Model =</span> .SD[<span class="fu">which.max</span>(Accuracy)]<span class="sc">$</span>Model,</span>
<span id="cb24-5"><a href="#cb24-5"></a>  <span class="at">Best_Accuracy =</span> <span class="fu">max</span>(Accuracy)</span>
<span id="cb24-6"><a href="#cb24-6"></a>), by <span class="ot">=</span> Task]</span>
<span id="cb24-7"><a href="#cb24-7"></a></span>
<span id="cb24-8"><a href="#cb24-8"></a><span class="fu">print</span>(task_stats)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>         Task Mean_Accuracy Std_Accuracy Best_Model Best_Accuracy
       &lt;char&gt;         &lt;num&gt;        &lt;num&gt;     &lt;char&gt;         &lt;num&gt;
1: Ionosphere     0.8945741   0.04859508        svm     0.9487324
2:      sonar     0.7887534   0.06356495        knn     0.8465738</code></pre>
</div>
</div>
<p>Benchmark结果可视化</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a><span class="co"># Benchmark结果可视化</span></span>
<span id="cb26-2"><a href="#cb26-2"></a></span>
<span id="cb26-3"><a href="#cb26-3"></a><span class="co"># 1. 按任务和模型的准确率热图</span></span>
<span id="cb26-4"><a href="#cb26-4"></a>accuracy_matrix <span class="ot">&lt;-</span> <span class="fu">dcast</span>(results_detailed, Model <span class="sc">~</span> Task, <span class="at">value.var =</span> <span class="st">"Accuracy"</span>)</span>
<span id="cb26-5"><a href="#cb26-5"></a><span class="fu">print</span>(<span class="st">"准确率矩阵:"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "准确率矩阵:"</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a><span class="fu">print</span>(accuracy_matrix)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Key: &lt;Model&gt;
           Model Ionosphere     sonar
          &lt;char&gt;      &lt;num&gt;     &lt;num&gt;
1: decision_tree  0.8661972 0.7312427
2:           knn  0.8575453 0.8465738
3:   naive_bayes  0.8317907 0.6880372
4: random_forest  0.9287726 0.8173055
5:           svm  0.9487324 0.8222997
6:       xgboost  0.9344064 0.8270616</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a><span class="co"># 可视化热图</span></span>
<span id="cb30-2"><a href="#cb30-2"></a>heatmap_data <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(accuracy_matrix[, <span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb30-3"><a href="#cb30-3"></a><span class="fu">rownames</span>(heatmap_data) <span class="ot">&lt;-</span> accuracy_matrix<span class="sc">$</span>Model</span>
<span id="cb30-4"><a href="#cb30-4"></a></span>
<span id="cb30-5"><a href="#cb30-5"></a><span class="fu">library</span>(reshape2)</span>
<span id="cb30-6"><a href="#cb30-6"></a>heatmap_df <span class="ot">&lt;-</span> <span class="fu">melt</span>(accuracy_matrix, <span class="at">id.vars =</span> <span class="st">"Model"</span>, </span>
<span id="cb30-7"><a href="#cb30-7"></a>                   <span class="at">variable.name =</span> <span class="st">"Task"</span>, <span class="at">value.name =</span> <span class="st">"Accuracy"</span>)</span>
<span id="cb30-8"><a href="#cb30-8"></a></span>
<span id="cb30-9"><a href="#cb30-9"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(heatmap_df, <span class="fu">aes</span>(<span class="at">x =</span> Task, <span class="at">y =</span> Model, <span class="at">fill =</span> Accuracy)) <span class="sc">+</span></span>
<span id="cb30-10"><a href="#cb30-10"></a>  <span class="fu">geom_tile</span>(<span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb30-11"><a href="#cb30-11"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">round</span>(Accuracy, <span class="dv">3</span>)), <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb30-12"><a href="#cb30-12"></a>  <span class="fu">scale_fill_gradient2</span>(<span class="at">low =</span> <span class="st">"red"</span>, <span class="at">mid =</span> <span class="st">"white"</span>, <span class="at">high =</span> <span class="st">"blue"</span>, <span class="at">midpoint =</span> <span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb30-13"><a href="#cb30-13"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"模型在不同任务上的准确率热图"</span>, </span>
<span id="cb30-14"><a href="#cb30-14"></a>       <span class="at">x =</span> <span class="st">"任务"</span>, <span class="at">y =</span> <span class="st">"模型"</span>) <span class="sc">+</span></span>
<span id="cb30-15"><a href="#cb30-15"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb30-16"><a href="#cb30-16"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span>
<span id="cb30-17"><a href="#cb30-17"></a></span>
<span id="cb30-18"><a href="#cb30-18"></a><span class="co"># 2. 模型性能比较箱线图</span></span>
<span id="cb30-19"><a href="#cb30-19"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(results_detailed, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(Model, Accuracy), <span class="at">y =</span> Accuracy, <span class="at">fill =</span> Model)) <span class="sc">+</span></span>
<span id="cb30-20"><a href="#cb30-20"></a>  <span class="fu">geom_boxplot</span>(<span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb30-21"><a href="#cb30-21"></a>  <span class="fu">geom_jitter</span>(<span class="at">width =</span> <span class="fl">0.2</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb30-22"><a href="#cb30-22"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"模型性能分布"</span>, <span class="at">x =</span> <span class="st">"模型"</span>, <span class="at">y =</span> <span class="st">"准确率"</span>) <span class="sc">+</span></span>
<span id="cb30-23"><a href="#cb30-23"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb30-24"><a href="#cb30-24"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb30-25"><a href="#cb30-25"></a>        <span class="at">legend.position =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb30-26"><a href="#cb30-26"></a>  <span class="fu">coord_flip</span>()</span>
<span id="cb30-27"><a href="#cb30-27"></a></span>
<span id="cb30-28"><a href="#cb30-28"></a><span class="co"># 3. 任务性能比较</span></span>
<span id="cb30-29"><a href="#cb30-29"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(results_detailed, <span class="fu">aes</span>(<span class="at">x =</span> Task, <span class="at">y =</span> Accuracy, <span class="at">fill =</span> Task)) <span class="sc">+</span></span>
<span id="cb30-30"><a href="#cb30-30"></a>  <span class="fu">geom_boxplot</span>(<span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb30-31"><a href="#cb30-31"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"不同任务的性能比较"</span>, <span class="at">x =</span> <span class="st">"任务"</span>, <span class="at">y =</span> <span class="st">"准确率"</span>) <span class="sc">+</span></span>
<span id="cb30-32"><a href="#cb30-32"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb30-33"><a href="#cb30-33"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb30-34"><a href="#cb30-34"></a></span>
<span id="cb30-35"><a href="#cb30-35"></a><span class="co"># 组合图形</span></span>
<span id="cb30-36"><a href="#cb30-36"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb30-37"><a href="#cb30-37"></a>(p1) <span class="sc">/</span> (p2 <span class="sc">|</span> p3)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="14-分类任务_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>统计显著性检验</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a><span class="co"># 统计显著性检验</span></span>
<span id="cb31-2"><a href="#cb31-2"></a></span>
<span id="cb31-3"><a href="#cb31-3"></a><span class="co"># 提取所有resample结果的预测</span></span>
<span id="cb31-4"><a href="#cb31-4"></a>predictions_all <span class="ot">&lt;-</span> bmr_extended<span class="sc">$</span><span class="fu">score</span>()</span>
<span id="cb31-5"><a href="#cb31-5"></a></span>
<span id="cb31-6"><a href="#cb31-6"></a><span class="co"># 查看提取的结果结构</span></span>
<span id="cb31-7"><a href="#cb31-7"></a><span class="fu">str</span>(predictions_all, <span class="at">max.level =</span> <span class="dv">1</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Classes 'bmr_score', 'data.table' and 'data.frame': 60 obs. of  11 variables:
 $ uhash          : chr  "26694fa8-5dd4-4c77-bffe-1f67cad81b9a" "26694fa8-5dd4-4c77-bffe-1f67cad81b9a" "26694fa8-5dd4-4c77-bffe-1f67cad81b9a" "26694fa8-5dd4-4c77-bffe-1f67cad81b9a" ...
 $ nr             : int  1 1 1 1 1 2 2 2 2 2 ...
 $ task           :List of 60
 $ task_id        : chr  "Ionosphere" "Ionosphere" "Ionosphere" "Ionosphere" ...
 $ learner        :List of 60
 $ learner_id     : chr  "random_forest" "random_forest" "random_forest" "random_forest" ...
 $ resampling     :List of 60
 $ resampling_id  : chr  "cv" "cv" "cv" "cv" ...
 $ iteration      : int  1 2 3 4 5 1 2 3 4 5 ...
 $ prediction_test:List of 60
 $ classif.ce     : num  0.0704 0.0286 0.0714 0.1 0.0857 ...
 - attr(*, ".internal.selfref")=&lt;externalptr&gt; </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a><span class="co"># 提取具体的预测对象</span></span>
<span id="cb33-2"><a href="#cb33-2"></a>predictions_list <span class="ot">&lt;-</span> predictions_all<span class="sc">$</span>prediction</span>
<span id="cb33-3"><a href="#cb33-3"></a></span>
<span id="cb33-4"><a href="#cb33-4"></a><span class="co"># Friedman检验 - 比较多个模型的性能</span></span>
<span id="cb33-5"><a href="#cb33-5"></a><span class="cf">if</span> (<span class="fu">requireNamespace</span>(<span class="st">"scmamp"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb33-6"><a href="#cb33-6"></a>  <span class="fu">library</span>(scmamp)</span>
<span id="cb33-7"><a href="#cb33-7"></a>  </span>
<span id="cb33-8"><a href="#cb33-8"></a>  <span class="co"># 准备数据用于Friedman检验</span></span>
<span id="cb33-9"><a href="#cb33-9"></a>  accuracy_matrix <span class="ot">&lt;-</span> <span class="fu">dcast</span>(results_detailed, Task <span class="sc">~</span> Model, <span class="at">value.var =</span> <span class="st">"Accuracy"</span>)</span>
<span id="cb33-10"><a href="#cb33-10"></a>  accuracy_data <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(accuracy_matrix[, <span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb33-11"><a href="#cb33-11"></a>  </span>
<span id="cb33-12"><a href="#cb33-12"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">=== Friedman检验 ===</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb33-13"><a href="#cb33-13"></a>  friedman_test <span class="ot">&lt;-</span> <span class="fu">friedmanTest</span>(accuracy_data)</span>
<span id="cb33-14"><a href="#cb33-14"></a>  <span class="fu">print</span>(friedman_test)</span>
<span id="cb33-15"><a href="#cb33-15"></a>  </span>
<span id="cb33-16"><a href="#cb33-16"></a>  <span class="cf">if</span> (friedman_test<span class="sc">$</span>p.value <span class="sc">&lt;</span> <span class="fl">0.05</span>) {</span>
<span id="cb33-17"><a href="#cb33-17"></a>    <span class="fu">cat</span>(<span class="st">"模型间存在显著差异，进行事后检验...</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb33-18"><a href="#cb33-18"></a>    </span>
<span id="cb33-19"><a href="#cb33-19"></a>    <span class="co"># Nemenyi事后检验</span></span>
<span id="cb33-20"><a href="#cb33-20"></a>    nemenyi_test <span class="ot">&lt;-</span> <span class="fu">nemenyiTest</span>(accuracy_data)</span>
<span id="cb33-21"><a href="#cb33-21"></a>    <span class="fu">print</span>(nemenyi_test)</span>
<span id="cb33-22"><a href="#cb33-22"></a>    </span>
<span id="cb33-23"><a href="#cb33-23"></a>    <span class="co"># 可视化CD图</span></span>
<span id="cb33-24"><a href="#cb33-24"></a>    <span class="fu">plotCD</span>(accuracy_data, <span class="at">alpha =</span> <span class="fl">0.05</span>)</span>
<span id="cb33-25"><a href="#cb33-25"></a>  } <span class="cf">else</span> {</span>
<span id="cb33-26"><a href="#cb33-26"></a>    <span class="fu">cat</span>(<span class="st">"模型间无显著差异</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb33-27"><a href="#cb33-27"></a>  }</span>
<span id="cb33-28"><a href="#cb33-28"></a>} <span class="cf">else</span> {</span>
<span id="cb33-29"><a href="#cb33-29"></a>  <span class="fu">cat</span>(<span class="st">"scmamp包未安装，跳过统计检验</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb33-30"><a href="#cb33-30"></a>}</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>scmamp包未安装，跳过统计检验</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a><span class="co"># 简单的成对t检验</span></span>
<span id="cb35-2"><a href="#cb35-2"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">=== 最佳模型 vs 其他模型的成对t检验 ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
=== 最佳模型 vs 其他模型的成对t检验 ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a>best_model <span class="ot">&lt;-</span> results_detailed[<span class="fu">which.max</span>(Accuracy)]<span class="sc">$</span>Model</span>
<span id="cb37-2"><a href="#cb37-2"></a>best_accuracies <span class="ot">&lt;-</span> results_detailed[Model <span class="sc">==</span> best_model]<span class="sc">$</span>Accuracy</span>
<span id="cb37-3"><a href="#cb37-3"></a></span>
<span id="cb37-4"><a href="#cb37-4"></a><span class="cf">for</span> (model <span class="cf">in</span> <span class="fu">unique</span>(results_detailed<span class="sc">$</span>Model)) {</span>
<span id="cb37-5"><a href="#cb37-5"></a>  <span class="cf">if</span> (model <span class="sc">!=</span> best_model) {</span>
<span id="cb37-6"><a href="#cb37-6"></a>    model_accuracies <span class="ot">&lt;-</span> results_detailed[Model <span class="sc">==</span> model]<span class="sc">$</span>Accuracy</span>
<span id="cb37-7"><a href="#cb37-7"></a>    t_test <span class="ot">&lt;-</span> <span class="fu">t.test</span>(best_accuracies, model_accuracies, <span class="at">paired =</span> <span class="cn">TRUE</span>)</span>
<span id="cb37-8"><a href="#cb37-8"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"%s vs %s: p-value = %.4f</span><span class="sc">\n</span><span class="st">"</span>, best_model, model, t_test<span class="sc">$</span>p.value))</span>
<span id="cb37-9"><a href="#cb37-9"></a>  }</span>
<span id="cb37-10"><a href="#cb37-10"></a>}</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>svm vs random_forest: p-value = 0.3439
svm vs xgboost: p-value = 0.7043
svm vs knn: p-value = 0.6656
svm vs naive_bayes: p-value = 0.0438
svm vs decision_tree: p-value = 0.0312</code></pre>
</div>
</div>
</section><section id="benchmark分析总结" class="level2"><h2 class="anchored" data-anchor-id="benchmark分析总结">14.2 Benchmark分析总结</h2>
<p>mlr3 Benchmark优势</p>
<p>统一的接口：<code>benchmark()</code>函数提供统一的Benchmark接口 灵活的设计：支持多个任务、学习器、重采样策略的组合 内置存储：可以存储模型和预测结果用于后续分析 丰富的结果：自动计算多个评估指标 统计检验：内置Friedman检验等统计方法</p>
<p>最佳实践建议</p>
<p>系统化比较：在项目初期进行全面的Benchmark分析 多维度评估：考虑准确率、训练时间、可解释性等多个维度 统计验证：使用统计检验验证性能差异的显著性 业务导向：根据具体业务需求选择最适合的模型 可重复性：设置随机种子确保结果可重复</p>
<p>这样的Benchmark分析为模型选择提供了科学依据，确保选择的模型不仅在测试集上表现好，而且具有统计显著性。</p>
</section><section id="r语言多分类" class="level2"><h2 class="anchored" data-anchor-id="r语言多分类">14.4 R语言–多分类</h2>
<p>数据集说明 本案例使用经典的鸢尾花数据集（Iris Dataset），包含三种鸢尾花的萼片和花瓣测量数据。 <strong>目标</strong>：预测鸢尾花的种类（Species）<br><strong>任务类型</strong>：多分类问题（3个类别）<br><strong>业务价值</strong>：植物分类、物种识别</p>
<p>数据加载与探索</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a><span class="co"># 综合案例：鸢尾花分类 - R语言实现 (mlr3框架)</span></span>
<span id="cb39-2"><a href="#cb39-2"></a></span>
<span id="cb39-3"><a href="#cb39-3"></a><span class="co"># 加载必要的包</span></span>
<span id="cb39-4"><a href="#cb39-4"></a><span class="fu">library</span>(mlr3)</span>
<span id="cb39-5"><a href="#cb39-5"></a><span class="fu">library</span>(mlr3verse)</span>
<span id="cb39-6"><a href="#cb39-6"></a><span class="fu">library</span>(mlr3pipelines)</span>
<span id="cb39-7"><a href="#cb39-7"></a><span class="fu">library</span>(mlr3tuning)</span>
<span id="cb39-8"><a href="#cb39-8"></a><span class="fu">library</span>(data.table)</span>
<span id="cb39-9"><a href="#cb39-9"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb39-10"><a href="#cb39-10"></a><span class="fu">library</span>(corrplot)</span>
<span id="cb39-11"><a href="#cb39-11"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb39-12"><a href="#cb39-12"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb39-13"><a href="#cb39-13"></a></span>
<span id="cb39-14"><a href="#cb39-14"></a><span class="co"># 加载鸢尾花数据集</span></span>
<span id="cb39-15"><a href="#cb39-15"></a><span class="fu">data</span>(<span class="st">"iris"</span>, <span class="at">package =</span> <span class="st">"datasets"</span>)</span>
<span id="cb39-16"><a href="#cb39-16"></a>iris_data <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(iris)</span>
<span id="cb39-17"><a href="#cb39-17"></a></span>
<span id="cb39-18"><a href="#cb39-18"></a><span class="co"># 数据基本信息</span></span>
<span id="cb39-19"><a href="#cb39-19"></a><span class="fu">str</span>(iris_data)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Classes 'data.table' and 'data.frame':  150 obs. of  5 variables:
 $ Sepal.Length: num  5.1 4.9 4.7 4.6 5 5.4 4.6 5 4.4 4.9 ...
 $ Sepal.Width : num  3.5 3 3.2 3.1 3.6 3.9 3.4 3.4 2.9 3.1 ...
 $ Petal.Length: num  1.4 1.4 1.3 1.5 1.4 1.7 1.4 1.5 1.4 1.5 ...
 $ Petal.Width : num  0.2 0.2 0.2 0.2 0.2 0.4 0.3 0.2 0.2 0.1 ...
 $ Species     : Factor w/ 3 levels "setosa","versicolor",..: 1 1 1 1 1 1 1 1 1 1 ...
 - attr(*, ".internal.selfref")=&lt;externalptr&gt; </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a><span class="co"># 检查缺失值</span></span>
<span id="cb41-2"><a href="#cb41-2"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">缺失值检查:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
缺失值检查:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1"></a><span class="fu">print</span>(<span class="fu">colSums</span>(<span class="fu">is.na</span>(iris_data)))</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Sepal.Length  Sepal.Width Petal.Length  Petal.Width      Species 
           0            0            0            0            0 </code></pre>
</div>
</div>
<p>数据可视化分析</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1"></a><span class="co"># 数据可视化分析 - R语言</span></span>
<span id="cb45-2"><a href="#cb45-2"></a></span>
<span id="cb45-3"><a href="#cb45-3"></a><span class="co"># 类别分布</span></span>
<span id="cb45-4"><a href="#cb45-4"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(iris_data, <span class="fu">aes</span>(<span class="at">x =</span> Species, <span class="at">fill =</span> Species)) <span class="sc">+</span></span>
<span id="cb45-5"><a href="#cb45-5"></a>  <span class="fu">geom_bar</span>(<span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb45-6"><a href="#cb45-6"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">"Set1"</span>) <span class="sc">+</span></span>
<span id="cb45-7"><a href="#cb45-7"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"类别分布"</span>, <span class="at">x =</span> <span class="st">"鸢尾花种类"</span>, <span class="at">y =</span> <span class="st">"数量"</span>) <span class="sc">+</span></span>
<span id="cb45-8"><a href="#cb45-8"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb45-9"><a href="#cb45-9"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb45-10"><a href="#cb45-10"></a></span>
<span id="cb45-11"><a href="#cb45-11"></a><span class="co"># 花萼长度与宽度的关系</span></span>
<span id="cb45-12"><a href="#cb45-12"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(iris_data, <span class="fu">aes</span>(<span class="at">x =</span> Sepal.Length, <span class="at">y =</span> Sepal.Width, <span class="at">color =</span> Species)) <span class="sc">+</span></span>
<span id="cb45-13"><a href="#cb45-13"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb45-14"><a href="#cb45-14"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">"Set1"</span>) <span class="sc">+</span></span>
<span id="cb45-15"><a href="#cb45-15"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"花萼长度 vs 宽度"</span>, <span class="at">x =</span> <span class="st">"花萼长度"</span>, <span class="at">y =</span> <span class="st">"花萼宽度"</span>) <span class="sc">+</span></span>
<span id="cb45-16"><a href="#cb45-16"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb45-17"><a href="#cb45-17"></a></span>
<span id="cb45-18"><a href="#cb45-18"></a><span class="co"># 花瓣长度与宽度的关系</span></span>
<span id="cb45-19"><a href="#cb45-19"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(iris_data, <span class="fu">aes</span>(<span class="at">x =</span> Petal.Length, <span class="at">y =</span> Petal.Width, <span class="at">color =</span> Species)) <span class="sc">+</span></span>
<span id="cb45-20"><a href="#cb45-20"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb45-21"><a href="#cb45-21"></a>  <span class="fu">scale_color_brewer</span>(<span class="at">palette =</span> <span class="st">"Set1"</span>) <span class="sc">+</span></span>
<span id="cb45-22"><a href="#cb45-22"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"花瓣长度 vs 宽度"</span>, <span class="at">x =</span> <span class="st">"花瓣长度"</span>, <span class="at">y =</span> <span class="st">"花瓣宽度"</span>) <span class="sc">+</span></span>
<span id="cb45-23"><a href="#cb45-23"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb45-24"><a href="#cb45-24"></a></span>
<span id="cb45-25"><a href="#cb45-25"></a><span class="co"># 特征分布箱线图</span></span>
<span id="cb45-26"><a href="#cb45-26"></a>p4 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(iris_data, <span class="fu">aes</span>(<span class="at">x =</span> Species, <span class="at">y =</span> Petal.Length, <span class="at">fill =</span> Species)) <span class="sc">+</span></span>
<span id="cb45-27"><a href="#cb45-27"></a>  <span class="fu">geom_boxplot</span>(<span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb45-28"><a href="#cb45-28"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">"Set1"</span>) <span class="sc">+</span></span>
<span id="cb45-29"><a href="#cb45-29"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"花瓣长度分布"</span>, <span class="at">x =</span> <span class="st">"鸢尾花种类"</span>, <span class="at">y =</span> <span class="st">"花瓣长度"</span>) <span class="sc">+</span></span>
<span id="cb45-30"><a href="#cb45-30"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb45-31"><a href="#cb45-31"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb45-32"><a href="#cb45-32"></a></span>
<span id="cb45-33"><a href="#cb45-33"></a><span class="co"># 组合图形</span></span>
<span id="cb45-34"><a href="#cb45-34"></a>(p1 <span class="sc">+</span> p2) <span class="sc">/</span> (p3 <span class="sc">+</span> p4)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="14-分类任务_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>创建mlr3任务和数据预处理</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb46"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1"></a><span class="co"># 创建mlr3任务和数据预处理</span></span>
<span id="cb46-2"><a href="#cb46-2"></a></span>
<span id="cb46-3"><a href="#cb46-3"></a><span class="co"># 创建分类任务</span></span>
<span id="cb46-4"><a href="#cb46-4"></a>task_iris <span class="ot">&lt;-</span> <span class="fu">as_task_classif</span>(iris_data, <span class="at">target =</span> <span class="st">"Species"</span>, <span class="at">id =</span> <span class="st">"iris"</span>,<span class="at">store_backends=</span><span class="cn">TRUE</span>)</span>
<span id="cb46-5"><a href="#cb46-5"></a></span>
<span id="cb46-6"><a href="#cb46-6"></a><span class="co"># 查看任务信息</span></span>
<span id="cb46-7"><a href="#cb46-7"></a><span class="fu">cat</span>(<span class="st">"任务信息:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>任务信息:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb48"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1"></a><span class="fu">print</span>(task_iris)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
── &lt;TaskClassif&gt; (150x5) ───────────────────────────────────────────────────────
• Target: Species
• Target classes: setosa (33%), versicolor (33%), virginica (33%)
• Properties: multiclass
• Features (4):
  • dbl (4): Petal.Length, Petal.Width, Sepal.Length, Sepal.Width</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb50"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1"></a><span class="co"># 数据预处理管道</span></span>
<span id="cb50-2"><a href="#cb50-2"></a>preprocess_pipeline <span class="ot">&lt;-</span> <span class="fu">po</span>(<span class="st">"scale"</span>) <span class="sc">%&gt;&gt;%</span> </span>
<span id="cb50-3"><a href="#cb50-3"></a>  <span class="fu">po</span>(<span class="st">"encode"</span>) <span class="sc">%&gt;&gt;%</span></span>
<span id="cb50-4"><a href="#cb50-4"></a>  <span class="fu">po</span>(<span class="st">"colapply"</span>, <span class="at">applicator =</span> as.numeric)</span>
<span id="cb50-5"><a href="#cb50-5"></a></span>
<span id="cb50-6"><a href="#cb50-6"></a><span class="co"># 应用预处理</span></span>
<span id="cb50-7"><a href="#cb50-7"></a>task_preprocessed <span class="ot">&lt;-</span> preprocess_pipeline<span class="sc">$</span><span class="fu">train</span>(task_iris)[[<span class="dv">1</span>]]</span>
<span id="cb50-8"><a href="#cb50-8"></a></span>
<span id="cb50-9"><a href="#cb50-9"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">预处理后的任务信息:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
预处理后的任务信息:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb52"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1"></a><span class="fu">print</span>(task_preprocessed)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
── &lt;TaskClassif&gt; (150x5) ───────────────────────────────────────────────────────
• Target: Species
• Target classes: setosa (33%), versicolor (33%), virginica (33%)
• Properties: multiclass
• Features (4):
  • dbl (4): Petal.Length, Petal.Width, Sepal.Length, Sepal.Width</code></pre>
</div>
</div>
<p>模型训练与比较</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb54"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1"></a><span class="co"># 模型训练与比较 - mlr3</span></span>
<span id="cb54-2"><a href="#cb54-2"></a></span>
<span id="cb54-3"><a href="#cb54-3"></a><span class="co"># 定义学习器</span></span>
<span id="cb54-4"><a href="#cb54-4"></a>learners <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb54-5"><a href="#cb54-5"></a>  <span class="fu">lrn</span>(<span class="st">"classif.ranger"</span>, <span class="at">id =</span> <span class="st">"random_forest"</span>, <span class="at">predict_type =</span> <span class="st">"prob"</span>),</span>
<span id="cb54-6"><a href="#cb54-6"></a>  <span class="fu">lrn</span>(<span class="st">"classif.xgboost"</span>, <span class="at">id =</span> <span class="st">"xgboost"</span>, <span class="at">predict_type =</span> <span class="st">"prob"</span>),</span>
<span id="cb54-7"><a href="#cb54-7"></a>  <span class="fu">lrn</span>(<span class="st">"classif.svm"</span>, <span class="at">id =</span> <span class="st">"svm"</span>, <span class="at">predict_type =</span> <span class="st">"prob"</span>),</span>
<span id="cb54-8"><a href="#cb54-8"></a>  <span class="fu">lrn</span>(<span class="st">"classif.kknn"</span>, <span class="at">id =</span> <span class="st">"knn"</span>, <span class="at">predict_type =</span> <span class="st">"prob"</span>)</span>
<span id="cb54-9"><a href="#cb54-9"></a>)</span>
<span id="cb54-10"><a href="#cb54-10"></a></span>
<span id="cb54-11"><a href="#cb54-11"></a><span class="co"># 设置交叉验证和评估指标</span></span>
<span id="cb54-12"><a href="#cb54-12"></a>resampling <span class="ot">&lt;-</span> <span class="fu">rsmp</span>(<span class="st">"cv"</span>, <span class="at">folds =</span> <span class="dv">5</span>)</span>
<span id="cb54-13"><a href="#cb54-13"></a>measures <span class="ot">&lt;-</span> <span class="fu">msrs</span>(<span class="fu">c</span>(<span class="st">"classif.acc"</span>, <span class="st">"classif.auc"</span>, <span class="st">"classif.bacc"</span>, <span class="st">"classif.ce"</span>))</span>
<span id="cb54-14"><a href="#cb54-14"></a></span>
<span id="cb54-15"><a href="#cb54-15"></a><span class="co"># 基准测试</span></span>
<span id="cb54-16"><a href="#cb54-16"></a>design <span class="ot">&lt;-</span> <span class="fu">benchmark_grid</span>(</span>
<span id="cb54-17"><a href="#cb54-17"></a>  <span class="at">tasks =</span> task_preprocessed,</span>
<span id="cb54-18"><a href="#cb54-18"></a>  <span class="at">learners =</span> learners,</span>
<span id="cb54-19"><a href="#cb54-19"></a>  <span class="at">resamplings =</span> resampling</span>
<span id="cb54-20"><a href="#cb54-20"></a>)</span>
<span id="cb54-21"><a href="#cb54-21"></a></span>
<span id="cb54-22"><a href="#cb54-22"></a>bmr <span class="ot">&lt;-</span> <span class="fu">benchmark</span>(design,<span class="at">store_backends=</span><span class="cn">TRUE</span>)</span>
<span id="cb54-23"><a href="#cb54-23"></a></span>
<span id="cb54-24"><a href="#cb54-24"></a><span class="co"># 性能评估</span></span>
<span id="cb54-25"><a href="#cb54-25"></a><span class="fu">cat</span>(<span class="st">"模型性能比较:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>模型性能比较:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb56"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1"></a>bmr_aggregated <span class="ot">&lt;-</span> bmr<span class="sc">$</span><span class="fu">aggregate</span>(measures)</span>
<span id="cb56-2"><a href="#cb56-2"></a></span>
<span id="cb56-3"><a href="#cb56-3"></a><span class="co"># 格式化输出结果</span></span>
<span id="cb56-4"><a href="#cb56-4"></a>results_r <span class="ot">&lt;-</span> bmr_aggregated[, .(</span>
<span id="cb56-5"><a href="#cb56-5"></a>  <span class="at">Model =</span> learner_id,</span>
<span id="cb56-6"><a href="#cb56-6"></a>  <span class="at">Accuracy =</span> classif.acc,</span>
<span id="cb56-7"><a href="#cb56-7"></a>  <span class="at">AUC =</span> classif.auc,</span>
<span id="cb56-8"><a href="#cb56-8"></a>  <span class="at">Balanced_Accuracy =</span> classif.bacc,</span>
<span id="cb56-9"><a href="#cb56-9"></a>  <span class="at">LogLoss =</span> classif.ce</span>
<span id="cb56-10"><a href="#cb56-10"></a>)]</span>
<span id="cb56-11"><a href="#cb56-11"></a></span>
<span id="cb56-12"><a href="#cb56-12"></a><span class="fu">print</span>(results_r[<span class="fu">order</span>(<span class="sc">-</span>Accuracy)])</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>           Model  Accuracy   AUC Balanced_Accuracy    LogLoss
          &lt;char&gt;     &lt;num&gt; &lt;num&gt;             &lt;num&gt;      &lt;num&gt;
1: random_forest 0.9600000   NaN         0.9587542 0.04000000
2:           svm 0.9600000   NaN         0.9582492 0.04000000
3:       xgboost 0.9533333   NaN         0.9520875 0.04666667
4:           knn 0.9466667   NaN         0.9460269 0.05333333</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb58"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1"></a><span class="co"># 性能可视化</span></span>
<span id="cb58-2"><a href="#cb58-2"></a><span class="fu">ggplot</span>(results_r, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(Model, Accuracy), <span class="at">y =</span> Accuracy)) <span class="sc">+</span></span>
<span id="cb58-3"><a href="#cb58-3"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">fill =</span> <span class="st">"steelblue"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb58-4"><a href="#cb58-4"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"模型性能比较 (准确率) - R/mlr3"</span>, <span class="at">x =</span> <span class="st">"模型"</span>, <span class="at">y =</span> <span class="st">"准确率"</span>) <span class="sc">+</span></span>
<span id="cb58-5"><a href="#cb58-5"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb58-6"><a href="#cb58-6"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb58-7"><a href="#cb58-7"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>, <span class="dv">1</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="14-分类任务_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>超参数调优</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb59"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1"></a><span class="co"># 超参数调优示例 - 随机森林</span></span>
<span id="cb59-2"><a href="#cb59-2"></a><span class="fu">library</span>(mlr3)           <span class="co"># 核心</span></span>
<span id="cb59-3"><a href="#cb59-3"></a><span class="fu">library</span>(mlr3learners)   <span class="co"># 学习器</span></span>
<span id="cb59-4"><a href="#cb59-4"></a><span class="fu">library</span>(mlr3tuning)     <span class="co"># 参数调优（包含 tnr()）</span></span>
<span id="cb59-5"><a href="#cb59-5"></a><span class="fu">library</span>(paradox)        <span class="co"># 参数空间</span></span>
<span id="cb59-6"><a href="#cb59-6"></a><span class="fu">library</span>(mlr3viz)        <span class="co"># 可视化</span></span>
<span id="cb59-7"><a href="#cb59-7"></a><span class="co"># 定义随机森林学习器</span></span>
<span id="cb59-8"><a href="#cb59-8"></a>learner_rf_tune <span class="ot">&lt;-</span> <span class="fu">lrn</span>(<span class="st">"classif.ranger"</span>, <span class="at">predict_type =</span> <span class="st">"prob"</span>, <span class="at">num.trees =</span> <span class="dv">100</span>)</span>
<span id="cb59-9"><a href="#cb59-9"></a></span>
<span id="cb59-10"><a href="#cb59-10"></a><span class="co"># 定义超参数空间</span></span>
<span id="cb59-11"><a href="#cb59-11"></a>param_set <span class="ot">&lt;-</span> <span class="fu">ps</span>(</span>
<span id="cb59-12"><a href="#cb59-12"></a>  <span class="at">mtry =</span> <span class="fu">p_int</span>(<span class="at">lower =</span> <span class="dv">1</span>, <span class="at">upper =</span> <span class="fu">ncol</span>(iris_data) <span class="sc">-</span> <span class="dv">1</span>),</span>
<span id="cb59-13"><a href="#cb59-13"></a>  <span class="at">min.node.size =</span> <span class="fu">p_int</span>(<span class="at">lower =</span> <span class="dv">1</span>, <span class="at">upper =</span> <span class="dv">10</span>),</span>
<span id="cb59-14"><a href="#cb59-14"></a>  <span class="at">sample.fraction =</span> <span class="fu">p_dbl</span>(<span class="at">lower =</span> <span class="fl">0.6</span>, <span class="at">upper =</span> <span class="fl">0.9</span>)</span>
<span id="cb59-15"><a href="#cb59-15"></a>)</span>
<span id="cb59-16"><a href="#cb59-16"></a></span>
<span id="cb59-17"><a href="#cb59-17"></a><span class="co"># 定义调优器</span></span>
<span id="cb59-18"><a href="#cb59-18"></a>tuner <span class="ot">&lt;-</span> <span class="fu">tnr</span>(<span class="st">"grid_search"</span>, <span class="at">resolution =</span> <span class="dv">5</span>)</span>
<span id="cb59-19"><a href="#cb59-19"></a>terminator <span class="ot">&lt;-</span> <span class="fu">trm</span>(<span class="st">"evals"</span>, <span class="at">n_evals =</span> <span class="dv">10</span>)</span>
<span id="cb59-20"><a href="#cb59-20"></a></span>
<span id="cb59-21"><a href="#cb59-21"></a><span class="co"># 自动调优</span></span>
<span id="cb59-22"><a href="#cb59-22"></a>at <span class="ot">&lt;-</span> <span class="fu">auto_tuner</span>(</span>
<span id="cb59-23"><a href="#cb59-23"></a>  <span class="at">tuner =</span> tuner,</span>
<span id="cb59-24"><a href="#cb59-24"></a>  <span class="at">learner =</span> learner_rf_tune,</span>
<span id="cb59-25"><a href="#cb59-25"></a>  <span class="at">resampling =</span> <span class="fu">rsmp</span>(<span class="st">"holdout"</span>),</span>
<span id="cb59-26"><a href="#cb59-26"></a>  <span class="at">measure =</span> <span class="fu">msr</span>(<span class="st">"classif.ce"</span>),</span>
<span id="cb59-27"><a href="#cb59-27"></a>  <span class="at">search_space =</span> param_set,</span>
<span id="cb59-28"><a href="#cb59-28"></a>  <span class="at">terminator =</span> terminator</span>
<span id="cb59-29"><a href="#cb59-29"></a>)</span>
<span id="cb59-30"><a href="#cb59-30"></a></span>
<span id="cb59-31"><a href="#cb59-31"></a><span class="co"># 在数据上演示调优</span></span>
<span id="cb59-32"><a href="#cb59-32"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb59-33"><a href="#cb59-33"></a>at<span class="sc">$</span><span class="fu">train</span>(task_preprocessed)</span>
<span id="cb59-34"><a href="#cb59-34"></a></span>
<span id="cb59-35"><a href="#cb59-35"></a><span class="fu">cat</span>(<span class="st">"最佳参数:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>最佳参数:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb61"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1"></a><span class="fu">print</span>(at<span class="sc">$</span>tuning_result)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>    mtry min.node.size sample.fraction learner_param_vals  x_domain classif.ce
   &lt;int&gt;         &lt;int&gt;           &lt;num&gt;             &lt;list&gt;    &lt;list&gt;      &lt;num&gt;
1:     2             3             0.6          &lt;list[5]&gt; &lt;list[3]&gt;       0.04</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb63"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1"></a><span class="co"># 使用调优后的模型进行预测</span></span>
<span id="cb63-2"><a href="#cb63-2"></a>predictions_tuned <span class="ot">&lt;-</span> at<span class="sc">$</span><span class="fu">predict</span>(task_preprocessed)</span>
<span id="cb63-3"><a href="#cb63-3"></a><span class="fu">cat</span>(<span class="st">"调优完成</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>调优完成</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb65"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1"></a><span class="fu">cat</span>(<span class="st">"调优后模型准确率:"</span>, predictions_tuned<span class="sc">$</span><span class="fu">score</span>(<span class="fu">msr</span>(<span class="st">"classif.acc"</span>)), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>调优后模型准确率: 0.9733333 </code></pre>
</div>
</div>
<p>模型解释</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb67"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1"></a><span class="co"># 模型解释 - 特征重要性</span></span>
<span id="cb67-2"><a href="#cb67-2"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb67-3"><a href="#cb67-3"></a><span class="co"># 训练最佳模型（随机森林）</span></span>
<span id="cb67-4"><a href="#cb67-4"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb67-5"><a href="#cb67-5"></a>learner_best <span class="ot">&lt;-</span> <span class="fu">lrn</span>(<span class="st">"classif.ranger"</span>, <span class="at">predict_type =</span> <span class="st">"prob"</span>, <span class="at">importance =</span> <span class="st">"permutation"</span>)</span>
<span id="cb67-6"><a href="#cb67-6"></a>learner_best<span class="sc">$</span><span class="fu">train</span>(task_preprocessed)</span>
<span id="cb67-7"><a href="#cb67-7"></a></span>
<span id="cb67-8"><a href="#cb67-8"></a><span class="co"># 特征重要性</span></span>
<span id="cb67-9"><a href="#cb67-9"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(learner_best<span class="sc">$</span>importance)) {</span>
<span id="cb67-10"><a href="#cb67-10"></a>  feature_importance <span class="ot">&lt;-</span> learner_best<span class="sc">$</span><span class="fu">importance</span>()</span>
<span id="cb67-11"><a href="#cb67-11"></a>  importance_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb67-12"><a href="#cb67-12"></a>    <span class="at">Feature =</span> <span class="fu">names</span>(feature_importance),</span>
<span id="cb67-13"><a href="#cb67-13"></a>    <span class="at">Importance =</span> <span class="fu">as.numeric</span>(feature_importance)</span>
<span id="cb67-14"><a href="#cb67-14"></a>  )</span>
<span id="cb67-15"><a href="#cb67-15"></a>  importance_df <span class="ot">&lt;-</span> importance_df[<span class="fu">order</span>(<span class="sc">-</span>importance_df<span class="sc">$</span>Importance), ]</span>
<span id="cb67-16"><a href="#cb67-16"></a>  </span>
<span id="cb67-17"><a href="#cb67-17"></a>  <span class="fu">cat</span>(<span class="st">"特征重要性排序:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb67-18"><a href="#cb67-18"></a>  <span class="fu">print</span>(importance_df)</span>
<span id="cb67-19"><a href="#cb67-19"></a>  </span>
<span id="cb67-20"><a href="#cb67-20"></a>  <span class="co"># 可视化特征重要性</span></span>
<span id="cb67-21"><a href="#cb67-21"></a>  <span class="fu">ggplot</span>(importance_df, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(Feature, Importance), <span class="at">y =</span> Importance)) <span class="sc">+</span></span>
<span id="cb67-22"><a href="#cb67-22"></a>    <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">fill =</span> <span class="st">"darkorange"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb67-23"><a href="#cb67-23"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"特征重要性 - 随机森林"</span>, <span class="at">x =</span> <span class="st">"特征"</span>, <span class="at">y =</span> <span class="st">"重要性"</span>) <span class="sc">+</span></span>
<span id="cb67-24"><a href="#cb67-24"></a>    <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb67-25"><a href="#cb67-25"></a>    <span class="fu">theme_minimal</span>()</span>
<span id="cb67-26"><a href="#cb67-26"></a>} <span class="cf">else</span> {</span>
<span id="cb67-27"><a href="#cb67-27"></a>  <span class="fu">cat</span>(<span class="st">"该学习器不支持特征重要性计算</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb67-28"><a href="#cb67-28"></a>}</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>特征重要性排序:
       Feature  Importance
1  Petal.Width 0.296006354
2 Petal.Length 0.292785833
3 Sepal.Length 0.033216550
4  Sepal.Width 0.006679592</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="14-分类任务_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>模型评估与混淆矩阵</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb69"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1"></a><span class="co"># 模型评估与混淆矩阵</span></span>
<span id="cb69-2"><a href="#cb69-2"></a></span>
<span id="cb69-3"><a href="#cb69-3"></a><span class="co"># 使用最佳模型进行预测</span></span>
<span id="cb69-4"><a href="#cb69-4"></a>predictions <span class="ot">&lt;-</span> learner_best<span class="sc">$</span><span class="fu">predict</span>(task_preprocessed)</span>
<span id="cb69-5"><a href="#cb69-5"></a></span>
<span id="cb69-6"><a href="#cb69-6"></a><span class="co"># 混淆矩阵</span></span>
<span id="cb69-7"><a href="#cb69-7"></a><span class="fu">cat</span>(<span class="st">"混淆矩阵:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>混淆矩阵:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb71"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1"></a><span class="fu">print</span>(predictions<span class="sc">$</span>confusion)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>            truth
response     setosa versicolor virginica
  setosa         50          0         0
  versicolor      0         48         1
  virginica       0          2        49</code></pre>
</div>
</div>
</section><section id="python多分类" class="level2"><h2 class="anchored" data-anchor-id="python多分类">14.5 Python–多分类</h2>
<p>数据加载与探索</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb73"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1"></a><span class="co"># 综合案例：鸢尾花分类 - Python语言实现 (sklearn框架)</span></span>
<span id="cb73-2"><a href="#cb73-2"></a></span>
<span id="cb73-3"><a href="#cb73-3"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb73-4"><a href="#cb73-4"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb73-5"><a href="#cb73-5"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb73-6"><a href="#cb73-6"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb73-7"><a href="#cb73-7"></a><span class="im">from</span> sklearn.datasets <span class="im">import</span> load_iris</span>
<span id="cb73-8"><a href="#cb73-8"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split, cross_val_score, GridSearchCV, StratifiedKFold</span>
<span id="cb73-9"><a href="#cb73-9"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler, LabelEncoder</span>
<span id="cb73-10"><a href="#cb73-10"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LogisticRegression</span>
<span id="cb73-11"><a href="#cb73-11"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> RandomForestClassifier</span>
<span id="cb73-12"><a href="#cb73-12"></a><span class="im">from</span> sklearn.ensemble <span class="im">import</span> GradientBoostingClassifier</span>
<span id="cb73-13"><a href="#cb73-13"></a><span class="im">from</span> sklearn.svm <span class="im">import</span> SVC</span>
<span id="cb73-14"><a href="#cb73-14"></a><span class="im">from</span> sklearn.neighbors <span class="im">import</span> KNeighborsClassifier</span>
<span id="cb73-15"><a href="#cb73-15"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> (accuracy_score, precision_score, recall_score, f1_score, </span>
<span id="cb73-16"><a href="#cb73-16"></a>                           roc_auc_score, confusion_matrix, classification_report, </span>
<span id="cb73-17"><a href="#cb73-17"></a>                           roc_curve, auc)</span>
<span id="cb73-18"><a href="#cb73-18"></a><span class="im">from</span> sklearn.inspection <span class="im">import</span> permutation_importance</span>
<span id="cb73-19"><a href="#cb73-19"></a><span class="im">import</span> warnings</span>
<span id="cb73-20"><a href="#cb73-20"></a>warnings.filterwarnings(<span class="st">'ignore'</span>)</span>
<span id="cb73-21"><a href="#cb73-21"></a></span>
<span id="cb73-22"><a href="#cb73-22"></a><span class="co"># 设置图形样式</span></span>
<span id="cb73-23"><a href="#cb73-23"></a>plt.style.use(<span class="st">'default'</span>)</span>
<span id="cb73-24"><a href="#cb73-24"></a>sns.set_palette(<span class="st">"husl"</span>)</span>
<span id="cb73-25"><a href="#cb73-25"></a></span>
<span id="cb73-26"><a href="#cb73-26"></a><span class="co"># 加载鸢尾花数据集</span></span>
<span id="cb73-27"><a href="#cb73-27"></a>iris <span class="op">=</span> load_iris()</span>
<span id="cb73-28"><a href="#cb73-28"></a>X <span class="op">=</span> pd.DataFrame(iris.data, columns<span class="op">=</span>iris.feature_names)</span>
<span id="cb73-29"><a href="#cb73-29"></a>y <span class="op">=</span> pd.Series(iris.target, name<span class="op">=</span><span class="st">'species'</span>)</span>
<span id="cb73-30"><a href="#cb73-30"></a>iris_data <span class="op">=</span> pd.concat([X, y], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb73-31"><a href="#cb73-31"></a></span>
<span id="cb73-32"><a href="#cb73-32"></a><span class="co"># 映射数字标签到类别名称</span></span>
<span id="cb73-33"><a href="#cb73-33"></a>target_names <span class="op">=</span> iris.target_names</span>
<span id="cb73-34"><a href="#cb73-34"></a>iris_data[<span class="st">'species_name'</span>] <span class="op">=</span> iris_data[<span class="st">'species'</span>].<span class="bu">map</span>(<span class="kw">lambda</span> x: target_names[x])</span>
<span id="cb73-35"><a href="#cb73-35"></a></span>
<span id="cb73-36"><a href="#cb73-36"></a><span class="bu">print</span>(<span class="st">"数据集基本信息:"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>数据集基本信息:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb75"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1"></a><span class="bu">print</span>(<span class="ss">f"样本数: </span><span class="sc">{</span>iris_data<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>样本数: 150</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb77"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1"></a><span class="bu">print</span>(<span class="ss">f"变量数: </span><span class="sc">{</span>iris_data<span class="sc">.</span>shape[<span class="dv">1</span>]<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>变量数: 6</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb79"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">变量名称:"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
变量名称:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb81"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1"></a><span class="bu">print</span>(iris_data.columns.tolist())</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>['sepal length (cm)', 'sepal width (cm)', 'petal length (cm)', 'petal width (cm)', 'species', 'species_name']</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb83"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1"></a><span class="co"># 类别分布</span></span>
<span id="cb83-2"><a href="#cb83-2"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">类别分布:"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
类别分布:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb85"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1"></a>class_dist <span class="op">=</span> iris_data[<span class="st">'species_name'</span>].value_counts()</span>
<span id="cb85-2"><a href="#cb85-2"></a><span class="bu">print</span>(class_dist)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>species_name
setosa        50
versicolor    50
virginica     50
Name: count, dtype: int64</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb87"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">类别比例:"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
类别比例:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb89"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1"></a><span class="bu">print</span>(class_dist <span class="op">/</span> class_dist.<span class="bu">sum</span>())</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>species_name
setosa        0.333333
versicolor    0.333333
virginica     0.333333
Name: count, dtype: float64</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb91"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">数据概览:"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
数据概览:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb93"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1"></a><span class="bu">print</span>(iris_data.describe())</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>       sepal length (cm)  sepal width (cm)  ...  petal width (cm)     species
count         150.000000        150.000000  ...        150.000000  150.000000
mean            5.843333          3.057333  ...          1.199333    1.000000
std             0.828066          0.435866  ...          0.762238    0.819232
min             4.300000          2.000000  ...          0.100000    0.000000
25%             5.100000          2.800000  ...          0.300000    0.000000
50%             5.800000          3.000000  ...          1.300000    1.000000
75%             6.400000          3.300000  ...          1.800000    2.000000
max             7.900000          4.400000  ...          2.500000    2.000000

[8 rows x 5 columns]</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb95"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">缺失值检查:"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
缺失值检查:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb97"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1"></a><span class="bu">print</span>(iris_data.isnull().<span class="bu">sum</span>())</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>sepal length (cm)    0
sepal width (cm)     0
petal length (cm)    0
petal width (cm)     0
species              0
species_name         0
dtype: int64</code></pre>
</div>
</div>
<p>数据可视化分析</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb99"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1"></a><span class="co"># 数据可视化分析 - Python</span></span>
<span id="cb99-2"><a href="#cb99-2"></a></span>
<span id="cb99-3"><a href="#cb99-3"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">12</span>))</span>
<span id="cb99-4"><a href="#cb99-4"></a></span>
<span id="cb99-5"><a href="#cb99-5"></a><span class="co"># 类别分布</span></span>
<span id="cb99-6"><a href="#cb99-6"></a>class_counts <span class="op">=</span> iris_data[<span class="st">'species_name'</span>].value_counts()</span>
<span id="cb99-7"><a href="#cb99-7"></a>axes[<span class="dv">0</span>,<span class="dv">0</span>].bar(class_counts.index, class_counts.values, color<span class="op">=</span>[<span class="st">'steelblue'</span>, <span class="st">'darkorange'</span>, <span class="st">'darkgreen'</span>], alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb99-8"><a href="#cb99-8"></a>axes[<span class="dv">0</span>,<span class="dv">0</span>].set_title(<span class="st">'类别分布'</span>)</span>
<span id="cb99-9"><a href="#cb99-9"></a>axes[<span class="dv">0</span>,<span class="dv">0</span>].set_ylabel(<span class="st">'数量'</span>)</span>
<span id="cb99-10"><a href="#cb99-10"></a>axes[<span class="dv">0</span>,<span class="dv">0</span>].tick_params(axis<span class="op">=</span><span class="st">'x'</span>, rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb99-11"><a href="#cb99-11"></a></span>
<span id="cb99-12"><a href="#cb99-12"></a><span class="co"># 花萼长度与宽度的关系</span></span>
<span id="cb99-13"><a href="#cb99-13"></a>species_colors <span class="op">=</span> {<span class="st">'setosa'</span>: <span class="st">'red'</span>, <span class="st">'versicolor'</span>: <span class="st">'green'</span>, <span class="st">'virginica'</span>: <span class="st">'blue'</span>}</span>
<span id="cb99-14"><a href="#cb99-14"></a><span class="cf">for</span> species <span class="kw">in</span> iris_data[<span class="st">'species_name'</span>].unique():</span>
<span id="cb99-15"><a href="#cb99-15"></a>    species_data <span class="op">=</span> iris_data[iris_data[<span class="st">'species_name'</span>] <span class="op">==</span> species]</span>
<span id="cb99-16"><a href="#cb99-16"></a>    axes[<span class="dv">0</span>,<span class="dv">1</span>].scatter(species_data[<span class="st">'sepal length (cm)'</span>], species_data[<span class="st">'sepal width (cm)'</span>], </span>
<span id="cb99-17"><a href="#cb99-17"></a>                     label<span class="op">=</span>species, alpha<span class="op">=</span><span class="fl">0.7</span>, s<span class="op">=</span><span class="dv">60</span>)</span>
<span id="cb99-18"><a href="#cb99-18"></a>axes[<span class="dv">0</span>,<span class="dv">1</span>].set_title(<span class="st">'花萼长度 vs 宽度'</span>)</span>
<span id="cb99-19"><a href="#cb99-19"></a>axes[<span class="dv">0</span>,<span class="dv">1</span>].set_xlabel(<span class="st">'花萼长度 (cm)'</span>)</span>
<span id="cb99-20"><a href="#cb99-20"></a>axes[<span class="dv">0</span>,<span class="dv">1</span>].set_ylabel(<span class="st">'花萼宽度 (cm)'</span>)</span>
<span id="cb99-21"><a href="#cb99-21"></a>axes[<span class="dv">0</span>,<span class="dv">1</span>].legend()</span>
<span id="cb99-22"><a href="#cb99-22"></a></span>
<span id="cb99-23"><a href="#cb99-23"></a><span class="co"># 花瓣长度与宽度的关系</span></span>
<span id="cb99-24"><a href="#cb99-24"></a><span class="cf">for</span> species <span class="kw">in</span> iris_data[<span class="st">'species_name'</span>].unique():</span>
<span id="cb99-25"><a href="#cb99-25"></a>    species_data <span class="op">=</span> iris_data[iris_data[<span class="st">'species_name'</span>] <span class="op">==</span> species]</span>
<span id="cb99-26"><a href="#cb99-26"></a>    axes[<span class="dv">1</span>,<span class="dv">0</span>].scatter(species_data[<span class="st">'petal length (cm)'</span>], species_data[<span class="st">'petal width (cm)'</span>], </span>
<span id="cb99-27"><a href="#cb99-27"></a>                     label<span class="op">=</span>species, alpha<span class="op">=</span><span class="fl">0.7</span>, s<span class="op">=</span><span class="dv">60</span>)</span>
<span id="cb99-28"><a href="#cb99-28"></a>axes[<span class="dv">1</span>,<span class="dv">0</span>].set_title(<span class="st">'花瓣长度 vs 宽度'</span>)</span>
<span id="cb99-29"><a href="#cb99-29"></a>axes[<span class="dv">1</span>,<span class="dv">0</span>].set_xlabel(<span class="st">'花瓣长度 (cm)'</span>)</span>
<span id="cb99-30"><a href="#cb99-30"></a>axes[<span class="dv">1</span>,<span class="dv">0</span>].set_ylabel(<span class="st">'花瓣宽度 (cm)'</span>)</span>
<span id="cb99-31"><a href="#cb99-31"></a>axes[<span class="dv">1</span>,<span class="dv">0</span>].legend()</span>
<span id="cb99-32"><a href="#cb99-32"></a></span>
<span id="cb99-33"><a href="#cb99-33"></a><span class="co"># 特征分布箱线图</span></span>
<span id="cb99-34"><a href="#cb99-34"></a>feature_data <span class="op">=</span> iris_data.melt(id_vars<span class="op">=</span>[<span class="st">'species_name'</span>], </span>
<span id="cb99-35"><a href="#cb99-35"></a>                             value_vars<span class="op">=</span>[<span class="st">'sepal length (cm)'</span>, <span class="st">'sepal width (cm)'</span>, </span>
<span id="cb99-36"><a href="#cb99-36"></a>                                       <span class="st">'petal length (cm)'</span>, <span class="st">'petal width (cm)'</span>])</span>
<span id="cb99-37"><a href="#cb99-37"></a>sns.boxplot(data<span class="op">=</span>feature_data, x<span class="op">=</span><span class="st">'variable'</span>, y<span class="op">=</span><span class="st">'value'</span>, hue<span class="op">=</span><span class="st">'species_name'</span>, ax<span class="op">=</span>axes[<span class="dv">1</span>,<span class="dv">1</span>])</span>
<span id="cb99-38"><a href="#cb99-38"></a>axes[<span class="dv">1</span>,<span class="dv">1</span>].set_title(<span class="st">'特征分布比较'</span>)</span>
<span id="cb99-39"><a href="#cb99-39"></a>axes[<span class="dv">1</span>,<span class="dv">1</span>].set_xlabel(<span class="st">'特征'</span>)</span>
<span id="cb99-40"><a href="#cb99-40"></a>axes[<span class="dv">1</span>,<span class="dv">1</span>].set_ylabel(<span class="st">'值'</span>)</span>
<span id="cb99-41"><a href="#cb99-41"></a>axes[<span class="dv">1</span>,<span class="dv">1</span>].tick_params(axis<span class="op">=</span><span class="st">'x'</span>, rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb99-42"><a href="#cb99-42"></a>axes[<span class="dv">1</span>,<span class="dv">1</span>].legend(bbox_to_anchor<span class="op">=</span>(<span class="fl">1.05</span>, <span class="dv">1</span>), loc<span class="op">=</span><span class="st">'upper left'</span>)</span>
<span id="cb99-43"><a href="#cb99-43"></a></span>
<span id="cb99-44"><a href="#cb99-44"></a>plt.tight_layout()</span>
<span id="cb99-45"><a href="#cb99-45"></a>plt.show()</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="14-分类任务_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb100"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1"></a><span class="co"># 相关性热图</span></span>
<span id="cb100-2"><a href="#cb100-2"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb100-3"><a href="#cb100-3"></a>corr_matrix <span class="op">=</span> iris_data[[<span class="st">'sepal length (cm)'</span>, <span class="st">'sepal width (cm)'</span>, </span>
<span id="cb100-4"><a href="#cb100-4"></a>                        <span class="st">'petal length (cm)'</span>, <span class="st">'petal width (cm)'</span>, <span class="st">'species'</span>]].corr()</span>
<span id="cb100-5"><a href="#cb100-5"></a>sns.heatmap(corr_matrix, annot<span class="op">=</span><span class="va">True</span>, cmap<span class="op">=</span><span class="st">'coolwarm'</span>, center<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb100-6"><a href="#cb100-6"></a>            square<span class="op">=</span><span class="va">True</span>, linewidths<span class="op">=</span><span class="fl">0.5</span>, cbar_kws<span class="op">=</span>{<span class="st">"shrink"</span>: <span class="fl">0.8</span>}, fmt<span class="op">=</span><span class="st">'.2f'</span>)</span>
<span id="cb100-7"><a href="#cb100-7"></a>plt.title(<span class="st">'变量相关性热图 - Python/sklearn'</span>)</span>
<span id="cb100-8"><a href="#cb100-8"></a>plt.tight_layout()</span>
<span id="cb100-9"><a href="#cb100-9"></a>plt.show()</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="14-分类任务_files/figure-html/unnamed-chunk-15-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>数据预处理</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb101"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1"></a><span class="co"># 数据预处理 - Python</span></span>
<span id="cb101-2"><a href="#cb101-2"></a></span>
<span id="cb101-3"><a href="#cb101-3"></a><span class="co"># 准备特征和目标变量</span></span>
<span id="cb101-4"><a href="#cb101-4"></a>X <span class="op">=</span> iris_data[[<span class="st">'sepal length (cm)'</span>, <span class="st">'sepal width (cm)'</span>, </span>
<span id="cb101-5"><a href="#cb101-5"></a>               <span class="st">'petal length (cm)'</span>, <span class="st">'petal width (cm)'</span>]]</span>
<span id="cb101-6"><a href="#cb101-6"></a>y <span class="op">=</span> iris_data[<span class="st">'species'</span>]</span>
<span id="cb101-7"><a href="#cb101-7"></a></span>
<span id="cb101-8"><a href="#cb101-8"></a><span class="co"># 数据划分（分层抽样保持类别比例）</span></span>
<span id="cb101-9"><a href="#cb101-9"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(</span>
<span id="cb101-10"><a href="#cb101-10"></a>    X, y, test_size<span class="op">=</span><span class="fl">0.3</span>, random_state<span class="op">=</span><span class="dv">42</span>, stratify<span class="op">=</span>y</span>
<span id="cb101-11"><a href="#cb101-11"></a>)</span>
<span id="cb101-12"><a href="#cb101-12"></a></span>
<span id="cb101-13"><a href="#cb101-13"></a><span class="bu">print</span>(<span class="ss">f"训练集大小: </span><span class="sc">{</span>X_train<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>训练集大小: 105</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb103"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1"></a><span class="bu">print</span>(<span class="ss">f"测试集大小: </span><span class="sc">{</span>X_test<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>测试集大小: 45</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb105"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1"></a><span class="bu">print</span>(<span class="ss">f"训练集类别分布:</span><span class="ch">\n</span><span class="sc">{</span>y_train<span class="sc">.</span>value_counts()<span class="sc">.</span>sort_index()<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>训练集类别分布:
species
0    35
1    35
2    35
Name: count, dtype: int64</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb107"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb107-1"><a href="#cb107-1"></a><span class="bu">print</span>(<span class="ss">f"测试集类别分布:</span><span class="ch">\n</span><span class="sc">{</span>y_test<span class="sc">.</span>value_counts()<span class="sc">.</span>sort_index()<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>测试集类别分布:
species
0    15
1    15
2    15
Name: count, dtype: int64</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb109"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1"></a><span class="co"># 数据标准化</span></span>
<span id="cb109-2"><a href="#cb109-2"></a>scaler <span class="op">=</span> StandardScaler()</span>
<span id="cb109-3"><a href="#cb109-3"></a>X_train_scaled <span class="op">=</span> scaler.fit_transform(X_train)</span>
<span id="cb109-4"><a href="#cb109-4"></a>X_test_scaled <span class="op">=</span> scaler.transform(X_test)</span>
<span id="cb109-5"><a href="#cb109-5"></a></span>
<span id="cb109-6"><a href="#cb109-6"></a><span class="bu">print</span>(<span class="st">"数据预处理完成"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>数据预处理完成</code></pre>
</div>
</div>
<p>模型训练与比较</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb111"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb111-1"><a href="#cb111-1"></a><span class="co"># 模型训练与比较 - sklearn</span></span>
<span id="cb111-2"><a href="#cb111-2"></a></span>
<span id="cb111-3"><a href="#cb111-3"></a><span class="co"># 定义模型字典</span></span>
<span id="cb111-4"><a href="#cb111-4"></a>models <span class="op">=</span> {</span>
<span id="cb111-5"><a href="#cb111-5"></a>    <span class="st">'Logistic Regression'</span>: LogisticRegression(random_state<span class="op">=</span><span class="dv">42</span>, max_iter<span class="op">=</span><span class="dv">1000</span>),</span>
<span id="cb111-6"><a href="#cb111-6"></a>    <span class="st">'Random Forest'</span>: RandomForestClassifier(random_state<span class="op">=</span><span class="dv">42</span>),</span>
<span id="cb111-7"><a href="#cb111-7"></a>    <span class="st">'K-Neighbors'</span>: KNeighborsClassifier(),</span>
<span id="cb111-8"><a href="#cb111-8"></a>    <span class="st">'Gradient Boosting'</span>: GradientBoostingClassifier(random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb111-9"><a href="#cb111-9"></a>}</span>
<span id="cb111-10"><a href="#cb111-10"></a></span>
<span id="cb111-11"><a href="#cb111-11"></a><span class="co"># 训练和评估模型</span></span>
<span id="cb111-12"><a href="#cb111-12"></a>results <span class="op">=</span> []</span>
<span id="cb111-13"><a href="#cb111-13"></a></span>
<span id="cb111-14"><a href="#cb111-14"></a><span class="cf">for</span> name, model <span class="kw">in</span> models.items():</span>
<span id="cb111-15"><a href="#cb111-15"></a>    <span class="co"># 训练模型</span></span>
<span id="cb111-16"><a href="#cb111-16"></a>    model.fit(X_train_scaled, y_train)</span>
<span id="cb111-17"><a href="#cb111-17"></a>    </span>
<span id="cb111-18"><a href="#cb111-18"></a>    <span class="co"># 预测</span></span>
<span id="cb111-19"><a href="#cb111-19"></a>    y_pred <span class="op">=</span> model.predict(X_test_scaled)</span>
<span id="cb111-20"><a href="#cb111-20"></a>    y_pred_proba <span class="op">=</span> model.predict_proba(X_test_scaled)</span>
<span id="cb111-21"><a href="#cb111-21"></a>    </span>
<span id="cb111-22"><a href="#cb111-22"></a>    <span class="co"># 计算评估指标</span></span>
<span id="cb111-23"><a href="#cb111-23"></a>    accuracy <span class="op">=</span> accuracy_score(y_test, y_pred)</span>
<span id="cb111-24"><a href="#cb111-24"></a>    precision <span class="op">=</span> precision_score(y_test, y_pred, average<span class="op">=</span><span class="st">'weighted'</span>)</span>
<span id="cb111-25"><a href="#cb111-25"></a>    recall <span class="op">=</span> recall_score(y_test, y_pred, average<span class="op">=</span><span class="st">'weighted'</span>)</span>
<span id="cb111-26"><a href="#cb111-26"></a>    f1 <span class="op">=</span> f1_score(y_test, y_pred, average<span class="op">=</span><span class="st">'weighted'</span>)</span>
<span id="cb111-27"><a href="#cb111-27"></a>    </span>
<span id="cb111-28"><a href="#cb111-28"></a>    <span class="co"># 多类AUC（One-vs-Rest）</span></span>
<span id="cb111-29"><a href="#cb111-29"></a>    <span class="cf">try</span>:</span>
<span id="cb111-30"><a href="#cb111-30"></a>        auc_score <span class="op">=</span> roc_auc_score(y_test, y_pred_proba, multi_class<span class="op">=</span><span class="st">'ovr'</span>)</span>
<span id="cb111-31"><a href="#cb111-31"></a>    <span class="cf">except</span>:</span>
<span id="cb111-32"><a href="#cb111-32"></a>        auc_score <span class="op">=</span> np.nan</span>
<span id="cb111-33"><a href="#cb111-33"></a>    </span>
<span id="cb111-34"><a href="#cb111-34"></a>    <span class="co"># 交叉验证</span></span>
<span id="cb111-35"><a href="#cb111-35"></a>    cv <span class="op">=</span> StratifiedKFold(n_splits<span class="op">=</span><span class="dv">5</span>, shuffle<span class="op">=</span><span class="va">True</span>, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb111-36"><a href="#cb111-36"></a>    cv_scores <span class="op">=</span> cross_val_score(model, X_train_scaled, y_train, cv<span class="op">=</span>cv, scoring<span class="op">=</span><span class="st">'accuracy'</span>)</span>
<span id="cb111-37"><a href="#cb111-37"></a>    cv_accuracy_mean <span class="op">=</span> cv_scores.mean()</span>
<span id="cb111-38"><a href="#cb111-38"></a>    </span>
<span id="cb111-39"><a href="#cb111-39"></a>    results.append({</span>
<span id="cb111-40"><a href="#cb111-40"></a>        <span class="st">'Model'</span>: name,</span>
<span id="cb111-41"><a href="#cb111-41"></a>        <span class="st">'Accuracy'</span>: accuracy,</span>
<span id="cb111-42"><a href="#cb111-42"></a>        <span class="st">'Precision'</span>: precision,</span>
<span id="cb111-43"><a href="#cb111-43"></a>        <span class="st">'Recall'</span>: recall,</span>
<span id="cb111-44"><a href="#cb111-44"></a>        <span class="st">'F1_Score'</span>: f1,</span>
<span id="cb111-45"><a href="#cb111-45"></a>        <span class="st">'AUC'</span>: auc_score,</span>
<span id="cb111-46"><a href="#cb111-46"></a>        <span class="st">'CV_Accuracy'</span>: cv_accuracy_mean</span>
<span id="cb111-47"><a href="#cb111-47"></a>    })</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<style>#sk-container-id-1 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: #000;
  --sklearn-color-text-muted: #666;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-1 {
  color: var(--sklearn-color-text);
}

#sk-container-id-1 pre {
  padding: 0;
}

#sk-container-id-1 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-1 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-1 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-1 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-1 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-1 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-1 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-1 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-1 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-1 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-1 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-1 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-1 label.sk-toggleable__label {
  cursor: pointer;
  display: flex;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
  align-items: start;
  justify-content: space-between;
  gap: 0.5em;
}

#sk-container-id-1 label.sk-toggleable__label .caption {
  font-size: 0.6rem;
  font-weight: lighter;
  color: var(--sklearn-color-text-muted);
}

#sk-container-id-1 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-1 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-1 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-1 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-1 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-1 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-1 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-1 div.sk-label label.sk-toggleable__label,
#sk-container-id-1 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-1 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-1 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-1 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-1 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-1 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-1 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 0.5em;
  text-align: center;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-1 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-1 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-1 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-1 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style>
<div id="sk-container-id-1" class="sk-top-container">
<div class="sk-text-repr-fallback">
<pre>GradientBoostingClassifier(random_state=42)</pre>
<b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b>
</div>
<div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator fitted sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-1" type="checkbox" checked=""><label for="sk-estimator-id-1" class="sk-toggleable__label fitted sk-toggleable__label-arrow"><div><div>GradientBoostingClassifier</div></div>
<div>
<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.6/modules/generated/sklearn.ensemble.GradientBoostingClassifier.html">?<span>Documentation for GradientBoostingClassifier</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span>
</div></label><div class="sk-toggleable__content fitted"><pre>GradientBoostingClassifier(random_state=42)</pre></div> </div></div></div>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb112"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb112-1"><a href="#cb112-1"></a><span class="co"># 创建结果DataFrame</span></span>
<span id="cb112-2"><a href="#cb112-2"></a>results_python <span class="op">=</span> pd.DataFrame(results)</span>
<span id="cb112-3"><a href="#cb112-3"></a><span class="bu">print</span>(<span class="st">"模型性能比较 - Python/sklearn:"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>模型性能比较 - Python/sklearn:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb114"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb114-1"><a href="#cb114-1"></a><span class="bu">print</span>(results_python.sort_values(<span class="st">'Accuracy'</span>, ascending<span class="op">=</span><span class="va">False</span>))</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>                 Model  Accuracy  Precision  ...  F1_Score       AUC  CV_Accuracy
3    Gradient Boosting  0.933333   0.944444  ...  0.932660  0.998519     0.961905
0  Logistic Regression  0.911111   0.915535  ...  0.910714  0.995556     0.980952
2          K-Neighbors  0.911111   0.929825  ...  0.909502  0.988889     0.942857
1        Random Forest  0.888889   0.898148  ...  0.887767  0.992593     0.952381

[4 rows x 7 columns]</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb116"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb116-1"><a href="#cb116-1"></a><span class="co"># 可视化模型比较</span></span>
<span id="cb116-2"><a href="#cb116-2"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">10</span>))</span>
<span id="cb116-3"><a href="#cb116-3"></a></span>
<span id="cb116-4"><a href="#cb116-4"></a><span class="co"># 准确率比较</span></span>
<span id="cb116-5"><a href="#cb116-5"></a>models_sorted_acc <span class="op">=</span> results_python.sort_values(<span class="st">'Accuracy'</span>)</span>
<span id="cb116-6"><a href="#cb116-6"></a>axes[<span class="dv">0</span>,<span class="dv">0</span>].barh(models_sorted_acc[<span class="st">'Model'</span>], models_sorted_acc[<span class="st">'Accuracy'</span>], color<span class="op">=</span><span class="st">'steelblue'</span>)</span>
<span id="cb116-7"><a href="#cb116-7"></a>axes[<span class="dv">0</span>,<span class="dv">0</span>].set_xlabel(<span class="st">'准确率'</span>)</span>
<span id="cb116-8"><a href="#cb116-8"></a>axes[<span class="dv">0</span>,<span class="dv">0</span>].set_title(<span class="st">'模型准确率比较 - Python/sklearn'</span>)</span>
<span id="cb116-9"><a href="#cb116-9"></a>axes[<span class="dv">0</span>,<span class="dv">0</span>].set_xlim(<span class="fl">0.8</span>, <span class="fl">1.0</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>(0.8, 1.0)</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb118"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb118-1"><a href="#cb118-1"></a>axes[<span class="dv">0</span>,<span class="dv">0</span>].grid(axis<span class="op">=</span><span class="st">'x'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb118-2"><a href="#cb118-2"></a></span>
<span id="cb118-3"><a href="#cb118-3"></a><span class="co"># F1分数比较</span></span>
<span id="cb118-4"><a href="#cb118-4"></a>models_sorted_f1 <span class="op">=</span> results_python.sort_values(<span class="st">'F1_Score'</span>)</span>
<span id="cb118-5"><a href="#cb118-5"></a>axes[<span class="dv">0</span>,<span class="dv">1</span>].barh(models_sorted_f1[<span class="st">'Model'</span>], models_sorted_f1[<span class="st">'F1_Score'</span>], color<span class="op">=</span><span class="st">'darkorange'</span>)</span>
<span id="cb118-6"><a href="#cb118-6"></a>axes[<span class="dv">0</span>,<span class="dv">1</span>].set_xlabel(<span class="st">'F1分数'</span>)</span>
<span id="cb118-7"><a href="#cb118-7"></a>axes[<span class="dv">0</span>,<span class="dv">1</span>].set_title(<span class="st">'模型F1分数比较 - Python/sklearn'</span>)</span>
<span id="cb118-8"><a href="#cb118-8"></a>axes[<span class="dv">0</span>,<span class="dv">1</span>].set_xlim(<span class="fl">0.8</span>, <span class="fl">1.0</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>(0.8, 1.0)</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb120"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb120-1"><a href="#cb120-1"></a>axes[<span class="dv">0</span>,<span class="dv">1</span>].grid(axis<span class="op">=</span><span class="st">'x'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb120-2"><a href="#cb120-2"></a></span>
<span id="cb120-3"><a href="#cb120-3"></a><span class="co"># AUC比较</span></span>
<span id="cb120-4"><a href="#cb120-4"></a>models_sorted_auc <span class="op">=</span> results_python.sort_values(<span class="st">'AUC'</span>)</span>
<span id="cb120-5"><a href="#cb120-5"></a>axes[<span class="dv">1</span>,<span class="dv">0</span>].barh(models_sorted_auc[<span class="st">'Model'</span>], models_sorted_auc[<span class="st">'AUC'</span>], color<span class="op">=</span><span class="st">'darkgreen'</span>)</span>
<span id="cb120-6"><a href="#cb120-6"></a>axes[<span class="dv">1</span>,<span class="dv">0</span>].set_xlabel(<span class="st">'AUC'</span>)</span>
<span id="cb120-7"><a href="#cb120-7"></a>axes[<span class="dv">1</span>,<span class="dv">0</span>].set_title(<span class="st">'模型AUC比较 - Python/sklearn'</span>)</span>
<span id="cb120-8"><a href="#cb120-8"></a>axes[<span class="dv">1</span>,<span class="dv">0</span>].set_xlim(<span class="fl">0.8</span>, <span class="fl">1.0</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>(0.8, 1.0)</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb122"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb122-1"><a href="#cb122-1"></a>axes[<span class="dv">1</span>,<span class="dv">0</span>].grid(axis<span class="op">=</span><span class="st">'x'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb122-2"><a href="#cb122-2"></a></span>
<span id="cb122-3"><a href="#cb122-3"></a><span class="co"># 交叉验证准确率比较</span></span>
<span id="cb122-4"><a href="#cb122-4"></a>models_sorted_cv <span class="op">=</span> results_python.sort_values(<span class="st">'CV_Accuracy'</span>)</span>
<span id="cb122-5"><a href="#cb122-5"></a>axes[<span class="dv">1</span>,<span class="dv">1</span>].barh(models_sorted_cv[<span class="st">'Model'</span>], models_sorted_cv[<span class="st">'CV_Accuracy'</span>], color<span class="op">=</span><span class="st">'darkred'</span>)</span>
<span id="cb122-6"><a href="#cb122-6"></a>axes[<span class="dv">1</span>,<span class="dv">1</span>].set_xlabel(<span class="st">'交叉验证准确率'</span>)</span>
<span id="cb122-7"><a href="#cb122-7"></a>axes[<span class="dv">1</span>,<span class="dv">1</span>].set_title(<span class="st">'交叉验证准确率比较 - Python/sklearn'</span>)</span>
<span id="cb122-8"><a href="#cb122-8"></a>axes[<span class="dv">1</span>,<span class="dv">1</span>].set_xlim(<span class="fl">0.8</span>, <span class="fl">1.0</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>(0.8, 1.0)</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb124"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb124-1"><a href="#cb124-1"></a>axes[<span class="dv">1</span>,<span class="dv">1</span>].grid(axis<span class="op">=</span><span class="st">'x'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb124-2"><a href="#cb124-2"></a></span>
<span id="cb124-3"><a href="#cb124-3"></a>plt.tight_layout()</span>
<span id="cb124-4"><a href="#cb124-4"></a>plt.show()</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="14-分类任务_files/figure-html/unnamed-chunk-17-5.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>详细模型评估</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb125"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb125-1"><a href="#cb125-1"></a><span class="co"># 详细模型评估 - 最佳模型</span></span>
<span id="cb125-2"><a href="#cb125-2"></a></span>
<span id="cb125-3"><a href="#cb125-3"></a><span class="co"># 选择最佳模型（基于准确率）</span></span>
<span id="cb125-4"><a href="#cb125-4"></a>best_model_name <span class="op">=</span> results_python.loc[results_python[<span class="st">'Accuracy'</span>].idxmax(), <span class="st">'Model'</span>]</span>
<span id="cb125-5"><a href="#cb125-5"></a>best_model <span class="op">=</span> models[best_model_name]</span>
<span id="cb125-6"><a href="#cb125-6"></a></span>
<span id="cb125-7"><a href="#cb125-7"></a><span class="bu">print</span>(<span class="ss">f"最佳模型: </span><span class="sc">{</span>best_model_name<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>最佳模型: Gradient Boosting</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb127"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb127-1"><a href="#cb127-1"></a><span class="co"># 重新训练最佳模型</span></span>
<span id="cb127-2"><a href="#cb127-2"></a>best_model.fit(X_train_scaled, y_train)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<style>#sk-container-id-2 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: #000;
  --sklearn-color-text-muted: #666;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-2 {
  color: var(--sklearn-color-text);
}

#sk-container-id-2 pre {
  padding: 0;
}

#sk-container-id-2 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-2 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-2 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-2 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-2 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-2 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-2 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-2 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-2 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-2 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-2 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-2 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-2 label.sk-toggleable__label {
  cursor: pointer;
  display: flex;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
  align-items: start;
  justify-content: space-between;
  gap: 0.5em;
}

#sk-container-id-2 label.sk-toggleable__label .caption {
  font-size: 0.6rem;
  font-weight: lighter;
  color: var(--sklearn-color-text-muted);
}

#sk-container-id-2 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-2 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-2 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-2 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-2 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-2 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-2 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-2 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-2 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-2 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-2 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-2 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-2 div.sk-label label.sk-toggleable__label,
#sk-container-id-2 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-2 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-2 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-2 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-2 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-2 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-2 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-2 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-2 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 0.5em;
  text-align: center;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-2 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-2 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-2 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-2 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style>
<div id="sk-container-id-2" class="sk-top-container">
<div class="sk-text-repr-fallback">
<pre>GradientBoostingClassifier(random_state=42)</pre>
<b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b>
</div>
<div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator fitted sk-toggleable">
<input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-2" type="checkbox" checked=""><label for="sk-estimator-id-2" class="sk-toggleable__label fitted sk-toggleable__label-arrow"><div><div>GradientBoostingClassifier</div></div>
<div>
<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.6/modules/generated/sklearn.ensemble.GradientBoostingClassifier.html">?<span>Documentation for GradientBoostingClassifier</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span>
</div></label><div class="sk-toggleable__content fitted"><pre>GradientBoostingClassifier(random_state=42)</pre></div> </div></div></div>
</div>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb128"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb128-1"><a href="#cb128-1"></a><span class="co"># 预测</span></span>
<span id="cb128-2"><a href="#cb128-2"></a>y_pred_best <span class="op">=</span> best_model.predict(X_test_scaled)</span>
<span id="cb128-3"><a href="#cb128-3"></a>y_pred_proba_best <span class="op">=</span> best_model.predict_proba(X_test_scaled)</span>
<span id="cb128-4"><a href="#cb128-4"></a></span>
<span id="cb128-5"><a href="#cb128-5"></a><span class="co"># 混淆矩阵</span></span>
<span id="cb128-6"><a href="#cb128-6"></a>cm <span class="op">=</span> confusion_matrix(y_test, y_pred_best)</span>
<span id="cb128-7"><a href="#cb128-7"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">混淆矩阵:"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
混淆矩阵:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb130"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb130-1"><a href="#cb130-1"></a><span class="bu">print</span>(cm)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[15  0  0]
 [ 0 15  0]
 [ 0  3 12]]</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb132"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb132-1"><a href="#cb132-1"></a><span class="co"># 分类报告</span></span>
<span id="cb132-2"><a href="#cb132-2"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">分类报告:"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
分类报告:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb134"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb134-1"><a href="#cb134-1"></a><span class="bu">print</span>(classification_report(y_test, y_pred_best, target_names<span class="op">=</span>target_names))</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>              precision    recall  f1-score   support

      setosa       1.00      1.00      1.00        15
  versicolor       0.83      1.00      0.91        15
   virginica       1.00      0.80      0.89        15

    accuracy                           0.93        45
   macro avg       0.94      0.93      0.93        45
weighted avg       0.94      0.93      0.93        45</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb136"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb136-1"><a href="#cb136-1"></a><span class="co"># 可视化混淆矩阵</span></span>
<span id="cb136-2"><a href="#cb136-2"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb136-3"><a href="#cb136-3"></a>sns.heatmap(cm, annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">'d'</span>, cmap<span class="op">=</span><span class="st">'Blues'</span>, </span>
<span id="cb136-4"><a href="#cb136-4"></a>            xticklabels<span class="op">=</span>target_names, yticklabels<span class="op">=</span>target_names)</span>
<span id="cb136-5"><a href="#cb136-5"></a>plt.title(<span class="ss">f'混淆矩阵 - </span><span class="sc">{</span>best_model_name<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb136-6"><a href="#cb136-6"></a>plt.xlabel(<span class="st">'预测标签'</span>)</span>
<span id="cb136-7"><a href="#cb136-7"></a>plt.ylabel(<span class="st">'真实标签'</span>)</span>
<span id="cb136-8"><a href="#cb136-8"></a>plt.tight_layout()</span>
<span id="cb136-9"><a href="#cb136-9"></a>plt.show()</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="14-分类任务_files/figure-html/unnamed-chunk-18-7.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>特征重要性分析</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb137"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb137-1"><a href="#cb137-1"></a><span class="co"># 特征重要性分析 - Python</span></span>
<span id="cb137-2"><a href="#cb137-2"></a></span>
<span id="cb137-3"><a href="#cb137-3"></a><span class="cf">if</span> <span class="bu">hasattr</span>(best_model, <span class="st">'feature_importances_'</span>):</span>
<span id="cb137-4"><a href="#cb137-4"></a>    feature_importance <span class="op">=</span> best_model.feature_importances_</span>
<span id="cb137-5"><a href="#cb137-5"></a>    feature_names <span class="op">=</span> X.columns</span>
<span id="cb137-6"><a href="#cb137-6"></a>    </span>
<span id="cb137-7"><a href="#cb137-7"></a>    <span class="co"># 创建特征重要性DataFrame</span></span>
<span id="cb137-8"><a href="#cb137-8"></a>    importance_df <span class="op">=</span> pd.DataFrame({</span>
<span id="cb137-9"><a href="#cb137-9"></a>        <span class="st">'Feature'</span>: feature_names,</span>
<span id="cb137-10"><a href="#cb137-10"></a>        <span class="st">'Importance'</span>: feature_importance</span>
<span id="cb137-11"><a href="#cb137-11"></a>    }).sort_values(<span class="st">'Importance'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb137-12"><a href="#cb137-12"></a>    </span>
<span id="cb137-13"><a href="#cb137-13"></a>    <span class="bu">print</span>(<span class="st">"特征重要性排序 - Python/sklearn:"</span>)</span>
<span id="cb137-14"><a href="#cb137-14"></a>    <span class="bu">print</span>(importance_df)</span>
<span id="cb137-15"><a href="#cb137-15"></a>    </span>
<span id="cb137-16"><a href="#cb137-16"></a>    <span class="co"># 可视化特征重要性</span></span>
<span id="cb137-17"><a href="#cb137-17"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb137-18"><a href="#cb137-18"></a>    sns.barplot(data<span class="op">=</span>importance_df, x<span class="op">=</span><span class="st">'Importance'</span>, y<span class="op">=</span><span class="st">'Feature'</span>, palette<span class="op">=</span><span class="st">'viridis'</span>)</span>
<span id="cb137-19"><a href="#cb137-19"></a>    plt.title(<span class="ss">f'特征重要性 - </span><span class="sc">{</span>best_model_name<span class="sc">}</span><span class="ss"> (Python/sklearn)'</span>)</span>
<span id="cb137-20"><a href="#cb137-20"></a>    plt.xlabel(<span class="st">'重要性'</span>)</span>
<span id="cb137-21"><a href="#cb137-21"></a>    plt.tight_layout()</span>
<span id="cb137-22"><a href="#cb137-22"></a>    plt.show()</span>
<span id="cb137-23"><a href="#cb137-23"></a></span>
<span id="cb137-24"><a href="#cb137-24"></a><span class="cf">else</span>:</span>
<span id="cb137-25"><a href="#cb137-25"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>best_model_name<span class="sc">}</span><span class="ss"> 不支持特征重要性计算"</span>)</span>
<span id="cb137-26"><a href="#cb137-26"></a>    </span>
<span id="cb137-27"><a href="#cb137-27"></a>    <span class="co"># 使用排列重要性作为替代</span></span>
<span id="cb137-28"><a href="#cb137-28"></a>    perm_importance <span class="op">=</span> permutation_importance(</span>
<span id="cb137-29"><a href="#cb137-29"></a>        best_model, X_test_scaled, y_test, n_repeats<span class="op">=</span><span class="dv">10</span>, random_state<span class="op">=</span><span class="dv">42</span></span>
<span id="cb137-30"><a href="#cb137-30"></a>    )</span>
<span id="cb137-31"><a href="#cb137-31"></a>    </span>
<span id="cb137-32"><a href="#cb137-32"></a>    perm_importance_df <span class="op">=</span> pd.DataFrame({</span>
<span id="cb137-33"><a href="#cb137-33"></a>        <span class="st">'Feature'</span>: feature_names,</span>
<span id="cb137-34"><a href="#cb137-34"></a>        <span class="st">'Importance'</span>: perm_importance.importances_mean</span>
<span id="cb137-35"><a href="#cb137-35"></a>    }).sort_values(<span class="st">'Importance'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb137-36"><a href="#cb137-36"></a>    </span>
<span id="cb137-37"><a href="#cb137-37"></a>    <span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">排列特征重要性:"</span>)</span>
<span id="cb137-38"><a href="#cb137-38"></a>    <span class="bu">print</span>(perm_importance_df)</span>
<span id="cb137-39"><a href="#cb137-39"></a>    </span>
<span id="cb137-40"><a href="#cb137-40"></a>    <span class="co"># 可视化排列重要性</span></span>
<span id="cb137-41"><a href="#cb137-41"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb137-42"><a href="#cb137-42"></a>    sns.barplot(data<span class="op">=</span>perm_importance_df, x<span class="op">=</span><span class="st">'Importance'</span>, y<span class="op">=</span><span class="st">'Feature'</span>, palette<span class="op">=</span><span class="st">'rocket'</span>)</span>
<span id="cb137-43"><a href="#cb137-43"></a>    plt.title(<span class="ss">f'排列特征重要性 - </span><span class="sc">{</span>best_model_name<span class="sc">}</span><span class="ss"> (Python/sklearn)'</span>)</span>
<span id="cb137-44"><a href="#cb137-44"></a>    plt.xlabel(<span class="st">'重要性'</span>)</span>
<span id="cb137-45"><a href="#cb137-45"></a>    plt.tight_layout()</span>
<span id="cb137-46"><a href="#cb137-46"></a>    plt.show()</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="14-分类任务_files/figure-html/unnamed-chunk-19-9.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section><section id="多分类案例总结" class="level2"><h2 class="anchored" data-anchor-id="多分类案例总结">14.6 多分类案例总结</h2>
<p>关键发现</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb138"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1"></a><span class="co"># 案例总结 - R语言</span></span>
<span id="cb138-2"><a href="#cb138-2"></a><span class="fu">cat</span>(<span class="st">"=== 鸢尾花分类案例总结 ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== 鸢尾花分类案例总结 ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb140"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1"></a><span class="fu">cat</span>(<span class="st">"1. 数据特征:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>1. 数据特征:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb142"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1"></a><span class="fu">cat</span>(<span class="st">"   - 数据集包含"</span>, <span class="fu">nrow</span>(iris_data), <span class="st">"个样本，"</span>, <span class="fu">ncol</span>(iris_data)<span class="sc">-</span><span class="dv">1</span>, <span class="st">"个特征</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   - 数据集包含 150 个样本， 4 个特征</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb144"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1"></a><span class="fu">cat</span>(<span class="st">"   - 目标变量: 鸢尾花种类(3个类别)</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   - 目标变量: 鸢尾花种类(3个类别)</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb146"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1"></a><span class="fu">cat</span>(<span class="st">"   - 类别分布均衡</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   - 类别分布均衡</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb148"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1"></a><span class="fu">cat</span>(<span class="st">"   - 最重要的特征: 花瓣长度和宽度</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   - 最重要的特征: 花瓣长度和宽度</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb150"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1"></a><span class="fu">cat</span>(<span class="st">"2. 模型性能比较:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>2. 模型性能比较:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb152"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1"></a><span class="fu">print</span>(results_r[<span class="fu">order</span>(<span class="sc">-</span>Accuracy)])</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>           Model  Accuracy   AUC Balanced_Accuracy    LogLoss
          &lt;char&gt;     &lt;num&gt; &lt;num&gt;             &lt;num&gt;      &lt;num&gt;
1: random_forest 0.9600000   NaN         0.9587542 0.04000000
2:           svm 0.9600000   NaN         0.9582492 0.04000000
3:       xgboost 0.9533333   NaN         0.9520875 0.04666667
4:           knn 0.9466667   NaN         0.9460269 0.05333333</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb154"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">3. 分类问题最佳实践:</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
3. 分类问题最佳实践:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb156"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1"></a><span class="fu">cat</span>(<span class="st">"   - 树模型和SVM在分类问题上表现优异</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   - 树模型和SVM在分类问题上表现优异</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb158"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1"></a><span class="fu">cat</span>(<span class="st">"   - 特征标准化对距离-based模型很重要</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   - 特征标准化对距离-based模型很重要</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb160"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1"></a><span class="fu">cat</span>(<span class="st">"   - 多分类问题需要考虑合适的评估指标</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   - 多分类问题需要考虑合适的评估指标</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb162"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1"></a><span class="fu">cat</span>(<span class="st">"   - 特征重要性分析有助于理解模型决策</span><span class="sc">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   - 特征重要性分析有助于理解模型决策</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb164"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb164-1"><a href="#cb164-1"></a><span class="co"># 案例总结 - Python</span></span>
<span id="cb164-2"><a href="#cb164-2"></a><span class="bu">print</span>(<span class="st">"=== 鸢尾花分类案例总结 ==="</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>=== 鸢尾花分类案例总结 ===</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb166"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb166-1"><a href="#cb166-1"></a><span class="bu">print</span>(<span class="st">"1. 数据特征:"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>1. 数据特征:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb168"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb168-1"><a href="#cb168-1"></a><span class="bu">print</span>(<span class="ss">f"   - 数据集包含 </span><span class="sc">{</span>iris_data<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">}</span><span class="ss"> 个样本，</span><span class="sc">{</span>iris_data<span class="sc">.</span>shape[<span class="dv">1</span>]<span class="op">-</span><span class="dv">1</span><span class="sc">}</span><span class="ss"> 个特征"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   - 数据集包含 150 个样本，5 个特征</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb170"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb170-1"><a href="#cb170-1"></a><span class="bu">print</span>(<span class="st">"   - 目标变量: 鸢尾花种类(3个类别)"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   - 目标变量: 鸢尾花种类(3个类别)</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb172"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb172-1"><a href="#cb172-1"></a><span class="bu">print</span>(<span class="st">"   - 类别分布均衡"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   - 类别分布均衡</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb174"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb174-1"><a href="#cb174-1"></a><span class="bu">print</span>(<span class="st">"   - 最重要的特征: 花瓣长度和宽度</span><span class="ch">\n</span><span class="st">"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   - 最重要的特征: 花瓣长度和宽度</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb176"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb176-1"><a href="#cb176-1"></a><span class="bu">print</span>(<span class="st">"2. 模型性能比较:"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>2. 模型性能比较:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb178"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb178-1"><a href="#cb178-1"></a><span class="bu">print</span>(results_python[[<span class="st">'Model'</span>, <span class="st">'Accuracy'</span>, <span class="st">'F1_Score'</span>, <span class="st">'AUC'</span>]].sort_values(<span class="st">'Accuracy'</span>, ascending<span class="op">=</span><span class="va">False</span>).to_string(index<span class="op">=</span><span class="va">False</span>))</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>              Model  Accuracy  F1_Score      AUC
  Gradient Boosting  0.933333  0.932660 0.998519
Logistic Regression  0.911111  0.910714 0.995556
        K-Neighbors  0.911111  0.909502 0.988889
      Random Forest  0.888889  0.887767 0.992593</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb180"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb180-1"><a href="#cb180-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">3. 分类问题最佳实践:"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
3. 分类问题最佳实践:</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb182"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb182-1"><a href="#cb182-1"></a><span class="bu">print</span>(<span class="st">"   - 集成学习方法在分类问题上表现稳定"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   - 集成学习方法在分类问题上表现稳定</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb184"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb184-1"><a href="#cb184-1"></a><span class="bu">print</span>(<span class="st">"   - 数据预处理对模型性能影响显著"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   - 数据预处理对模型性能影响显著</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb186"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb186-1"><a href="#cb186-1"></a><span class="bu">print</span>(<span class="st">"   - 交叉验证提供更可靠的性能估计"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   - 交叉验证提供更可靠的性能估计</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb188"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb188-1"><a href="#cb188-1"></a><span class="bu">print</span>(<span class="st">"   - 混淆矩阵和分类报告提供详细性能分析"</span>)</span></code></pre></div><button title="复制到剪贴板" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   - 混淆矩阵和分类报告提供详细性能分析</code></pre>
</div>
</div>
<p>技术要点回顾</p>
<p><strong>数据预处理</strong>： - 特征标准化：确保不同尺度的特征具有可比性 - 类别编码：将文本标签转换为数值 - 数据划分：使用分层抽样保持类别比例</p>
<p><strong>模型选择</strong>： - 逻辑回归：可解释性强，适合线性可分数据 - 树模型：自动处理非线性关系，提供特征重要性 - SVM：在高维空间中表现优异 - KNN：基于距离的简单有效方法</p>
<p><strong>模型评估</strong>： - 准确率：整体分类正确率 - 精确率、召回率、F1分数：更细致的性能评估 - AUC：模型区分能力的综合指标 - 混淆矩阵：详细分析各类别的分类情况</p>
<p><strong>模型优化</strong>： - 超参数调优：提升模型性能 - 特征选择：基于重要性筛选特征 - 交叉验证：稳健的性能估计</p>
<p>业务应用建议</p>
<ul>
<li><p>物种识别：扩展到其他植物或动物的分类识别</p></li>
<li><p>质量检测：应用于工业产品质量分类</p></li>
<li><p>医疗诊断：用于疾病分类和诊断辅助</p></li>
<li><p>客户细分：用于市场营销中的客户分类</p></li>
</ul>


</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "已复制");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "已复制");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="../chapters/13 回归任务与基准测试.html" class="pagination-link" aria-label="13 回归任务与基准测试">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-title">13 回归任务与基准测试</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../chapters/15 案例综合分析.html" class="pagination-link" aria-label="15 案例综合分析">
        <span class="nav-page-text"><span class="chapter-title">15 案例综合分析</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>