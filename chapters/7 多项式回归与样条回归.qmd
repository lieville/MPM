---
title: "多项式与样条回归"
format: html
editor: visual
---

## 本章导读

在现实世界中，变量之间的关系往往不是简单的直线关系。当我们发现线性模型无法很好地描述数据模式时，就需要考虑非线性关系。本章将介绍两种重要的非线性建模方法：多项式回归和样条回归。这些方法在线性模型的框架基础上，通过数学变换来捕捉复杂的曲线关系，既保持了线性模型的 interpretability，又具备了处理非线性模式的能力。

## 7.1 多项式回归

### 7.1.1 基本概念与模型设定

多项式回归是线性回归的自然扩展，通过引入自变量的高次项来捕捉非线性关系。

一元d次多项式模型： $$
y_i = \beta_0 + \beta_1 x_i + \beta_2 x_i^2 + \cdots + \beta_d x_i^d + \varepsilon_i
$$

矩阵表示： 设计矩阵包含自变量的各次幂： $$
\mathbf{X} = \begin{pmatrix}
1 & x_1 & x_1^2 & \cdots & x_1^d \\
1 & x_2 & x_2^2 & \cdots & x_2^d \\
\vdots & \vdots & \vdots & \ddots & \vdots \\
1 & x_n & x_n^2 & \cdots & x_n^d
\end{pmatrix}
$$

模型仍可表示为： $$
\mathbf{y} = \mathbf{X}\boldsymbol{\beta} + \boldsymbol{\varepsilon}
$$

重要理解：虽然模型包含了自变量的非线性函数，但由于参数 $\beta_j$ 是以线性形式出现的，这仍然是一个线性模型，可以使用最小二乘法进行估计。

### 7.1.2 正交多项式：解决数值稳定性问题

#### 问题的产生

当多项式阶数较高时，普通多项式基会面临严重的数值问题：

1.  多重共线性：$x^j$ 和 $x^k$ 之间高度相关
2.  矩阵病态：$\mathbf{X}'\mathbf{X}$ 的条件数很大
3.  估计不稳定：参数估计对数据微小变化敏感

#### 正交多项式的概念

正交多项式通过构造一组相互正交的基函数来解决上述问题。

离散正交条件： 对于样本点 $x_1, \ldots, x_n$，要求： $$
\sum_{i=1}^n Q_j(x_i)Q_k(x_i) = 0 \quad \text{当 } j \neq k
$$

正交多项式回归模型： $$
y_i = \alpha_0 Q_0(x_i) + \alpha_1 Q_1(x_i) + \cdots + \alpha_d Q_d(x_i) + \varepsilon_i
$$

#### 主要正交多项式族

Legendre多项式（区间 $[-1,1]$）： 前几项为： $$
\begin{aligned}
P_0(x) &= 1 \\
P_1(x) &= x \\
P_2(x) &= \frac{1}{2}(3x^2 - 1) \\
P_3(x) &= \frac{1}{2}(5x^3 - 3x)
\end{aligned}
$$

递推关系： $$
(n+1)P_{n+1}(x) = (2n+1)xP_n(x) - nP_{n-1}(x)
$$

Chebyshev多项式（最小化最大误差）： $$
T_n(x) = \cos(n \arccos x)
$$

#### 正交多项式的优势

1.  数值稳定性：消除多重共线性
2.  计算简化：参数估计相互独立
3.  解释清晰：各项贡献可分离
4.  模型选择：可以逐步添加项

### 7.1.3 多项式阶数选择

选择合适的多项式阶数至关重要，需要在偏差和方差之间取得平衡。

交叉验证方法： $$
CV(d) = \frac{1}{n}\sum_{i=1}^n (y_i - \hat{y}_i^{(-i)}(d))^2
$$

信息准则： - AIC：$AIC(d) = n\ln(\hat{\sigma}^2_d) + 2(d+1)$ - BIC：$BIC(d) = n\ln(\hat{\sigma}^2_d) + (d+1)\ln(n)$

假设检验方法： 使用F检验比较相邻阶数的模型： $$
F = \frac{(RSS_d - RSS_{d+1})/(1)}{RSS_{d+1}/(n-d-2)}
$$

实践建议：通常多项式的阶数不超过5，高阶多项式容易产生过拟合和数值不稳定问题。

## 7.2 变量变换方法

### 7.2.1 Box-Cox变换

Box-Cox变换通过对响应变量进行幂变换，使其更接近正态分布并稳定方差。

变换族定义： $$
y^{(\lambda)} = \begin{cases}
\dfrac{y^\lambda - 1}{\lambda} & \lambda \neq 0 \\
\ln y & \lambda = 0
\end{cases}
$$

参数选择： 通过最大化轮廓似然函数选择 $\lambda$： $$
L_{\text{max}}(\lambda) = -\frac{n}{2} \ln(RSS(\lambda)/n) + (\lambda-1)\sum_{i=1}^n \ln y_i
$$

### 7.2.2 其他常用变换

对数变换： 适用于右偏分布和方差随均值增大的情况： $$
y^* = \ln(y)
$$

平方根变换： 适用于泊松分布的计数数据： $$
y^* = \sqrt{y}
$$

逻辑变换： 适用于比例数据： $$
y^* = \ln\left(\frac{y}{1-y}\right)
$$

## 7.3 样条回归

### 7.3.1 基本概念与动机

样条回归通过分段多项式拟合来提供更灵活的曲线拟合。

节点：分段的位置点 $\xi_1 < \xi_2 < \cdots < \xi_K$

分段多项式： $$
f(x) = \begin{cases}
f_1(x) & x \leq \xi_1 \\
f_2(x) & \xi_1 < x \leq \xi_2 \\
\vdots & \vdots \\
f_{K+1}(x) & x > \xi_K
\end{cases}
$$

### 7.3.2 三次样条回归

三次样条是最常用的样条形式，在节点处保持二阶导数连续。

光滑性条件： - 函数值连续：$f_j(\xi_j) = f_{j+1}(\xi_j)$ - 一阶导数连续：$f_j'(\xi_j) = f_{j+1}'(\xi_j)$ - 二阶导数连续：$f_j''(\xi_j) = f_{j+1}''(\xi_j)$

基函数表示： 使用截断幂基： $$
f(x) = \beta_0 + \beta_1 x + \beta_2 x^2 + \beta_3 x^3 + \sum_{k=1}^K \theta_k (x - \xi_k)_+^3
$$

### 7.3.3 B样条基函数

B样条提供了数值稳定性更好的基函数表示。

递归定义： $$
B_{i,1}(x) = \begin{cases}
1 & \text{if } t_i \leq x < t_{i+1} \\
0 & \text{otherwise}
\end{cases}
$$

$$
B_{i,k}(x) = \frac{x - t_i}{t_{i+k-1} - t_i}B_{i,k-1}(x) + \frac{t_{i+k} - x}{t_{i+k} - t_{i+1}}B_{i+1,k-1}(x)
$$

B样条性质： - 局部支撑性 - 非负性 - 单位分解性 - 数值稳定性

### 7.3.4 自然样条

自然样条在边界区域施加线性约束，提高外推稳定性。

边界条件： $$
f''(\xi_1) = f''(\xi_K) = 0
$$

## 7.4 平滑样条

### 7.4.1 惩罚最小二乘框架

平滑样条通过惩罚函数粗糙度来自动控制光滑度。

目标函数： $$
\min_f \left\{ \sum_{i=1}^n (y_i - f(x_i))^2 + \lambda \int [f''(x)]^2 dx \right\}
$$

光滑参数 $\lambda$ 的作用： - $\lambda \to 0$：插值函数，可能过拟合 - $\lambda \to \infty$：线性函数，可能欠拟合

### 7.4.2 光滑参数选择

广义交叉验证： $$
GCV(\lambda) = \frac{\frac{1}{n}\sum_{i=1}^n (y_i - \hat{f}_\lambda(x_i))^2}{[1 - \text{tr}(\mathbf{S}_\lambda)/n]^2}
$$

有效自由度： $$
df_\lambda = \text{tr}(\mathbf{S}_\lambda)
$$

## 7.5 多元扩展

### 7.5.1 可加模型

可加模型将多元非线性关系分解为单变量函数的和。

模型形式： $$
y_i = \beta_0 + \sum_{j=1}^p f_j(x_{ij}) + \varepsilon_i
$$

Backfitting算法：通过循环更新每个 $f_j$ 来估计模型。

### 7.5.2 薄板样条

薄板样条是平滑样条在多元情况下的推广。

惩罚项： $$
J_m(f) = \int \int \left( \frac{\partial^2 f}{\partial x_1^2} \right)^2 + 2\left( \frac{\partial^2 f}{\partial x_1 \partial x_2} \right)^2 + \left( \frac{\partial^2 f}{\partial x_2^2} \right)^2 dx_1 dx_2
$$

## 7.6 案例分析

## 本章总结

核心公式回顾

1.  多项式回归：$y_i = \beta_0 + \beta_1 x_i + \beta_2 x_i^2 + \cdots + \beta_d x_i^d + \varepsilon_i$
2.  正交多项式条件：$\sum_{i=1}^n Q_j(x_i)Q_k(x_i) = 0$（$j \neq k$）
3.  Box-Cox变换：$y^{(\lambda)} = \frac{y^\lambda - 1}{\lambda}$（$\lambda \neq 0$）
4.  样条光滑条件：$f_j^{(m)}(\xi_j) = f_{j+1}^{(m)}(\xi_j)$（$m=0,1,2$）
5.  平滑样条目标函数：$\min_f \left\{ \sum (y_i - f(x_i))^2 + \lambda \int [f''(x)]^2 dx \right\}$

方法比较与选择指南

| 方法类型   | 适用场景       | 优势                     | 局限性                 |
|------------------|--------------------|------------------|------------------|
| 多项式回归 | 光滑的全局趋势 | 简单直观，易于解释       | 不够灵活，外推性能差   |
| 正交多项式 | 高阶多项式拟合 | 数值稳定，系数独立       | 需要专门的基函数构造   |
| 样条回归   | 局部变化复杂   | 灵活性高，适应性强       | 需要选择节点位置       |
| 平滑样条   | 自动光滑度控制 | 无需选择节点，理论性质好 | 计算量较大，解释性稍差 |

重要概念体系

1.  基函数展开：用基函数的线性组合逼近复杂函数关系
2.  正交性原理：通过正交化改善数值稳定性和统计性质
3.  分段多项式：在不同区间使用不同的多项式逼近
4.  光滑性条件：在分段连接处施加连续性约束
5.  惩罚回归：通过惩罚项控制模型复杂度
6.  偏差-方差权衡：在模型复杂度和预测精度间寻求平衡

实践指导原则

1.  从简到繁：先尝试低阶多项式，再考虑更复杂的方法
2.  模型验证：使用交叉验证评估模型泛化能力
3.  数值稳定性：高阶多项式务必使用正交多项式形式
4.  领域知识：结合实际问题背景选择合适的方法
5.  可视化诊断：通过残差图和拟合曲线评估模型 adequacy

多项式回归和样条回归为处理非线性关系提供了系统的框架，它们在线性模型的基础上通过基函数扩展来捕捉复杂的数据模式。理解这些方法的原理和适用条件，对于建立有效的预测模型具有重要意义。
